!function(){"use strict";class e{static on(e,t,a){this.eventDispatcher.on(e,t,a)}static event(e,t){this.eventDispatcher.event(e,t)}static off(e,t,a){this.eventDispatcher.off(e,t,a)}static offAllCaller(e){this.eventDispatcher.offAllCaller(e)}}var t,a,i,o,s,n,r,l,h,d;e.eventDispatcher=new Laya.EventDispatcher,function(e){e.Load="scenes/Load.scene",e.Home="scenes/Home.scene",e.Game="scenes/Game.scene",e.Over="scenes/Over.scene"}(t||(t={})),function(e){e.SubPackage="分包",e.Scene3D="3D场景"}(a||(a={})),function(e){e.Scene_GoHome="Scene_GoHome",e.Scene_GoGame="Scene_GoGame",e.Scene_GoOver="Scene_GoOver",e.Progress_Load_Update="Progress_Load_Update",e.Platform_Wake_Do="Platform_Wake_Do",e.Platform_Hide_Do="Platform_Hide_Do",e.Game_Coin_Update="Game_Coin_Update",e.Game_Sold_Event="Game_Sold_Event",e.Game_SkinChange_Event="Game_SkinChange_Event"}(i||(i={})),function(e){e.Bgm="Bgm",e.Button="Button",e.Get="Get",e.Pour="Pour",e.Lid="Lid",e.Sleeve="Sleeve",e.Upgrade="Upgrade",e.Sell="Sell",e.Obstacle="Obstacle",e.Hand="Hand",e.RaiseMoney="RaiseMoney",e.Win="Win",e.GetMoney="GetMoney"}(o||(o={})),function(e){e.Item_Cup="Item_Cup"}(s||(s={})),function(e){e[e.Cup=0]="Cup",e[e.Coffee=1]="Coffee",e[e.level1=2]="level1",e[e.level2=3]="level2"}(n||(n={})),function(e){e.Obs_Cup="Obs_Cup",e.Coffee1="Coffee1",e.Coffee2="Coffee2",e.Lid="Lid",e.Sleeve="Sleeve",e.Door="Door",e.Sell="Sell",e.Obs1="Obs1",e.Obs2="Obs2",e.Obs3="Obs3",e.Obs4="Obs4",e.HandModel="HandModel",e.Road2="Road2",e.Road3="Road3",e.Road4="Road4",e.Road5="Road5",e.Road6="Road6"}(r||(r={}));class c{constructor(){this.isSubPackage=!0,this.isVibrate=!0}init(){c.instance=this}loadSubPackage(e,t){if(this.platformApi&&this.isSubPackage){this.platformApi.loadSubpackage({name:e,success:function(a){console.log("分包加载成功：",e),t.call(!0,a)},fail:function(a){console.error("分包加载失败：",e,JSON.stringify(a)),t.call(!1,a)}})}else console.log("没有平台API"),t(!0)}showToast(e,t=1e3){console.log(e,t.toString()+"ms")}vibrateShort(){this.platformApi&&this.isVibrate&&this.platformApi.vibrateShort()}vibrateLong(){this.platformApi&&this.isVibrate&&this.platformApi.vibrateLong()}regisiterCallback(){this.platformApi&&(this.platformApi.offShow(this.onShowEvent),this.platformApi.onShow(this.onShowEvent),this.platformApi.offHide(this.onHideEvent),this.platformApi.onHide(this.onHideEvent))}onShowEvent(t){e.event(i.Platform_Wake_Do,t)}onHideEvent(t){e.event(i.Platform_Hide_Do,t)}showVideo(e,t){this.showToast("无视频，默认发放奖励"),e&&e()}}class y{static set nowItem1Index(e){e<0&&(e=0),e>5&&(e=5),this._nowItem1Index=e}static get nowItem1Index(){return this._nowItem1Index}static set nowItem2Index(e){e<0&&(e=0),e>5&&(e=5),this._nowItem2Index=e}static get nowItem2Index(){return this._nowItem2Index}static set nowHandIndex(e){e<0&&(e=0),e>5&&(e=5),this._nowHandIndex=e}static get nowHandIndex(){return this._nowHandIndex}static soldDeal(e){let t=0;return t+=1,e.itemState>=n.Coffee&&(t+=1),e.itemState>=n.level1&&(t+=2),e.itemState>=n.level2&&(t+=2),e.isLib&&(t+=1),e.isSleeve&&(t+=1),t}}y.itemSize=1.25,y.coinUrl="ui/game/money.png",y.road2Height=.63,y.road3Height=.312,y._nowItem1Index=0,y._nowItem2Index=0,y._nowHandIndex=0,y.itemUnlockData=[[-1,200,400,600,1,1],[-1,300,500,800,1,1],[-1,500,1e3,1500,2,2]];class m{static AddGrade(){let e=this.GetPlayerData();e.grade++,parseInt(e.grade)>99&&(e.grade=99),this.SavePlayerData(e)}static ReadGrade(){let e=this.GetPlayerData();return parseInt(e.grade)}static changeSkinsData(e){let t=this.GetPlayerData();t.skinsData=e,this.SavePlayerData(t)}static readSkinsData(){return this.GetPlayerData().skinsData}static readNowSkinData(){return this.GetPlayerData().nowSkinsData}static changeNowSkinData(e){let t=this.GetPlayerData();t.nowSkinsData=e,this.SavePlayerData(t)}static AddCoin(t){let a=this.GetPlayerData();a.coin+=t,a.coin>99999&&(a.coin=99999),Math.floor(a.coin),this.SavePlayerData(a),e.event(i.Game_Coin_Update)}static CostCoin(e){let t=!1;return this.ReadCoin()>=e?(this.AddCoin(-e),t=!0):c.instance.showToast("金币不足"),t}static ReadCoin(){let e=this.GetPlayerData();return Math.floor(e.coin)}static ReadHighScore(){return this.GetPlayerData().highScore}static WriteHighScore(e){let t=this.GetPlayerData();e>t.highScore?(t.highScore=e,this.SavePlayerData(t)):c.instance.showToast("输入值"+e.toString()+"不是最高分最高分是"+t.highScore)}static GetPlayerData(){let e;return(e=Laya.LocalStorage.getJSON("PlayerData"))||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),e)}static SavePlayerData(e){Laya.LocalStorage.setJSON("PlayerData",e)}static ClearPlayerData(){Laya.LocalStorage.clear()}static CheckPlayerData(){let e;(e=Laya.LocalStorage.getJSON("PlayerData"))&&e.ver&&e.ver==this.data.ver||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),console.log("触发存档重置条件")),console.log(this.GetPlayerData())}}m.data={ver:"CoffeeRun_0.2.2",grade:1,coin:0,skinsData:y.itemUnlockData,nowSkinsData:[0,0,0],highScore:0};class g extends Laya.Scene{onAwake(){this.size(Laya.stage.width,Laya.stage.height),this.init(),this.initEvent()}onClosed(){e.offAllCaller(this),Laya.timer.clearAll(this)}init(){}initEvent(){}}class u extends g{init(){u.instance=this,this.updateCoinUI(),this.stageValue.value=m.ReadGrade().toString()}initEvent(){e.on(i.Game_Coin_Update,this,this.updateCoinUI)}updateCoinUI(){this.coinValue.value=m.ReadCoin().toString()}}class p{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(e){return Math.round(10*e)}toTween(e,t,a,i,o,s=!0){if(this.target=e,this.isLocal=s,e&&!e.destroyed){var n={},r={};if(t.pos){var l=s?e.transform.localPosition.clone():e.transform.position.clone();n.posX=l.x,n.posY=l.y,n.posZ=l.z,r.posX=t.pos.x,r.posY=t.pos.y,r.posZ=t.pos.z}if(t.rot){var h=s?e.transform.localRotation.clone():e.transform.rotation.clone();n.rotX=h.x,n.rotY=h.y,n.rotZ=h.z,n.rotW=h.w,r.rotX=t.rot.x,r.rotY=t.rot.y,r.rotZ=t.rot.z,r.rotW=t.rot.w}if(t.sca){var d=e.transform.getWorldLossyScale().clone();n.scaX=d.x,n.scaY=d.y,n.scaZ=d.z,r.scaX=t.sca.x,r.scaY=t.sca.y,r.scaZ=t.sca.z}this.tween.to(n,{posX:r.posX,posY:r.posY,posZ:r.posZ,rotX:r.rotX,rotY:r.rotY,rotZ:r.rotZ,rotW:r.rotW,scaX:r.scaX,scaY:r.scaY,scaZ:r.scaZ},a,o,Laya.Handler.create(this,()=>{i&&i();var t=this.tweens.shift();e&&!e.destroyed&&(t?this.toTween(this.target,t.value,t.time,t.completeFun,o):this.updateTweenCallback&&(this.updateTweenCallback=null))}));var c=0;return this.tween.update=new Laya.Handler(this,()=>{if(!e||e.destroyed)return;let i=(c+=Laya.timer.delta)/a;i>1&&(i=1),t.pos&&(s?e.transform.localPosition=new Laya.Vector3(n.posX,n.posY,n.posZ):e.transform.position=new Laya.Vector3(n.posX,n.posY,n.posZ)),t.rot&&(s?e.transform.localRotation=new Laya.Quaternion(n.rotX,n.rotY,n.rotZ,n.rotW):e.transform.rotation=new Laya.Quaternion(n.rotX,n.rotY,n.rotZ,n.rotW)),t.sca&&e.transform.setWorldLossyScale(new Laya.Vector3(n.scaX,n.scaY,n.scaZ)),this.updateTweenCallback&&this.updateTweenCallback(i)}),this}}clearTween(e){this.tweens=[],this.tween.clear(),this.target&&e&&(e.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z):this.target.transform.position=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z)),e.rot&&(this.target.transform.rotation=new Laya.Quaternion(e.rot.x,e.rot.y,e.rot.z,e.rot.w)),e.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(e.sca.x,e.sca.y,e.sca.z)))}then(e,t,a){return this.tweens.push({value:e,time:t,completeFun:a}),this}toScaleTween(e,t,a,i,o,s=Laya.Ease.elasticOut){e&&!e.destroyed&&(e.transform.localScale=t,this.toTween(e,{sca:a},i,o,s))}}class f extends Laya.Script3D{onAwake(){this.self=this.owner,this.selfTween=new p,this.init()}init(...e){}onDestroy(){Laya.timer.clearAll(this),this.selfTween.clearTween(),e.offAllCaller(this)}tweenBornDo(){let e=this.selfTween;e.clearTween(),this.self.transform.localScale=new Laya.Vector3(0,0,0),e.toTween(this.self,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut)}}class C extends f{constructor(){super(...arguments),this.forwardSpeed_Data=1,this.speedAxis=1,this.isCamCtrl=!0,this.isMove=!1,this.axis=0,this.horizontal=0,this.modelMoveRange=8,this.camPointMoveRange=4,this.forwardSpeed=0,this.horizontalSensity=.12,this.forwardSensity=.15,this.wayAxis=0,this.targetYpos=0,this.targetHorizontal=0,this.inHorizontal=0}init(){C.instance=this,this.player=this.self,this.model=this.player.getChildByName("Model"),this.camPoint=this.player.getChildByName("CamPoint"),this.startCamPoint=this.player.getChildByName("CamStartPoint"),this.endCamPoint=this.player.getChildByName("CamEndPoint"),this.forwardSpeed=this.forwardSpeed_Data}reset(e,t){this.axis=e,this.horizontal=t,this.targetHorizontal=t,this.speedAxis=1;let a=this.player.transform.localPosition.clone();a.z=this.axis,this.player.transform.localPosition=a;let i=this.model.transform.localPosition.clone();i.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=i;let o=this.camPoint.transform.localPosition.clone();o.x=-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=o;let s=this.player.transform.position.clone();s.y=0,this.targetYpos=0,this.player.transform.position=s}onUpdate(){let e=Laya.timer.delta/16;this.forwardSpeed>=0?this.isMove&&(this.axis+=this.forwardSpeed*this.forwardSensity*e*this.speedAxis):this.forwardSpeed<0&&(this.axis+=this.forwardSpeed*this.forwardSensity*e*this.speedAxis),this.wayAxis=this.targetHorizontal-this.horizontal,this.horizontal+=this.wayAxis*this.horizontalSensity*e;let t=this.player.transform.localPosition.clone();t.z=this.axis,this.isMove&&(this.player.transform.localPosition=t);let a=this.model.transform.localPosition.clone();if(a.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=a,this.isCamCtrl){let e=this.camPoint.transform.localPosition.clone();e.x=this.startCamPoint.transform.localPosition.x-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=e}if(this.isMove){let e=this.player.transform.position.clone(),t=Laya.timer.delta/1e3*15;t>1&&(t=1),e.y=Laya.MathUtil.lerp(e.y,this.targetYpos,t),this.player.transform.position=e}}changeHegiht(e){this.targetYpos=e}checkWay(e){let t=!1;return this.targetHorizontal=this.inHorizontal+e,this.targetHorizontal>.5?(this.targetHorizontal=.5,this.checkOut(),t=!0):this.targetHorizontal<-.5&&(this.targetHorizontal=-.5,this.checkOut(),t=!0),t}checkOut(){this.inHorizontal=this.targetHorizontal}Hit(){this.forwardSpeed=-1,Laya.timer.frameLoop(1,this,this.HitUpdate)}HitUpdate(){this.forwardSpeed+=.1*Laya.timer.delta/16,this.forwardSpeed>=this.forwardSpeed_Data&&(Laya.timer.clear(this,this.HitUpdate),this.forwardSpeed=this.forwardSpeed_Data)}onDisable(){}}class w{static init(){for(var t in this._soundCtx={},this._soundFile=[],this.loopSounds=[],o){let e=o[t];this._soundFile.push(e)}console.log("音效：",this._soundFile);let a=this._pathRoot,s="",n=this._soundFile,r=this._soundFile.length;for(let e=0;e<r;++e){s=n[e];let t=new Laya.SoundChannel;t.url=a+s+this.soundType,Laya.SoundManager.addChannel(t),this._soundCtx[s]=!0}Laya.SoundManager.autoStopMusic=!0,e.on(i.Platform_Wake_Do,this,this.randomPlayMusic),Laya.timer.once(1e3,this,this.randomPlayMusic)}static setSoundVolume(e,t){this._soundCtx[e]&&Laya.SoundManager.setSoundVolume(t,this._pathRoot+e+this.soundType)}static play(e,t=!1){if(this._soundCtx[e])return t&&-1==this.loopSounds.indexOf(e)?(this.loopSounds.push(e),Laya.SoundManager.playSound(this._pathRoot+e+this.soundType,0)):Laya.SoundManager.playSound(this._pathRoot+e+this.soundType)}static stop(e,t=!1){if(this._soundCtx[e]){if(t){let t=this.loopSounds.indexOf(e);-1!=t&&this.loopSounds.splice(t,1)}Laya.SoundManager.stopSound(this._pathRoot+e+this.soundType)}}static playMusic(e){let t;return Laya.SoundManager.stopMusic(),e?(t=Laya.SoundManager.playMusic(this._pathRoot+e+this.soundType,0),this.currentBgm=e):t=this.currentBgm?Laya.SoundManager.playMusic(this._pathRoot+this.currentBgm+this.soundType,0):Laya.SoundManager.playMusic(this._pathRoot+o.Bgm+this.soundType,0),t}static stopMusic(){Laya.SoundManager.stopMusic()}static randomPlayMusic(){let e=o.Bgm;w.playMusic(e);Laya.timer.once(65e3,this,this.randomPlayMusic)}static soundSwitch(e){this.isSound=e,Laya.SoundManager.soundMuted=!this.isSound}static muiscSwitch(e){this.isMusic=e,Laya.SoundManager.musicMuted=!this.isMusic}static playSoundLimit(e){let t=!0;if(this.CDs[e]&&0!=this.CDs[e]&&(t=!1),t){let t=this.play(e);t&&(this.CDs[e]=200*t.duration),Laya.timer.once(this.CDs[e],this,()=>{this.CDs[e]=0})}}}w._pathRoot="res/sounds/",w.soundType=".mp3",w.isSound=!0,w.isMusic=!0,w.CDs={};class L{static add(e,t){var a=new Laya.Vector3;return Laya.Vector3.add(e,t,a),a.clone()}static subtract(e,t){var a=new Laya.Vector3;return Laya.Vector3.subtract(e,t,a),a.clone()}static mull(e,t){var a=new Laya.Vector3;return Laya.Vector3.scale(e,t,a),a.clone()}static dot(e,t){return Laya.Vector3.dot(e,t)}static cross(e,t){var a=new Laya.Vector3;return Laya.Vector3.cross(e,t,a),a.clone()}static normalized(e){var t=new Laya.Vector3;return Laya.Vector3.normalize(e,t),t.clone()}static distance(e,t){var a=L.subtract(e,t);return Laya.Vector3.scalarLength(a)}}class S{static d3_getSpritePosBySprite3DPoint(e,t,a=new Laya.Vector3(0,0,0)){var i=t.transform.position.clone();i.x+=a.x,i.y+=a.y,i.z+=a.z;var o=new Laya.Vector4;e.viewport.project(i,e.projectionViewMatrix,o);var s=new Laya.Vector2(o.x/Laya.stage.clientScaleX,o.y/Laya.stage.clientScaleY);return new Laya.Point(s.x,s.y)}static d3_FindNodeByName(e,t){let a=null,i=e=>{for(let o=0;o<e.numChildren;o++){if(e.getChildAt(o).name==t)return void(a=e.getChildAt(o));i(e.getChildAt(o))}};return i(e),a}static d3_FindNodeHasName(e,t){let a=null,i=e=>{for(let o=0;o<e.numChildren;o++){if(-1!=e.getChildAt(o).name.indexOf(t))return void(a=e.getChildAt(o));i(e.getChildAt(o))}};return i(e),a}static d3_switchAllMathInChildren(e,t){if(e.meshRenderer){let a=e.meshRenderer.material.clone();a.albedoColor=S.d3_getRgbByHex(t),e.meshRenderer.material=a}for(let a=0;a<e.numChildren;a++){let i=e.getChildAt(a);if(i.meshRenderer){let e=new Laya.BlinnPhongMaterial,a=S.d3_getRgbByHex(t);e.albedoColor=new Laya.Vector4(a.x,a.y,a.z,1),e.specularColor=new Laya.Vector4(0,0,0,1),i.meshRenderer.material=e}this.d3_switchAllMathInChildren(i,t)}}static d3_unactiveAllChildren(e){for(let t=0;t<e.numChildren;t++)e.getChildAt(t).active=!1}static d3_addChildNotMove(e,t){let a=e.transform.position.clone(),i=e.transform.rotation.clone();t.addChild(e),e.transform.position=a,e.transform.rotation=i}static d3_getRgbByHex(e){var t=[],a=[];let i=e.replace(/#/,"");if(3==i.length){for(var o=[],s=0;s<3;s++)o.push(i.charAt(s)+i.charAt(s));i=o.join("")}for(s=0;s<3;s++)t[s]="0x"+i.substr(2*s,2),a.push(parseInt(t[s]));return new Laya.Vector4(a[0]/255,a[1]/255,a[2]/255,0)}static d3_objectShake(e,t=1,a=.7){var i=t,o=1,s=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(i>0){var t=new Laya.Vector3;Laya.Vector3.scale((n=Math.random()>.5?Math.random():-Math.random(),r=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(n,r,0)),a,t),Laya.Vector3.add(s,t,t),e.transform.localPosition=t,i-=.02*o}else i=0,e.transform.localPosition=s,Laya.timer.clear(this,updateShake);var n,r})}static getAngle(e,t){var a=Laya.Vector3.dot(e,t),i=Laya.Vector3.scalarLength(e)*Laya.Vector3.scalarLength(t);if(0==i){if(e.z>t.z)return 0;if(e.z<t.z)return 180;if(e.y>t.y)return 90;if(e.y<t.y)return-90}var o=a/i;return o<-1&&(o=-1),o>1&&(o=1),180*Math.acos(o)/Math.PI}static getAngleUp(e,t,a){let i=S.getAngle(e,t),o=new Laya.Vector3;return Laya.Vector3.cross(t,e,o),S.getAngle(a,o)>90&&(i*=-1),i}static getProjection(e,t){let a=L.mull(t,L.dot(e,t));return L.subtract(e,a)}static d2_AddClickEvent(e,t,a,i,s=!1,n=!0,r=!0){e.offAllCaller(t);let l=e.scaleX,h=.9*l,d=!1;e.on(Laya.Event.MOUSE_DOWN,t,t=>{d=!0,r&&Laya.Tween.to(e,{scaleX:h,scaleY:h},60),s&&t.stopPropagation},i);e.on(Laya.Event.MOUSE_UP,t,i=>{0!=d&&(d=!1,s&&i.stopPropagation,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),a&&a.call(t,i),n&&w.play(o.Button))},i);e.on(Laya.Event.MOUSE_OUT,t,t=>{0!=d&&(d=!1,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),s&&t.stopPropagation)},i)}static getAngle2DWay(e,t){var a=Laya.Vector2.dot(e,t),i=Laya.Vector2.scalarLength(e)*Laya.Vector2.scalarLength(t),o=180*Math.acos(a/i)/Math.PI,s=e.x*t.y-t.x*e.y;return s>0?o*=1:s<0?o*=-1:o=0,o}static d2_numberLabelToast(e,t){let a=e>=0?this.greenColor:this.redColor,i=e>=0?"+":"-",o=S.d3_getSpritePosBySprite3DPoint(C.instance.mainCamera,t,new Laya.Vector3(0,.2,0));S.d2_labelToast(i+e+"$",a,Laya.stage,1,new Laya.Vector2(o.x,o.y))}static d2_coinCollectAnim(e,t,a,i,o=15,s=1,n=null,r=null){for(var l=o,h=0;h<o;h++){let o=Laya.Pool.getItemByClass("coin",Laya.Image);o.skin=e,o.x=t.x,o.y=t.y,o.scale(s,s),i.addChild(o);let h=300+100*Math.random()-50;Laya.Tween.to(o,{x:o.x+250*Math.random()-125,y:o.y+250*Math.random()-125},h),Laya.timer.once(h+50,this,function(){Laya.Tween.to(o,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){i.removeChild(o),Laya.Pool.recover("coin",o),l--,r&&r(),0==l&&n&&n(i)}))})}}static d2_coinCollectAnimAni(e,t,a,i,o=15,s=null){for(var n=o,r=0;r<o;r++){let o=Laya.Pool.getItemByClass("coinAnim",Laya.Clip);o.skin=e.skin,o.index=e.index,o.clipX=e.clipX,o.clipY=e.clipY,o.autoPlay=e.autoPlay,o.x=t.x,o.y=t.y,o.scale(.8,.8),i.addChild(o);let r=300+100*Math.random()-50;Laya.Tween.to(o,{x:o.x+250*Math.random()-125,y:o.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(o,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){i.removeChild(o),Laya.Pool.recover("coinAnim",o),0==--n&&s&&s(i)}))})}}static faceToast(e,t,a,i){let o=new Laya.Image(e);o.anchorX=.5,o.anchorY=.5,o.alpha=1,o.scaleX=.3,o.scaleY=.3,t.addChild(o),o.x=a.x,o.y=a.y,Laya.Tween.to(o,{x:i.x,y:i.y,alpha:.9},1e3,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{o&&!o.destroyed&&Laya.Tween.to(o,{x:i.x,y:i.y-100,alpha:0},1e3,null,Laya.Handler.create(this,()=>{o&&!o.destroyed&&o.destroy()}))}))}static d2_fontClipToast(e,t,a,i,o){if(!this.wordToastOk)return;let s=Laya.Pool.getItemByClass("fontClip_d2",Laya.FontClip);s.skin=e,s.sheet="0123456789",s.value=t,s.anchorX=.5,s.anchorY=.5,s.alpha=1,s.scaleX=i,s.scaleY=i,a.addChild(s),s.x=o.x,s.y=o.y;let n=new Laya.Vector2(o.x+(S.halfPercent()?S.randomInt(-100,-75):S.randomInt(75,100)),o.y-50);Laya.Tween.to(s,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(s,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{a.removeChild(s),Laya.Pool.recover("fontClip_d2",s)}))}))}static d2_imageToast(e,t,a){if(!this.wordToastOk)return;S.wordToastOk=!1;let i=new Laya.Image(e);i.anchorX=.5,i.anchorY=.5,i.alpha=1,t.addChild(i),i.top=300,i.centerX=0;i.scaleX=0,i.scaleY=0,Laya.Tween.to(i,{scaleX:1,scaleY:1},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{S.wordToastOk=!0,i&&!i.destroyed&&Laya.Tween.to(i,{top:200,alpha:0},500,null,Laya.Handler.create(this,()=>{i&&!i.destroyed&&i.destroy()}))}))}static d2_labelToast(e,t,a,i,o){let s=Laya.Pool.getItemByClass("label_d2",Laya.Label);s.text=e,s.color=t,s.anchorX=.5,s.anchorY=.5,s.alpha=1,s.scaleX=i,s.scaleY=i,s.font="Microsoft YaHei",s.fontSize=50,s.bold=!0,a.addChild(s),s.x=o.x,s.y=o.y;let n=new Laya.Vector2(o.x+(S.halfPercent()?S.randomInt(-100,-75):S.randomInt(75,100)),o.y-50);Laya.Tween.to(s,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(s,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{a.removeChild(s),Laya.Pool.recover("label_d2",s)}))}))}static clamp01(e){return e>1?1:e<0?0:e}static clamp(e,t,a){return e<t?t:e>a?a:e}static get getCurrentTime(){return(new Date).getTime()}static get getCurrentTime_Second(){return Math.floor(Date.parse((new Date).toString())/1e3)}static math_gcd(e,t){return 0==t?e:this.math_gcd(t,e%t)}static numberTo(e,t,a){return Math.abs(t-e)<a?e=t:e<t?e+=a:e>t&&(e-=a),e}static randomNumber(e,t){return e+(t-e)*Math.random()}static randomInt(e,t){return Math.floor(e+(t+1-e)*Math.random())}static halfPercent(){return Math.random()<.5}static percent(e){return Math.random()<e}static cloneArray(e){return[].concat(e)}static getRandomInArray(e){if(e.length){let t=Math.random()*e.length;return e[t=Math.floor(t)]}return console.error("传入错误参数,返回空"),null}static takeRandomInArray(e){if(e.length){let t=Math.random()*e.length,a=e[t=Math.floor(t)];return e.splice(t,1),a}return console.error("传入错误参数,返回空"),null}static randomArray(e){let t=new Array(e.length),a=t.length;for(let i=0;i<a;i++){let a=this.takeRandomInArray(e);t[i]=a}return t}static BoxCheck_2D_Normal(e,t,a,i,o,s,n,r){let l=o-e,h=s-t,d=Math.abs(h),c=Math.abs(l),y=(i+r)/2,m=(a+n)/2;return{isHit:d<y&&c<m,axisDis:c,axisRange:m,horizontalDis:d,horizontalRange:y,axisWay:l,horizontalWay:h}}static CircleCheck_2D(e,t,a,i,o,s){let n=Math.pow(e-i,2)+Math.pow(t-o,2),r=Math.pow(a+s,2);return{isHit:n<r,distancePow2:n,rangePow2:r}}}S.greenColor="#00FF00",S.redColor="#FF0000",S.wordToastOk=!0,function(e){e.start="touchStart",e.move="touchMove",e.end="touchEnd",e.getAxis="GetAxis",e.slideWay="slideWay",e.singleTouchStart="singleTouchStart",e.singleTouchMove="singleTouchMove",e.singleTouchEnd="singleTouchEnd",e.secondTouchStart="secondTouchStart",e.secondTouchMove="secondTouchMove",e.secondTouchEnd="secondTouchEnd",e.getAxisAlways="getAxisAlways",e.keyDown="keyDown"}(l||(l={}));class v extends Laya.Script{constructor(){super(...arguments),this.isPressed=!1,this.hOriginal=0,this.vOriginal=0,this.hAxis=0,this.vAxis=0,this.outAxis=0,this.touchId=-1}onEnable(){v.instance=this}onMouseDown(t){e.event(l.start,[t])}onMouseMove(t){e.event(l.move,[t])}onMouseOut(t){e.event(l.end,[t])}onMouseOver(t){e.event(l.end,[t])}onMouseUp(t){e.event(l.end,[t])}}class b extends Laya.Script{constructor(){super(...arguments),this.calls=[],this.firstId=-1,this.secondId=-1,this.firstOriginalPoint=new Laya.Vector2,this.secondOriginalPoint=new Laya.Vector2,this.isSecond=!1,this.orignalHorizontal=0,this.orignalAxis=0,this.orignalHorizontalAlways=0,this.orignalAxisAlways=0,this.offset=new Laya.Vector3}onEnable(){e.on(l.start,this,this.onMouseDown),e.on(l.move,this,this.onMouseMove),e.on(l.end,this,this.onMouseUp)}onDisable(){e.off(l.start,this,this.onMouseDown),e.off(l.move,this,this.onMouseMove),e.off(l.end,this,this.onMouseUp)}onMouseDown(t){0==this.isSecond?-1==this.firstId?(this.checkOut(t),this.firstId=t.touchId,e.event(l.singleTouchStart,t),this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):this.firstId!=t.touchId&&-1==this.secondId&&(this.secondId=t.touchId,this.isSecond=!0,e.event(l.secondTouchStart,t),this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):-1==this.firstId?(this.firstId=t.touchId,this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):-1==this.secondId&&(this.secondId=t.touchId,this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),this.checkOutAlways(t)}onMouseMove(t){if(0==this.isSecond)t.touchId==this.firstId&&(this.checkWay(t),this.checkOut(t),e.event(l.singleTouchMove,t));else if(-1!=this.firstId&&-1!=this.secondId){let a,i={distance:0,angle:0},o=this.Vector2Reduce(this.secondOriginalPoint,this.firstOriginalPoint),s=Laya.Vector2.scalarLength(o);if(t.touchId==this.firstId?a=this.Vector2Reduce(this.secondOriginalPoint,new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):t.touchId==this.secondId&&(a=this.Vector2Reduce(new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height),this.firstOriginalPoint)),a){let t=Laya.Vector2.scalarLength(a);i.distance=t-s,i.angle=S.getAngle2DWay(o,a),e.event(l.secondTouchMove,i)}}t.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),t.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),this.checkWayAlways(t)}onMouseUp(t){this.checkOutAlways(t),t.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),t.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),0==this.isSecond?t.touchId==this.firstId&&(this.checkOut(t),e.event(l.singleTouchEnd,t),this.firstId=-1):(t.touchId==this.firstId&&(this.firstId=-1),t.touchId==this.secondId&&(this.secondId=-1),-1==this.firstId&&-1==this.secondId&&(this.isSecond=!1))}WayCheck(){let e=this.Vector2Reduce(this.nowPos,this.startPos);if(Laya.Vector2.scalarLength(e)>100){let t=Math.atan2(e.y,e.x)/Math.PI*180,a="none";t>-135&&t<-45?a="up":t>-45&&t<45?a="right":t<135&&t>45?a="down":(t<-135||t>135)&&(a="left"),this.isDown=!1}this.startPos=this.nowPos}onDestroy(){this.touchTimer&&clearTimeout(this.touchTimer)}checkWay(t){let a=t.stageX-this.orignalHorizontal,i=t.stageY-this.orignalAxis;e.event(l.getAxis,[{x:a,y:i}])}checkOut(e){this.orignalHorizontal=e.stageX,this.orignalAxis=e.stageY}checkWayAlways(t){let a=t.stageX/Laya.stage.width-this.orignalHorizontalAlways,i=t.stageY/Laya.stage.height-this.orignalAxisAlways;this.checkOutAlways(t),e.event(l.getAxisAlways,[{x:a,y:i}])}checkOutAlways(e){this.orignalHorizontalAlways=e.stageX/Laya.stage.width,this.orignalAxisAlways=e.stageY/Laya.stage.height}modelRotateControlDown(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);this.startPosition=e.clone(),this.prePosition=e.clone()}modelRotateControlMove(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);Laya.Vector3.subtract(e,this.prePosition,this.offset),this.prePosition=e.clone();var t=new Laya.Vector3(this.offset.x,this.offset.y,0);let a=new Laya.Vector3;Laya.Vector3.cross(t,new Laya.Vector3(0,0,1),a),Laya.Vector3.normalize(a,a)}modelRotateControlUp(){new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0)}onKeyDown(t){e.event(l.keyDown,t)}Vector2Reduce(e,t){return new Laya.Vector2(e.x-t.x,e.y-t.y)}}class x{static bornStageObj(e,t=this.mainScene){let a=this.prefabs.getChildByName(e);if(!a)return console.warn("生成物体不存在",e),null;let i=Laya.Sprite3D.instantiate(a,t);return i.transform.localPosition=new Laya.Vector3,this.stageObj.push(i),this.fxPool=[],i}static stageObjClear(){for(let e=this.stageObj.length-1;e>=0;e--)this.stageObj[e]&&!this.stageObj[e].destroyed&&this.stageObj[e].destroy();this.stageObj=[]}static bornFxDestroy(e,t,a=1e3,i=1,o=new Laya.Vector3){if(!this.isFxOn)return null;let s=this.fxs.getChildByName(e).clone();return t.addChild(s),s.transform.localPosition=o,s.transform.localRotationEuler=new Laya.Vector3,s.transform.localScale=new Laya.Vector3(i,i,i),Laya.timer.once(a,this,()=>{s.destroy()}),s}static bornFxFromPool(e,t,a=1e3,i=1,o=new Laya.Vector3){let s;for(let t=this.fxPool.length-1;t>=0;t--)if(this.fxPool[t].name==e){(s=this.fxPool.splice(t,1)[0]).active=!0;break}if(!s){let t=this.fxs.getChildByName(e);s=t.clone()}return t.addChild(s),this.stageObj.push(s),s.transform.localPosition=o,s.transform.localRotationEuler=new Laya.Vector3,s.transform.localScale=new Laya.Vector3(i,i,i),Laya.timer.once(a,this,()=>{s&&!s.destroyed&&(this.mainScene.addChild(s),s.active=!1,this.fxPool.push(s))}),s}static bornFxStage(e,t,a=1,i=new Laya.Vector3){let o=this.fxs.getChildByName(e).clone();return t.addChild(o),o.transform.localPosition=i,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(a,a,a),this.stageObj.push(o),o}}x.stageObj=[],x.isFxOn=!0,x.fxPool=[];class M extends f{constructor(){super(...arguments),this.yForceMin=1,this.yForceMax=2,this.xForceMin=.5,this.xForceMax=1,this.zForceMin=15,this.zForceMax=25,this.dir=new Laya.Vector3(0,1,0),this.gravity=0,this.yforce=0,this.xForce=0,this.zForce=0,this.rotate=new Laya.Vector3,this.dorpDeadY=-2,this.dropDeadChangeX=4,this.isDestory=!0,this.isActive=!0}init(){this.setData()}changeDropData(e,t,a,i,o,s){this.yForceMin=e.x,this.yForceMax=e.y,this.xForceMin=t.x,this.xForceMax=t.y,this.zForceMin=a.x,this.zForceMax=a.y,this.rotate=o,this.dir=i,this.gravity=s,this.setData()}setTimeDestroy(e=1e3){Laya.timer.once(e,this,()=>{this.self.destroy()})}setData(){this.xForce=S.randomNumber(this.xForceMin,this.xForceMax),this.yforce=S.randomNumber(this.yForceMin,this.yForceMax),this.zForce=S.randomNumber(this.zForceMin,this.zForceMax)}onUpdate(){if(!this.isActive)return;let e=Laya.timer.delta/1e3;this.yforce-=this.gravity*e;let t=this.self;t&&!t.destroyed&&(t.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*e,this.yforce*e,this.dir.z*this.zForce*e),!1),Math.abs(this.self.transform.position.x)>this.dropDeadChangeX&&(this.dorpDeadY=-19.5),this.self.transform.position.y<this.dorpDeadY&&(this.isDestory?this.self.destroy():this.isActive=!1))}}class P extends f{constructor(){super(...arguments),this.range=1,this.width=1,this.raidus=1,this.colliderActive=!0,this.isBullet=!1,this.itemState=n.Cup,this.isLib=!1,this.isSleeve=!1}init(...e){this.model=this.self.getChildAt(0).getChildByName("Model")}setData(e,t,a=!1){this.range=e,this.width=t,this.raidus=this.range>this.width?this.range:this.width,this.colliderActive=!0,this.isBullet=a}changeState(e){let t,a,i,o,s;this.self.getChildAt(0);this.itemState=e,S.d3_unactiveAllChildren(this.model);let r=0;switch(e){case n.Cup:case n.Coffee:r=0;break;case n.level1:r=1;break;case n.level2:r=2}switch(this.model.getChildAt(r).active=!0,a=(t=0==r?this.model.getChildAt(r):this.model.getChildAt(r).getChildAt(y.nowItem2Index)).getChildByName("Lid"),i=t.getChildByName("Name"),o=t.getChildByName("Sleeve"),s=t.getChildByName("Others"),a.active=this.isLib,o.active=this.isSleeve,i.active=!1,r){case 0:let e=s.getChildByName("Bardak");S.d3_unactiveAllChildren(e),e.getChildAt(y.nowItem1Index).active=!0,s.getChildByName("Coffee").active=this.itemState==n.Coffee;break;default:S.d3_unactiveAllChildren(t.parent),t.active=!0}(()=>{this.tweenBornDo()})()}addLid(){this.isLib=!0,w.playSoundLimit(o.Lid),this.changeState(this.itemState)}addSleeve(){this.isSleeve=!0,w.playSoundLimit(o.Sleeve),this.changeState(this.itemState)}changeHegiht(e){let t=this.self.transform.position.clone();t.y=e,this.self.transform.position=t}}class _ extends f{constructor(){super(...arguments),this.offsetX=0,this.offsetZ=0,this.itemLerpAxis=15,this.nowType=[]}init(...e){_.instance=this,this.items=this.self.getChildByName("Items"),this.model=this.self.getChildByName("Model"),this.size=y.itemSize}reset(){this.items.active=!0,this.nowType=[];for(let e=this.items.numChildren-1;e>=0;e--)this.items.getChildAt(e).destroy();for(let e=0;e<0;e++)this.addItem()}addItem(){let e=new Laya.Sprite3D("item");x.stageObj.push(e),this.items.addChild(e),e.transform.localPosition=new Laya.Vector3,x.bornStageObj(s.Item_Cup,e).transform.localPosition=new Laya.Vector3;let t=e.addComponent(P);t.setData(this.size,this.size),t.changeState(n.Cup),w.playSoundLimit(o.Get)}addOldItem(e){S.d3_addChildNotMove(e.self,this.items),e.self.transform.localPosition=new Laya.Vector3,e.self.getChildAt(0).getChildByName("Model").transform.rotation=new Laya.Quaternion,e.tweenBornDo(),w.playSoundLimit(o.Get)}onUpdate(){let e=Laya.timer.delta/1e3;e>.03&&(e=.03);let t,a=this.model.transform.position.clone();a.x+=this.offsetX,a.z+=this.offsetZ;for(let i=0;i<this.items.numChildren;i++)if((t=this.items.getChildAt(i))&&!t.destroyed){let o=new Laya.Vector3,s=0==i?1:e*this.itemLerpAxis;s>1&&(s=1),Laya.Vector3.lerp(t.transform.position.clone(),a,s,o),o.z=this.model.transform.position.z+this.offsetZ+i*this.size,t.transform.position=new Laya.Vector3(o.x,t.transform.position.clone().y,o.z),a=t.transform.position.clone()}}}class A extends M{constructor(){super(...arguments),this.isColliderActive=!1,this.isLandRotate=!0,this.hitGroundAxis=.6,this.blockAxis=.05}init(){super.init(),this.dorpDeadY=this.self.transform.position.clone().y,this.isDestory=!1,this.dropDeadChangeX=4.5+y.itemSize/2,this.isLandRotate=!0,this.isActive=!0,this.yforce=0,this.changeDropData(new Laya.Vector2(20,30),new Laya.Vector2(-7.5,7.5),new Laya.Vector2(15,30),new Laya.Vector3(1,1,1),new Laya.Vector3(S.randomNumber(-10,10),S.randomNumber(-10,10),S.randomNumber(-10,10)),125)}onUpdate(){let e=Laya.timer.delta/1e3;if(this.isActive){this.yforce-=this.gravity*e;let t=this.self;this.self.getChildAt(0).getChildByName("Model");if(t&&!t.destroyed&&(t.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*e,this.yforce*this.dir.y*e,this.dir.z*this.zForce*e),!1),Math.abs(this.self.transform.position.x)>this.dropDeadChangeX&&(this.dorpDeadY=-19.5,this.isDestory=!0),this.self.transform.position.y<=this.dorpDeadY))if(this.isColliderActive=!0,this.isDestory)this.self.destroy();else{let e=-(this.self.transform.position.y-this.dorpDeadY);this.yforce*=-this.hitGroundAxis,this.xForce*=this.hitGroundAxis,this.zForce*=this.hitGroundAxis,this.xForce+this.zForce+this.yforce<=this.blockAxis&&(this.isActive=!1),t.transform.position=new Laya.Vector3(this.self.transform.position.x,this.dorpDeadY+e,this.self.transform.position.z)}}}colliderDo(){this.isColliderActive&&(_.instance.addOldItem(this.self.getComponent(P)),c.instance.vibrateShort(),this.destroy())}}class k extends f{constructor(){super(...arguments),this.isCircle=!1,this.range=1,this.width=1,this.raidus=1,this.soundRange=100,this.colliderActive=!0,this.colliderSprite=[],this.obsType=r.Obs_Cup,this.rewardAdd=0,this.hasColliderObj=[],this.rotateSpeed=0,this.rotateRange=0}init(...e){}setData(t){this.obsType=t,this.isCircle=!1;let a=S.d3_FindNodeHasName(this.self,"collider");switch(this.range=parseFloat(a.name.split("_")[2]),this.width=parseFloat(a.name.split("_")[3]),this.raidus=(this.range+this.width)/2,this.raidus*=.5,this.colliderSprite.push(a),t){case r.Obs_Cup:S.d3_unactiveAllChildren(this.self),this.self.getChildAt(y.nowItem1Index).active=!0,e.on(i.Game_SkinChange_Event,this,()=>{S.d3_unactiveAllChildren(this.self),this.self.getChildAt(y.nowItem1Index).active=!0});break;case r.Coffee1:case r.Coffee2:case r.Lid:case r.Sleeve:case r.Door:case r.Sell:case r.Obs1:case r.Obs2:case r.Obs3:case r.Obs4:break;case r.HandModel:0!=this.self.transform.rotationEuler.y&&(this.self.transform.localScaleZ=-1);let o=S.randomInt(1,4);for(let e=1;e<=4;e++){let t="B"+e.toString(),a="TshirtB"+e.toString();S.d3_FindNodeByName(this.self,t).active=o==e,S.d3_FindNodeByName(this.self,a).active=o==e}break;case r.Road2:case r.Road3:this.roadPath=this.self.getChildByName("Path");break;case r.Road4:this.range-=y.itemSize,this.width-=y.itemSize;break;case r.Road5:this.roadPath=this.self.getChildByName("Path");break;case r.Road6:this.range-=y.itemSize,this.width-=y.itemSize;break;default:console.log("关卡物品预设里没有该类型物件",t)}}colliderDo(t=null,a){let s=()=>{this.colliderActive&&(this.self.active=!1,_.instance.addItem(),this.colliderActive=!1,c.instance.vibrateShort())},l=e=>{if(this.colliderActive)if(!t&&e)C.instance.Hit();else if(t&&-1==this.hasColliderObj.indexOf(t)){this.hasColliderObj.push(t);let e=t.self.transform.position.clone();x.dropItemsGrip.addChild(t.self),t.self.transform.position=e,t.self.addComponent(A),c.instance.vibrateShort(),w.playSoundLimit(o.Obstacle)}},h=()=>{if(this.colliderActive&&t&&-1==this.hasColliderObj.indexOf(t)){this.hasColliderObj.push(t),x.mainScene.addChild(t.self);let e=t.self.addComponent(M);e.dorpDeadY=-10,e.changeDropData(new Laya.Vector2(0,0),new Laya.Vector2(0,0),new Laya.Vector2(0,0),new Laya.Vector3(1,1,1),new Laya.Vector3(S.randomNumber(-10,10),S.randomNumber(-10,10),S.randomNumber(-10,10)),125),c.instance.vibrateShort(),w.playSoundLimit(o.Obstacle)}},d=e=>{if(this.colliderActive&&t&&-1==this.hasColliderObj.indexOf(t))switch(this.hasColliderObj.push(t),t.changeState(e),c.instance.vibrateShort(),e){case n.Coffee:w.playSoundLimit(o.Pour);break;case n.level1:case n.level2:w.playSoundLimit(o.Upgrade)}},g=()=>{if(this.colliderActive&&t&&-1==this.hasColliderObj.indexOf(t)){this.colliderActive=!1,this.hasColliderObj.push(t);let a=S.d3_FindNodeByName(this.self,"BuckTransform");a||(a=this.self),a.addChild(t.self),t.self.transform.localPosition=new Laya.Vector3,t.self.transform.localRotation=new Laya.Quaternion,c.instance.vibrateShort();let s=this.self.getComponent(Laya.Animator);if(s&&s.crossFade("take_coffee",.1,0,0),this.rewardAdd>0){let o=y.soldDeal(t);o+=this.rewardAdd;let s=S.d3_getSpritePosBySprite3DPoint(C.instance.mainCamera,a);S.d2_coinCollectAnim(y.coinUrl,new Laya.Vector2(s.x,s.y),new Laya.Vector2(u.instance.coinValue.x,u.instance.coinValue.y),u.instance.scene,o,1),m.AddCoin(o),e.event(i.Game_Sold_Event,o)}w.play(o.Hand)}},p=()=>{if(this.colliderActive&&t&&-1==this.hasColliderObj.indexOf(t)){let a;this.hasColliderObj.push(t),a||(a=this.self),a.addChild(t.self),c.instance.vibrateShort();let s=this.self.getChildByName("StartPos").transform.localPosition.clone(),n=this.self.getChildByName("EndPos").transform.localPosition.clone();t.self.transform.localPosition=s,t.selfTween.toTween(t.self,{pos:n},500,null,null,!0);let r=y.soldDeal(t),l=S.d3_getSpritePosBySprite3DPoint(C.instance.mainCamera,this.self.getChildByName("StartPos"));S.d2_coinCollectAnim(y.coinUrl,new Laya.Vector2(l.x,l.y),new Laya.Vector2(u.instance.coinValue.x,u.instance.coinValue.y),u.instance.scene,r,1),m.AddCoin(r),e.event(i.Game_Sold_Event,r),w.playSoundLimit(o.Sell)}},f=()=>{if(this.colliderActive&&t&&-1==this.hasColliderObj.indexOf(t)){this.hasColliderObj.push(t);let e=t.self.transform.localScale.clone();S.d3_addChildNotMove(t.self,x.mainScene),e.y=.1,t.self.transform.localScale=e,c.instance.vibrateShort(),w.playSoundLimit(o.Obstacle)}};if(-1==this.hasColliderObj.indexOf(t)){switch(this.obsType){case r.Obs_Cup:s();break;case r.Coffee1:case r.Coffee2:t&&t.itemState==n.Cup&&d(n.Coffee);break;case r.Lid:t&&t.itemState>=n.Coffee&&t.addLid();break;case r.Sleeve:t&&t.itemState>=n.Coffee&&t.addSleeve();break;case r.Door:if(t&&t.itemState>=n.Coffee){let e=t.itemState+1;e>n.level2&&(e=n.level2),d(e)}break;case r.Sell:p();break;case r.Obs1:l(!0);break;case r.Obs2:l(!1);break;case r.Obs3:l(!0);break;case r.Obs4:f();break;case r.HandModel:g();break;case r.Road2:this.changeHeight_Road2(t);break;case r.Road3:this.changeHeight_Road3(t);break;case r.Road4:h();break;case r.Road5:if(t){this.changeHeight_Road5(t),t.addSleeve(),this.self.getChildByName("Sleeve2_1").transform.localRotationEuler=new Laya.Vector3(0,-45,0),this.rotateSpeed=5}break;case r.Road6:h()}t&&this.hasColliderObj.push(t)}else switch(this.obsType){case r.Road2:this.changeHeight_Road2(t);break;case r.Road3:this.changeHeight_Road3(t);break;case r.Road5:this.changeHeight_Road5(t)}}colliderExit(e=null,t){switch(this.obsType){case r.Road2:this.changeHeight_Road2(e,!0);break;case r.Road3:this.changeHeight_Road3(e,!0);break;case r.Road5:this.changeHeight_Road5(e,!0)}let a=this.hasColliderObj.indexOf(e);this.hasColliderObj.splice(a,1)}changeHeight_Road2(e,t=!1){let a,i=this.roadPath.getChildAt(0).transform.position.clone(),o=this.roadPath.getChildAt(1).transform.position.clone(),s=((a=e?e.self.transform.position.clone():C.instance.player.transform.position.clone()).z-i.z)/(o.z-i.z);s=s>1?1:s;let n=Math.sin(Math.PI/2*s)*y.road2Height;a.y=i.y+n,t&&(a.y=o.y),e?e.changeHegiht(a.y):C.instance.changeHegiht(a.y)}changeHeight_Road3(e,t=!1){let a,i=this.roadPath.getChildAt(0).transform.position.clone(),o=this.roadPath.getChildAt(1).transform.position.clone(),s=(this.roadPath.getChildAt(2).transform.position.clone(),((a=e?e.self.transform.position.clone():C.instance.player.transform.position.clone()).z-i.z)/(o.z-i.z));s=s>1?1:s;let n=Math.sin(Math.PI/2*(s%.25))*y.road3Height;a.y=i.y+n,t&&(a.y=o.y),e?e.changeHegiht(a.y):C.instance.changeHegiht(a.y)}changeHeight_Road5(e,t=!1){let a,i,o=this.roadPath.getChildAt(0).transform.position.clone(),s=this.roadPath.getChildAt(2).transform.position.clone(),n=this.roadPath.getChildAt(1).transform.position.clone(),r=(a=e?e.self.transform.position.clone():C.instance.player.transform.position.clone()).z-o.z,l=n.z-o.z,h=s.z-n.z,d=r/l,c=!0;d>1&&(d=(r-=l)/h,c=!1),d=d>1?1:d,i=c?(n.y-o.y)*d:(s.y-n.y)*d,a.y=t?o.y:o.y+i,e?e.changeHegiht(a.y):C.instance.changeHegiht(a.y)}playLoopSound(e){this.loopSoundChannel&&!this.loopSoundChannel.isStopped||(this.loopSoundChannel=w.play(e,!0)),this.loopSoundChannel&&(this.loopSoundChannel.volume=w.isSound?1:0),Laya.timer.frameOnce(1,this,this.soundStop)}soundStop(){this.loopSoundChannel&&(this.loopSoundChannel.volume=0)}playCloseSound(e){let t=Math.abs(this.self.transform.position.z-C.instance.player.transform.position.z),a=t<this.soundRange?t/this.soundRange:1;this.loopSoundChannel&&!this.loopSoundChannel.isStopped||(this.loopSoundChannel=w.play(e,!0)),this.loopSoundChannel&&(this.loopSoundChannel.volume=w.isSound?1-a:0)}onUpdate(){switch(this.obsType){case r.Road5:let e=this.self.getChildByName("Sleeve2_1");if(this.rotateRange>=45)e.transform.localRotationEuler=new Laya.Vector3(0,-45,0);else{let t=Laya.timer.delta/1e3;this.rotateSpeed-=10*t,this.rotateSpeed<0&&(this.rotateSpeed=0),e.transform.rotate(new Laya.Vector3(0,-this.rotateSpeed,0),!0,!1),this.rotateRange+=this.rotateSpeed}}}}class D{static addLoadRes(e){this.loadingList.push(e),this.loadingCount++}static removeLoadRes(t){let a=this.loadingList.indexOf(t);-1==a?console.log("完成了不存在的资源加载"):this.loadingList.splice(a,1),e.event(i.Progress_Load_Update)}}D.loadingList=[],D.loadingCount=0;class V extends Laya.Script{onAwake(){this.self=this.owner,this.init()}init(...e){}onDestroy(){Laya.timer.clearAll(this),e.offAllCaller(this)}}!function(e){e[e.has=0]="has",e[e.choose=1]="choose",e[e.coin=2]="coin",e[e.video=3]="video"}(h||(h={})),function(e){e[e.cup=0]="cup",e[e.hand=1]="hand",e[e.levelUp=2]="levelUp"}(d||(d={}));class I extends V{constructor(){super(...arguments),this.bgUrl=["ui/game/Shop/sd_bz_bj.png","ui/game/Shop/sd_sb_bj.png","ui/game/Shop/sd_ys_bj.png"],this.showUrl=["ui/game/Shop/sd_bz_zst.png","ui/game/Shop/sd_sb_zst.png","ui/game/Shop/sd_ys_zst.png"],this.itemUrl=["ui/game/Shop/skin.png","ui/game/Shop/skin_selected.png","ui/game/Shop/skin_buy.png","ui/game/Shop/skin_buy.png"],this.nowType=d.cup}init(){this.self.width=Laya.stage.width,this.self.height=Laya.stage.height,this.self.x=0,this.self.y=0,this.mainPanel=this.self.getChildByName("mainPanel"),this.closeBtn=this.self.getChildByName("closeBtn"),this.bg=this.self.getChildByName("bg"),this.showImage=this.self.getChildByName("showImage"),this.cupType=this.mainPanel.getChildByName("cupType"),this.handType=this.mainPanel.getChildByName("handType"),this.levelUpType=this.mainPanel.getChildByName("levelUpType"),this.nowType=d.cup,this.switchType(this.nowType),this.initEvent()}initEvent(){S.d2_AddClickEvent(this.closeBtn,this,this.onCloseClick),S.d2_AddClickEvent(this.cupType,this,this.switchType,[d.cup],!1,!0,!1),S.d2_AddClickEvent(this.handType,this,this.switchType,[d.hand],!1,!0,!1),S.d2_AddClickEvent(this.levelUpType,this,this.switchType,[d.levelUp],!1,!0,!1)}onCloseClick(){this.self.set_visible(!1),this.closeCB&&this.closeCB();let t=m.readNowSkinData();y.nowItem1Index=t[d.cup],y.nowItem2Index=t[d.levelUp],y.nowHandIndex=t[d.hand],e.event(i.Game_SkinChange_Event)}switchType(e){this.nowType=e;let t=this.cupType.getChildAt(0),a=this.handType.getChildAt(0),i=this.levelUpType.getChildAt(0);t.set_visible(!0),a.set_visible(!0),i.set_visible(!0),this.bg.skin=this.bgUrl[e],this.showImage.skin=this.showUrl[e];let o=m.readNowSkinData()[this.nowType];switch(this.nowChooseIndex=o,this.nowType){case d.cup:t.set_visible(!1);break;case d.hand:a.set_visible(!1);break;case d.levelUp:i.set_visible(!1);break;default:console.error("选择错误的类型",e)}this.initList(),this.updateShow()}initList(){this.list=this.mainPanel.getChildByName("list");let e=m.readSkinsData();this.list.selectEnable=!1,this.list.array=e[this.nowType],this.list.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.list.hScrollBarSkin="",this.list.repeatX=3,this.list.repeatY=2}onListRender(e,t){let a=e.getChildByName("Item"),i=a.getChildByName("icon"),o=a.getChildByName("coin"),s=a.getChildByName("video"),n=h.has;o.set_visible(!1),s.set_visible(!1);let r,l=m.readSkinsData()[this.nowType],c=m.readNowSkinData()[this.nowType],g=y.itemUnlockData[this.nowType][t];switch(-1==g||-1==l[t]?(n=h.has,c==t&&(n=h.choose)):g<10?n=h.video:g>=10&&(n=h.coin),this.nowType){case d.cup:i.skin="ui/game/Shop/Cup/buck"+(t+1)+".png";break;case d.hand:i.skin="ui/game/Shop/Hand/hand0"+t+".png";break;case d.levelUp:i.skin="ui/game/Shop/LevelUp/frap0"+(t+1)+".png"}switch(n){case h.coin:o.set_visible(!0),(r=o.getChildAt(0)).value=g.toString();break;case h.video:s.set_visible(!0),(r=s.getChildAt(0)).value=(g-l[t]).toString()+"/"+g.toString()}a.skin=this.itemUrl[n],a.scale(1,1),S.d2_AddClickEvent(a,this,this.clickEvent,[{id:t,type:this.nowType,unlockType:n,unlockCount:g}])}clickEvent(e){let t=e.id,a=e.type,i=e.unlockType,o=m.readSkinsData()[this.nowType][t],s=(e,t)=>{let a=m.readSkinsData();a[e][t]=-1,m.changeSkinsData(a),n(t)},n=e=>{this.nowChooseIndex=e;let t=m.readNowSkinData();t[this.nowType]=e,m.changeNowSkinData(t)};switch(i){case h.has:n(t);break;case h.choose:break;case h.coin:m.CostCoin(e.unlockCount)&&s(a,t);break;case h.video:c.instance.showVideo(()=>{o--;let e=m.readSkinsData();e[a][t]=o,m.changeSkinsData(e),o<=0&&s(a,t)},()=>{c.instance.showToast("视频解锁失败")})}this.updateShow(),this.list.refresh()}updateShow(){let e,t=this.nowChooseIndex;switch(this.nowType){case d.cup:e="ui/game/Shop/Cup/buck"+(t+1)+".png";break;case d.hand:e="ui/game/Shop/Hand/hand0"+t+".png";break;case d.levelUp:e="ui/game/Shop/LevelUp/frap0"+(t+1)+".png";break;default:e=""}this.showImage.getChildByName("icon").skin=e}}class T{constructor(){this.dropObjs=[],this.colliders=[],this.moneyCount=0,this.nowRound=0,this.playCount=0,this.levelScale=1,this.roadLength=50*this.levelScale,this.colliderRange=50,this.isWin=!1,this.isEnd=!1,this.isFxOn=!0,this.isObjToJson=!1,this.isBornStage=!0,this.isJsonBorn=!0,this.endColor1=["#6B49C1","#CD60F9","#FD636D","#FD9C69","#FED869","#6EF55B","#61BDFE","#5C84FE"],this.endColor2=["#7448B9","#F15FEE","#FF777B","#FED78C","#FEFF77","#A6FF7A","#66FEFF","#69B1FD"],this.endBoxColor=[["75A4FE","CBE5FE"],["2772EF","46E662"],["CBF8B7","17B721"],["FF7BDE","FFD1FF"],["FB47AA","DB8AFF"],["FFD4FF","A944D0"]],this.highBoxColor="FFE51C",this.isStart=!1,this.lastValue=0,this.isPressed=!1,this.orignal=0,T.instance=this,this.init()}init(){this.initEvent(),this.isJsonBorn&&this.readJson()}createShadow(e){e.shadowMode=Laya.ShadowMode.SoftLow,e.shadowDistance=50,e.shadowResolution=2048,e.shadowCascadesMode=Laya.ShadowCascadesMode.NoCascades,e.shadowNormalBias=.6,e.shadowStrength=.4}hideShadow(e){e.shadowMode=Laya.ShadowMode.None}useRetinalCanvas(){Laya.stage.useRetinalCanvas=!0}disabelRetinalCanvas(){Laya.stage.useRetinalCanvas=!1}setFog(e,t,a){t.enableFog=e,e&&(t.fogColor=a,t.fogStart=10,t.fogRange=30)}readJson(){D.addLoadRes("关卡");let e=["res/json/stageInfo.json"],t=()=>{Laya.loader.load(e,Laya.Handler.create(this,a=>{if(a){for(let t=0;t<e.length;t++)Laya.loader.load(e[t],Laya.Handler.create(this,e=>{switch(t){case 0:this.stageJson=e,this.allSet=[];for(let e=0;e<this.stageJson.length;e++){let t=this.stageJson[e].setInfo;for(let e=0;e<t.length;e++)this.allSet.push(t[e])}console.log(this.allSet),console.log(e);break;default:console.log(e)}}),null,Laya.Loader.JSON);D.removeLoadRes("关卡")}else console.log("load json fail,reload after 1s"),Laya.timer.once(1e3,this,t)}),null,Laya.Loader.JSON)};e.length>0&&t()}JsonV3(e,t){if(t){let a=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),o=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector3(a,i,o)}return new Laya.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z))}V3ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString()}}JsonV4(e,t){if(t){let a=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),o=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t),s=Math.round(parseFloat(e.w)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector4(a,i,o,s)}return new Laya.Vector4(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z),parseFloat(e.w))}V4ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString(),w:e.w.toString()}}firstIn(){console.log("首次进入处理"),x.mainScene=this.mainScene;for(let e=0;e<this.mainScene.numChildren;e++){let t=this.mainScene.getChildAt(e);switch(t.name){case"Prefabs":x.prefabs=t,x.prefabs.active=!1;break;case"Light":this.light=t;break;case"Fxs":x.fxs=t,Laya.timer.once(1e3,this,()=>{x.fxs.active=!1});break;case"Stage":this.stage=t,this.player=this.stage.getChildByName("Player"),this.runMoveComp=this.player.addComponent(C),this.itemsComp=this.player.addComponent(_),this.camPoint=this.player.getChildByName("CamPoint"),this.mainCam=this.camPoint.getChildByName("MainCam"),this.mainCamera=this.mainCam.getChildByName("Main Camera"),this.runMoveComp.mainCamera=this.mainCamera,this.start=this.stage.getChildByName("Start"),this.end=this.stage.getChildByName("End"),this.endMoneys=this.end.getChildByName("Money"),this.dropItemGrip=this.stage.getChildByName("DropItemGrip"),x.dropItemsGrip=this.dropItemGrip,x.dropItemsGrip=this.dropItemGrip,this.endBox=this.end.getChildByName("End_2").getChildByName("End_Box"),this.moneyGrip=this.end.getChildByName("End_2").getChildByName("MoneyGrip"),x.moneyGrip=this.moneyGrip}}this.useRetinalCanvas(),this.createShadow(this.light);for(let e=0;e<8;e++){let t=this.endMoneys.getChildAt(e);for(let a=0;a<t.numChildren;a++){let i=t.getChildAt(a),o=i.meshRenderer.material.clone();switch(a){case 0:o.albedoColor=S.d3_getRgbByHex(this.endColor1[e]),i.meshRenderer.material=o;break;case 1:o.albedoColor=S.d3_getRgbByHex(this.endColor2[e]),i.meshRenderer.material=o;break;case 2:let t="res/scene/Texture/Pland3_"+(e+1).toString()+".png";Laya.Texture2D.load(t,Laya.Handler.create(this,e=>{o.albedoTexture=e,i.meshRenderer.material=o}))}}}let t=this.endBox.getChildAt(0),a=t.getChildByName("word0"),o=t.getChildByName("word1"),s=t.getChildByName("number");a.active=!1,o.active=!1,s.transform.localPosition=new Laya.Vector3(.0375,.138,-.203);let n=t.meshRenderer.material.clone();n.albedoColor=S.d3_getRgbByHex(this.endBoxColor[0][0]),t.meshRenderer.material=n,this.numberDeal(s,10);let r=100-this.endBox.numChildren,l=this.endBox.numChildren;for(let e=l;e<l+r;e++){let a=t.clone();this.endBox.addChild(a),a.transform.localPosition=new Laya.Vector3(0,.275*e,0),s=a.getChildByName("number"),this.numberDeal(s,10+10*e);let i=a.meshRenderer.material.clone(),o=Math.floor(e/20),n=this.endBoxColor[o%this.endBoxColor.length];i.albedoColor=S.d3_getRgbByHex(n[e%2]),a.meshRenderer.material=i}let h=m.readNowSkinData();y.nowItem1Index=h[d.cup],y.nowItem2Index=h[d.levelUp],y.nowHandIndex=h[d.hand],e.event(i.Game_SkinChange_Event)}initEvent(){e.on(i.Game_Sold_Event,this,this.addMoenyCount),e.on(i.Game_SkinChange_Event,this,this.changeSkin)}levelInit(){this.isEnd=!1,this.isStart=!1,Laya.timer.clear(this,this.gameUpdate),x.stageObjClear(),this.dropObjs=[],this.colliders=[],this.nowRound=0,this.moneyCount=0,this.lastValue=0;let e=m.ReadGrade()-1,t=new Laya.Vector3,a=new Laya.Vector3(0,0,this.roadLength),i=L.add(t,a);this.start.transform.position=t;let o=this.isBornStage,s=this.isJsonBorn;if(o){let t,o,n,l=this.stage.getChildByName("Level");if(this.isObjToJson){let e=[];for(let t=0;t<l.numChildren;t++){let a=l.getChildAt(t),i={name:"",setInfo:[]};i.name=a.name;for(let e=0;e<a.numChildren;e++){let t=a.getChildAt(e),o={name:"",objInfo:[]};o.name=t.name;for(let e=0;e<t.numChildren;e++){let a=t.getChildAt(e),i=a.name,s=a.transform.localPosition.clone(),n=a.transform.rotation.clone(),r={name:i,pos:this.V3ToJson(s),rot:this.V4ToJson(n)};o.objInfo.push(r)}i.setInfo.push(o)}e.push(i)}console.log(JSON.stringify(e))}if(s)if(e>=this.stageJson.length){let t=Math.floor(e/5);(o=[]).push(this.allSet[S.randomInt(0,Math.floor(this.allSet.length/2))]),o.push(this.allSet[S.randomInt(1,Math.floor(this.allSet.length/2)+1)]);for(let e=0;e<t;e++)o.push(S.getRandomInArray(this.allSet));n=o.length}else n=(o=this.stageJson[e].setInfo).length;else t=e%(l=this.stage.getChildByName("Level")).numChildren,n=(o=l.getChildAt(t)).numChildren;for(let e=0;e<n;e++){let t,n;n=s?(t=o[e]).objInfo.length:(t=o.getChildAt(e)).numChildren;let l=new Laya.Sprite3D(t.name);this.stage.addChild(l),l.transform.position=i;let h=i;for(let e=0;e<n;e++){let o,n,d,c,m,g,u;if(s){n=(o=t.objInfo[e]).name.split(" ")[0];let a=this.JsonV3(o.pos);a.z*=this.levelScale,d=L.add(a,l.transform.position.clone()),c=this.JsonV4(o.rot)}else{n=(o=t.getChildAt(e)).name.split(" ")[0];let a=o.transform.localPosition.clone();a.z*=this.levelScale,d=L.add(a,l.transform.position.clone()),c=o.transform.rotation.clone()}let p=e=>{a=new Laya.Vector3(0,0,e),i=L.add(i,a)},f=e=>{(u=m.addComponent(k)).setData(e),g=this.colliderIndexJudge(d),this.colliders[g].push(u)};switch(m=x.bornStageObj(n,l),d.z<=h.z?d.y=l.transform.position.y:d.y=i.y,m.transform.position=d,m.transform.rotation=c,n){case"Road1":p(this.roadLength);break;case r.Road2:p(this.roadLength),i.y+=y.road2Height,h.z=d.z+21.85,Laya.timer.frameOnce(1,this,f,[n],!1);break;case r.Road3:case r.Road4:case r.Road5:case r.Road6:p(this.roadLength),Laya.timer.frameOnce(1,this,f,[n],!1);break;default:Laya.timer.frameOnce(1,this,f,[n],!1)}}}}else this.moneyCount=100;this.end.transform.position=i;let n=Math.ceil((i.z+this.roadLength)/this.colliderRange);for(let e=0;e<n;e++)this.colliders.push([]);let l=[1,3,5,7,10,12,15,20];for(let e=0;e<8;e++){let t=this.endMoneys.getChildAt(e),a=x.bornStageObj(r.HandModel,this.end),o=t.transform.position.clone();o.y=i.y,a.transform.position=o,a.transform.rotationEuler=e%2==0?new Laya.Vector3:new Laya.Vector3(0,180,0);let s=a.addComponent(k);s.setData(r.HandModel),s.rewardAdd=l[e];let n=this.colliderIndexJudge(o);this.colliders[n].push(s)}for(let e=0;e<this.endBox.numChildren;e++){let t=this.endBox.getChildAt(e);t.transform.localPosition=new Laya.Vector3(0,.275*e,0);let a=t.getChildByName("number"),i=t.getChildByName("word0"),o=t.getChildByName("word1");i.active=!1,o.active=!1,a.active=!0,this.numberDeal(a,10+10*e);let s=t.meshRenderer.material.clone(),n=Math.floor(e/20),r=this.endBoxColor[n%this.endBoxColor.length];s.albedoColor=S.d3_getRgbByHex(r[e%2]),t.meshRenderer.material=s,a.transform.localPosition=new Laya.Vector3(.0375,a.transform.localPosition.y,a.transform.localPosition.z)}this.player.transform.position=t,this.camPoint.transform.localPosition=this.runMoveComp.startCamPoint.transform.localPosition.clone(),this.camPoint.transform.localRotation=this.runMoveComp.startCamPoint.transform.localRotation.clone(),this.runMoveComp.reset(.75*this.roadLength*this.levelScale,0),this.runMoveComp.model.transform.localPosition=new Laya.Vector3(0,0,0),this.runMoveComp.model.transform.localRotationEuler=new Laya.Vector3(0,0,0),this.itemsComp.reset(),this.runMoveComp.isCamCtrl=!0,this.changeSkin(),Laya.timer.frameLoop(1,this,this.gameUpdate)}gameStart(){this.isStart=!0,this.controlOn(),this.roundInit(),this.playCount++,Laya.timer.loop(16,this,this.fixUpdate),this.runMoveComp.isMove=!0}levelEnd(t){this.isEnd=!0,this.isWin=t,Laya.timer.clear(this,this.fixUpdate),e.event(i.Scene_GoOver)}roundInit(){let e;switch(this.nowRound){case 0:break;case 1:u.instance.nowValue.set_visible(!1),this.runMoveComp.targetHorizontal=0,this.controlOff(),this.onMouseUp(),this.runMoveComp.isCamCtrl=!1,this.runMoveComp.speedAxis=2,(e=new p).toTween(this.camPoint,{pos:this.runMoveComp.endCamPoint.transform.localPosition.clone(),rot:this.runMoveComp.endCamPoint.transform.localRotation.clone()},1e3,()=>{},null,!0);break;case 2:this.runMoveComp.isMove=!1,this.runMoveComp.isCamCtrl=!1,this.moneyCount>9999&&(this.moneyCount=9999);let t=Math.floor(this.moneyCount/10)-1;t<0&&(t=0);let a=this.player.transform.position.clone();a.y+=2.75*t;let i=new p,s=550;t<=10&&(s=50+50*t);let n=this.moneyCount>m.ReadHighScore();n&&m.WriteHighScore(this.moneyCount);let r=this.endBox.getChildAt(t),l=r.getChildByName("number");this.numberDeal(l,this.moneyCount);let h=r.meshRenderer.material.clone();h.albedoColor=S.d3_getRgbByHex(this.highBoxColor),r.meshRenderer.material=h;let d=Math.floor(m.ReadHighScore()/10),c=this.endBox.getChildAt(d);(h=c.meshRenderer.material.clone()).albedoColor=S.d3_getRgbByHex(this.highBoxColor),c.meshRenderer.material=h,l=c.getChildByName("number"),this.numberDeal(l,m.ReadHighScore());let y=r.getChildByName("word0"),g=r.getChildByName("word1");l=r.getChildByName("number"),y.active=!0,y.transform.localPosition=new Laya.Vector3(.158,y.transform.localPosition.y,y.transform.localPosition.z),l.transform.localPosition=new Laya.Vector3(-.171,l.transform.localPosition.y,l.transform.localPosition.z),y=c.getChildByName("word0"),g=c.getChildByName("word1"),l=c.getChildByName("number"),y.active=!1,g.active=!0,g.transform.localPosition=new Laya.Vector3(.189,y.transform.localPosition.y,y.transform.localPosition.z),l.transform.localPosition=new Laya.Vector3(-.114,l.transform.localPosition.y,l.transform.localPosition.z);let f=this.nowModel.getComponent(Laya.Animator);f.crossFade("PlayerHand_Money_Default",.5,0,0),Laya.timer.once(500,this,()=>{w.play(o.RaiseMoney),i.toTween(this.player,{pos:a},s,()=>{let e=()=>{Laya.timer.once(1e3,this,()=>{this.roundEnd()})};if(n){let t=c.getChildByName("fx");f.crossFade("PlayerHand_Win_Default",.1,0,0),w.play(o.Win),x.bornFxDestroy("ConfettiFX",t,2e3),e()}else f.crossFade("PlayerHand_Win_Default",.1,0,0),w.play(o.Win),Laya.timer.once(1e3*f.getControllerLayer(0).getAnimatorState("PlayerHand_Win_Default").clip.duration()*.2,this,()=>{(a=this.camPoint.transform.position.clone()).y+=2.75*(d-t),i.toTween(this.camPoint,{pos:a},1e3,()=>{e()},Laya.Ease.expoInOut,!1)})},Laya.Ease.expoInOut,!1)});break;case 3:this.levelEnd(!0);break;default:console.log("多次触发跳关了")}}roundEnd(){this.isEnd||(this.nowRound++,this.roundInit())}gameUpdate(){Laya.timer.delta;let e=()=>{let e=S.d3_getSpritePosBySprite3DPoint(this.mainCamera,this.runMoveComp.model,new Laya.Vector3(1.5,0,0));if(u.instance){u.instance.nowValue.x=e.x,u.instance.nowValue.y=e.y;let t=0;for(let e=0;e<this.itemsComp.items.numChildren;e++){let a=this.itemsComp.items.getChildAt(e).getComponent(P);a&&(t+=y.soldDeal(a))}t!=this.lastValue&&(S.d2_numberLabelToast(t-this.lastValue,this.runMoveComp.model),this.lastValue=t),u.instance.nowValue.getChildAt(0).value=t.toString()}};switch(this.nowRound){case 0:this.player.transform.position.z>this.end.transform.position.z&&this.roundEnd(),e();break;case 1:this.runMoveComp.speedAxis=1.25;let t,a,i=this.end.transform.position.z+42,s=this.itemsComp.items,n=new Laya.Vector3;for(let e=s.numChildren-1;e>=0;e--)if((t=s.getChildAt(e))&&!t.destroyed&&(n=t.transform.position.clone()).z>i){a=t.getComponent(P),S.d3_addChildNotMove(t,x.mainScene);let e=y.soldDeal(a),i=S.d3_getSpritePosBySprite3DPoint(C.instance.mainCamera,t);S.d2_coinCollectAnim(y.coinUrl,new Laya.Vector2(i.x,i.y),new Laya.Vector2(u.instance.coinValue.x,u.instance.coinValue.y),u.instance.scene,e,1),m.AddCoin(e),this.moneyCount+=e,t.active=!1;let s=x.bornStageObj("Money_Deck_1",this.moneyGrip);s.transform.localPosition=new Laya.Vector3(0,.09*(this.moneyGrip.numChildren-1),0),s.addComponent(f).tweenBornDo(),c.instance.vibrateShort(),w.play(o.Get)}this.player.transform.position.z>i&&this.roundEnd();break;case 2:let r=Math.round((this.player.transform.position.y-2.75)/2.75);r<0&&(r=0);let l=r-Math.floor(this.moneyGrip.numChildren/3);for(let e=0;e<=l;e++)for(let t=0;t<3;t++){let a=x.bornStageObj("Money_Deck_1",this.moneyGrip);a.transform.localPosition=new Laya.Vector3(0,.275*(r+e)+.09*t,0),a.addComponent(f).tweenBornDo()}}}fixUpdate(){{this.nowRound;let e,t,a,i=this.itemsComp.items,o=new Laya.Vector3;if((o=this.runMoveComp.model.transform.position.clone()).z+=_.instance.offsetZ-y.itemSize,(a=this.colliderIndexJudge(o))>=0&&a<this.colliders.length)for(let e=0;e<this.colliders[a].length;e++){let t,i=this.colliders[a][e];for(let s=0;s<this.colliders[a][e].colliderSprite.length;s++){let n=this.colliders[a][e].colliderSprite[s];if(n&&!n.destroyed){let e=n.transform.position.clone();if((t=i.isCircle?S.CircleCheck_2D(o.z,o.x,y.itemSize/2,e.z,e.x,i.raidus):S.BoxCheck_2D_Normal(o.z,o.x,y.itemSize,y.itemSize,e.z,e.x,i.range,i.width)).isHit)break}}if(t&&t.isHit){i.colliderDo();break}}for(let s=0;s<i.numChildren;s++)if((e=i.getChildAt(s))&&!e.destroyed){if(o=e.transform.position.clone(),!(t=e.getComponent(P)).colliderActive)continue;if((a=this.colliderIndexJudge(o))>=0&&a<this.colliders.length)for(let e=0;e<this.colliders[a].length;e++){let i,s=this.colliders[a][e];for(let n=0;n<this.colliders[a][e].colliderSprite.length;n++){let r=this.colliders[a][e].colliderSprite[n];if(r&&!r.destroyed){let e=r.transform.position.clone();if((i=s.isCircle?S.CircleCheck_2D(o.z,o.x,t.raidus,e.z,e.x,s.raidus):S.BoxCheck_2D_Normal(o.z,o.x,t.range,t.width,e.z,e.x,s.range,s.width)).isHit)break}}if(i&&i.isHit){s.colliderDo(t);break}i&&!i.isHit&&-1!=s.hasColliderObj.indexOf(t)&&s.colliderExit(t)}}for(let s=0;s<this.dropItemGrip.numChildren;s++){let n=this.dropItemGrip.getChildAt(s);if(n&&!n.destroyed){let s=n.getComponent(A);if(s.isColliderActive){let r,l=n.transform.position.clone(),h=this.colliderIndexJudge(l);if(o=this.runMoveComp.model.transform.position.clone(),a=this.colliderIndexJudge(o),Math.abs(h-a)<=2&&(r=S.BoxCheck_2D_Normal(o.z,o.x,y.itemSize,y.itemSize,l.z,l.x,y.itemSize,y.itemSize)).isHit){s.colliderDo();break}for(let n=0;n<i.numChildren;n++)if((e=i.getChildAt(n))&&!e.destroyed){if(o=e.transform.position.clone(),!(t=e.getComponent(P)).colliderActive)continue;if(a=this.colliderIndexJudge(o),Math.abs(h-a)<=1&&(r=S.BoxCheck_2D_Normal(o.z,o.x,y.itemSize,y.itemSize,l.z,l.x,y.itemSize,y.itemSize)).isHit){s.colliderDo();break}}}}}}}colliderIndexJudge(e){return Math.floor((e.z-this.roadLength)/this.colliderRange)}changeSkin(){let e=this.runMoveComp.model;for(let t=0;t<e.numChildren;t++)e.getChildAt(t).active=t==y.nowHandIndex;this.nowModel=e.getChildAt(y.nowHandIndex);let t=this.nowModel;t.getComponent(Laya.Animator).play("PlayerHand_Idle_Default",0,0);let a=S.d3_FindNodeHasName(t,"Trail");this.nowTrail&&this.nowTrail.destroy(),this.nowTrail=x.bornFxStage("Trail",a)}addMoenyCount(e){this.moneyCount+=e}numberShow(e,t,a){let i=a%4*.25,o=.25*Math.floor(a/4),s=e.getChildAt(t),n=s.meshRenderer.material.clone(),r=new Laya.Vector4(1,1,i,-o);n.tilingOffset=r,s.meshRenderer.material=n}numberDeal(e,t){let a,i=Math.floor(t/1e3),o=Math.floor(t%1e3/100),s=Math.floor(t%100/10),n=Math.floor(t%10),r=(t,a)=>{this.numberShow(e,t,a)},l=1;switch(0!=i?(l=4,r(0,i),r(1,o),r(2,s)):0!=o?(l=3,r(1,o),r(2,s)):0!=s&&(l=2,r(2,s)),r(3,n),S.d3_unactiveAllChildren(e),l){case 1:(a=e.getChildAt(3)).transform.localPosition=new Laya.Vector3(-.0375,0,0),a.active=!0;break;case 2:for(let t=0;t<2;t++)(a=e.getChildAt(2+t)).transform.localPosition=new Laya.Vector3(0-.075*t,0,0),a.active=!0;break;case 3:for(let t=0;t<3;t++)(a=e.getChildAt(1+t)).transform.localPosition=new Laya.Vector3(.0375-.075*t,0,0),a.active=!0;break;case 4:for(let t=0;t<4;t++)(a=e.getChildAt(t)).transform.localPosition=new Laya.Vector3(.075-.075*t,0,0),a.active=!0}}controlOn(){e.on(l.singleTouchStart,this,this.onMouseDown),e.on(l.singleTouchMove,this,this.onMouseMove),e.on(l.singleTouchEnd,this,this.onMouseUp)}controlOff(){e.off(l.singleTouchStart,this,this.onMouseDown),e.off(l.singleTouchMove,this,this.onMouseMove),e.off(l.singleTouchEnd,this,this.onMouseUp)}onMouseDown(e){this.isPressed=!0,this.orignal=e.stageX/Laya.stage.width,this.runMoveComp&&this.runMoveComp.checkOut()}onMouseMove(e){if(this.isPressed){let t=e.stageX/Laya.stage.width-this.orignal;this.runMoveComp&&this.runMoveComp.checkWay(2*t)&&(this.orignal=e.stageX/Laya.stage.width)}}onMouseUp(){this.isPressed=!1,this.runMoveComp&&this.runMoveComp.checkOut()}}class B extends g{init(){this.updateCoinUI(),this.stageValue.value=m.ReadGrade().toString(),T.instance.playCount>0&&this.onBtnShopClick()}initEvent(){e.on(i.Game_Coin_Update,this,this.updateCoinUI),S.d2_AddClickEvent(this.btnStart,this,this.onBtnStartClick),S.d2_AddClickEvent(this.shopBtn,this,this.onBtnShopClick)}onBtnStartClick(){e.event(i.Scene_GoGame)}onBtnShopClick(){this.shopPanel.set_visible(!0)}updateCoinUI(){this.coinValue.value=m.ReadCoin().toString()}}class R extends V{init(...t){this.value=this.self.getChildByName("value"),this.coinUpdate(),e.on(i.Game_Coin_Update,this,this.coinUpdate)}coinUpdate(){this.value.value=m.ReadCoin().toString()}}class O{static toAlpha(e,t,a,i,o,s,n=!1,r=!1){function alpha1(){let t=r||n?new Laya.Handler(this,alpha2):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(e,{alpha:a},i,o,t)}function alpha2(){let a=r?new Laya.Handler(this,alpha1):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(e,{alpha:t},i,o,a)}e&&!e.destroyed&&(this.clearTween(e),e.alpha=t,alpha1())}static toScale(e,t,a,i,o,s,n=!1,r=!1){function scale1(){let t=r||n?new Laya.Handler(this,scale2):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(e,{scaleX:a,scaleY:a},i,o,t)}function scale2(){let a=r?new Laya.Handler(this,scale1):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(e,{scaleX:t,scaleY:t},i,o,a)}e&&!e.destroyed&&(this.clearTween(e),e.scale(t,t),scale1())}static toPosition(e,t,a,i,o,s=!1,n=0){if(!e||e.destroyed)return;this.clearTween(e);let r={},l={};function pos1(){if(s)var t=0==n?new Laya.Handler(this,pos2):new Laya.Handler(this,pos3);else t=new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,l,a,i,t)}function pos2(){Laya.Tween.to(e,r,a,i,Laya.Handler.create(this,pos1))}function pos3(){e.pos(r.x,r.y),pos1()}null!=t.x&&(r.x=e.x,l.x=t.x),null!=t.y&&(r.y=e.y,l.y=t.y),pos1()}static toRotaion(e,t,a,i,o,s=!1,n=!1){if(!e||e.destroyed)return;this.clearTween(e);let r=e.rotation,l=r+t,h=r-t+r;function rotate2(){Laya.Tween.to(e,{rotation:h},2*a,i,Laya.Handler.create(this,rotate3))}function rotate3(){Laya.Tween.to(e,{rotation:l},2*a,i,Laya.Handler.create(this,rotate2))}function rotate4(){let t=new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{rotation:r},a,i,t)}!function(){let t=n?new Laya.Handler(this,rotate2):s?new Laya.Handler(this,rotate4):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{rotation:l},a,i,t)}()}static showViewByScale(e,t,a=1,i=200){this.toScale(e,0,a,i,Laya.Ease.bounceOut,t,!0,!1)}static clearTween(e){Laya.Tween.clearAll(e)}}class H extends Laya.Script{constructor(){super(...arguments),this.delayTime=0}onEnable(){let e=this.owner,t=e.y;Laya.timer.once(this.delayTime,this,()=>{O.toPosition(e,{y:t+15},1e3,Laya.Ease.sineInOut,()=>{},!0)})}onDisable(){let e=this.owner;O.clearTween(e),Laya.timer.clearAll(this)}}class z extends g{init(){Laya.timer.frameOnce(1,this,this.loadProgressUpdate)}initEvent(){e.on(i.Progress_Load_Update,this,this.loadProgressUpdate)}loadProgressUpdate(){let t=D.loadingList;0==t.length?(console.log("加载完毕"),e.event(i.Scene_GoHome)):console.log("正在加载",t[0]),this.loadBar.value=(D.loadingCount-t.length)/D.loadingCount}}class N extends g{constructor(){super(...arguments),this.coinUrl="ui/game/money.png"}init(){this.updateCoinUI(),this.stageValue.value=m.ReadGrade().toString(),this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?5*T.instance.moneyCount:T.instance.moneyCount).toString(),O.toScale(this.icon,0,1,500,Laya.Ease.elasticOut),w.play(o.Win)}initEvent(){this.videoCheckBox.on("change",this,()=>{this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?5*T.instance.moneyCount:T.instance.moneyCount).toString()}),S.d2_AddClickEvent(this.btnContinue,this,this.onBtnContinueClick)}onBtnContinueClick(){let t=this,a=a=>{this.btnContinue.offAllCaller(this),a?m.AddCoin(5*T.instance.moneyCount):m.AddCoin(T.instance.moneyCount),t.updateCoinUI(),w.play(o.GetMoney),S.d2_coinCollectAnim(this.coinUrl,new Laya.Vector2(t.btnContinue.x,t.btnContinue.y),new Laya.Vector2(t.coinValue.x,t.coinValue.y),t.scene,10,1,()=>{T.instance.isWin&&m.AddGrade(),e.event(i.Scene_GoHome)})};this.videoCheckBox.selected?c.instance.showVideo(()=>{a(!0)},()=>{c.instance.showToast("未看完视频，没有奖励")}):a(!1)}updateCoinUI(){this.coinValue.value=m.ReadCoin().toString()}}class F{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("Scenes/Game.ts",u),e("Tools/ctrl/TouchCtrl.ts",b),e("Tools/ctrl/TouchScan.ts",v),e("Scenes/Home.ts",B),e("UIComps/CoinComp.ts",R),e("Tools/uiTween/PosUITween.ts",H),e("UIComps/ShopComp.ts",I),e("Scenes/Load.ts",z),e("Scenes/Over.ts",N)}}F.width=750,F.height=1334,F.scaleMode="fixedwidth",F.screenMode="vertical",F.alignV="middle",F.alignH="center",F.startScene="scenes/Game.scene",F.sceneRoot="",F.debug=!1,F.stat=!1,F.physicsDebug=!1,F.exportSceneToJson=!0,F.init();class E extends c{init(){super.init(),this.platformApi=Laya.Browser.window.wx,this.showShareMenuWithTicket(!0),this.regisiterWXShareCallback()}showToast(e,t=1500){Laya.Browser.window.wx.showToast({title:e,icon:"none",duration:t})}showShareMenuWithTicket(e){wx.showShareMenu({withShareTicket:e,success:function(){},fail:function(){},complete:function(){}})}regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var e={title:"分享",image:""};Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:e.title,imageUrl:e.image,query:"share_id=1"}})}}}class U{static init(){this.isStatShow&&Laya.Stat.show(),this.game=new T,this.goLoad(),D.addLoadRes(a.SubPackage),D.addLoadRes(a.Scene3D),w.init(),m.CheckPlayerData(),Laya.Browser.onWeiXin?this.platform=new E:this.platform=new c,this.platform.init();this.platform.loadSubPackage(this.subPackageName,e=>{e&&(D.removeLoadRes(a.SubPackage),this.load3DRes(this.scene3DUrl))})}static sceneEventOn(){e.on(i.Scene_GoHome,this,this.goHome),e.on(i.Scene_GoGame,this,this.goGame),e.on(i.Scene_GoOver,this,this.goOver)}static goLoad(){this.sceneEventOn(),this.openScene(t.Load)}static goHome(){this.closeScene(t.Load),this.closeScene(t.Over),this.openScene(t.Home),this.game.levelInit()}static goGame(){0==this.game.playCount&&w.randomPlayMusic(),this.closeScene(t.Home),this.openScene(t.Game),this.game.gameStart()}static goOver(){this.closeScene(t.Game),this.openScene(t.Over)}static load3DRes(e){var t=[{url:e,clas:Laya.Scene3D,priority:1}];Laya.loader.create(t,Laya.Handler.create(this,this.onLoadFinished,[{target:"3dRes"}],!1),Laya.Handler.create(this,this.onLoading,null,!1)),Laya.loader.on(Laya.Event.ERROR,this,t=>{console.error("资源加载失败",t),this.load3DRes(e)})}static onLoadFinished(e){console.log("资源加载完成",e),this.loadSceneRes(),D.removeLoadRes(a.Scene3D)}static onLoading(e){}static loadSceneRes(){let e=Laya.loader.getRes(this.scene3DUrl);Laya.stage.addChild(e),Laya.stage.setChildIndex(e,0),this.game.mainScene=e,this.game.firstIn()}static openScene(e,t){Laya.Scene.open(e,!1,null,Laya.Handler.create(this,e=>{Laya.stage.addChild(e),t&&t()}))}static closeScene(e,t){Laya.Scene.close(e)&&t&&t()}static checkPerformance(e,t,a){let i=0,o=100,s=o;Laya.timer.loop(100,this,function addValue(){i+=1e3/Laya.timer.delta;s--;if(s<=0){Laya.timer.clear(this,addValue);let s=i/o;s>50?e&&e():s>40?t&&t():a&&a()}})}}U.subPackageName="scene",U.scene3DUrl="res/scene/Conventional/ResScene.ls",U.isStatShow=!1;new class{constructor(){window.Laya3D?Laya3D.init(F.width,F.height):Laya.init(F.width,F.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=F.scaleMode,Laya.stage.screenMode=F.screenMode,Laya.stage.alignV=F.alignV,Laya.stage.alignH=F.alignH,Laya.URL.exportSceneToJson=F.exportSceneToJson,(F.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),F.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),F.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){U.init()}}}();