!function(){"use strict";class e{static on(e,t,a){this.eventDispatcher.on(e,t,a)}static event(e,t){this.eventDispatcher.event(e,t)}static off(e,t,a){this.eventDispatcher.off(e,t,a)}static offAllCaller(e){this.eventDispatcher.offAllCaller(e)}}e.eventDispatcher=new Laya.EventDispatcher;class t extends Laya.Scene{onAwake(){this.size(Laya.stage.width,Laya.stage.height),this.init(),this.initEvent()}onClosed(){e.offAllCaller(this),Laya.timer.clearAll(this)}init(){}initEvent(){}}class a extends t{init(){a.instance=this}initEvent(){}}var i,o,s,n,r,l,h,c,d,p,m,y,u,g,f;!function(e){e.Load="scenes/Load.scene",e.Home="scenes/Home.scene",e.Game="scenes/Game.scene",e.Over="scenes/Over.scene"}(i||(i={})),function(e){e.SubPackage="分包",e.Scene3D="3D场景"}(o||(o={})),function(e){e.Scene_Load_Open="Scene_Load_Open",e.Scene_Home_Open="Scene_Home_Open",e.Scene_Game_Open="Scene_Game_Open",e.Scene_Over_Open="Scene_Over_Open",e.Progress_Load_Update="Progress_Load_Update",e.Platform_Wake_Do="Platform_Wake_Do",e.Platform_Hide_Do="Platform_Hide_Do",e.Game_ObsBoard_LevelUp="Game_ObsBoard_LevelUp",e.Game_Coin_Update="Game_Coin_Update",e.Game_Level_Update="Game_Level_Update"}(s||(s={})),function(e){e.Bgm="Bgm",e.Button="Button",e.Get="Get",e.Blade="Blade",e.Fire="Fire",e.Upgrade="Upgrade",e.Axe="Axe",e.Arch="Arch",e.Gun="Gun",e.RocketGun="RocketGun",e.Complete="Complete",e.GetMoney="GetMoney",e.Hit="Hit"}(n||(n={})),function(e){e.Money="Money"}(r||(r={})),function(e){e.Money="Money",e.FireTable_1="FireTable_1",e.Blade_2="Blade_2",e.Blade_1="Blade_1",e.Board_1="Board_1",e.Hero_1="Hero_1"}(l||(l={})),function(e){e.Axe="Axe",e.Arch="Arch",e.Gun="Gun",e.Pistol="Pistol",e.Rifle="Rifle",e.MachineGun="MachineGun",e.Rocketgun="Rocketgun"}(h||(h={})),function(e){e.Load="scenes/Load.scene",e.Home="scenes/Home.scene",e.Game="scenes/Game.scene",e.Over="scenes/Over.scene"}(c||(c={})),function(e){e.SubPackage="分包",e.Scene3D="3D场景"}(d||(d={})),function(e){e.Scene_Load_Open="Scene_Load_Open",e.Scene_Home_Open="Scene_Home_Open",e.Scene_Game_Open="Scene_Game_Open",e.Scene_Over_Open="Scene_Over_Open",e.Progress_Load_Update="Progress_Load_Update",e.Platform_Wake_Do="Platform_Wake_Do",e.Platform_Hide_Do="Platform_Hide_Do",e.Game_ObsBoard_LevelUp="Game_ObsBoard_LevelUp",e.Game_Coin_Update="Game_Coin_Update",e.Game_Level_Update="Game_Level_Update"}(p||(p={})),function(e){e.Bgm="Bgm",e.Button="Button",e.Get="Get",e.Blade="Blade",e.Fire="Fire",e.Upgrade="Upgrade",e.Axe="Axe",e.Arch="Arch",e.Gun="Gun",e.RocketGun="RocketGun",e.Complete="Complete",e.GetMoney="GetMoney",e.Hit="Hit"}(m||(m={})),(y||(y={})).Money="Money",function(e){e.Money="Money",e.FireTable_1="FireTable_1",e.Blade_2="Blade_2",e.Blade_1="Blade_1",e.Board_1="Board_1",e.Hero_1="Hero_1"}(u||(u={})),function(e){e.Axe="Axe",e.Arch="Arch",e.Gun="Gun",e.Pistol="Pistol",e.Rifle="Rifle",e.MachineGun="MachineGun",e.Rocketgun="Rocketgun"}(g||(g={}));class L{static init(){for(var e in this._soundCtx={},this._soundFile=[],this.loopSounds=[],m){let t=m[e];this._soundFile.push(t)}console.log("音效：",this._soundFile);let t=this._pathRoot,a="",i=this._soundFile,o=this._soundFile.length;for(let e=0;e<o;++e){a=i[e];let o=new Laya.SoundChannel;o.url=t+a+this.soundType,Laya.SoundManager.addChannel(o),this._soundCtx[a]=!0}Laya.SoundManager.autoStopMusic=!0}static setSoundVolume(e,t){this._soundCtx[e]&&Laya.SoundManager.setSoundVolume(t,this._pathRoot+e+this.soundType)}static play(e,t=!1){if(this._soundCtx[e])return t&&-1==this.loopSounds.indexOf(e)?(this.loopSounds.push(e),Laya.SoundManager.playSound(this._pathRoot+e+this.soundType,0)):Laya.SoundManager.playSound(this._pathRoot+e+this.soundType)}static stop(e,t=!1){if(this._soundCtx[e]){if(t){let t=this.loopSounds.indexOf(e);-1!=t&&this.loopSounds.splice(t,1)}Laya.SoundManager.stopSound(this._pathRoot+e+this.soundType)}}static playMusic(e){Laya.SoundManager.stopMusic(),e?(Laya.SoundManager.playMusic(this._pathRoot+e+this.soundType,0),this.currentBgm=e):this.currentBgm?Laya.SoundManager.playMusic(this._pathRoot+this.currentBgm+this.soundType,0):Laya.SoundManager.playMusic(this._pathRoot+m.Bgm+this.soundType,0)}static stopMusic(){Laya.SoundManager.stopMusic()}}L._pathRoot="res/sounds/",L.soundType=".mp3";class w{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(e){return Math.round(10*e)}toTween(e,t,a,i,o,s=!0){if(this.target=e,this.isLocal=s,e&&!e.destroyed){var n={},r={};if(t.pos){var l=s?e.transform.localPosition.clone():e.transform.position.clone();n.posX=l.x,n.posY=l.y,n.posZ=l.z,r.posX=t.pos.x,r.posY=t.pos.y,r.posZ=t.pos.z}if(t.rot){var h=s?e.transform.localRotationEuler.clone():e.transform.rotationEuler.clone();n.rotX=h.x,n.rotY=h.y,n.rotZ=h.z,r.rotX=t.rot.x,r.rotY=t.rot.y,r.rotZ=t.rot.z}if(t.sca){var c=e.transform.getWorldLossyScale().clone();n.scaX=c.x,n.scaY=c.y,n.scaZ=c.z,r.scaX=t.sca.x,r.scaY=t.sca.y,r.scaZ=t.sca.z}this.tween.to(n,{posX:r.posX,posY:r.posY,posZ:r.posZ,rotX:r.rotX,rotY:r.rotY,rotZ:r.rotZ,scaX:r.scaX,scaY:r.scaY,scaZ:r.scaZ},a,o,Laya.Handler.create(this,()=>{i&&i();var t=this.tweens.shift();e&&!e.destroyed&&(t?this.toTween(this.target,t.value,t.time,t.completeFun,o):this.updateTweenCallback&&(this.updateTweenCallback=null))}));var d=0;return this.tween.update=new Laya.Handler(this,()=>{if(!e||e.destroyed)return;let i=(d+=Laya.timer.delta)/a;i>1&&(i=1),t.pos&&(s?e.transform.localPosition=new Laya.Vector3(n.posX,n.posY,n.posZ):e.transform.position=new Laya.Vector3(n.posX,n.posY,n.posZ)),t.rot&&(s?e.transform.localRotationEuler=new Laya.Vector3(n.rotX,n.rotY,n.rotZ):e.transform.rotationEuler=new Laya.Vector3(n.rotX,n.rotY,n.rotZ)),t.sca&&e.transform.setWorldLossyScale(new Laya.Vector3(n.scaX,n.scaY,n.scaZ)),this.updateTweenCallback&&this.updateTweenCallback(i)}),this}}clearTween(e){this.tweens=[],this.tween.clear(),this.target&&e&&(e.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z):this.target.transform.position=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z)),e.rot&&(this.target.transform.rotationEuler=new Laya.Vector3(e.rot.x,e.rot.y,e.rot.z)),e.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(e.sca.x,e.sca.y,e.sca.z)))}then(e,t,a){return this.tweens.push({value:e,time:t,completeFun:a}),this}toScaleTween(e,t,a,i,o,s=Laya.Ease.elasticOut){e&&!e.destroyed&&(e.transform.localScale=t,this.toTween(e,{sca:a},i,o,s))}}class C{static add(e,t){var a=new Laya.Vector3;return Laya.Vector3.add(e,t,a),a.clone()}static subtract(e,t){var a=new Laya.Vector3;return Laya.Vector3.subtract(e,t,a),a.clone()}static mull(e,t){var a=new Laya.Vector3;return Laya.Vector3.scale(e,t,a),a.clone()}static dot(e,t){return Laya.Vector3.dot(e,t)}static cross(e,t){var a=new Laya.Vector3;return Laya.Vector3.cross(e,t,a),a.clone()}static normalized(e){var t=new Laya.Vector3;return Laya.Vector3.normalize(e,t),t.clone()}static distance(e,t){var a=C.subtract(e,t);return Laya.Vector3.scalarLength(a)}}class S{static d3_getSpritePosBySprite3DPoint(e,t,a=new Laya.Vector3(0,0,0)){var i=t.transform.position.clone();i.x+=a.x,i.y+=a.y,i.z+=a.z;var o=new Laya.Vector4;e.viewport.project(i,e.projectionViewMatrix,o);var s=new Laya.Vector2(o.x/Laya.stage.clientScaleX,o.y/Laya.stage.clientScaleY);return new Laya.Point(s.x,s.y)}static d3_FindNodeByName(e,t){let a=null,i=e=>{for(let o=0;o<e.numChildren;o++){if(e.getChildAt(o).name==t)return void(a=e.getChildAt(o));i(e.getChildAt(o))}};return i(e),a}static d3_switchAllMathInChildren(e,t){if(e.meshRenderer){let a=e.meshRenderer.material.clone();a.albedoColor=S.d3_getRgbByHex(t),e.meshRenderer.material=a}for(let a=0;a<e.numChildren;a++){let i=e.getChildAt(a);if(i.meshRenderer){let e=new Laya.BlinnPhongMaterial,a=S.d3_getRgbByHex(t);e.albedoColor=new Laya.Vector4(a.x,a.y,a.z,1),e.specularColor=new Laya.Vector4(0,0,0,1),i.meshRenderer.material=e}this.d3_switchAllMathInChildren(i,t)}}static d3_unactiveAllChildren(e){for(let t=0;t<e.numChildren;t++)e.getChildAt(t).active=!1}static d3_objectScaleTips(e){let t=new w,a=e.transform.localScale.clone(),i=C.mull(a,.8),o=C.mull(a,1.2);t.toTween(e,{sca:i},50).then({sca:o},50).then({sca:a},50)}static d3_getRgbByHex(e){var t=[],a=[];let i=e.replace(/#/,"");if(3==i.length){for(var o=[],s=0;s<3;s++)o.push(i.charAt(s)+i.charAt(s));i=o.join("")}for(s=0;s<3;s++)t[s]="0x"+i.substr(2*s,2),a.push(parseInt(t[s]));return new Laya.Vector3(a[0]/255,a[1]/255,a[2]/255)}static d3_objectShake(e,t=1,a=.7){var i=t,o=1,s=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(i>0){var t=new Laya.Vector3;Laya.Vector3.scale((n=Math.random()>.5?Math.random():-Math.random(),r=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(n,r,0)),a,t),Laya.Vector3.add(s,t,t),e.transform.localPosition=t,i-=.02*o}else i=0,e.transform.localPosition=s,Laya.timer.clear(this,updateShake);var n,r})}static getAngle(e,t){var a=Laya.Vector3.dot(e,t),i=Laya.Vector3.scalarLength(e)*Laya.Vector3.scalarLength(t);if(0==i){if(e.z>t.z)return 0;if(e.z<t.z)return 180;if(e.y>t.y)return 90;if(e.y<t.y)return-90}var o=a/i;return o<-1&&(o=-1),o>1&&(o=1),180*Math.acos(o)/Math.PI}static getAngleUp(e,t,a){let i=S.getAngle(e,t),o=new Laya.Vector3;return Laya.Vector3.cross(t,e,o),S.getAngle(a,o)>90&&(i*=-1),i}static getProjection(e,t){let a=C.mull(t,C.dot(e,t));return C.subtract(e,a)}static d2_AddClickEvent(e,t,a,i,o=!1,s=!0,r=!0){e.offAllCaller(t);let l=e.scaleX,h=.9*l,c=!1;e.on(Laya.Event.MOUSE_DOWN,t,t=>{c=!0,r&&Laya.Tween.to(e,{scaleX:h,scaleY:h},60),o&&t.stopPropagation},i);e.on(Laya.Event.MOUSE_UP,t,i=>{0!=c&&(c=!1,o&&i.stopPropagation,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),a&&a.call(t,i),s&&L.play(n.Button))},i);e.on(Laya.Event.MOUSE_OUT,t,t=>{0!=c&&(c=!1,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),o&&t.stopPropagation)},i)}static getAngle2DWay(e,t){var a=Laya.Vector2.dot(e,t),i=Laya.Vector2.scalarLength(e)*Laya.Vector2.scalarLength(t),o=180*Math.acos(a/i)/Math.PI,s=e.x*t.y-t.x*e.y;return s>0?o*=1:s<0?o*=-1:o=0,o}static d2_coinCollectAnim(e,t,a,i,o=15,s=1,n=null,r=null){for(var l=o,h=0;h<o;h++){let o=Laya.Pool.getItemByClass("coin",Laya.Image);o.skin=e,o.x=t.x,o.y=t.y,o.scale(s,s),i.addChild(o);let h=300+100*Math.random()-50;Laya.Tween.to(o,{x:o.x+250*Math.random()-125,y:o.y+250*Math.random()-125},h),Laya.timer.once(h+50,this,function(){Laya.Tween.to(o,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){i.removeChild(o),Laya.Pool.recover("coin",o),l--,r&&r(),0==l&&n&&n(i)}))})}}static d2_coinCollectAnimAni(e,t,a,i,o=15,s=null){for(var n=o,r=0;r<o;r++){let o=Laya.Pool.getItemByClass("coinAnim",Laya.Clip);o.skin=e.skin,o.index=e.index,o.clipX=e.clipX,o.clipY=e.clipY,o.autoPlay=e.autoPlay,o.x=t.x,o.y=t.y,o.scale(.8,.8),i.addChild(o);let r=300+100*Math.random()-50;Laya.Tween.to(o,{x:o.x+250*Math.random()-125,y:o.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(o,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){i.removeChild(o),Laya.Pool.recover("coinAnim",o),0==--n&&s&&s(i)}))})}}static faceToast(e,t,a,i){let o=new Laya.Image(e);o.anchorX=.5,o.anchorY=.5,o.alpha=1,o.scaleX=.3,o.scaleY=.3,t.addChild(o),o.x=a.x,o.y=a.y,Laya.Tween.to(o,{x:i.x,y:i.y,alpha:.9},1e3,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{o&&!o.destroyed&&Laya.Tween.to(o,{x:i.x,y:i.y-100,alpha:0},1e3,null,Laya.Handler.create(this,()=>{o&&!o.destroyed&&o.destroy()}))}))}static d2_fontClipToast(e,t,a,i,o){if(!this.wordToastOk)return;let s=Laya.Pool.getItemByClass("fontClip_d2",Laya.FontClip);s.skin=e,s.sheet="0123456789",s.value=t,s.anchorX=.5,s.anchorY=.5,s.alpha=1,s.scaleX=i,s.scaleY=i,a.addChild(s),s.x=o.x,s.y=o.y;let n=new Laya.Vector2(o.x+(S.halfPercent()?S.randomInt(-100,-75):S.randomInt(75,100)),o.y-50);Laya.Tween.to(s,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(s,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{a.removeChild(s),Laya.Pool.recover("fontClip_d2",s)}))}))}static d2_imageToast(e,t,a){if(!this.wordToastOk)return;S.wordToastOk=!1;let i=new Laya.Image(e);i.anchorX=.5,i.anchorY=.5,i.alpha=1,t.addChild(i),i.top=300,i.centerX=0;i.scaleX=0,i.scaleY=0,Laya.Tween.to(i,{scaleX:1,scaleY:1},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{S.wordToastOk=!0,i&&!i.destroyed&&Laya.Tween.to(i,{top:200,alpha:0},500,null,Laya.Handler.create(this,()=>{i&&!i.destroyed&&i.destroy()}))}))}static clamp01(e){return e>1?1:e<0?0:e}static clamp(e,t,a){return e<t?t:e>a?a:e}static get getCurrentTime(){return(new Date).getTime()}static get getCurrentTime_Second(){return Math.floor(Date.parse((new Date).toString())/1e3)}static math_gcd(e,t){return 0==t?e:this.math_gcd(t,e%t)}static numberTo(e,t,a){return Math.abs(t-e)<a?e=t:e<t?e+=a:e>t&&(e-=a),e}static randomNumber(e,t){return e+(t-e)*Math.random()}static randomInt(e,t){return Math.floor(e+(t+1-e)*Math.random())}static halfPercent(){return Math.random()<.5}static percent(e){return Math.random()<e}static cloneArray(e){return[].concat(e)}static getRandomInArray(e){if(e.length){let t=Math.random()*e.length;return e[t=Math.floor(t)]}return console.error("传入错误参数,返回空"),null}static takeRandomInArray(e){if(e.length){let t=Math.random()*e.length,a=e[t=Math.floor(t)];return e.splice(t,1),a}return console.error("传入错误参数,返回空"),null}static randomArray(e){let t=new Array(e.length),a=t.length;for(let i=0;i<a;i++){let a=this.takeRandomInArray(e);t[i]=a}return t}static BoxCheck_2D_Normal(e,t,a,i,o,s,n,r){let l=o-e,h=s-t,c=Math.abs(h),d=Math.abs(l),p=(i+r)/2,m=(a+n)/2;return{isHit:c<p&&d<m,axisDis:d,axisRange:m,horizontalDis:c,horizontalRange:p,axisWay:l,horizontalWay:h}}static CircleCheck_2D(e,t,a,i,o,s){let n=Math.pow(e-i,2)+Math.pow(t-o,2),r=Math.pow(a+s,2);return{isHit:n<r,distancePow2:n,rangePow2:r}}}S.wordToastOk=!0,function(e){e.start="touchStart",e.move="touchMove",e.end="touchEnd",e.getAxis="GetAxis",e.slideWay="slideWay",e.singleTouchStart="singleTouchStart",e.singleTouchMove="singleTouchMove",e.singleTouchEnd="singleTouchEnd",e.secondTouchStart="secondTouchStart",e.secondTouchMove="secondTouchMove",e.secondTouchEnd="secondTouchEnd",e.getAxisAlways="getAxisAlways",e.keyDown="keyDown"}(f||(f={}));class v extends Laya.Script{constructor(){super(...arguments),this.isPressed=!1,this.hOriginal=0,this.vOriginal=0,this.hAxis=0,this.vAxis=0,this.outAxis=0,this.touchId=-1}onEnable(){v.instance=this}onMouseDown(t){e.event(f.start,[t])}onMouseMove(t){e.event(f.move,[t])}onMouseOut(t){e.event(f.end,[t])}onMouseOver(t){e.event(f.end,[t])}onMouseUp(t){e.event(f.end,[t])}}class b extends Laya.Script{constructor(){super(...arguments),this.calls=[],this.firstId=-1,this.secondId=-1,this.firstOriginalPoint=new Laya.Vector2,this.secondOriginalPoint=new Laya.Vector2,this.isSecond=!1,this.orignalHorizontal=0,this.orignalAxis=0,this.orignalHorizontalAlways=0,this.orignalAxisAlways=0,this.offset=new Laya.Vector3}onEnable(){e.on(f.start,this,this.onMouseDown),e.on(f.move,this,this.onMouseMove),e.on(f.end,this,this.onMouseUp)}onDisable(){e.off(f.start,this,this.onMouseDown),e.off(f.move,this,this.onMouseMove),e.off(f.end,this,this.onMouseUp)}onMouseDown(t){0==this.isSecond?-1==this.firstId?(this.checkOut(t),this.firstId=t.touchId,e.event(f.singleTouchStart,t),this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):this.firstId!=t.touchId&&-1==this.secondId&&(this.secondId=t.touchId,this.isSecond=!0,e.event(f.secondTouchStart,t),this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):-1==this.firstId?(this.firstId=t.touchId,this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):-1==this.secondId&&(this.secondId=t.touchId,this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),this.checkOutAlways(t)}onMouseMove(t){if(0==this.isSecond)t.touchId==this.firstId&&(this.checkWay(t),this.checkOut(t),e.event(f.singleTouchMove,t));else if(-1!=this.firstId&&-1!=this.secondId){let a,i={distance:0,angle:0},o=this.Vector2Reduce(this.secondOriginalPoint,this.firstOriginalPoint),s=Laya.Vector2.scalarLength(o);if(t.touchId==this.firstId?a=this.Vector2Reduce(this.secondOriginalPoint,new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):t.touchId==this.secondId&&(a=this.Vector2Reduce(new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height),this.firstOriginalPoint)),a){let t=Laya.Vector2.scalarLength(a);i.distance=t-s,i.angle=S.getAngle2DWay(o,a),e.event(f.secondTouchMove,i)}}t.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),t.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),this.checkWayAlways(t)}onMouseUp(t){this.checkOutAlways(t),t.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),t.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),0==this.isSecond?t.touchId==this.firstId&&(this.checkOut(t),e.event(f.singleTouchEnd,t),this.firstId=-1):(t.touchId==this.firstId&&(this.firstId=-1),t.touchId==this.secondId&&(this.secondId=-1),-1==this.firstId&&-1==this.secondId&&(this.isSecond=!1))}WayCheck(){let e=this.Vector2Reduce(this.nowPos,this.startPos);if(Laya.Vector2.scalarLength(e)>100){let t=Math.atan2(e.y,e.x)/Math.PI*180,a="none";t>-135&&t<-45?a="up":t>-45&&t<45?a="right":t<135&&t>45?a="down":(t<-135||t>135)&&(a="left"),this.isDown=!1}this.startPos=this.nowPos}onDestroy(){this.touchTimer&&clearTimeout(this.touchTimer)}checkWay(t){let a=t.stageX-this.orignalHorizontal,i=t.stageY-this.orignalAxis;e.event(f.getAxis,[{x:a,y:i}])}checkOut(e){this.orignalHorizontal=e.stageX,this.orignalAxis=e.stageY}checkWayAlways(t){let a=t.stageX/Laya.stage.width-this.orignalHorizontalAlways,i=t.stageY/Laya.stage.height-this.orignalAxisAlways;this.checkOutAlways(t),e.event(f.getAxisAlways,[{x:a,y:i}])}checkOutAlways(e){this.orignalHorizontalAlways=e.stageX/Laya.stage.width,this.orignalAxisAlways=e.stageY/Laya.stage.height}modelRotateControlDown(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);this.startPosition=e.clone(),this.prePosition=e.clone()}modelRotateControlMove(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);Laya.Vector3.subtract(e,this.prePosition,this.offset),this.prePosition=e.clone();var t=new Laya.Vector3(this.offset.x,this.offset.y,0);let a=new Laya.Vector3;Laya.Vector3.cross(t,new Laya.Vector3(0,0,1),a),Laya.Vector3.normalize(a,a)}modelRotateControlUp(){new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0)}onKeyDown(t){e.event(f.keyDown,t)}Vector2Reduce(e,t){return new Laya.Vector2(e.x-t.x,e.y-t.y)}}class _{static AddGrade(){let e=this.GetPlayerData();e.grade++,parseInt(e.grade)>99&&(e.grade=99),this.SavePlayerData(e)}static ReadGrade(){let e=this.GetPlayerData();return parseInt(e.grade)}static AddCoin(t){let a=this.GetPlayerData();a.coin+=t,a.coin>9999&&(a.coin=9999),Math.floor(a.coin),this.SavePlayerData(a),e.event(s.Game_Coin_Update)}static ReadCoin(){let e=this.GetPlayerData();return Math.floor(e.coin)}static ReadSpeed(){return this.GetPlayerData().speedLevel}static AddSpeed(){let e=this.GetPlayerData();e.speedLevel++,e.speedLevel>9&&(e.speedLevel=9),this.SavePlayerData(e)}static ReadAttack(){return this.GetPlayerData().attackLevel}static AddAttack(){let e=this.GetPlayerData();e.attackLevel++,e.attackLevel>9&&(e.attackLevel=9),this.SavePlayerData(e)}static GetPlayerData(){let e;return(e=Laya.LocalStorage.getJSON("PlayerData"))||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),e)}static SavePlayerData(e){Laya.LocalStorage.setJSON("PlayerData",e)}static ClearPlayerData(){Laya.LocalStorage.clear()}static CheckPlayerData(){let e;(e=Laya.LocalStorage.getJSON("PlayerData"))&&e.ver&&e.ver==this.data.ver||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),console.log("触发存档重置条件"))}}_.data={ver:4,grade:1,coin:0,speedLevel:1,attackLevel:1};class x{init(){}loadSubPackage(e,t){if(this.platformApi){this.platformApi.loadSubpackage({name:e,success:function(a){console.log("分包加载成功：",e),t.call(!0,a)},fail:function(a){console.error("分包加载失败：",e,JSON.stringify(a)),t.call(!1,a)}})}else console.log("没有平台API"),t(!0)}showToast(e,t=1e3){console.log(e,t.toString()+"ms")}vibrateShort(){this.platformApi&&this.platformApi.vibrateShort()}vibrateLong(){this.platformApi&&this.platformApi.vibrateLong()}regisiterCallback(){this.platformApi&&(this.platformApi.offShow(this.onShowEvent),this.platformApi.onShow(this.onShowEvent),this.platformApi.offHide(this.onHideEvent),this.platformApi.onHide(this.onHideEvent))}onShowEvent(t){e.event(s.Platform_Wake_Do,t)}onHideEvent(t){e.event(s.Platform_Hide_Do,t)}}class M extends x{init(){this.platformApi=Laya.Browser.window.wx,this.showShareMenuWithTicket(!0),this.regisiterWXShareCallback()}showToast(e,t=1500){Laya.Browser.window.wx.showToast({title:e,icon:"none",duration:t})}showShareMenuWithTicket(e){wx.showShareMenu({withShareTicket:e,success:function(){},fail:function(){},complete:function(){}})}regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var e={title:"分享",image:""};Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:e.title,imageUrl:e.image,query:"share_id=1"}})}}}class P{static init(e){this.isStatShow&&Laya.Stat.show(),this.game=e,this.goLoad(),this.addLoadRes(o.SubPackage),this.addLoadRes(o.Scene3D);let t=this.subPackageName,a=this.scene3DUrl;Laya.Browser.onWeiXin?this.platform=new M:this.platform=new x,this.platform.init();this.platform.loadSubPackage(t,e=>{e&&(this.removeLoadRes(o.SubPackage),this.load3DRes(a))}),L.init(),_.CheckPlayerData()}static goLoad(){this.openScene(i.Load)}static goHome(){this.closeScene(i.Load),this.closeScene(i.Over),this.openScene(i.Home),this.game.levelInit()}static goGame(){this.closeScene(i.Home),this.openScene(i.Game),this.game.gameStart()}static goOver(){this.closeScene(i.Game),this.openScene(i.Over)}static load3DRes(e){var t=[{url:e,clas:Laya.Scene3D,priority:1}];Laya.loader.create(t,Laya.Handler.create(this,this.onLoadFinished,[{target:"3dRes"}],!1),Laya.Handler.create(this,this.onLoading,null,!1)),Laya.loader.on(Laya.Event.ERROR,this,t=>{console.error("资源加载失败",t),this.load3DRes(e)})}static onLoadFinished(e){console.log("资源加载完成",e),this.loadSceneRes(),this.removeLoadRes(o.Scene3D)}static onLoading(e){}static loadSceneRes(){let e=Laya.loader.getRes(this.scene3DUrl);Laya.stage.addChild(e),Laya.stage.setChildIndex(e,0),this.game.mainScene=e,this.game.firstIn()}static addLoadRes(e){this.loadingList.push(e),this.loadingCount++}static removeLoadRes(t){let a=this.loadingList.indexOf(t);-1==a?console.log("完成了不存在的资源加载"):this.loadingList.splice(a,1),e.event(s.Progress_Load_Update)}static openScene(e,t){Laya.Scene.open(e,!1,null,Laya.Handler.create(this,e=>{Laya.stage.addChild(e),t&&t()}))}static closeScene(e,t){Laya.Scene.close(e)&&t&&t()}static checkPerformance(e,t,a){let i=0,o=50,s=o;Laya.timer.loop(100,this,function addValue(){i+=1e3/Laya.timer.delta;s--;if(s<=0){Laya.timer.clear(this,addValue);let s=i/o;s>50?e&&e():s>40?t&&t():a&&a()}})}}P.subPackageName="scene",P.scene3DUrl="res/scene/Conventional/ResScene.ls",P.isStatShow=!1,P.loadingList=[],P.loadingCount=0;class A extends t{init(){this.updateUpgarde(),this.updateCoinUI(),this.stageValue.value=_.ReadGrade().toString()}initEvent(){S.d2_AddClickEvent(this.btnStart,this,this.onBtnStartClick),e.on(s.Game_Coin_Update,this,this.updateCoinUI),S.d2_AddClickEvent(this.speedUpgardBtn,this,this.onBtnSpeedMoneyClick),S.d2_AddClickEvent(this.speedUpgradeVideoBtn,this,this.onBtnSpeedVideoClick),S.d2_AddClickEvent(this.attackBtn,this,this.onBtnAttackMoneyClick),S.d2_AddClickEvent(this.attackUpgradeVideoBtn,this,this.onBtnAttackVideoClick)}onBtnStartClick(){P.goGame()}onBtnSpeedMoneyClick(){let e=_.ReadCoin(),t=200*_.ReadSpeed();e<t?P.platform.showToast("金币不足"):(_.AddCoin(-t),_.AddSpeed(),this.updateUpgarde(),P.platform.showToast("攻速升级"))}onBtnSpeedVideoClick(){_.AddSpeed(),this.updateUpgarde(),P.platform.showToast("攻速升级")}onBtnAttackMoneyClick(){let e=_.ReadCoin(),t=200*_.ReadAttack();e<t?P.platform.showToast("金币不足"):(_.AddCoin(-t),_.AddAttack(),this.updateUpgarde(),P.platform.showToast("攻击数量升级"))}onBtnAttackVideoClick(){_.AddAttack(),this.updateUpgarde(),P.platform.showToast("攻击数量升级")}updateCoinUI(){this.coinValue.value=_.ReadCoin().toString()}updateUpgarde(){let t=_.ReadCoin(),a=_.ReadSpeed(),i=200*a,o=this.speedUpgardBtn.getChildByName("coinValue"),n=this.speedUpgardBtn.getChildByName("level"),r=this.speedUpgardBtn.getChildByName("icon");o.value=i.toString(),n.value=a>=9?"9->9":a.toString()+"->"+(a+1).toString(),t<i?(this.speedUpgardBtn.skin="ui/game/yxjm_dk_4.png",r.skin="ui/game/yxjm_gjtn_2.png"):(this.speedUpgardBtn.skin="ui/game/yxjm_dk_1.png",r.skin="ui/game/yxjm_gjtn_1.png");let l=_.ReadAttack(),h=200*l,c=this.attackBtn.getChildByName("coinValue"),d=this.attackBtn.getChildByName("level"),p=this.attackBtn.getChildByName("icon");c.value=h.toString(),d.value=l>=9?"9->9":l.toString()+"->"+(l+1).toString(),t<h?(this.attackBtn.skin="ui/game/yxjm_dk_3.png",p.skin="ui/game/yxjm_gjtn_4.png"):(this.attackBtn.skin="ui/game/yxjm_dk_2.png",p.skin="ui/game/yxjm_gjtn_3.png"),e.event(s.Game_Level_Update)}}class k extends t{init(){Laya.timer.frameOnce(1,this,this.loadProgressUpdate)}initEvent(){e.on(s.Progress_Load_Update,this,this.loadProgressUpdate)}loadProgressUpdate(){let e=P.loadingList;0==e.length?(console.log("加载完毕"),P.goHome(),P.loadingCount=0):console.log("正在加载",e[0]),this.loadBar.value=e.length/P.loadingCount}}class B extends Laya.Script3D{onAwake(){this.self=this.owner,this.selfTween=new w,this.init()}init(...e){}onDestroy(){Laya.timer.clearAll(this),this.selfTween.clearTween(),e.offAllCaller(this)}}class V extends B{constructor(){super(...arguments),this.forwardSpeed_Data=1.2,this.axis=0,this.horizontal=0,this.isMove=!1,this.modelMoveRange=7.5,this.camPointMoveRange=2.5,this.forwardSpeed=1.25,this.horizontalSensity=.12,this.forwardSensity=.15,this.wayAxis=0,this.targetHorizontal=0,this.inHorizontal=0}init(){this.player=this.self,this.model=this.player.getChildByName("Model"),this.camPoint=this.player.getChildByName("CamPoint"),this.forwardSpeed=this.forwardSpeed_Data}reset(e,t){this.axis=e,this.horizontal=t,this.targetHorizontal=t;let a=this.player.transform.localPosition.clone();a.z=this.axis,this.player.transform.localPosition=a;let i=this.model.transform.localPosition.clone();i.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=i;let o=this.camPoint.transform.localPosition.clone();o.x=-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=o}onUpdate(){let e=Laya.timer.delta/16;this.forwardSpeed>=0?this.isMove&&(this.axis+=this.forwardSpeed*this.forwardSensity*e):this.forwardSpeed<0&&(this.axis+=this.forwardSpeed*this.forwardSensity*e),this.wayAxis=this.targetHorizontal-this.horizontal,this.horizontal+=this.wayAxis*this.horizontalSensity*e;let t=this.player.transform.localPosition.clone();t.z=this.axis,this.isMove&&(this.player.transform.localPosition=t);let a=this.model.transform.localPosition.clone();a.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=a;let i=this.camPoint.transform.localPosition.clone();i.x=-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=i}checkWay(e){let t=!1;return this.targetHorizontal=this.inHorizontal+e,this.targetHorizontal>.5?(this.targetHorizontal=.5,this.checkOut(),t=!0):this.targetHorizontal<-.5&&(this.targetHorizontal=-.5,this.checkOut(),t=!0),t}checkOut(){this.inHorizontal=this.targetHorizontal}Hit(){this.forwardSpeed=-.5,Laya.timer.frameLoop(1,this,this.HitUpdate)}HitUpdate(){this.forwardSpeed+=.05*Laya.timer.delta/16,this.forwardSpeed>=this.forwardSpeed_Data&&(Laya.timer.clear(this,this.HitUpdate),this.forwardSpeed=this.forwardSpeed_Data)}onDisable(){}}class D extends B{constructor(){super(...arguments),this.range=1,this.width=1,this.raidus=1,this.colliderActive=!0,this.isBullet=!1}init(...e){}setData(e,t,a=!1){this.range=e,this.width=t,this.raidus=this.range>this.width?this.range:this.width,this.colliderActive=!0,this.isBullet=a}}class H extends B{constructor(){super(...arguments),this.offsetZ=2,this.nowType=[]}init(...e){this.items=this.self.getChildByName("Items"),this.model=this.self.getChildByName("Model")}reset(){this.items.active=!0,this.nowType=[],this.nowType.push(r.Money);for(let e=this.items.numChildren-1;e>=0;e--)this.items.getChildAt(e).destroy();for(let e=0;e<0;e++)this.addItem()}addItem(){let e=new Laya.Sprite3D("item");P.game.stageObj.push(e),this.items.addChild(e),e.transform.localPosition=new Laya.Vector3;for(let t=0;t<this.nowType.length;t++){let a=P.game.bornStageObj(this.getItemUrl(this.nowType[t]),e);a.addComponent(B).selfTween;a.transform.localPosition=new Laya.Vector3(0==t?0:Math.sin(t*Math.PI+Math.PI/2),0,0)}for(let e=this.items.numChildren-1;e>=0;e--){let t=this.items.getChildAt(e),a=t.addComponent(B),i=a.selfTween,o=10+10*(this.items.numChildren-1-e);Laya.timer.once(o,a,()=>{i.clearTween(),t.transform.localScale=new Laya.Vector3,i.toTween(t,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut)})}e.addComponent(D).setData(1,2)}getItemUrl(e){switch(e){case r.Money:return r.Money;default:return null}}onUpdate(){let e=Laya.timer.delta/1e3,t=this.model.transform.position.clone();t.x+=.75,t.z+=this.offsetZ;let a=this.items.getChildAt(0);a&&!a.destroyed&&(a.transform.position=t);for(let i=1;i<this.items.numChildren;i++)if((a=this.items.getChildAt(i))&&!a.destroyed){let o=new Laya.Vector3,s=(a.getComponent(D),15*e);s>1&&(s=1),Laya.Vector3.lerp(a.transform.position.clone(),t,s,o),o.z=this.model.transform.position.z+this.offsetZ+i,a.transform.position=o,t=a.transform.position}}}class T extends B{constructor(){super(...arguments),this.yForceMin=1,this.yForceMax=2,this.xForceMin=.5,this.xForceMax=1,this.zForceMin=15,this.zForceMax=25,this.dir=new Laya.Vector3(0,1,0),this.gravity=0,this.yforce=0,this.xForce=0,this.zForce=0,this.rotate=new Laya.Vector3,this.dorpDeadY=-2,this.dropDeadChangeX=4,this.isDestory=!0,this.isActive=!0}init(){this.setData()}changeDropData(e,t,a,i,o,s){this.yForceMin=e.x,this.yForceMax=e.y,this.xForceMin=t.x,this.xForceMax=t.y,this.zForceMin=a.x,this.zForceMax=a.y,this.rotate=o,this.dir=i,this.gravity=s,this.setData()}setTimeDestroy(e=1e3){Laya.timer.once(e,this,()=>{this.self.destroy()})}setData(){this.xForce=S.randomNumber(this.xForceMin,this.xForceMax),this.yforce=S.randomNumber(this.yForceMin,this.yForceMax),this.zForce=S.randomNumber(this.zForceMin,this.zForceMax)}onUpdate(){if(!this.isActive)return;let e=Laya.timer.delta/1e3;this.yforce-=this.gravity*e;let t=this.self;t&&!t.destroyed&&(t.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*e,this.yforce*e,this.dir.z*this.zForce*e),!1),t.transform.rotate(C.mull(this.rotate,e),!0),Math.abs(this.self.transform.position.x)>this.dropDeadChangeX&&(this.dorpDeadY=-19.5),this.self.transform.position.y<this.dorpDeadY&&(this.isDestory?this.self.destroy():this.isActive=!1))}}class O extends B{constructor(){super(...arguments),this.isCircle=!1,this.range=1,this.width=1,this.raidus=1,this.type=l.Money,this.colliderActive=!0,this.colliderSprite=[],this.isHarm=!1,this.boardNumber=[],this.heroHp=5}init(...e){}setData(t,a,i,o=1){let n;switch(this.type=t,this.range=a,this.width=i,this.raidus=(this.range+this.width)/2,this.raidus*=.5,t){case l.Money:this.colliderSprite.push(this.self);break;case l.FireTable_1:this.isCircle=!1;for(let e=0;e<this.self.numChildren;e++){let t=this.self.getChildAt(e);-1!=t.name.indexOf("collider")&&this.colliderSprite.push(t)}break;case l.Blade_2:this.isCircle=!1;for(let e=0;e<this.self.numChildren;e++)-1!=(n=this.self.getChildAt(e)).name.indexOf("collider")&&this.colliderSprite.push(n);break;case l.Blade_1:this.isCircle=!1,n=S.d3_FindNodeByName(this.self,"collider"),this.colliderSprite.push(n);break;case l.Board_1:this.colliderSprite.push(this.self),this.boardUpdate(),e.on(s.Game_ObsBoard_LevelUp,this,this.boardUpdate);break;case l.Hero_1:this.isCircle=!1,this.colliderSprite.push(this.self);let o=this.self.getChildAt(0),r="Hero_Orange";for(let e=1;e<o.numChildren;e++){let t=o.getChildAt(e);t.active=t.name==r}}}colliderDo(t=null){let a;switch(this.type){case l.Money:if(t&&t.isBullet)return;this.colliderActive&&(this.self.destroy(),P.game.itemsComp.addItem(),this.colliderActive=!1,P.game.vibrateShort(),L.play(n.Get));break;case l.FireTable_1:if(t){if(t.isBullet)return;t.colliderActive=!1,P.game.vibrateShort(),G.instance.runMoveComp.Hit(),(a=t.self.transform.position.clone()).y+=1,G.instance.bornFxDestroy("MoneyBurn",G.instance.mainScene,2e3,1,a),t.self.destroy(),L.play(n.Fire)}break;case l.Blade_2:if(t){if(t.isBullet)return;t.colliderActive=!1,(a=t.self.transform.position.clone()).y+=1,G.instance.bornFxDestroy("MoneyFly",G.instance.mainScene,2e3,1,a),t.self.destroy(),P.game.vibrateShort(),G.instance.runMoveComp.Hit(),L.play(n.Blade)}break;case l.Blade_1:if(t){if(t.isBullet)return;t.colliderActive=!1,G.instance.bornFxDestroy("MoneyFly",G.instance.mainScene,2e3,1,t.self.transform.position.clone()),t.self.destroy(),P.game.vibrateShort(),G.instance.runMoveComp.Hit(),L.play(n.Blade)}break;case l.Board_1:let i=()=>{this.colliderActive=!1,this.selfTween.toTween(this.self,{sca:new Laya.Vector3(0,0,0)},300,()=>{G.instance.isWaitUpgrade=!1},Laya.Ease.backIn),G.instance.isWaitUpgrade=!1,e.offAllCaller(this),this.boardUpdate()};if(this.colliderActive)if(t){if(t.isBullet)return;t.colliderActive=!1,P.game.vibrateShort(),G.instance.runMoveComp.Hit(),G.instance.hitUpgare(),L.play(n.Upgrade);let a,o=t.self.transform.position.x;if(o>=-1.3&&o<=1.3?a=1:o<-1.3?a=2:o>1.3&&(a=0),G.instance.typesLevel[a]<=7?G.instance.typesLevel[a]+=1:G.instance.typesLevel[a]+=.5,G.instance.typesLevel[a]>G.instance.maxLevel[a])G.instance.typesLevel[a]=G.instance.maxLevel[a],t.colliderActive=!0;else{let e=this.self.transform.position.clone();e.y+=5,e.x=2.6-2.6*a;let i=t.self.transform.position.clone();i.y+=.25,i.z-=.2,G.instance.bornFxDestroy("SmokeFX",G.instance.mainScene,1e3,2,i),G.instance.bornFxDestroy("ConFX",G.instance.mainScene,1e3,1,e),t.self.destroy()}let r=!0;for(let e=0;e<G.instance.typesLevel.length;e++)if(G.instance.typesLevel[e]<G.instance.maxLevel[e]){r=!1;break}(0==G.instance.itemsComp.items.numChildren||r)&&i(),e.event(s.Game_ObsBoard_LevelUp)}else P.game.vibrateShort(),G.instance.runMoveComp.Hit(),G.instance.hitUpgare(),i();break;case l.Hero_1:this.colliderActive&&(t?t.isBullet&&(t.colliderActive=!1,t.self.destroy(),this.hurt(G.instance.typesLevel[2])):this.hurt(this.heroHp))}}boardUpdate(){let e,t,a=new Laya.Vector3,i=[];for(let o=0;o<3;o++){a.x=2.6-2.6*o,a.z=-.1;for(let s=0;s<6;s++){let n,r;if(a.y=.6*s,this.boardNumber.length>1?(n=this.boardNumber.pop(),r=this.boardNumber.pop()):(n=G.instance.bornStageObj("Number",this.self),r=G.instance.bornStageObj("Number",this.self)),i.push(n),i.push(r),n.active=!0,r.active=!0,G.instance.typesLevel[o]<=G.instance.maxLevel[o])if(G.instance.typesLevel[o]<7||2==o)n.transform.localPosition=a,r.active=!1,(e=n.meshRenderer.material.clone()).tilingOffset=new Laya.Vector4(1,1,.125*(2+s),0),n.meshRenderer.material=e;else if(s<2)r.active=!1,n.transform.localPosition=a,(e=n.meshRenderer.material.clone()).tilingOffset=new Laya.Vector4(1,1,.125*s,.125),n.meshRenderer.material=e;else{r.active=!0;let i=a.clone();i.x-=.2,n.transform.localPosition=i,i.x+=.4,r.transform.localPosition=i;let o=Math.floor((8+s)/10),l=Math.floor((8+s)%10);(e=n.meshRenderer.material.clone()).tilingOffset=new Laya.Vector4(1,1,.125*l,0),n.meshRenderer.material=e,(t=r.meshRenderer.material.clone()).tilingOffset=new Laya.Vector4(1,1,.125*o,0),r.meshRenderer.material=t}}let s,n="Board_"+(o+1).toString()+"_1",r=S.d3_FindNodeByName(this.self,n),l=r.transform.localPosition.clone();G.instance.typesLevel[o]<=G.instance.maxLevel[o]&&(s=G.instance.typesLevel[o]<7||2==o?(s=(G.instance.typesLevel[o]-1)/6)>=1?1:s:(G.instance.typesLevel[o]-7)/6),l.y=-3.6*(1-s),r.transform.localPosition=l}this.boardNumber=i}hurt(e=5){if(this.heroHp-=e,this.heroHp<=0)this.die();else{let e=this.self.getChildAt(0).getComponent(Laya.Animator);e.speed=.75,this.colliderActive=!1;let t="hit"+S.randomInt(1,3);e.play(t,0,0);let a=this.self.getChildAt(0),i="Hero_Red";for(let e=1;e<a.numChildren;e++){let t=a.getChildAt(e);t.active=t.name==i}Laya.timer.once(100,this,()=>{for(let e=1;e<a.numChildren;e++){let t=a.getChildAt(e);t.active="Hero_Orange"==t.name}}),Laya.timer.once(250,this,()=>{this.colliderActive=!0})}let t="ui/game/"+(e+S.randomInt(0,2))+".png",i=S.d3_getSpritePosBySprite3DPoint(G.instance.mainCamera,this.self),o=S.randomNumber(-100,100),s=S.randomNumber(50,100);S.faceToast(t,a.instance.scene,new Laya.Vector2(i.x,i.y),new Laya.Vector2(i.x+o,i.y-s)),G.instance.playHurtSound()}die(){Laya.timer.clearAll(this);G.instance.diamondCount+=3;let e=this.self.transform.position.clone();for(let t=0;t<3;t++){let t=G.instance.bornStageObj("Diamond_1",G.instance.mainScene),a=e.clone();a.y+=1,t.transform.position=a;let i=t.addComponent(T);i.isDestory=!1,i.dorpDeadY=.75,i.changeDropData(new Laya.Vector2(20,30),new Laya.Vector2(1,3),new Laya.Vector2(1,3),new Laya.Vector3(S.randomNumber(-2,2),1,S.randomNumber(-2,2)),new Laya.Vector3(S.randomNumber(-10,10),S.randomNumber(-10,10),S.randomNumber(-10,10)),30)}let t=this.self.getChildAt(0);for(let e=1;e<t.numChildren;e++){let a=t.getChildAt(e);a.active="Hero_Black"==a.name}let a=this.self.getChildAt(0).getComponent(Laya.Animator);a.speed=.75,this.colliderActive=!1,a.play("die",0,0)}}class R extends B{constructor(){super(...arguments),this.speed=5,this.maxHp=5,this.isStart=!1,this.nowPathId=0,this.nowHp=0,this.isBig=!1,this.goWay=new Laya.Vector3,this.nowDistance=0,this.maxDistance=0}init(...e){this.anim=this.self.getChildAt(0).getComponent(Laya.Animator)}realInit(e,t){let a=this.self.getChildAt(0),i="Hero_Orange",o=t;this.self.transform.localScale=new Laya.Vector3,o||(i="Hero_Yellow"),o?this.selfTween.toTween(this.self,{sca:new Laya.Vector3(2.25,2.25,2.25)},500):this.selfTween.toTween(this.self,{sca:new Laya.Vector3(1.25,1.25,1.25)},500),this.isBig=o;for(let e=1;e<a.numChildren;e++){let t=a.getChildAt(e);t.active=t.name==i}o&&(this.maxHp=20),this.nowHp=this.maxHp,this.endHouse=e,this.anim.play("run",0,0),this.getWay(),this.isStart=!0}getWay(){if(this.nowPathId++,this.nowPathId>=this.endHouse.numChildren)this.isStart=!1,G.instance.endCheck();else{let e=this.endHouse.getChildAt(this.nowPathId-1);this.self.transform.position=e.transform.position.clone(),this.nowDistance=0;let t=this.endHouse.getChildAt(this.nowPathId);this.goWay=C.subtract(t.transform.position.clone(),e.transform.position.clone()),this.maxDistance=Laya.Vector3.scalarLength(this.goWay),this.goWay=C.normalized(this.goWay);let a=Math.atan2(-this.goWay.z,this.goWay.x)/(2*Math.PI)*360;this.self.transform.localRotationEuler=new Laya.Vector3(0,a-90,0)}}onUpdate(){if(!this.isStart)return;let e=Laya.timer.delta/1e3,t=this.self.transform.position.clone(),a=e*this.speed;t=C.add(t,C.mull(this.goWay,a)),this.nowDistance+=a,this.self.transform.position=t,this.nowDistance>=this.maxDistance&&this.getWay()}hurt(e){if(!this.isStart)return;this.nowHp-=e;let t="hit"+S.randomInt(1,3);if(this.anim.play(t,0,0),this.speed=0,this.nowHp<=0)this.dead();else{let e=this.self.getChildAt(0),t="Hero_Red";for(let a=1;a<e.numChildren;a++){let i=e.getChildAt(a);i.active=i.name==t}Laya.timer.once(100,this,()=>{let t=this.isBig?"Hero_Orange":"Hero_Yellow";for(let a=1;a<e.numChildren;a++){let i=e.getChildAt(a);i.active=i.name==t}}),Laya.timer.once(400,this,()=>{this.anim.crossFade("run",.25,0,0),this.speed=5})}let i="ui/game/"+(e+S.randomInt(0,2))+".png",o=S.d3_getSpritePosBySprite3DPoint(G.instance.mainCamera,this.self),s=S.randomNumber(-100,100),n=S.randomNumber(50,100);S.faceToast(i,a.instance.scene,new Laya.Vector2(o.x,o.y),new Laya.Vector2(o.x+s,o.y-n)),G.instance.playHurtSound()}dead(){G.instance.endCheck(),this.isStart=!1,Laya.timer.clearAll(this),this.anim.play("die",0,0),this.anim.speed=.75;let e=this.self.getChildAt(0);for(let t=1;t<e.numChildren;t++){let a=e.getChildAt(t);a.active="Hero_Black"==a.name}let t=this.isBig?6:3;G.instance.diamondCount+=this.isBig?6:3;let a=this.self.transform.position.clone();for(let e=0;e<t;e++){let e=G.instance.bornStageObj("Diamond_1",G.instance.mainScene),t=a.clone();t.y+=1,e.transform.position=t;let i=e.addComponent(T);i.isDestory=!1,i.dorpDeadY=-19.5,i.changeDropData(new Laya.Vector2(20,30),new Laya.Vector2(1,3),new Laya.Vector2(1,3),new Laya.Vector3(S.randomNumber(-2,2),1,S.randomNumber(-2,2)),new Laya.Vector3(S.randomNumber(-10,10),S.randomNumber(-10,10),S.randomNumber(-10,10)),30)}Laya.timer.once(1e3,this,()=>{a.y-=3*this.self.transform.localScaleX,this.selfTween.toTween(this.self,{pos:a},1e3,()=>{},null,!1)})}}class G{constructor(){this.dropObjs=[],this.colliders=[],this.typesLevel=[1,1,1],this.maxLevel=[13,13,7],this.attackRange=50,this.endPeopleBornCountData=[30,40,50,60],this.endPeopleBornBigCountData=[5,7,9,11],this.endPeopleBornCount=0,this.endPeopleBigCount=0,this.endPeopleCount=0,this.diePeopleCount=0,this.endHouseHpData=100,this.endHouseNowHp=[],this.diamondCount=0,this.isObjToJson=!1,this.nowRound=0,this.playCount=0,this.isWin=!1,this.isEnd=!1,this.isStart=!1,this.isThrowCD=1e3,this.isAttack=!1,this.weaponType=h.Axe,this.nowPoint=new Laya.Vector2,this.shootPos=new Laya.Vector3,this.isEndCanShoot=!0,this.isWaitUpgrade=!1,this.isPressed=!1,this.orignal=0,this.isVibrate=!0,this.isSound=!0,this.hurtSoundCD=100,this.ishurtSoundOK=!0,this.stageObj=[],this.fxPool=[],G.instance=this,this.init()}init(){this.initEvent(),this.readJson()}createShadow(e){e.shadowMode=Laya.ShadowMode.SoftLow,e.shadowDistance=200,e.shadowResolution=1024,e.shadowCascadesMode=Laya.ShadowCascadesMode.NoCascades,e.shadowNormalBias=.6,e.shadowStrength=.4}hideShadow(e){e.shadowMode=Laya.ShadowMode.None}useRetinalCanvas(){Laya.stage.useRetinalCanvas=!0}disabelRetinalCanvas(){Laya.stage.useRetinalCanvas=!1}setFog(e,t,a){t.enableFog=e,e&&(t.fogColor=a,t.fogStart=10,t.fogRange=20)}readJson(){let e=["res/json/stageInfo.json"],t=()=>{Laya.loader.load(e,Laya.Handler.create(this,a=>{if(a)for(let t=0;t<e.length;t++)Laya.loader.load(e[t],Laya.Handler.create(this,e=>{switch(t){case 0:this.stageJson=e,console.log(e);break;default:console.log(e)}}),null,Laya.Loader.JSON);else console.log("load json fail,reload after 1s"),Laya.timer.once(1e3,this,t)}),null,Laya.Loader.JSON)};e.length>0&&t()}JsonV3(e,t){if(t){let a=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),o=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector3(a,i,o)}return new Laya.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z))}V3ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString()}}JsonV4(e,t){if(t){let a=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),o=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t),s=Math.round(parseFloat(e.w)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector4(a,i,o,s)}return new Laya.Vector4(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z),parseFloat(e.w))}V4ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString(),w:e.w.toString()}}firstIn(){console.log("首次进入处理");for(let e=0;e<this.mainScene.numChildren;e++){let t=this.mainScene.getChildAt(e);switch(t.name){case"Prefabs":this.prefabs=t;break;case"Light":this.light=t;break;case"Fxs":this.fxs=t,Laya.timer.once(2e3,this,()=>{this.fxs.active=!1});break;case"Stage":this.stage=t,this.player=this.stage.getChildByName("Player"),this.runMoveComp=this.player.addComponent(V),this.itemsComp=this.player.addComponent(H),this.camPoint=this.player.getChildByName("CamPoint"),this.mainCam=this.camPoint.getChildByName("MainCam"),this.mainCamera=this.mainCam.getChildByName("Main Camera"),this.start=this.stage.getChildByName("Start"),this.end=this.stage.getChildByName("End"),this.rightHand=S.d3_FindNodeByName(this.player,"Hand_1_01"),this.rightHandAnim=this.rightHand.getComponent(Laya.Animator),this.weaponGrip=S.d3_FindNodeByName(this.rightHand,"WeaponGrip"),this.startCamPoint=this.player.getChildByName("CamStartPoint"),this.endCamPoint=this.end.getChildByName("CamPoint"),this.endBulletGrip=this.end.getChildByName("EndBulletGrip"),this.endPeopleGrip=this.end.getChildByName("EndPeopleGrip"),this.endHouse=[];for(let e=0;e<this.end.numChildren;e++){let t=this.end.getChildAt(e);-1!=t.name.indexOf("House_1")&&this.endHouse.push(t)}}}P.checkPerformance(()=>{},()=>{this.disabelRetinalCanvas()},()=>{this.hideShadow(this.light),this.disabelRetinalCanvas()}),this.useRetinalCanvas(),this.createShadow(this.light),this.randomPlayMusic(),this.weaponGrip.addComponent(B)}initEvent(){e.on(s.Game_ObsBoard_LevelUp,this,this.weaponLevelDeal),e.on(s.Game_Level_Update,this,()=>{this.typesLevel=[_.ReadSpeed(),_.ReadAttack(),1],e.event(s.Game_ObsBoard_LevelUp)})}levelInit(){this.isEnd=!1,this.isStart=!1,Laya.timer.clear(this,this.gameUpdate),this.stageObjClear(),this.dropObjs=[],this.fxPool=[],this.colliders=[],this.waters=[],this.bulletsGrip=new Laya.Sprite3D,this.herosGrip=new Laya.Sprite3D,this.mainScene.addChild(this.bulletsGrip),this.mainScene.addChild(this.herosGrip),this.stageObj.push(this.bulletsGrip),this.stageObj.push(this.herosGrip),this.nowRound=0,this.diePeopleCount=0,this.diamondCount=0,this.endHouseNowHp=[];for(let e=0;e<this.endHouse.length;e++)this.endHouse[e].active=!0,this.endHouseNowHp.push(this.endHouseHpData);this.weaponType=null;let e=_.ReadGrade(),t=0;t=e<=10?0:e<=20?1:e<=30?2:3;let a=S.randomInt(-2,2);this.endPeopleBornCount=this.endPeopleBornCountData[t]+a,this.endPeopleCount=this.endPeopleBornCount,a=S.randomInt(-2,2),this.endPeopleBigCount=this.endPeopleBornBigCountData[t]+a;let i=new Laya.Vector3,o=new Laya.Vector3(0,0,100),s=C.add(i,o);this.start.transform.position=i;let n=S.d3_FindNodeByName(this.start,"Water_1");this.waters.push(n),this.typesLevel=[_.ReadSpeed(),_.ReadAttack(),1],this.maxLevel=[13,13,7];{let t,a=this.stage.getChildByName("Level");if(this.isObjToJson){let e=[];for(let t=0;t<a.numChildren;t++){let i=a.getChildAt(t),o={name:"",setInfo:[]};o.name=i.name;for(let e=0;e<i.numChildren;e++){let t=i.getChildAt(e),a={name:"",objInfo:[]};a.name=t.name;for(let e=0;e<t.numChildren;e++){let i=t.getChildAt(e),o=i.name,s=i.transform.localPosition.clone(),n=i.transform.rotation.clone(),r={name:o,pos:this.V3ToJson(s),rot:this.V4ToJson(n)};a.objInfo.push(r)}o.setInfo.push(a)}e.push(o)}console.log(JSON.stringify(e))}if(!0){t=e%this.stageJson.length;let a=this.stageJson[t];for(let e=0;e<a.setInfo.length;e++){let t=a.setInfo[e],i=new Laya.Sprite3D(t.name);this.stage.addChild(i),i.transform.position=s;for(let e=0;e<t.objInfo.length;e++){let a,n,r,h=t.objInfo[e],c=h.name.split(" ")[0],d=C.add(this.JsonV3(h.pos),i.transform.position.clone()),p=this.JsonV4(h.rot);switch(c){case"Road":s=C.add(s,o),this.colliders.push([]),this.colliders.push([]),(a=this.bornStageObj(c,i)).transform.position=d;let e=S.d3_FindNodeByName(a,"Water_1");this.waters.push(e);break;case l.Money:c=l.Money,(a=this.bornStageObj(c,i)).transform.position=d,(r=a.addComponent(O)).setData(l.Money,1,2),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.FireTable_1:c=l.FireTable_1,(a=this.bornStageObj(c,i)).transform.position=d,a.transform.rotation=p,(r=a.addComponent(O)).setData(l.FireTable_1,.8,.8),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.Blade_2:c=l.Blade_2,(a=this.bornStageObj(c,i)).transform.position=d,a.transform.rotation=p,(r=a.addComponent(O)).setData(l.Blade_2,1,1),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.Blade_1:c=l.Blade_1,(a=this.bornStageObj(c,i)).transform.position=d,a.transform.rotation=p,(r=a.addComponent(O)).setData(l.Blade_1,1,1),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.Board_1:c=l.Board_1,(a=this.bornStageObj(c,i)).transform.position=d,a.transform.rotation=p,(r=a.addComponent(O)).setData(l.Board_1,1,8),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.Hero_1:c=l.Hero_1,(a=this.bornStageObj(c,this.herosGrip)).transform.position=d,a.transform.rotation=new Laya.Quaternion,(r=a.addComponent(O)).setData(l.Hero_1,1.5,1.5),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;default:console.log("关卡物品预设里没有该类型物件",c)}}}}else{t=e%a.numChildren;let i=a.getChildAt(t);for(let e=0;e<i.numChildren;e++){let t=i.getChildAt(e),a=new Laya.Sprite3D(t.name);this.stage.addChild(a),a.transform.position=s;for(let e=0;e<t.numChildren;e++){let i,n,r,h=t.getChildAt(e),c=h.name.split(" ")[0],d=C.add(h.transform.localPosition.clone(),a.transform.position.clone()),p=h.transform.rotation.clone();switch(c){case"Road":s=C.add(s,o),this.colliders.push([]),this.colliders.push([]),(i=this.bornStageObj(c,a)).transform.position=d;break;case l.Money:c=l.Money,(i=this.bornStageObj(c,a)).transform.position=d,(r=i.addComponent(O)).setData(l.Money,1,2),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.FireTable_1:c=l.FireTable_1,(i=this.bornStageObj(c,a)).transform.position=d,i.transform.rotation=p,(r=i.addComponent(O)).setData(l.FireTable_1,.8,.8),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.Blade_2:c=l.Blade_2,(i=this.bornStageObj(c,a)).transform.position=d,i.transform.rotation=p,(r=i.addComponent(O)).setData(l.Blade_2,1,1),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.Blade_1:c=l.Blade_1,(i=this.bornStageObj(c,a)).transform.position=d,i.transform.rotation=p,(r=i.addComponent(O)).setData(l.Blade_1,1,1),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.Board_1:c=l.Board_1,(i=this.bornStageObj(c,a)).transform.position=d,i.transform.rotation=p,(r=i.addComponent(O)).setData(l.Board_1,1,8),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;case l.Hero_1:c=l.Hero_1,(i=this.bornStageObj(c,this.herosGrip)).transform.position=d,i.transform.rotation=p,(r=i.addComponent(O)).setData(l.Hero_1,1.5,1.5),n=this.colliderIndexJudge(d),this.colliders[n].push(r);break;default:console.log("关卡物品预设里没有该类型物件",c)}}}}}this.end.transform.position=s,this.player.transform.position=i,this.camPoint.transform.localPosition=this.startCamPoint.transform.localPosition.clone(),this.camPoint.transform.localRotation=this.startCamPoint.transform.localRotation.clone();let r=S.d3_FindNodeByName(this.runMoveComp.model,"Hand_1"),h=S.d3_FindNodeByName(this.runMoveComp.model,"Hand_2");r.active=!0,h.active=!0,this.runMoveComp.reset(90,0),this.runMoveComp.model.transform.localPosition=new Laya.Vector3(0,0,0),this.runMoveComp.model.transform.localRotationEuler=new Laya.Vector3(0,0,0),this.itemsComp.reset(),this.weaponLevelDeal(),Laya.timer.frameLoop(1,this,this.gameUpdate)}gameStart(){this.isStart=!0,this.controlOn(),this.roundInit(),this.playCount++,Laya.timer.loop(16,this,this.fixUpdate),this.runMoveComp.isMove=!0}levelEnd(e){this.isEnd=!0,Laya.timer.clear(this,this.fixUpdate),this.isWin=e,P.goOver()}roundInit(){switch(this.nowRound){case 0:break;case 1:this.controlOff(),this.onMouseUp(),this.runMoveComp.targetHorizontal=0,this.runMoveComp.isMove=!1;let e=new w,t=new w,i=this.runMoveComp.model.transform.localPosition.clone();switch(this.weaponType){case h.Axe:i.z-=0;break;case h.Arch:case h.Gun:case h.Pistol:case h.Rifle:case h.MachineGun:i.z-=1;break;case h.Rocketgun:i.z-=2;break;default:i.z-=0}i.y-=1,t.toTween(this.runMoveComp.model,{pos:i},1e3),e.toTween(this.camPoint,{pos:this.endCamPoint.transform.position.clone(),rot:this.endCamPoint.transform.localRotationEuler.clone()},1e3,()=>{this.runMoveComp.horizontal=0;let e=S.d3_FindNodeByName(this.runMoveComp.model,"Hand_1"),t=S.d3_FindNodeByName(this.runMoveComp.model,"Hand_2");e.active=!1,t.active=!1,Laya.timer.frameOnce(1,this,()=>{this.endShootStart(),this.endPeopleBorn();for(let e=0;e<this.endHouse.length;e++){let t=S.d3_getSpritePosBySprite3DPoint(this.mainCamera,this.endHouse[e],new Laya.Vector3(0,8,0));0==e?(a.instance.house1Bar.x=t.x,a.instance.house1Bar.y=t.y):1==e&&(a.instance.house2Bar.x=t.x,a.instance.house2Bar.y=t.y)}})},null,!1);break;case 2:this.endPeopleBornCount=0,this.itemsComp.items.active=!1,this.endShootEnd(),this.levelEnd(!0);break;default:console.log("多次触发跳关了")}}roundEnd(e=!1){this.isEnd||(this.nowRound++,this.roundInit())}gameUpdate(){let e=Laya.timer.delta/1e3;0==this.nowRound?(this.player.transform.position.z>this.end.transform.position.z&&(this.player.transform.position=this.end.transform.position.clone(),this.runMoveComp.isMove=!1,this.roundEnd(!0)),this.isWaitUpgrade?this.runMoveComp.isMove=this.isPressed:this.isStart&&(this.runMoveComp.isMove=!0)):1==this.nowRound&&(this.runMoveComp.isMove=!1);for(let t=0;t<this.waters.length;t++){let a=this.waters[t],i=a.meshRenderer.material.clone();i.tilingOffset.z-=.05*e,i.tilingOffset.w+=.05*e,a.meshRenderer.material=i}}fixUpdate(){if(0==this.nowRound){let e,t,a=this.itemsComp.items,i=new Laya.Vector3;i=this.runMoveComp.model.transform.position.clone();let o=this.colliderIndexJudge(i);if(o>=0&&o<this.colliders.length)for(let e=0;e<this.colliders[o].length;e++){let t,a=this.colliders[o][e];for(let s=0;s<this.colliders[o][e].colliderSprite.length;s++){let n=this.colliders[o][e].colliderSprite[s];if(n&&!n.destroyed){let e=n.transform.position.clone();if((t=a.isCircle?S.CircleCheck_2D(i.z,i.x,.5,e.z,e.x,a.raidus):S.BoxCheck_2D_Normal(i.z,i.x,1,1,e.z,e.x,a.range,a.width)).isHit)break}}if(t&&t.isHit){a.colliderDo();break}}for(let s=0;s<a.numChildren;s++)if((e=a.getChildAt(s))&&!e.destroyed){if(i=e.transform.position.clone(),!(t=e.getComponent(D)).colliderActive)continue;if(o=this.colliderIndexJudge(i),i.z>=this.end.transform.position.z&&e.destroy(),o>=0&&o<this.colliders.length)for(let e=0;e<this.colliders[o].length;e++){let a,s=this.colliders[o][e];for(let n=0;n<this.colliders[o][e].colliderSprite.length;n++){let r=this.colliders[o][e].colliderSprite[n];if(r&&!r.destroyed){let e=r.transform.position.clone();if((a=s.isCircle?S.CircleCheck_2D(i.z,i.x,t.raidus,e.z,e.x,s.raidus):S.BoxCheck_2D_Normal(i.z,i.x,t.range,t.width,e.z,e.x,s.range,s.width)).isHit)break}}if(a&&a.isHit){s.colliderDo(t);break}}}for(let e=0;e<this.bulletsGrip.numChildren;e++){let a=this.bulletsGrip.getChildAt(e);if(a&&!a.destroyed){if(i=a.transform.position.clone(),!(t=a.getComponent(D)).colliderActive)continue;if((o=this.colliderIndexJudge(i))>=0&&o<this.colliders.length)for(let e=0;e<this.colliders[o].length;e++){let a,s=this.colliders[o][e];for(let n=0;n<this.colliders[o][e].colliderSprite.length;n++){let r=this.colliders[o][e].colliderSprite[n];if(r&&!r.destroyed){let e=r.transform.position.clone();if((a=s.isCircle?S.CircleCheck_2D(i.z,i.x,t.raidus,e.z,e.x,s.raidus):S.BoxCheck_2D_Normal(i.z,i.x,t.range,t.width,e.z,e.x,s.range,s.width)).isHit)break}}if(a&&a.isHit){s.colliderDo(t);break}}}}let s=!1;for(let e=0;e<this.herosGrip.numChildren;e++){let t=this.herosGrip.getChildAt(e);if(t&&!t.destroyed){let e=t.transform.position.z-this.player.transform.position.z;if(e>0&&e<this.attackRange){s=!0;break}}}this.isAttack=s}else if(1==this.nowRound)for(let e=this.endBulletGrip.numChildren-1;e>=0;e--){let t=this.endBulletGrip.getChildAt(e);if(t&&!t.destroyed)for(let e=this.endPeopleGrip.numChildren-1;e>=0;e--){let a=this.endPeopleGrip.getChildAt(e);if(a&&!a.destroyed&&t.transform.position.y<3*a.transform.localScaleX-20){let e=t.transform.position.clone(),i=a.transform.position.clone();if(S.BoxCheck_2D_Normal(e.z,e.x,1.5,1.5,i.z,i.x,1,1).isHit){t.destroy(),a.getComponent(R).hurt(this.typesLevel[2]);break}}}if(t&&!t.destroyed){let e=this.endHouse.length;for(let i=0;i<this.endHouse.length;i++){let o=this.endHouse[i];if(this.endHouseNowHp[i]>0){if(t.transform.position.y<-15){let e=t.transform.position.clone(),s=o.transform.position.clone();if(S.BoxCheck_2D_Normal(e.z,e.x,1.5,1.5,s.z,s.x,2,2).isHit){t.destroy(),this.endHouseNowHp[i]-=this.typesLevel[2];let e=this.endHouseNowHp[i]/this.endHouseHpData;e<0&&(e=0),0==i?a.instance.house1Bar.value=e:1==i&&(a.instance.house2Bar.value=e);let s="ui/game/"+(this.typesLevel[2]+S.randomInt(0,2))+".png",n=S.d3_getSpritePosBySprite3DPoint(G.instance.mainCamera,o),r=S.randomNumber(-100,100),l=S.randomNumber(50,100);if(S.faceToast(s,a.instance.scene,new Laya.Vector2(n.x,n.y),new Laya.Vector2(n.x+r,n.y-l)),this.endHouseNowHp[i]<=0){o.active=!1;let e=30;G.instance.diamondCount+=G.instance.diamondCount+=100;let t=o.transform.position.clone();for(let a=0;a<e;a++){let e=G.instance.bornStageObj("Diamond_1",G.instance.mainScene),a=t.clone();a.y+=1,e.transform.position=a;let i=e.addComponent(T);i.isDestory=!1,i.dorpDeadY=-19,i.changeDropData(new Laya.Vector2(20,30),new Laya.Vector2(1,3),new Laya.Vector2(1,3),new Laya.Vector3(S.randomNumber(-2,2),1,S.randomNumber(-2,2)),new Laya.Vector3(S.randomNumber(-10,10),S.randomNumber(-10,10),S.randomNumber(-10,10)),30)}0==i?a.instance.house1Bar.visible=!1:1==i&&(a.instance.house2Bar.visible=!1)}break}}}else e--}if(0==e){for(let e=0;e<this.endPeopleGrip.numChildren;e++)this.endPeopleGrip.getChildAt(e).getComponent(R).dead();this.roundEnd(!0)}}}}colliderIndexJudge(e){return Math.floor((e.z-100)/50)}AutoAttack(){if(this.isThrowCD=1500-100*(this.typesLevel[0]-1),Laya.timer.once(this.isThrowCD,this,this.AutoAttack),!this.isAttack)return;let e,t,a,i=this.isThrowCD/1500,o="Throw",s=(new Laya.Vector3,300*i),r=500*i,l=!1,c="Axe",d=()=>{},p=()=>{};e=this.weaponGrip.getChildAt(0);let m=()=>{s=67*i,r=800*i,o="Shoot",c="Bullet_1",l=!1,(a=e.getChildByName("fx")).active=!1,a.transform.localScale=new Laya.Vector3(1,1,1),d=(()=>{a&&(a.active=!0)}),p=(()=>{})};switch(this.weaponType){case h.Axe:o="Throw",s=300*i,r=500*i,l=!0,c="Axe",d=(()=>{this.weaponGrip&&(this.weaponGrip.transform.localScale=new Laya.Vector3)}),p=(()=>{if(this.weaponGrip){this.weaponGrip.transform.localScale=new Laya.Vector3(1,1,1),this.weaponGrip.getComponent(B).selfTween.toScaleTween(this.weaponGrip,new Laya.Vector3,new Laya.Vector3(1,1,1),300*i,()=>{},Laya.Ease.circOut)}}),a=this.weaponGrip,L.play(n.Axe);break;case h.Arch:s=67*i,r=800*i,o="Shoot",(t=e.getComponent(Laya.Animator)).play("Arch",0,0),c="Arrow_1",l=!1,a=e.getChildByName("Arrow_1"),d=(()=>{}),p=(()=>{t&&(t.play("empty",0,0),t.speed=1/i)}),L.play(n.Arch);break;case h.Gun:case h.Pistol:case h.Rifle:case h.MachineGun:m(),L.play(n.Gun);break;case h.Rocketgun:m(),L.play(n.RocketGun);break;default:o="Throw"}this.rightHandAnim.play(o,0,0),this.rightHandAnim.speed=1/i,Laya.timer.once(s,this,()=>{d();let e=this.typesLevel[1];for(let t=0;t<e;t++){let a,i=0;i=e%2==0?t+2:t+1;let o=10;switch(Math.floor(i/2)){case 0:o=0;break;case 1:o=10;break;case 2:o=7.5;break;case 3:o=6;break;case 4:o=5.25;break;case 5:o=4.8;break;case 6:o=4.5}let s=(a=i%2==0?Math.floor(i/2)*o:-Math.floor(i/2)*o)/90*Math.PI/2,n=this.bornStageObj(c,this.mainScene);n.transform.position=this.weaponGrip.transform.position.clone(),n.transform.rotationEuler=new Laya.Vector3(0,-180,0),this.bornFxStage("Trail",n);let r=n.addComponent(T);n.addComponent(D).setData(2,1,!0),this.bulletsGrip.addChild(n);let h=Math.abs(50*Math.sin(s)),d=75*Math.cos(s);r.changeDropData(new Laya.Vector2(2.5,2.5),new Laya.Vector2(h,h),new Laya.Vector2(d,d),new Laya.Vector3(Math.sin(s),0,Math.cos(s)),new Laya.Vector3(l?360:0,0,0),15),r.dorpDeadY=-1}}),Laya.timer.once(r,this,()=>{p(),this.rightHandAnim.speed=1})}changeWeapon(e){if(this.weaponType!=e){let t;this.weaponGrip.active=!0,this.weaponGrip.destroyChildren(),this.weaponType=e,this.rightHandAnim.play("Grab",0,0),(t=this.bornStageObj(e,this.weaponGrip)).transform.localRotationEuler=new Laya.Vector3;let a=t.addComponent(B);Laya.timer.frameOnce(1,this,()=>{a.selfTween&&a.selfTween.toScaleTween(t,new Laya.Vector3,new Laya.Vector3(1,1,1),500,()=>{})}),this.AutoAttack()}}weaponLevelDeal(){let e=G.instance.typesLevel[2];switch(this.rightHandAnim.speed=1,e){case 1:G.instance.changeWeapon(h.Axe);break;case 2:G.instance.changeWeapon(h.Arch);break;case 3:G.instance.changeWeapon(h.Gun);break;case 4:G.instance.changeWeapon(h.Pistol);break;case 5:G.instance.changeWeapon(h.Rifle);break;case 6:G.instance.changeWeapon(h.MachineGun);break;case 7:G.instance.changeWeapon(h.Rocketgun)}}endShootStart(){e.on(f.getAxis,this,this.pointUpdate),this.nowPoint=new Laya.Vector2(Laya.stage.width/2,Laya.stage.height/2),a.instance.aim.x=this.nowPoint.x,a.instance.aim.y=this.nowPoint.y;let t,i=this.weaponGrip.getChildAt(0);t=this.weaponType==h.Axe?this.weaponGrip:this.weaponType==h.Arch?i.getChildByName("fx"):S.d3_FindNodeByName(this.weaponGrip,"fx"),this.shootPos=t.transform.position.clone(),this.onShootTouncShoot()}pointUpdate(e){let t=this.nowPoint;t.x+=e.x,t.y+=e.y,this.nowPoint=t,this.runMoveComp.model.transform.rotate(new Laya.Vector3(75e-5*e.y,-75e-5*e.x,0),!1),a.instance.aim.x=this.nowPoint.x,a.instance.aim.y=this.nowPoint.y}onShootTouncShoot(){this.isThrowCD=1500-100*(this.typesLevel[0]-1);let e=this.nowPoint;Laya.timer.once(this.isThrowCD,this,this.onShootTouncShoot);let t=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0));this.mainCamera.viewportPointToRay(e,t);let a=this.isThrowCD/1500,i="Throw",o="Axe",s=!0,r=!1,l=300,c=S.d3_FindNodeByName(this.weaponGrip,"Arrow_1"),d=this.weaponGrip.getChildAt(0),p=d.getComponent(Laya.Animator);this.weaponType==h.Axe?(i="Throw",o="Axe",s=!0,r=!1,c=this.weaponGrip,l=300*a,L.play(n.Axe)):this.weaponType==h.Arch?(l=67*a,i="Shoot",o="Arrow_1",s=!1,r=!1,p.play("ArchNoArrow",0,0),p.speed=1/a,c=d.getChildByName("fx"),L.play(n.Arch)):(i="Shoot",o="Bullet_1",s=!1,r=!0,l=67*a,c=S.d3_FindNodeByName(this.weaponGrip,"fx"),this.weaponType!=h.Rocketgun?L.play(n.Gun):L.play(n.RocketGun));let m=c.transform.position.clone();this.rightHandAnim.play(i,0,0),this.rightHandAnim.speed=1/a;let y=this.bornStageObj(o,this.mainScene);this.bornFxStage("Trail",y);let u=c;r&&(u.active=!1,u.transform.localScale=new Laya.Vector3(1,1,1),Laya.timer.once(67*a,this,()=>{u&&(u.active=!0)})),Laya.timer.once(l,this,()=>{let e=this.typesLevel[1];for(let a=0;a<e;a++){let e,i=0;i=a+1;let n=10;switch(Math.floor(i/2)){case 0:n=0;break;case 1:n=5;break;case 2:n=10;break;case 3:n=13;break;case 4:n=15;break;case 5:n=17;break;case 6:n=19}let r=Math.atan2(t.direction.y,t.direction.z),l=Math.atan2(t.direction.x,t.direction.z),h=(e=i%2==0?n:-n)/90*Math.PI/2,c=this.bornStageObj(o,this.endBulletGrip);c.transform.position=m,c.transform.rotationEuler=new Laya.Vector3(0,-180,0),(l+=.25*h)>0&&l<.3&&(l+=(.3-l)/.3*.07),c.transform.rotate(new Laya.Vector3(-r,l,0),!1,!0),this.bornFxStage("Trail",c);let d=c.addComponent(T);d.setTimeDestroy(2e3);let p=new Laya.Vector3;c.transform.getForward(p);let y=Math.abs(100*Math.sin(5*l)),u=100*Math.cos(l);d.dorpDeadY=-22;let g=80*r;s||(y*=1.5,u*=1.5,g*=1.5),d.changeDropData(new Laya.Vector2(g,g),new Laya.Vector2(y,y),new Laya.Vector2(u,u),p,new Laya.Vector3(s?360:0,0,0),15)}})}endShootEnd(){e.off(f.getAxis,this,this.pointUpdate),Laya.timer.clear(this,this.onShootTouncShoot)}endPeopleBorn(){let e=this.endHouse[this.endPeopleBornCount%2];if(!e||e.destroyed)return;if(!e.active)return this.endPeopleBornCount--,void Laya.timer.once(500,this,this.endPeopleBorn);let t=this.bornStageObj("Hero_1",this.endPeopleGrip);t.transform.position=e.transform.position.clone();let a=t.addComponent(R),i=this.endPeopleBornCount<=this.endPeopleBigCount;a.realInit(e,i),this.endPeopleBornCount--,this.endPeopleBornCount<=0||Laya.timer.once(500,this,this.endPeopleBorn)}endCheck(){this.diePeopleCount++,this.diePeopleCount>=this.endPeopleCount&&this.roundEnd(!0)}hitUpgare(){let e=!0;for(let t=0;t<this.typesLevel.length;t++)if(this.typesLevel[t]<this.maxLevel[t]){e=!1;break}return this.isWaitUpgrade=this.itemsComp.items.numChildren>0&&!e,this.isWaitUpgrade}controlOn(){e.on(f.singleTouchStart,this,this.onMouseDown),e.on(f.singleTouchMove,this,this.onMouseMove),e.on(f.singleTouchEnd,this,this.onMouseUp)}controlOff(){e.off(f.singleTouchStart,this,this.onMouseDown),e.off(f.singleTouchMove,this,this.onMouseMove),e.off(f.singleTouchEnd,this,this.onMouseUp)}onMouseDown(e){this.isPressed=!0,this.orignal=e.stageX/Laya.stage.width,this.runMoveComp&&0==this.nowRound&&this.runMoveComp.checkOut()}onMouseMove(e){if(this.isPressed){let t=e.stageX/Laya.stage.width-this.orignal;this.runMoveComp&&0==this.nowRound&&this.runMoveComp.checkWay(2*t)&&(this.orignal=e.stageX/Laya.stage.width)}}onMouseUp(){this.isPressed=!1,this.runMoveComp&&0==this.nowRound&&this.runMoveComp.checkOut()}vibrateShort(){this.isVibrate&&P.platform.vibrateShort()}soundSwitch(e){this.isSound=e,Laya.SoundManager.musicVolume=this.isSound?1:0,Laya.SoundManager.soundVolume=this.isSound?1:0}randomPlayMusic(){L.playMusic("Bgm"),Laya.timer.once(35e3,this,this.randomPlayMusic)}playHurtSound(){this.ishurtSoundOK&&(this.ishurtSoundOK=!1,Laya.timer.once(this.hurtSoundCD,this,()=>{this.ishurtSoundOK=!0}),L.play(n.Hit))}bornStageObj(e,t=this.mainScene){let a=this.prefabs.getChildByName(e);if(!a)return console.warn("生成物体不存在",e),null;let i=Laya.Sprite3D.instantiate(a,t);return i.transform.localPosition=new Laya.Vector3,this.stageObj.push(i),i}stageObjClear(){for(let e=this.stageObj.length-1;e>=0;e--)this.stageObj[e]&&!this.stageObj[e].destroyed&&this.stageObj[e].destroy();this.stageObj=[]}bornFxDestroy(e,t,a=1e3,i=1,o=new Laya.Vector3){let s=this.fxs.getChildByName(e).clone();return t.addChild(s),s.transform.localPosition=o,s.transform.localRotationEuler=new Laya.Vector3,s.transform.localScale=new Laya.Vector3(i,i,i),Laya.timer.once(a,this,()=>{s.destroy()}),s}bornFxFromPool(e,t,a=1e3,i=1,o=new Laya.Vector3){let s;for(let t=this.fxPool.length-1;t>=0;t--)if(this.fxPool[t].name==e){(s=this.fxPool.splice(t,1)[0]).active=!0;break}if(!s){let t=this.fxs.getChildByName(e);s=t.clone()}return t.addChild(s),this.stageObj.push(s),s.transform.localPosition=o,s.transform.localRotationEuler=new Laya.Vector3,s.transform.localScale=new Laya.Vector3(i,i,i),Laya.timer.once(a,this,()=>{s&&!s.destroyed&&(this.mainScene.addChild(s),s.active=!1,this.fxPool.push(s))}),s}bornFxStage(e,t,a=1,i=new Laya.Vector3){let o=this.fxs.getChildByName(e).clone();return t.addChild(o),o.transform.localPosition=i,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(a,a,a),this.stageObj.push(o),o}}class I extends t{init(){this.updateCoinUI(),this.stageValue.value=_.ReadGrade().toString(),this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?3*G.instance.diamondCount:G.instance.diamondCount).toString(),L.play(n.Complete)}initEvent(){this.videoCheckBox.on("change",this,()=>{this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?3*G.instance.diamondCount:G.instance.diamondCount).toString()}),S.d2_AddClickEvent(this.btnContinue,this,this.onBtnContinueClick)}onBtnContinueClick(){this.btnContinue.offAllCaller(this);let e=this,t=()=>{_.AddCoin(e.videoCheckBox.selected?3*G.instance.diamondCount:G.instance.diamondCount),e.updateCoinUI(),L.play(n.GetMoney),S.d2_coinCollectAnim("ui/game/yxjm_zs_2.png",new Laya.Vector2(e.btnContinue.x,e.btnContinue.y),new Laya.Vector2(e.coinValue.x,e.coinValue.y),e.scene,10,1,()=>{P.game.isWin&&_.AddGrade(),P.goHome()})};this.videoCheckBox,t()}updateCoinUI(){this.coinValue.value=_.ReadCoin().toString()}}class N{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("Main/Scenes/Game.ts",a),e("Tools/ctrl/TouchCtrl.ts",b),e("Tools/ctrl/TouchScan.ts",v),e("Main/Scenes/Home.ts",A),e("Main/Scenes/Load.ts",k),e("Main/Scenes/Over.ts",I)}}N.width=750,N.height=1334,N.scaleMode="fixedwidth",N.screenMode="vertical",N.alignV="middle",N.alignH="center",N.startScene="scenes/Game.scene",N.sceneRoot="",N.debug=!1,N.stat=!1,N.physicsDebug=!1,N.exportSceneToJson=!0,N.init();new class{constructor(){window.Laya3D?Laya3D.init(N.width,N.height):Laya.init(N.width,N.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=N.scaleMode,Laya.stage.screenMode=N.screenMode,Laya.stage.alignV=N.alignV,Laya.stage.alignH=N.alignH,Laya.URL.exportSceneToJson=N.exportSceneToJson,(N.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),N.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),N.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){P.init(new G)}}}();