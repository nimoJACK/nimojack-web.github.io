!function(){"use strict";var e,t,a,s,i,o,n,r,l,h,d,c,m,y,g;!function(e){e.Load="scenes/Load.scene",e.Home="scenes/Home.scene",e.Game="scenes/Game.scene",e.Over="scenes/Over.scene"}(e||(e={})),function(e){e.SubPackage="分包",e.Scene3D="3D场景"}(t||(t={})),function(e){e[e.Scene_Load_Open=0]="Scene_Load_Open",e[e.Scene_Home_Open=1]="Scene_Home_Open",e[e.Scene_Game_Open=2]="Scene_Game_Open",e[e.Scene_Over_Open=3]="Scene_Over_Open",e[e.Progress_Load_Update=4]="Progress_Load_Update",e[e.Platform_Wake_Do=5]="Platform_Wake_Do",e[e.Platform_Hide_Do=6]="Platform_Hide_Do",e[e.Game_Obs_ItemAdd=7]="Game_Obs_ItemAdd",e[e.Game_Obs_ItemUpgrade=8]="Game_Obs_ItemUpgrade",e[e.Game_Progress_Update=9]="Game_Progress_Update",e[e.Data_Coin_Update=10]="Data_Coin_Update",e[e.Game_Score_Update=11]="Game_Score_Update"}(a||(a={})),function(e){e.Brush="Brush",e.Lipstick="Lipstick",e.Eyelash="Eyelash",e.Wax_1="Wax_1",e.Eyeshadow_1="Eyeshadow_1",e.Comb="Comb",e.Parfume="Parfume"}(s||(s={})),function(e){e.Brush_1="Brush_1",e.Mist_1="Mist_1",e.Door_1="Door_1",e.Door_2="Door_2",e.Wheel_1="Wheel_1",e.Fork_1="Fork_1",e.Billboard_1="Billboard_1",e.Head="Head"}(i||(i={})),function(e){e.Bgm="Bgm",e.Button="Button",e.Get="Get",e.BreakDoor="BreakDoor",e.Send="Send",e.Spary="Spary",e.Lose="Lose",e.Happy="Happy",e.Angry="Angry",e.MakeUp="MakeUp",e.Cheers="Cheers",e.Complete="Complete",e.GetMoney="GetMoney",e.Unlock="Unlock"}(o||(o={})),n||(n={}),function(e){e.Load="scenes/Load.scene",e.Home="scenes/Home.scene",e.Game="scenes/Game.scene",e.Over="scenes/Over.scene"}(r||(r={})),function(e){e.SubPackage="分包",e.Scene3D="3D场景"}(l||(l={})),function(e){e[e.Scene_Load_Open=0]="Scene_Load_Open",e[e.Scene_Home_Open=1]="Scene_Home_Open",e[e.Scene_Game_Open=2]="Scene_Game_Open",e[e.Scene_Over_Open=3]="Scene_Over_Open",e[e.Progress_Load_Update=4]="Progress_Load_Update",e[e.Platform_Wake_Do=5]="Platform_Wake_Do",e[e.Platform_Hide_Do=6]="Platform_Hide_Do",e[e.Game_Obs_ItemAdd=7]="Game_Obs_ItemAdd",e[e.Game_Obs_ItemUpgrade=8]="Game_Obs_ItemUpgrade",e[e.Game_Progress_Update=9]="Game_Progress_Update",e[e.Data_Coin_Update=10]="Data_Coin_Update",e[e.Game_Score_Update=11]="Game_Score_Update"}(h||(h={})),function(e){e.Brush="Brush",e.Lipstick="Lipstick",e.Eyelash="Eyelash",e.Wax_1="Wax_1",e.Eyeshadow_1="Eyeshadow_1",e.Comb="Comb",e.Parfume="Parfume"}(d||(d={})),function(e){e.Brush_1="Brush_1",e.Mist_1="Mist_1",e.Door_1="Door_1",e.Door_2="Door_2",e.Wheel_1="Wheel_1",e.Fork_1="Fork_1",e.Billboard_1="Billboard_1",e.Head="Head"}(c||(c={})),function(e){e.Bgm="Bgm",e.Button="Button",e.Get="Get",e.BreakDoor="BreakDoor",e.Send="Send",e.Spary="Spary",e.Lose="Lose",e.Happy="Happy",e.Angry="Angry",e.MakeUp="MakeUp",e.Cheers="Cheers",e.Complete="Complete",e.GetMoney="GetMoney",e.Unlock="Unlock"}(m||(m={})),y||(y={});class p{static init(){for(var e in this._soundCtx={},this._soundFile=[],this.loopSounds=[],m){let t=m[e];this._soundFile.push(t)}console.log("音效：",this._soundFile);let t=this._pathRoot,a="",s=this._soundFile,i=this._soundFile.length;for(let e=0;e<i;++e){a=s[e];let i=new Laya.SoundChannel;i.url=t+a+this.soundType,Laya.SoundManager.addChannel(i),this._soundCtx[a]=!0}Laya.SoundManager.autoStopMusic=!0}static setSoundVolume(e,t){this._soundCtx[e]&&Laya.SoundManager.setSoundVolume(t,this._pathRoot+e+this.soundType)}static play(e,t=!1){if(this._soundCtx[e])return t&&-1==this.loopSounds.indexOf(e)?(this.loopSounds.push(e),Laya.SoundManager.playSound(this._pathRoot+e+this.soundType,0)):Laya.SoundManager.playSound(this._pathRoot+e+this.soundType)}static stop(e,t=!1){if(this._soundCtx[e]){if(t){let t=this.loopSounds.indexOf(e);-1!=t&&this.loopSounds.splice(t,1)}Laya.SoundManager.stopSound(this._pathRoot+e+this.soundType)}}static playMusic(e){Laya.SoundManager.stopMusic(),e?(Laya.SoundManager.playMusic(this._pathRoot+e+this.soundType,0),this.currentBgm=e):this.currentBgm?Laya.SoundManager.playMusic(this._pathRoot+this.currentBgm+this.soundType,0):Laya.SoundManager.playMusic(this._pathRoot+m.Bgm+this.soundType,0)}static stopMusic(){Laya.SoundManager.stopMusic()}}p._pathRoot="res/sounds/",p.soundType=".mp3";class u{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(e){return Math.round(10*e)}toTween(e,t,a,s,i,o=!0){if(this.target=e,this.isLocal=o,e&&!e.destroyed){var n={},r={};if(t.pos){var l=o?e.transform.localPosition.clone():e.transform.position.clone();n.posX=l.x,n.posY=l.y,n.posZ=l.z,r.posX=t.pos.x,r.posY=t.pos.y,r.posZ=t.pos.z}if(t.rot){var h=o?e.transform.localRotationEuler.clone():e.transform.rotationEuler.clone();n.rotX=h.x,n.rotY=h.y,n.rotZ=h.z,r.rotX=t.rot.x,r.rotY=t.rot.y,r.rotZ=t.rot.z}if(t.sca){var d=e.transform.getWorldLossyScale().clone();n.scaX=d.x,n.scaY=d.y,n.scaZ=d.z,r.scaX=t.sca.x,r.scaY=t.sca.y,r.scaZ=t.sca.z}this.tween.to(n,{posX:r.posX,posY:r.posY,posZ:r.posZ,rotX:r.rotX,rotY:r.rotY,rotZ:r.rotZ,scaX:r.scaX,scaY:r.scaY,scaZ:r.scaZ},a,i,Laya.Handler.create(this,()=>{s&&s();var t=this.tweens.shift();e&&!e.destroyed&&(t?this.toTween(this.target,t.value,t.time,t.completeFun,i):this.updateTweenCallback&&(this.updateTweenCallback=null))}));var c=0;return this.tween.update=new Laya.Handler(this,()=>{if(!e||e.destroyed)return;let s=(c+=Laya.timer.delta)/a;s>1&&(s=1),t.pos&&(o?e.transform.localPosition=new Laya.Vector3(n.posX,n.posY,n.posZ):e.transform.position=new Laya.Vector3(n.posX,n.posY,n.posZ)),t.rot&&(o?e.transform.localRotationEuler=new Laya.Vector3(n.rotX,n.rotY,n.rotZ):e.transform.rotationEuler=new Laya.Vector3(n.rotX,n.rotY,n.rotZ)),t.sca&&e.transform.setWorldLossyScale(new Laya.Vector3(n.scaX,n.scaY,n.scaZ)),this.updateTweenCallback&&this.updateTweenCallback(s)}),this}}clearTween(e){this.tweens=[],this.tween.clear(),this.target&&e&&(e.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z):this.target.transform.position=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z)),e.rot&&(this.target.transform.rotationEuler=new Laya.Vector3(e.rot.x,e.rot.y,e.rot.z)),e.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(e.sca.x,e.sca.y,e.sca.z)))}then(e,t,a){return this.tweens.push({value:e,time:t,completeFun:a}),this}toScaleTween(e,t,a,s,i,o=Laya.Ease.elasticOut){e.transform.localScale=t,this.toTween(e,{sca:a},s,i,o)}}class f{static add(e,t){var a=new Laya.Vector3;return Laya.Vector3.add(e,t,a),a.clone()}static subtract(e,t){var a=new Laya.Vector3;return Laya.Vector3.subtract(e,t,a),a.clone()}static mull(e,t){var a=new Laya.Vector3;return Laya.Vector3.scale(e,t,a),a.clone()}static dot(e,t){return Laya.Vector3.dot(e,t)}static cross(e,t){var a=new Laya.Vector3;return Laya.Vector3.cross(e,t,a),a.clone()}static normalized(e){var t=new Laya.Vector3;return Laya.Vector3.normalize(e,t),t.clone()}static distance(e,t){var a=f.subtract(e,t);return Laya.Vector3.scalarLength(a)}}class C{static d3_getSpritePosBySprite3DPoint(e,t,a=new Laya.Vector3(0,0,0)){var s=t.transform.position.clone();s.x+=a.x,s.y+=a.y,s.z+=a.z;var i=new Laya.Vector4;e.viewport.project(s,e.projectionViewMatrix,i);var o=new Laya.Vector2(i.x/Laya.stage.clientScaleX,i.y/Laya.stage.clientScaleY);return new Laya.Point(o.x,o.y)}static d3_FindNodeByName(e,t){let a=null,s=e=>{for(let i=0;i<e.numChildren;i++){if(e.getChildAt(i).name==t)return void(a=e.getChildAt(i));s(e.getChildAt(i))}};return s(e),a}static d3_switchAllMathInChildren(e,t){if(e.meshRenderer){let a=e.meshRenderer.material.clone();a.albedoColor=C.d3_getRgbByHex(t),e.meshRenderer.material=a}for(let a=0;a<e.numChildren;a++){let s=e.getChildAt(a);if(s.meshRenderer){let e=new Laya.BlinnPhongMaterial,a=C.d3_getRgbByHex(t);e.albedoColor=new Laya.Vector4(a.x,a.y,a.z,1),e.specularColor=new Laya.Vector4(0,0,0,1),s.meshRenderer.material=e}this.d3_switchAllMathInChildren(s,t)}}static d3_unactiveAllChildren(e){for(let t=0;t<e.numChildren;t++)e.getChildAt(t).active=!1}static d3_objectScaleTips(e){let t=new u,a=e.transform.localScale.clone(),s=f.mull(a,.8),i=f.mull(a,1.2);t.toTween(e,{sca:s},50).then({sca:i},50).then({sca:a},50)}static d3_getRgbByHex(e){var t=[],a=[];let s=e.replace(/#/,"");if(3==s.length){for(var i=[],o=0;o<3;o++)i.push(s.charAt(o)+s.charAt(o));s=i.join("")}for(o=0;o<3;o++)t[o]="0x"+s.substr(2*o,2),a.push(parseInt(t[o]));return new Laya.Vector3(a[0]/255,a[1]/255,a[2]/255)}static d3_objectShake(e,t=1,a=.7){var s=t,i=1,o=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(s>0){var t=new Laya.Vector3;Laya.Vector3.scale((n=Math.random()>.5?Math.random():-Math.random(),r=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(n,r,0)),a,t),Laya.Vector3.add(o,t,t),e.transform.localPosition=t,s-=.02*i}else s=0,e.transform.localPosition=o,Laya.timer.clear(this,updateShake);var n,r})}static getAngle(e,t){var a=Laya.Vector3.dot(e,t),s=Laya.Vector3.scalarLength(e)*Laya.Vector3.scalarLength(t);if(0==s){if(e.z>t.z)return 0;if(e.z<t.z)return 180;if(e.y>t.y)return 90;if(e.y<t.y)return-90}var i=a/s;return i<-1&&(i=-1),i>1&&(i=1),180*Math.acos(i)/Math.PI}static getAngleUp(e,t,a){let s=C.getAngle(e,t),i=new Laya.Vector3;return Laya.Vector3.cross(t,e,i),C.getAngle(a,i)>90&&(s*=-1),s}static getProjection(e,t){let a=f.mull(t,f.dot(e,t));return f.subtract(e,a)}static d2_AddClickEvent(e,t,a,s,i=!1,n=!0,r=!0){e.offAllCaller(t);let l=e.scaleX,h=.9*l,d=!1;e.on(Laya.Event.MOUSE_DOWN,t,t=>{d=!0,r&&Laya.Tween.to(e,{scaleX:h,scaleY:h},60),i&&t.stopPropagation},s);e.on(Laya.Event.MOUSE_UP,t,s=>{0!=d&&(d=!1,i&&s.stopPropagation,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),a&&a.call(t,s),n&&p.play(o.Button))},s);e.on(Laya.Event.MOUSE_OUT,t,t=>{0!=d&&(d=!1,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),i&&t.stopPropagation)},s)}static getAngle2DWay(e,t){var a=Laya.Vector2.dot(e,t),s=Laya.Vector2.scalarLength(e)*Laya.Vector2.scalarLength(t),i=180*Math.acos(a/s)/Math.PI,o=e.x*t.y-t.x*e.y;return o>0?i*=1:o<0?i*=-1:i=0,i}static d2_coinCollectAnim(e,t,a,s,i=15,o=1,n=null,r=null){for(var l=i,h=0;h<i;h++){let i=Laya.Pool.getItemByClass("coin",Laya.Image);i.skin=e,i.x=t.x,i.y=t.y,i.scale(o,o),s.addChild(i);let h=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},h),Laya.timer.once(h+50,this,function(){Laya.Tween.to(i,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){s.removeChild(i),Laya.Pool.recover("coin",i),l--,r&&r(),0==l&&n&&n(s)}))})}}static d2_coinCollectAnimAni(e,t,a,s,i=15,o=null){for(var n=i,r=0;r<i;r++){let i=Laya.Pool.getItemByClass("coinAnim",Laya.Clip);i.skin=e.skin,i.index=e.index,i.clipX=e.clipX,i.clipY=e.clipY,i.autoPlay=e.autoPlay,i.x=t.x,i.y=t.y,i.scale(.8,.8),s.addChild(i);let r=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(i,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){s.removeChild(i),Laya.Pool.recover("coinAnim",i),0==--n&&o&&o(s)}))})}}static faceToast(e,t,a,s){let i=new Laya.Image(e);i.anchorX=.5,i.anchorY=.5,i.alpha=1,i.size(100,100),t.addChild(i),i.x=a.x,i.y=a.y,Laya.Tween.to(i,{x:s.x,y:s.y,alpha:.9},1e3,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{i&&!i.destroyed&&Laya.Tween.to(i,{x:s.x,y:s.y-100,alpha:0},1e3,null,Laya.Handler.create(this,()=>{i&&!i.destroyed&&i.destroy()}))}))}static d2_fontClipToast(e,t,a,s,i){if(!this.wordToastOk)return;let o=Laya.Pool.getItemByClass("fontClip_d2",Laya.FontClip);o.skin=e,o.sheet="0123456789",o.value=t,o.anchorX=.5,o.anchorY=.5,o.alpha=1,o.scaleX=s,o.scaleY=s,a.addChild(o),o.x=i.x,o.y=i.y;let n=new Laya.Vector2(i.x+(C.halfPercent()?C.randomInt(-100,-75):C.randomInt(75,100)),i.y-50);Laya.Tween.to(o,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(o,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{a.removeChild(o),Laya.Pool.recover("fontClip_d2",o)}))}))}static d2_imageToast(e,t,a){if(!this.wordToastOk)return;C.wordToastOk=!1;let s=new Laya.Image(e);s.anchorX=.5,s.anchorY=.5,s.alpha=1,t.addChild(s),s.top=300,s.centerX=0;s.scaleX=0,s.scaleY=0,Laya.Tween.to(s,{scaleX:1,scaleY:1},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{C.wordToastOk=!0,s&&!s.destroyed&&Laya.Tween.to(s,{top:200,alpha:0},500,null,Laya.Handler.create(this,()=>{s&&!s.destroyed&&s.destroy()}))}))}static clamp01(e){return e>1?1:e<0?0:e}static clamp(e,t,a){return e<t?t:e>a?a:e}static get getCurrentTime(){return(new Date).getTime()}static get getCurrentTime_Second(){return Math.floor(Date.parse((new Date).toString())/1e3)}static math_gcd(e,t){return 0==t?e:this.math_gcd(t,e%t)}static numberTo(e,t,a){return Math.abs(t-e)<a?e=t:e<t?e+=a:e>t&&(e-=a),e}static randomNumber(e,t){return e+(t-e)*Math.random()}static randomInt(e,t){return Math.floor(e+(t+1-e)*Math.random())}static halfPercent(){return Math.random()<.5}static percent(e){return Math.random()<e}static cloneArray(e){return[].concat(e)}static getRandomInArray(e){if(e.length){let t=Math.random()*e.length;return e[t=Math.floor(t)]}return console.error("传入错误参数,返回空"),null}static takeRandomInArray(e){if(e.length){let t=Math.random()*e.length,a=e[t=Math.floor(t)];return e.splice(t,1),a}return console.error("传入错误参数,返回空"),null}static randomArray(e){let t=new Array(e.length),a=t.length;for(let s=0;s<a;s++){let a=this.takeRandomInArray(e);t[s]=a}return t}static BoxCheck_2D_Normal(e,t,a,s,i,o,n,r){let l=i-e,h=o-t,d=Math.abs(h),c=Math.abs(l),m=(s+r)/2,y=(a+n)/2;return{isHit:d<m&&c<y,axisDis:c,axisRange:y,horizontalDis:d,horizontalRange:m,axisWay:l,horizontalWay:h}}static CircleCheck_2D(e,t,a,s,i,o){let n=Math.pow(e-s,2)+Math.pow(t-i,2),r=Math.pow(a+o,2);return{isHit:n<r,distancePow2:n,rangePow2:r}}}C.wordToastOk=!0;class L{static on(e,t,a){this.eventDispatcher.on(e,t,a)}static event(e,t){this.eventDispatcher.event(e,t)}static off(e,t,a){this.eventDispatcher.off(e,t,a)}static offAllCaller(e){this.eventDispatcher.offAllCaller(e)}}L.eventDispatcher=new Laya.EventDispatcher;class w{static AddGrade(){let e=this.GetPlayerData();e.grade++,parseInt(e.grade)>99&&(e.grade=99),this.SavePlayerData(e)}static ReadGrade(){let e=this.GetPlayerData();return parseInt(e.grade)}static AddCoin(e){let t=this.GetPlayerData();t.coin+=e,t.coin>9999&&(t.coin=9999),Math.floor(t.coin),p.play(o.GetMoney),this.SavePlayerData(t),L.event(a.Data_Coin_Update)}static ReadCoin(){let e=this.GetPlayerData();return Math.floor(e.coin)}static readItemUnlock(){return this.GetPlayerData().itemUnlockState}static addItemUnlock(){let e=this.GetPlayerData();e.itemUnlockState++,this.SavePlayerData(e)}static ReadHeadData(){return this.GetPlayerData().nowHeadData}static writeHeadData(e){let t=this.GetPlayerData();t.nowHeadData=e,this.SavePlayerData(t)}static readHomeLevelUpData(){let e=this.GetPlayerData();return{brush:e.brushLevel,money:e.moneyLevel}}static brushLevelUp(){let e=this.GetPlayerData();e.brushLevel++,e.brushLevel>99&&(e.brushLevel=99),this.SavePlayerData(e)}static moneyLevelUp(){let e=this.GetPlayerData();e.moneyLevel++,e.moneyLevel>99&&(e.moneyLevel=99),this.SavePlayerData(e)}static GetPlayerData(){let e;return(e=Laya.LocalStorage.getJSON("PlayerData"))||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),e)}static SavePlayerData(e){Laya.LocalStorage.setJSON("PlayerData",e)}static ClearPlayerData(){Laya.LocalStorage.clear()}static CheckPlayerData(){let e;(e=Laya.LocalStorage.getJSON("PlayerData"))&&e.ver&&e.ver==this.data.ver||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),console.log("触发存档重置条件"))}}w.forwardSpeed=1.2,w.data={ver:8,grade:1,coin:0,nowHeadData:{headId:3,partsIds:[1,1,1,1,1,1,1]},itemUnlockState:4,brushLevel:1,moneyLevel:1};class _{static init(){}static loadSubPackage(e,t){if(this.platformApi){this.platformApi.loadSubpackage({name:e,success:function(a){console.log("分包加载成功：",e),t.call(!0,a)},fail:function(a){console.error("分包加载失败：",e,JSON.stringify(a)),t.call(!1,a)}})}else console.log("没有平台API"),t(!0)}static showToast(e,t=1e3){console.log(e,t.toString()+"ms")}static vibrateShort(){this.platformApi&&this.platformApi.vibrateShort()}static vibrateLong(){this.platformApi&&this.platformApi.vibrateLong()}static regisiterCallback(){this.platformApi&&(this.platformApi.offShow(this.onShowEvent),this.platformApi.onShow(this.onShowEvent),this.platformApi.offHide(this.onHideEvent),this.platformApi.onHide(this.onHideEvent))}static onShowEvent(e){L.event(a.Platform_Wake_Do,e)}static onHideEvent(e){L.event(a.Platform_Hide_Do,e)}}class v extends _{static init(){this.platformApi=Laya.Browser.window.wx,this.showShareMenuWithTicket(!0),this.regisiterWXShareCallback()}showToast(e,t=1500){Laya.Browser.window.wx.showToast({title:e,duration:t})}static showShareMenuWithTicket(e){wx.showShareMenu({withShareTicket:e,success:function(){},fail:function(){},complete:function(){}})}static regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var e={title:"分享",image:""};Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:e.title,imageUrl:e.image,query:"share_id=1"}})}}}class b extends Laya.Script3D{onAwake(){this.self=this.owner,this.selfTween=new u,this.init()}init(...e){}onDestroy(){Laya.timer.clearAll(this),this.selfTween.clearTween(),L.offAllCaller(this)}}class S extends b{constructor(){super(...arguments),this.range=1,this.width=1,this.type=i.Brush_1,this.colliderActive=!0,this.isHarm=!1,this.headHp=3,this.headState=1,this.headType=1}init(...e){}setData(e,t,s,o=1){switch(this.type=e,this.range=t,this.width=s,this.colliderSprite=this.self,e){case i.Brush_1:L.on(a.Game_Obs_ItemAdd,this,this.brush_addType),L.on(a.Game_Obs_ItemUpgrade,this,this.upgrade);break;case i.Mist_1:this.obsData=C.getRandomInArray(k.game.mistColor);let n=this.obsData==k.game.harmColor,r=this.self.getChildByName("MistFX"),l=k.game.bornFxStage(r.name,this.self,1);l.transform.position=r.transform.position.clone(),l.transform.rotation=r.transform.rotation.clone();let h=C.d3_getRgbByHex(this.obsData),d=new Laya.Vector4(h.x,h.y,h.z,l.particleSystem.startColorConstant.w);l.particleSystem.startColorConstant=d;let c=l.getChildAt(0),m=new Laya.Vector4(h.x,h.y,h.z,c.particleSystem.startColorConstant.w);c.particleSystem.startColorConstant=m;let y=d.clone();y.w=1;for(let e=0;e<3;e++)if(1!=e){let t=this.self.getChildAt(e).meshRenderer,a=t.material.clone();a.albedoColor=y,t.material=a}l.getChildAt(1).active=n;break;case i.Door_1:k.game.doorItem.length>0?this.obsData=C.takeRandomInArray(k.game.doorItem):this.obsData=C.getRandomInArray(k.game.doorActiveItem);let g=this.self.getChildByName("Obj");for(let e=0;e<5;e++)this.self.getChildAt(e).active=!1;this.self.getChildAt(C.randomInt(0,4)).active=!0,k.game.bornStageObj(k.game.itemsComp.getItemUrl(this.obsData,1,1),g).transform.localScale=new Laya.Vector3(1,1,1);break;case i.Door_2:for(let e=0;e<5;e++)this.self.getChildAt(e).active=!1;this.self.getChildAt(C.randomInt(0,4)).active=!0;break;case i.Wheel_1:this.colliderSprite=this.self.getChildByName("Wheel1_1");break;case i.Fork_1:this.self.getComponent(Laya.Animator).play("Fork"),this.colliderSprite=this.self.getChildAt(0).getChildAt(0);break;case i.Billboard_1:Laya.timer.frameOnce(1,this,()=>{let e,t=k.game.end.transform.position.clone();t.z+=45;let a=!0,s=!0;for(e=this.self.getChildAt(1);a;){let i=e.transform.position.clone();i.z<=t.z?(i.z+=5.2,s=!s,(e=k.game.bornStageObj(s?"Road_3":"Road_4",this.self)).transform.position=i):a=!1}});break;case i.Head:this.headHp=C.randomInt(3,6);let p=C.d3_FindNodeByName(this.self,"Mustache_1"),u=C.d3_FindNodeByName(this.self,"Hairs"),f=C.d3_FindNodeByName(this.self,"Eyebrows"),w=C.d3_FindNodeByName(this.self,"Eyes"),_=C.d3_FindNodeByName(this.self,"Head"),v=C.d3_FindNodeByName(this.self,"Mouths"),b=this.self.getChildByName("Body"),S=this.self.getChildByName("NumberUI"),M=k.game.bornFxStage("NumberUI",S);C.d3_unactiveAllChildren(M),M.getChildAt(this.headHp).active=!0,p.active=!1,C.d3_unactiveAllChildren(u),C.d3_unactiveAllChildren(f),C.d3_unactiveAllChildren(w),C.d3_unactiveAllChildren(_),C.d3_unactiveAllChildren(v),C.d3_unactiveAllChildren(b);let B=o,I=1;this.headType=B,this.headState=I;let A="Head_"+B+"_"+I;_.getChildByName(A).active=!0;let P="Eyes_"+B+"_"+I;w.getChildByName(P).active=!0;let x="Mouth_1";v.getChildByName(x).active=!0;let D="Eyebrow_"+B+"_"+I;f.getChildByName(D).active=!0;let H="Hair_"+B+"_"+I;u.getChildByName(H).active=!0}}colliderDo(e){let t;switch(this.type){case i.Brush_1:this.colliderActive&&(this.self.destroy(),k.game.itemsComp.addItem(),this.colliderActive=!1,p.play(o.Get),k.game.vibrateShort());break;case i.Mist_1:this.colliderActive&&(e.changeColor(this.obsData,this.obsData==k.game.harmColor),this.mistSoundChannel&&!this.mistSoundChannel.isStopped||(this.mistSoundChannel=p.play(o.Spary,!0)),this.mistSoundChannel&&(this.mistSoundChannel.volume=k.game.isSound?1:0),Laya.timer.frameOnce(1,this,this.soundStop));break;case i.Door_1:if(this.colliderActive){let e;this.colliderActive=!1;let t=[];for(let a=0;a<this.self.numChildren;a++){let s=this.self.getChildAt(a),i=s.name.split("_");i.length>=2&&"Parts"==i[1]&&t.push(s),"Mid"==i[0]&&(e=s)}for(let a=0;a<t.length;a++)k.game.dropObjs.push({obj:t[a],upforce:C.randomNumber(1,2),forwardfoce:C.randomNumber(.5,1),horizontalforre:C.randomNumber(15,25),dir:f.normalized(f.subtract(t[a].transform.position.clone(),e.transform.position.clone())),rotate:{x:C.randomNumber(-7,7),y:C.randomNumber(-7,7),z:C.randomNumber(-7,7)}});L.event(a.Game_Obs_ItemAdd,[this.obsData]),p.play(o.BreakDoor)}k.game.vibrateShort(),e.addType(this.obsData);break;case i.Door_2:if(this.colliderActive){let e;this.colliderActive=!1;let t=[];for(let a=0;a<this.self.numChildren;a++){let s=this.self.getChildAt(a),i=s.name.split("_");i.length>=2&&"Parts"==i[1]&&t.push(s),"Mid"==i[0]&&(e=s)}for(let a=0;a<t.length;a++)k.game.dropObjs.push({obj:t[a],upforce:C.randomNumber(1,2),forwardfoce:C.randomNumber(.5,1),horizontalforre:C.randomNumber(15,25),dir:f.normalized(f.subtract(t[a].transform.position.clone(),e.transform.position.clone())),rotate:{x:C.randomNumber(-7,7),y:C.randomNumber(-7,7),z:C.randomNumber(-7,7)}});L.event(a.Game_Obs_ItemUpgrade),p.play(o.BreakDoor)}k.game.vibrateShort(),e.upgrade(this.self);break;case i.Wheel_1:k.game.itemsComp.items.numChildren>1&&this.colliderActive&&(e.colliderActive=!1,this.colliderActive=!1,Laya.timer.once(100,this,()=>{this.colliderActive=!0}),t=e.self.transform.position.clone(),k.game.stage.addChild(e.self),e.self.transform.position=t,k.game.dropObjs.push({obj:e.self,upforce:C.randomNumber(7,14),forwardfoce:C.randomNumber(0,10),horizontalforre:C.randomNumber(-10,-5),dir:f.normalized(f.subtract(e.self.transform.position.clone(),this.colliderSprite.transform.position.clone())),rotate:{x:0,y:0,z:0}}),p.play(o.Lose),k.game.vibrateShort());break;case i.Fork_1:if(k.game.itemsComp.items.numChildren>1&&this.colliderActive){e.colliderActive=!1,this.colliderActive=!1,this.self.getChildAt(0).getChildAt(0).addChild(e.self),e.self.transform.localPosition=new Laya.Vector3,p.play(o.Lose),k.game.vibrateShort()}break;case i.Billboard_1:if(k.game.itemsComp.items.numChildren>1&&this.colliderActive){this.colliderActive=!1,Laya.timer.once(100,this,()=>{this.colliderActive=!0});let t=this.self.getChildAt(0).transform.position.clone(),a=this.self.getChildAt(1).transform.position.clone();a.z=t.z;let s=k.game.end.transform.position.clone();s.z+=10,s.x=a.x,t.y=1,a.y=1,s.y=1;let i=new u,n=25*Math.abs(a.x-t.x),r=25*Math.abs(s.z-a.z),l=k.game.bornStageObj("Frame_1",k.game.stage);l.addChild(e.self),e.colliderActive=!1,e.self.transform.localPosition=new Laya.Vector3(0,.5,-.1),e.self.transform.localScale=new Laya.Vector3(.9,.9,.01),l.transform.position=t,i.toTween(l,{pos:a},n,null,null,!1).then({pos:s},r,()=>{k.game.mainScene.addChild(e.self),l.destroy(),k.game.endBillCount++;let t=k.game.end.transform.position.clone();t.z+=15-k.game.endBillCount,e.mist_isHarm&&(k.game.endGotHarm=!0),e.self.transform.position=t,e.self.transform.localScale=new Laya.Vector3(1,1,1),k.game.endBillBoardItem.push(e.self)}),p.play(o.Send),k.game.vibrateShort()}break;case i.Head:if(this.colliderActive&&k.game.itemsComp.items.numChildren>1){if(k.game.runMoveComp.Hit(),e.mist_isHarm&&(this.isHarm=!0),this.headHp--,e.self.destroy(),0==this.headHp)this.headUpgrade(),this.colliderActive=!1;else{this.self.getComponent(Laya.Animator).play("blink"),p.play(o.Lose)}let t=this.self.getChildByName("NumberUI").getChildAt(0);C.d3_unactiveAllChildren(t),t.getChildAt(this.headHp).active=!0,k.game.vibrateShort()}}}soundStop(){this.mistSoundChannel&&(this.mistSoundChannel.volume=0)}upgrade(){let e=this.self,t=C.d3_FindNodeByName(k.game.prefabs,k.game.itemsComp.getItemUrl(s.Brush,k.game.itemsComp.nowLevel,1));e.meshRenderer.materials=C.cloneArray(t.meshRenderer.materials)}brush_addType(e){k.game.bornStageObj(k.game.itemsComp.getItemUrl(e,k.game.itemsComp.nowLevel),this.self).transform.localPosition=new Laya.Vector3(1==this.self.numChildren?-1:1,0,0)}headUpgrade(){let e=C.d3_FindNodeByName(this.self,"Mustache_1"),t=C.d3_FindNodeByName(this.self,"Hairs"),a=C.d3_FindNodeByName(this.self,"Eyebrows"),s=C.d3_FindNodeByName(this.self,"Eyes"),i=C.d3_FindNodeByName(this.self,"Head"),n=C.d3_FindNodeByName(this.self,"Mouths"),r=this.self.getChildByName("Body");e.active=!1,C.d3_unactiveAllChildren(t),C.d3_unactiveAllChildren(a),C.d3_unactiveAllChildren(s),C.d3_unactiveAllChildren(i),C.d3_unactiveAllChildren(n),C.d3_unactiveAllChildren(r);let l=this.headType,h="Head_"+l.toString()+"_3";i.getChildByName(h).active=!0;let d="Eyes_"+l.toString()+"_"+2..toString();s.getChildByName(d).active=!0;for(let e=0;e<s.getChildByName(d).numChildren;e++);n.getChildByName("Mouth_2").active=!0;let c="Eyebrow_"+l.toString()+"_"+2..toString();a.getChildByName(c).active=!0;let m="Hair_"+l.toString()+"_"+2..toString();t.getChildByName(m).active=!0;let y=this.self.getComponent(Laya.Animator);y.play(this.isHarm?"hate":"happy"),y.speed=1;let g=this.self.transform.position.clone();g.y+=2,this.selfTween.toTween(this.self,{pos:g},1e3,null,null,!1),k.game.runMoveComp.isMove=!1,p.play(this.isHarm?o.Angry:o.Happy);let u=C.d3_getSpritePosBySprite3DPoint(k.game.mainCamera,this.self);C.d2_coinCollectAnim("ui/game/jsym_xj_1.png",u,new Laya.Vector2(D.instance.moneyValue.parent.x,D.instance.moneyValue.parent.y),D.instance.scene,5,.5,()=>{w.AddCoin(75),Laya.timer.once(1e3,this,()=>{this.self.active=!1}),k.game.runMoveComp.isMove=!0})}turnFade(e){let t=e.skinnedMeshRenderer;t||(t=e.meshRenderer);let a=t.material.clone();a.renderMode=2,a.albedoColor=new Laya.Vector4(1,1,1,1),t.material=a}}class M extends b{constructor(){super(...arguments),this.range=1,this.width=1,this.types=[],this.mist_isHarm=!1,this.upgradeDoors=[],this.colliderActive=!0,this.nowColorIndex=1,this.nowScore=1}init(...e){}setData(e,t,a,s){this.types=e,this.nowLevel=t,this.range=a,this.width=s,this.colliderActive=!0,this.nowScore=this.types.length*this.nowLevel}changeColor(e="FFFFFF",t=!1){let a=k.game.mistColor.indexOf(e)+2;this.nowColorIndex=a;let i=k.game.bornStageObj(k.game.itemsComp.getItemUrl(s.Brush,this.nowLevel,a)),o=this.self.getChildAt(0);k.game.stage.addChild(o),o.destroy(),this.self.addChildAt(i,0),i.transform.localPosition=new Laya.Vector3,this.mist_isHarm||(this.mist_isHarm=t),this.mist_isHarm&&k.game.bornFxStage("ToxicBrushFX",i,1)}addType(e){if(-1==this.types.indexOf(e)){this.types.push(e);let t=k.game.itemsComp.getItemUrl(e,this.nowLevel),a=k.game.bornStageObj(t,this.self),s=this.types.length-1;a.transform.localPosition=new Laya.Vector3(0==s?0:Math.sin(s*Math.PI+Math.PI/2),0,0);let i=new u;a.transform.localScale=new Laya.Vector3(0,0,0),i.toTween(a,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut),p.play(o.Get),this.nowScore=this.types.length*this.nowLevel}}upgrade(e){if(-1!=this.upgradeDoors.indexOf(e))return;let t;this.upgradeDoors.push(e);for(let e=this.self.numChildren-1;e>=0;e--){let t=this.self.getChildAt(e);t.active=!1,Laya.timer.once(1e3,this,()=>{t.destroy()})}this.nowLevel++,this.nowLevel>3&&(this.nowLevel=3);for(let e=0;e<this.types.length;e++){let a=k.game.bornStageObj(k.game.itemsComp.getItemUrl(this.types[e],this.nowLevel,this.nowColorIndex),this.self);a.transform.localPosition=new Laya.Vector3(0==e?0:Math.sin(e*Math.PI+Math.PI/2),0,0);let s=new u;a.transform.localScale=new Laya.Vector3(0,0,0),s.toTween(a,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut),0==e&&(t=a)}this.mist_isHarm&&k.game.bornFxStage("ToxicBrushFX",t,1),p.play(o.Get),this.nowScore=this.types.length*this.nowLevel}}class B extends b{constructor(){super(...arguments),this.nowType=[],this.nowLevel=1}init(...e){this.items=this.self.getChildByName("items"),this.model=this.self.getChildByName("Model"),L.on(a.Game_Obs_ItemAdd,this,this.addType),L.on(a.Game_Obs_ItemUpgrade,this,this.upgrade)}reset(){this.nowType=[],this.nowType.push(s.Brush),this.nowLevel=1;for(let e=this.items.numChildren-1;e>=0;e--)this.items.getChildAt(e).destroy();let e=w.readHomeLevelUpData().brush;e>8&&(e=8);for(let t=0;t<e;t++)this.addItem()}addType(e){this.nowType.push(e)}upgrade(){this.nowLevel++}addItem(){let e=new Laya.Sprite3D("item");k.game.stageObj.push(e),this.items.addChild(e),e.transform.localPosition=new Laya.Vector3;for(let t=0;t<this.nowType.length;t++){let a=k.game.bornStageObj(this.getItemUrl(this.nowType[t],this.nowLevel),e),s=a.addComponent(b).selfTween;a.transform.localPosition=new Laya.Vector3(0==t?0:Math.sin(t*Math.PI+Math.PI/2),0,0),a.transform.localScale=new Laya.Vector3(0,0,0),s.toTween(a,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut)}e.addComponent(M).setData(C.cloneArray(this.nowType),this.nowLevel,1,this.nowType.length)}getItemUrl(e,t=1,a=1){switch(e){case s.Brush:return s.Brush+"_"+t+"_"+a.toString();case s.Comb:return s.Comb+"_"+t;case s.Eyelash:return s.Eyelash+"_"+t;case s.Lipstick:return s.Lipstick+"_"+t;case s.Parfume:return s.Parfume+"_"+t;case s.Eyeshadow_1:return s.Eyeshadow_1;case s.Wax_1:return s.Wax_1;default:return null}}onUpdate(){let e=Laya.timer.delta/1e3,t=this.model.transform.position.clone(),s=this.items.getChildAt(0);s&&!s.destroyed&&(s.transform.position=t);let i=0;for(let a=1;a<this.items.numChildren;a++)if((s=this.items.getChildAt(a))&&!s.destroyed){let o=new Laya.Vector3,n=s.getComponent(M),r=15*e;r>1&&(r=1),Laya.Vector3.lerp(s.transform.position.clone(),t,r,o),o.z=this.model.transform.position.z+a,s.transform.position=o,t=s.transform.position,i+=n.nowScore}L.event(a.Game_Score_Update,[i])}}class I extends b{constructor(){super(...arguments),this.axis=0,this.horizontal=0,this.isMove=!1,this.modelMoveRange=7.5,this.camPointMoveRange=2.5,this.forwardSpeed=1.25,this.horizontalSensity=.12,this.forwardSensity=.15,this.wayAxis=0,this.targetHorizontal=0,this.inHorizontal=0}init(){this.player=this.self,this.model=this.player.getChildByName("Model"),this.camPoint=this.player.getChildByName("CamPoint"),this.forwardSpeed=w.forwardSpeed}reset(e,t){this.axis=e,this.horizontal=t,this.targetHorizontal=t;let a=this.player.transform.localPosition.clone();a.z=this.axis,this.player.transform.localPosition=a;let s=this.model.transform.localPosition.clone();s.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=s;let i=this.camPoint.transform.localPosition.clone();i.x=-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=i}onUpdate(){let e=Laya.timer.delta/16;this.isMove&&(this.axis+=this.forwardSpeed*this.forwardSensity*e),this.wayAxis=this.targetHorizontal-this.horizontal,this.horizontal+=this.wayAxis*this.horizontalSensity*e;let t=this.player.transform.localPosition.clone();t.z=this.axis,this.isMove&&(this.player.transform.localPosition=t);let a=this.model.transform.localPosition.clone();a.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=a;let s=this.camPoint.transform.localPosition.clone();s.x=-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=s}checkWay(e){let t=!1;return this.targetHorizontal=this.inHorizontal+e,this.targetHorizontal>.5?(this.targetHorizontal=.5,this.checkOut(),t=!0):this.targetHorizontal<-.5&&(this.targetHorizontal=-.5,this.checkOut(),t=!0),t}checkOut(){this.inHorizontal=this.targetHorizontal}Hit(){this.forwardSpeed=0,Laya.timer.frameLoop(1,this,this.HitUpdate)}HitUpdate(){this.forwardSpeed+=.05,this.forwardSpeed>=w.forwardSpeed&&(Laya.timer.clear(this,this.HitUpdate),this.forwardSpeed=w.forwardSpeed)}onDisable(){}}!function(e){e.start="touchStart",e.move="touchMove",e.end="touchEnd",e.getAxis="GetAxis",e.slideWay="slideWay",e.singleTouchStart="singleTouchStart",e.singleTouchMove="singleTouchMove",e.singleTouchEnd="singleTouchEnd",e.secondTouchStart="secondTouchStart",e.secondTouchMove="secondTouchMove",e.secondTouchEnd="secondTouchEnd",e.getAxisAlways="getAxisAlways",e.keyDown="keyDown"}(g||(g={}));class A extends Laya.Script{constructor(){super(...arguments),this.isPressed=!1,this.hOriginal=0,this.vOriginal=0,this.hAxis=0,this.vAxis=0,this.outAxis=0,this.touchId=-1}onEnable(){A.instance=this}onMouseDown(e){L.event(g.start,[e])}onMouseMove(e){L.event(g.move,[e])}onMouseOut(e){L.event(g.end,[e])}onMouseOver(e){L.event(g.end,[e])}onMouseUp(e){L.event(g.end,[e])}}class P{constructor(){this.dropObjs=[],this.colliders=[],this.endTypes=[],this.endBillBoardItem=[],this.endBillCount=0,this.bodyColorIndex=3,this.endGotHarm=!1,this.nowHeadData={headId:3,partsIds:[1,1,1,1,1,1,1]},this.mistColor=["EA6F96","F1D41E","7E093C","E42000","198325"],this.harmColor="198325",this.doorItemData=[s.Lipstick,s.Eyelash,s.Wax_1,s.Eyeshadow_1,s.Comb,s.Parfume],this.doorItem=[],this.doorActiveItem=[],this.isObjToJson=!1,this.nowRound=0,this.playCount=0,this.isWin=!1,this.isPressed=!1,this.orignal=0,this.isVibrate=!0,this.isSound=!0,this.stageObj=[],this.fxPool=[],this.init()}init(){this.initEvent(),this.readJson()}createShadow(e){e.shadowMode=Laya.ShadowMode.SoftLow,e.shadowDistance=30,e.shadowResolution=1024,e.shadowCascadesMode=Laya.ShadowCascadesMode.NoCascades,e.shadowNormalBias=.4,e.shadowStrength=.4}hideShadow(e){e.shadowMode=Laya.ShadowMode.None}useRetinalCanvas(){Laya.stage.useRetinalCanvas=!0}disabelRetinalCanvas(){Laya.stage.useRetinalCanvas=!1}setFog(e,t,a){t.enableFog=e,e&&(t.fogColor=a,t.fogStart=10,t.fogRange=20)}readJson(){let e=["res/json/stageInfo.json"],t=()=>{Laya.loader.load(e,Laya.Handler.create(this,a=>{if(a)for(let t=0;t<e.length;t++)Laya.loader.load(e[t],Laya.Handler.create(this,e=>{switch(t){case 0:this.stageJson=e,console.log(e);break;default:console.log(e)}}),null,Laya.Loader.JSON);else console.log("load json fail,reload after 1s"),Laya.timer.once(1e3,this,t)}),null,Laya.Loader.JSON)};e.length>0&&t()}JsonV3(e,t){if(t){let a=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),s=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector3(a,s,i)}return new Laya.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z))}V3ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString()}}JsonV4(e,t){if(t){let a=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),s=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t),o=Math.round(parseFloat(e.w)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector4(a,s,i,o)}return new Laya.Vector4(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z),parseFloat(e.w))}V4ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString(),w:e.w.toString()}}firstIn(){for(let e=0;e<this.mainScene.numChildren;e++){let t=this.mainScene.getChildAt(e);switch(t.name){case"Prefabs":this.prefabs=t;let e=t.getChildByName("Road_3"),a=t.getChildByName("Road_4");Laya.timer.frameLoop(1,this,()=>{let t=e.meshRenderer.sharedMaterial,s=a.meshRenderer.sharedMaterial,i=t.tilingOffset.clone();i.w-=Laya.timer.delta/1e3,t.tilingOffset=i;let o=s.tilingOffset.clone();o.w-=Laya.timer.delta/1e3,s.tilingOffset=o});break;case"Light":this.light=t;break;case"Fxs":this.fxs=t,Laya.timer.once(2e3,this,()=>{this.fxs.active=!1});break;case"Stage":this.stage=t,this.player=this.stage.getChildByName("Player"),this.runMoveComp=this.player.addComponent(I),this.itemsComp=this.player.addComponent(B),this.camPoint=this.player.getChildByName("CamPoint"),this.mainCam=this.camPoint.getChildByName("MainCam"),this.mainCamera=this.mainCam.getChildByName("Main Camera"),this.start=this.stage.getChildByName("Start"),this.end=this.stage.getChildByName("End"),this.finishSet=this.end.getChildByName("FinishSet"),C.d3_FindNodeByName(this.end.getChildByName("Head"),"Wax").getComponent(Laya.Animator).play("empty")}}this.useRetinalCanvas(),this.createShadow(this.light),this.randomPlayMusic(),this.nowHeadData=w.ReadHeadData()}initEvent(){}levelInit(){Laya.timer.clear(this,this.gameUpdate),this.stageObjClear(),this.dropObjs=[],this.fxPool=[],this.colliders=[],this.endTypes=[],this.endBillBoardItem=[],this.doorActiveItem=[],this.doorItem=C.cloneArray(this.doorItemData),this.nowRound=0,this.endBillCount=0,this.endGotHarm=!1;let e=w.ReadGrade()%this.stageJson.length,t=this.stage.getChildByName("Level"),a=new Laya.Vector3;this.colliders.push([]);let o=new Laya.Vector3(0,0,30),n=f.add(a,o);if(this.colliders.push([]),this.endItemShow=null,this.isObjToJson){let e=[];for(let a=0;a<t.numChildren;a++){let s=t.getChildAt(a),i={name:"",setInfo:[]};i.name=s.name;for(let e=0;e<s.numChildren;e++){let t=s.getChildAt(e),a={name:"",objInfo:[]};a.name=t.name;for(let e=0;e<t.numChildren;e++){let s=t.getChildAt(e),i=s.name,o=s.transform.localPosition.clone(),n=s.transform.rotation.clone(),r={name:i,pos:this.V3ToJson(o),rot:this.V4ToJson(n)};a.objInfo.push(r)}i.setInfo.push(a)}e.push(i)}console.log(JSON.stringify(e))}let r=w.readItemUnlock();for(let e=this.doorItem.length-1;e>=0;e--)e>2+r?this.doorItem.splice(e,1):2==k.game.nowHeadData.partsIds[e+1]?this.doorActiveItem.push(this.doorItem.splice(e,1)[0]):this.doorActiveItem.push(this.doorItem[e]);{let t=this.stageJson[e];for(let e=0;e<t.setInfo.length;e++){let a=t.setInfo[e],r=new Laya.Sprite3D(a.name);this.stage.addChild(r),r.transform.position=n;for(let e=0;e<a.objInfo.length;e++){let t,l,h,d=a.objInfo[e],c=d.name.split(" ")[0],m=f.add(this.JsonV3(d.pos),r.transform.position.clone()),y=this.JsonV4(d.rot);switch(c){case"Road_1":n=f.add(n,o),this.colliders.push([]),(t=this.bornStageObj(c,r)).transform.position=m;break;case"Brush_1":c=this.itemsComp.getItemUrl(s.Brush,1,1),(t=this.bornStageObj(c,r)).transform.position=m,(h=t.addComponent(S)).setData(i.Brush_1,1,1),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;case"Mist_1":(t=this.bornStageObj(c,r)).transform.position=m,t.transform.rotation=y,(h=t.addComponent(S)).setData(i.Mist_1,1,1),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;case"Door_1":(t=this.bornStageObj(c,r)).transform.position=m,(h=t.addComponent(S)).setData(i.Door_1,.5,2),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;case"Door_2":(t=this.bornStageObj(c,r)).transform.position=m,(h=t.addComponent(S)).setData(i.Door_2,.5,2),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;case"Wheel_1":(t=this.bornStageObj(c,r)).transform.position=m,(h=t.addComponent(S)).setData(i.Wheel_1,.5,1),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;case"Fork_1":(t=this.bornStageObj(c,r)).transform.position=m,t.transform.rotation=y,(h=t.addComponent(S)).setData(i.Fork_1,1,1),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;case"Billboard_1":(t=this.bornStageObj(c,r)).transform.position=m,(h=t.addComponent(S)).setData(i.Billboard_1,.5,2),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;case"Head_Stage_1":c="Head",(t=this.bornStageObj(c,r)).transform.position=m,(h=t.addComponent(S)).setData(i.Head,2,2,1),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;case"Head_Stage_2":c="Head",(t=this.bornStageObj(c,r)).transform.position=m,(h=t.addComponent(S)).setData(i.Head,2,2,2),l=Math.floor((m.z+15)/30),this.colliders[l].push(h);break;default:console.log("关卡物品预设里没有该类型物件",c)}}}}this.start.transform.position=a,this.end.transform.position=n,this.player.transform.position=a,this.runMoveComp.reset(0,0),this.itemsComp.reset(),this.mainCam.getComponent(Laya.Animator).play("CamNormal",0,0);let l=!0;for(let e=0;e<this.nowHeadData.partsIds.length;e++)if(2!=this.nowHeadData.partsIds[e]){l=!1;break}let h=this.end.getChildByName("Door_1");for(let e=0;e<5;e++)h.getChildAt(e).active=!1;if(h.getChildAt(C.randomInt(0,4)).active=!0,C.d3_unactiveAllChildren(this.finishSet),C.d3_FindNodeByName(this.end.getChildByName("Head"),"Wax").getComponent(Laya.Animator).play("empty"),l){this.nowHeadData.headId++,this.nowHeadData.headId>6&&(this.nowHeadData.headId=3);for(let e=0;e<this.nowHeadData.partsIds.length;e++)this.nowHeadData.partsIds[e]=1}this.bodyColorIndex=C.randomInt(3,6),this.endHeadChange(this.nowHeadData,this.bodyColorIndex),Laya.timer.frameLoop(1,this,this.gameUpdate)}gameStart(){this.controlOn(),this.roundInit(),this.playCount++,Laya.timer.loop(16,this,this.fixUpdate),this.runMoveComp.isMove=!0}levelEnd(e){this.controlOff(),Laya.timer.clear(this,this.fixUpdate),D.instance.stateBar.set_visible(!1),this.isWin=e;let t=this.end.getChildByName("Head"),a=t.getComponent(Laya.Animator),i=new u,n=()=>{Laya.timer.once(750,this,()=>{this.endHeadChange(this.nowHeadData,this.bodyColorIndex),a.play(this.endGotHarm?"hate":"happy"),this.endGotHarm&&p.play(o.Angry),Laya.timer.once(3e3,this,()=>{k.goOver(),p.play(o.Cheers),w.writeHeadData(this.nowHeadData)})})},r=0,l=()=>{Laya.timer.once(750,this,()=>{let e,i=this.itemsComp.nowType[r],h=!0,d=!1;switch(i){case s.Brush:e=this.finishSet.getChildByName(i),this.nowHeadData.partsIds[0]=2;break;case s.Lipstick:e=this.finishSet.getChildByName(i),this.nowHeadData.partsIds[1]=2,h=!1,this.bornStageObj(this.itemsComp.getItemUrl(i,this.itemsComp.nowLevel),e.getChildAt(0));break;case s.Eyelash:e=this.finishSet.getChildByName(i),this.nowHeadData.partsIds[2]=2,Laya.timer.once(1e3,this,()=>{a.play("eyelash",0,0)});break;case s.Wax_1:i="Wax",e=C.d3_FindNodeByName(t,"Wax"),h=!1,d=!0,this.nowHeadData.partsIds[3]=2;break;case s.Eyeshadow_1:i="Eyeshadow",e=this.finishSet.getChildByName(i),h=!1,this.nowHeadData.partsIds[4]=2;break;case s.Comb:e=this.finishSet.getChildByName(i),this.nowHeadData.partsIds[5]=2;break;case s.Parfume:e=this.finishSet.getChildByName(i),this.nowHeadData.partsIds[6]=2,h=!1}h&&this.bornStageObj(this.itemsComp.getItemUrl(i,this.itemsComp.nowLevel),e),e.active=!0;let c=i+"P",m=e.getComponent(Laya.Animator);m.play(i,0,0);let y=1e3*m.getControllerLayer(0).getAnimatorState(i).clip.duration();this.finishSet.getChildByName(c).active=!0,Laya.timer.once(.5*y,this,()=>{this.endHeadChange(this.nowHeadData,this.bodyColorIndex,d),r++,Laya.timer.once(.5*y,this,()=>{p.play(o.Complete)}),r>=this.itemsComp.nowType.length?n():Laya.timer.once(.5*y,this,l)}),p.play(o.MakeUp)})};this.mainCam.getComponent(Laya.Animator).play("CamEnd",0,0),Laya.timer.once(1500,this,()=>{i.toTween(this.endItemShow,{sca:new Laya.Vector3(0,0,0)},250,()=>{this.endItemShow.active=!1,l()})})}roundInit(){switch(this.nowRound){case 0:break;case 1:this.runMoveComp.isMove=!1,this.roundEnd();break;case 2:this.levelEnd(!0);break;default:console.log("多次触发跳关了")}}roundEnd(e=!1){this.nowRound++,this.roundInit()}gameUpdate(){let e=Laya.timer.delta/1e3;for(var t=this.dropObjs.length-1;t>=0;t--){this.dropObjs[t].upforce-=20*e;let a=this.dropObjs[t].obj;a.transform&&(a.transform.translate(new Laya.Vector3(this.dropObjs[t].dir.x*this.dropObjs[t].forwardfoce*e,this.dropObjs[t].upforce*e,this.dropObjs[t].dir.z*this.dropObjs[t].horizontalforre*e),!1),a.transform.rotate(f.mull(this.dropObjs[t].rotate,e),!1),this.dropObjs[t].obj.transform.position.y<-2&&(this.dropObjs[t].obj.destroy(),this.dropObjs.splice(t,1)))}this.player.transform.position.z>this.end.transform.position.z+14&&(this.runMoveComp.isMove=!1),L.event(a.Game_Progress_Update,this.player.transform.position.z/this.end.transform.position.z)}fixUpdate(){let e,t,a=this.itemsComp.items,s=new Laya.Vector3;for(let i=0;i<a.numChildren;i++)if((e=a.getChildAt(i))&&!e.destroyed){if(s=e.transform.position.clone(),!(t=e.getComponent(M)).colliderActive)continue;let a=Math.floor((s.z+15)/30);if(a==this.colliders.length-1&&s.z>=this.end.transform.position.z+14-this.endBillCount)this.endBillCount>0?(this.itemGoEnd(this.endBillBoardItem[this.endBillCount-1].getComponent(M).types),this.endBillBoardItem[this.endBillCount-1].active=!1,this.endBillCount--):(e.destroy(),t.mist_isHarm&&(this.endGotHarm=!0),this.itemGoEnd(t.types));else for(let e=0;e<this.colliders[a].length;e++){let i=this.colliders[a][e].colliderSprite,o=this.colliders[a][e];if(i&&!i.destroyed){let e=i.transform.position.clone();if(C.BoxCheck_2D_Normal(s.z,s.x,t.range,t.width,e.z,e.x,o.range,o.width).isHit){o.colliderDo(t);break}}}}}itemGoEnd(e){if(this.endItemShow){let e=this.endItemShow.transform.localScale.clone();e.x+=.1,e.y+=.1,e.z+=.1,this.endItemShow.transform.localScale=e}else this.endItemBorn();this.endTypes.push(e);let t=!0;for(let e=0;e<this.itemsComp.items.numChildren;e++){let a=this.itemsComp.items.getChildAt(e);a&&!a.destroyed&&(t=!1)}t&&(this.endGotHarm&&this.endItemGotHarmDo(),this.levelEnd(!0)),p.play(o.Lose)}endItemBorn(){let e=new Laya.Sprite3D("item");k.game.stageObj.push(e),this.mainScene.addChild(e),this.controlOff(),e.transform.localPosition=new Laya.Vector3;for(let t=0;t<this.itemsComp.nowType.length;t++){k.game.bornStageObj(this.itemsComp.getItemUrl(this.itemsComp.nowType[t],this.itemsComp.nowLevel),e).transform.localPosition=new Laya.Vector3(0==t?0:Math.sin(t*Math.PI+Math.PI/2),0,0)}this.endItemShow=e;let t=this.end.transform.position.clone();t.z+=14,e.transform.position=t;let a=1+.1*this.endBillBoardItem.length;e.transform.localScale=new Laya.Vector3(a,a,a)}endItemGotHarmDo(){this.finishSet.getChildByName("PosionP").active=!0}endHeadChange(e,t,a=!1){let s=this.end.getChildByName("Head"),i=C.d3_FindNodeByName(s,"Mustache_1"),o=C.d3_FindNodeByName(s,"Hairs"),n=C.d3_FindNodeByName(s,"Eyebrows"),r=C.d3_FindNodeByName(s,"Eyes"),l=C.d3_FindNodeByName(s,"Head"),h=C.d3_FindNodeByName(s,"Mouths"),d=s.getChildByName("Body");i.active=!1,C.d3_unactiveAllChildren(o),C.d3_unactiveAllChildren(n),C.d3_unactiveAllChildren(r),C.d3_unactiveAllChildren(l),C.d3_unactiveAllChildren(h),C.d3_unactiveAllChildren(d);let c=e.headId,m=e.partsIds,y="Body_"+t;d.getChildByName(y).active=!0;let g=1==m[0]?1:1==m[4]?2:3,p="Head_"+c.toString()+"_"+g.toString();l.getChildByName(p).active=!0;let u="Mouth_"+(1==m[1]?1:c<=2?2:3);h.getChildByName(u).active=!0;let f=m[2],L="Eyebrow_"+c.toString()+"_"+f.toString();n.getChildByName(L).active=!0;let w="Eyes_"+c.toString()+"_"+f.toString();r.getChildByName(w).active=!0,i.active=2!=m[3]||a;let _=m[5],v="Hair_"+c.toString()+"_"+_.toString();o.getChildByName(v).active=!0,this.finishSet.getChildByName("StinkP").active=1==m[6],s.getComponent(Laya.Animator).play("blink")}controlOn(){L.on(g.singleTouchStart,this,this.onMouseDown),L.on(g.singleTouchMove,this,this.onMouseMove),L.on(g.singleTouchEnd,this,this.onMouseUp)}controlOff(){L.off(g.singleTouchStart,this,this.onMouseDown),L.off(g.singleTouchMove,this,this.onMouseMove),L.off(g.singleTouchEnd,this,this.onMouseUp),this.onMouseUp(),this.runMoveComp.targetHorizontal=0}onMouseDown(e){this.isPressed=!0,this.orignal=e.stageX/Laya.stage.width,this.runMoveComp&&this.runMoveComp.checkOut()}onMouseMove(e){if(this.isPressed){let t=e.stageX/Laya.stage.width-this.orignal;this.runMoveComp&&this.runMoveComp.checkWay(2*t)&&(this.orignal=e.stageX/Laya.stage.width)}}onMouseUp(){this.isPressed=!1,this.runMoveComp&&this.runMoveComp.checkOut()}vibrateShort(){this.isVibrate&&(Laya.Browser.onWeiXin?v.vibrateShort():_.vibrateShort())}soundSwitch(e){this.isSound=e,Laya.SoundManager.musicVolume=this.isSound?1:0,Laya.SoundManager.soundVolume=this.isSound?1:0}randomPlayMusic(){p.playMusic("Bgm"),Laya.timer.once(48e3,this,this.randomPlayMusic)}bornStageObj(e,t=this.mainScene){let a=this.prefabs.getChildByName(e);if(!a)return console.warn("生成物体不存在",e),null;let s=Laya.Sprite3D.instantiate(a,t);return s.transform.localPosition=new Laya.Vector3,this.stageObj.push(s),s}stageObjClear(){for(let e=this.stageObj.length-1;e>=0;e--)this.stageObj[e]&&!this.stageObj[e].destroyed&&this.stageObj[e].destroy();this.stageObj=[]}bornFxDestroy(e,t,a=1e3,s=1,i=new Laya.Vector3){let o=this.fxs.getChildByName(e).clone();return t.addChild(o),o.transform.localPosition=i,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(s,s,s),Laya.timer.once(a,this,()=>{o.destroy()}),o}bornFxFromPool(e,t,a=1e3,s=1,i=new Laya.Vector3){let o;for(let t=this.fxPool.length-1;t>=0;t--)if(this.fxPool[t].name==e){(o=this.fxPool.splice(t,1)[0]).active=!0;break}if(!o){let t=this.fxs.getChildByName(e);o=t.clone()}return t.addChild(o),this.stageObj.push(o),o.transform.localPosition=i,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(s,s,s),Laya.timer.once(a,this,()=>{o&&!o.destroyed&&(this.mainScene.addChild(o),o.active=!1,this.fxPool.push(o))}),o}bornFxStage(e,t,a=1,s=new Laya.Vector3){let i=this.fxs.getChildByName(e).clone();return t.addChild(i),i.transform.localPosition=s,i.transform.localScale=new Laya.Vector3(a,a,a),this.stageObj.push(i),i}}class k{static init(){this.game=new P,this.goLoad(),this.addLoadRes(t.SubPackage),this.addLoadRes(t.Scene3D);let e=this.subPackageName,a=this.scene3DUrl,s=e=>{e&&(this.removeLoadRes(t.SubPackage),this.load3DRes(a))};Laya.Browser.onWeiXin?(v.init(),v.loadSubPackage(e,s)):(_.init(),_.loadSubPackage(e,s)),p.init(),w.CheckPlayerData()}static goLoad(){this.openScene(e.Load)}static goHome(){this.closeScene(e.Load),this.closeScene(e.Over),this.openScene(e.Home),this.game.levelInit()}static goGame(){this.closeScene(e.Home),this.openScene(e.Game),this.game.gameStart()}static goOver(){this.closeScene(e.Game),this.openScene(e.Over)}static load3DRes(e){var t=[{url:e,clas:Laya.Scene3D,priority:1}];Laya.loader.create(t,Laya.Handler.create(this,this.onLoadFinished,[{target:"3dRes"}],!1),Laya.Handler.create(this,this.onLoading,null,!1)),Laya.loader.on(Laya.Event.ERROR,this,t=>{console.error("资源加载失败",t),this.load3DRes(e)})}static onLoadFinished(e){console.log("资源加载完成",e),this.loadSceneRes(),this.removeLoadRes(t.Scene3D)}static onLoading(e){}static loadSceneRes(){let e=Laya.loader.getRes(this.scene3DUrl);Laya.stage.addChild(e),Laya.stage.setChildIndex(e,0),this.game.mainScene=e,this.game.firstIn()}static addLoadRes(e){this.loadingList.push(e),this.loadingCount++}static removeLoadRes(e){let t=this.loadingList.indexOf(e);-1==t?console.log("完成了不存在的资源加载"):this.loadingList.splice(t,1),L.event(a.Progress_Load_Update)}static openScene(e,t){Laya.Scene.open(e,!1,null,Laya.Handler.create(this,e=>{Laya.stage.addChild(e),t&&t()}))}static closeScene(e,t){Laya.Scene.close(e)&&t&&t()}}k.subPackageName="scene",k.scene3DUrl="res/scene/Conventional/ResScene.ls",k.loadingList=[],k.loadingCount=0;class x extends Laya.Scene{onAwake(){this.size(Laya.stage.width,Laya.stage.height),this.init(),this.initEvent()}onClosed(){L.offAllCaller(this),Laya.timer.clearAll(this)}init(){}initEvent(){}}class D extends x{constructor(){super(...arguments),this.gameBarStateUrl=["ui/game/yxjm_wz_2.png","ui/game/yxjm_wz_3.png","ui/game/yxjm_wz_4.png","ui/game/yxjm_wz_5.png"]}init(){D.instance=this,this.stageUIInit(),this.moneyUIUpdate()}initEvent(){L.on(a.Game_Progress_Update,this,this.stageUIUpdate),L.on(a.Data_Coin_Update,this,this.moneyUIUpdate),L.on(a.Game_Score_Update,this,this.statebarUpdate)}stageUIInit(){this.stageValue1.value=w.ReadGrade().toString();let e=w.ReadGrade()+1;e>99&&(e=99),this.stageValue2.value=e.toString(),this.stageBar.value=0}stageUIUpdate(e){this.stageBar.value=e}moneyUIUpdate(){this.moneyValue.value=w.ReadCoin().toString()}statebarUpdate(e){let t=Math.floor(e/10),a=t%10/10;a=(t=t>3?3:t)>3?1:a,this.stateBar.getChildByName("word").skin=this.gameBarStateUrl[t],this.stateBar.value=a;let s=C.d3_getSpritePosBySprite3DPoint(k.game.mainCamera,k.game.runMoveComp.model,new Laya.Vector3(0,3.25,0));this.stateBar.x=s.x,this.stateBar.y=s.y}}class H{static Vector2Reduce(e,t){return new Laya.Vector2(e.x-t.x,e.y-t.y)}static vibrateSoft(e,t=1){this.isVibrating||(this.isVibrating=!0,Laya.timer.once(100,this,()=>{this.isVibrating=!1}),C.d3_objectShake(e,.1,.05*t))}static vibrateShort(e,t=1){this.isVibrating||(this.isVibrating=!0,Laya.timer.once(100,this,()=>{this.isVibrating=!1}),C.d3_objectShake(e,.1,.25*t))}static vibrateLong(e,t=1){this.isVibrating||(this.isVibrating=!0,Laya.timer.once(1e3,this,()=>{this.isVibrating=!1}),C.d3_objectShake(e,1,.25*t))}}H.isVibrating=!1;class V extends Laya.Script{constructor(){super(...arguments),this.calls=[],this.firstId=-1,this.secondId=-1,this.firstOriginalPoint=new Laya.Vector2,this.secondOriginalPoint=new Laya.Vector2,this.isSecond=!1,this.orignalHorizontal=0,this.orignalAxis=0,this.orignalHorizontalAlways=0,this.orignalAxisAlways=0,this.offset=new Laya.Vector3}onEnable(){L.on(g.start,this,this.onMouseDown),L.on(g.move,this,this.onMouseMove),L.on(g.end,this,this.onMouseUp)}onDisable(){L.off(g.start,this,this.onMouseDown),L.off(g.move,this,this.onMouseMove),L.off(g.end,this,this.onMouseUp)}onMouseDown(e){0==this.isSecond?-1==this.firstId?(this.checkOut(e),this.firstId=e.touchId,L.event(g.singleTouchStart,e),this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):this.firstId!=e.touchId&&-1==this.secondId&&(this.secondId=e.touchId,this.isSecond=!0,L.event(g.secondTouchStart,e),this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):-1==this.firstId?(this.firstId=e.touchId,this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):-1==this.secondId&&(this.secondId=e.touchId,this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),this.checkOutAlways(e)}onMouseMove(e){if(0==this.isSecond)e.touchId==this.firstId&&(this.checkWay(e),L.event(g.singleTouchMove,e));else if(-1!=this.firstId&&-1!=this.secondId){let t,a={distance:0,angle:0},s=H.Vector2Reduce(this.secondOriginalPoint,this.firstOriginalPoint),i=Laya.Vector2.scalarLength(s);if(e.touchId==this.firstId?t=H.Vector2Reduce(this.secondOriginalPoint,new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):e.touchId==this.secondId&&(t=H.Vector2Reduce(new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height),this.firstOriginalPoint)),t){let e=Laya.Vector2.scalarLength(t);a.distance=e-i,a.angle=C.getAngle2DWay(s,t),L.event(g.secondTouchMove,a)}}e.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),e.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),this.checkWayAlways(e)}onMouseUp(e){this.checkOutAlways(e),e.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),e.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),0==this.isSecond?e.touchId==this.firstId&&(this.checkOut(e),L.event(g.singleTouchEnd,e),this.firstId=-1):(e.touchId==this.firstId&&(this.firstId=-1),e.touchId==this.secondId&&(this.secondId=-1),-1==this.firstId&&-1==this.secondId&&(this.isSecond=!1))}WayCheck(){let e=H.Vector2Reduce(this.nowPos,this.startPos);if(Laya.Vector2.scalarLength(e)>100){let t=Math.atan2(e.y,e.x)/Math.PI*180,a="none";t>-135&&t<-45?a="up":t>-45&&t<45?a="right":t<135&&t>45?a="down":(t<-135||t>135)&&(a="left"),this.isDown=!1}this.startPos=this.nowPos}onDestroy(){this.touchTimer&&clearTimeout(this.touchTimer)}checkWay(e){let t=e.stageX-this.orignalHorizontal,a=e.stageY-this.orignalAxis;L.event(g.getAxis,[{x:t,y:a}])}checkOut(e){this.orignalHorizontal=e.stageX,this.orignalAxis=e.stageY}checkWayAlways(e){let t=e.stageX/Laya.stage.width-this.orignalHorizontalAlways,a=e.stageY/Laya.stage.height-this.orignalAxisAlways;this.checkOutAlways(e),L.event(g.getAxisAlways,[{x:t,y:a}])}checkOutAlways(e){this.orignalHorizontalAlways=e.stageX/Laya.stage.width,this.orignalAxisAlways=e.stageY/Laya.stage.height}modelRotateControlDown(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);this.startPosition=e.clone(),this.prePosition=e.clone()}modelRotateControlMove(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);Laya.Vector3.subtract(e,this.prePosition,this.offset),this.prePosition=e.clone();var t=new Laya.Vector3(this.offset.x,this.offset.y,0);let a=new Laya.Vector3;Laya.Vector3.cross(t,new Laya.Vector3(0,0,1),a),Laya.Vector3.normalize(a,a)}modelRotateControlUp(){new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0)}onKeyDown(e){L.event(g.keyDown,e)}}class N extends x{constructor(){super(...arguments),this.isBrushVideo=!1,this.isMoneyVideo=!1,this.brushCost=0,this.moneyCost=0,this.shopItemIconUrl=["ui/game/sdjm_hzp_2.png","ui/game/sdjm_hzp_3.png","ui/game/sdjm_hzp_4.png","ui/game/sdjm_hzp_5.png","ui/game/sdjm_hzp_6.png","ui/game/sdjm_hzp_7.png"],this.getItemIconUrl=["ui/game/sdjm_hzp_4.png","ui/game/sdjm_hzp_5.png","ui/game/sdjm_hzp_6.png","ui/game/sdjm_hzp_7.png"],this.getItemTitleUrl=["ui/game/djjm_wz_2.png","ui/game/djjm_wz_3.png","ui/game/djjm_wz_4.png","ui/game/djjm_wz_5.png"]}init(){this.stageUIInit(),this.moneyUIUpdate(),this.settingPanelInit(),this.getItemPanelInit(),this.shopPanelInit(),this.powerBtnUpdate()}initEvent(){C.d2_AddClickEvent(this.btnStart,this,this.onBtnStartClick),C.d2_AddClickEvent(this.btnSetting,this,this.onBtnSettingClick),C.d2_AddClickEvent(this.btnShop,this,this.onBtnShopClick),C.d2_AddClickEvent(this.btnBrush,this,this.onBtnBrushClick),C.d2_AddClickEvent(this.btnMoney,this,this.onBtnMoneyClick)}onBtnStartClick(){k.goGame()}onBtnSettingClick(){this.settingPanel.set_visible(!0)}onBtnShopClick(){this.showShopPanel()}powerBtnUpdate(){if(w.ReadGrade()>1){this.isBrushVideo=!1,this.isMoneyVideo=!1;let e=w.readHomeLevelUpData(),t=e.brush,a=e.money;t>8&&(t=8),a>8&&(a=8);let s=800*t,i=800*a;this.brushCost=s,this.moneyCost=i,this.isBrushVideo=!(w.ReadCoin()>=s),this.isMoneyVideo=!(w.ReadCoin()>=i),this.btnBrush.getChildByName("video").set_visible(this.isBrushVideo),this.btnBrush.getChildByName("money").set_visible(!this.isBrushVideo),this.btnBrush.getChildByName("money").getChildAt(0).value=s.toString(),this.btnBrush.getChildByName("level").getChildAt(0).value=e.brush.toString(),this.btnMoney.getChildByName("video").set_visible(this.isMoneyVideo),this.btnMoney.getChildByName("money").set_visible(!this.isMoneyVideo),this.btnMoney.getChildByName("money").getChildAt(0).value=i.toString(),this.btnMoney.getChildByName("level").getChildAt(0).value=e.money.toString()}else this.btnBrush.alpha=0,this.btnMoney.alpha=0,this.btnBrush.getChildByName("video").set_visible(!1),this.btnMoney.getChildByName("video").set_visible(!1),this.btnBrush.getChildByName("money").getChildAt(0).value="800",this.btnMoney.getChildByName("money").getChildAt(0).value="800",this.btnBrush.getChildByName("level").getChildAt(0).value="1",this.btnMoney.getChildByName("level").getChildAt(0).value="1"}onBtnBrushClick(){w.ReadGrade()>1&&(this.isBrushVideo?(w.brushLevelUp(),this.powerBtnUpdate(),k.game.itemsComp.reset()):(w.AddCoin(-this.brushCost),w.brushLevelUp(),this.moneyUIUpdate(),this.powerBtnUpdate(),k.game.itemsComp.reset()))}onBtnMoneyClick(){w.ReadGrade()>1&&(this.isMoneyVideo?(w.moneyLevelUp(),this.powerBtnUpdate()):(w.AddCoin(-this.moneyCost),w.moneyLevelUp(),this.moneyUIUpdate(),this.powerBtnUpdate()))}stageUIInit(){this.stageValue1.value=w.ReadGrade().toString();let e=w.ReadGrade()+1;e>99&&(e=99),this.stageValue2.value=e.toString(),this.stageBar.value=0}moneyUIUpdate(){this.moneyValue.value=w.ReadCoin().toString()}settingPanelInit(){let e=this.settingPanel.getChildByName("bg");this.settingCloseBtn=e.getChildByName("closeBtn"),this.voiceBack=e.getChildByName("voiceBack"),this.vibrateBack=e.getChildByName("vibrateBack"),C.d2_AddClickEvent(this.settingCloseBtn,this,this.settingPanelClose),C.d2_AddClickEvent(this.voiceBack,this,this.voiceChange,[!k.game.isSound],!1,!0,!1),C.d2_AddClickEvent(this.vibrateBack,this,this.vibrateChange,[!k.game.isVibrate],!1,!0,!1),this.voiceChange(k.game.isSound),this.vibrateChange(k.game.isVibrate)}settingPanelClose(){this.settingPanel.set_visible(!1)}voiceChange(e){let t=this.voiceBack.getChildByName("active"),a=this.voiceBack.getChildByName("unactive");t.set_visible(e),a.set_visible(!e),k.game.soundSwitch(e),C.d2_AddClickEvent(this.voiceBack,this,this.voiceChange,[!k.game.isSound],!1,!0,!1)}vibrateChange(e){let t=this.vibrateBack.getChildByName("active"),a=this.vibrateBack.getChildByName("unactive");t.set_visible(e),a.set_visible(!e),k.game.isVibrate=e,C.d2_AddClickEvent(this.vibrateBack,this,this.vibrateChange,[!k.game.isVibrate],!1,!0,!1)}shopPanelInit(){let e=this.shopPanel.getChildByName("panel"),t=this.shopPanel.getChildByName("closeBtn");C.d2_AddClickEvent(t,this,this.onShopCloseClick);for(let t=0;t<e.numChildren;t++){let a=e.getChildAt(t),s=a.getChildByName("lock");t<2+w.readItemUnlock()?(s.set_visible(!1),C.d2_AddClickEvent(a,this,this.onShopChooseClick,[t])):s.set_visible(!0)}}onShopChooseClick(e){this.shopPanel.getChildByName("platform").getChildByName("icon").skin=this.shopItemIconUrl[e]}onShopCloseClick(){this.shopPanel.set_visible(!1)}showShopPanel(){this.shopPanel.set_visible(!0)}getItemPanelInit(){let e=w.readItemUnlock(),t=k.game.playCount>0&&e<=3;if(this.getItemPanel.set_visible(t),!t)return;p.play(o.Unlock);this.getItemPanel.getChildByName("title").getChildByName("value").skin=this.getItemTitleUrl[e],this.getItemPanel.getChildByName("icon").skin=this.getItemIconUrl[e];let a=this.getItemPanel.getChildByName("btnGetItem"),s=this.getItemPanel.getChildByName("btnGiveUp");C.d2_AddClickEvent(a,this,this.onGetItemPanel_btnGetItemClick),C.d2_AddClickEvent(s,this,this.onGetItemPanel_btnGiveUpClick)}onGetItemPanel_btnGetItemClick(){w.addItemUnlock(),this.getItemPanel.set_visible(!1)}onGetItemPanel_btnGiveUpClick(){this.getItemPanel.set_visible(!1)}}class O{static toAlpha(e,t,a,s,i,o,n=!1,r=!1){function alpha1(){let t=r||n?new Laya.Handler(this,alpha2):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{alpha:a},s,i,t)}function alpha2(){let a=r?new Laya.Handler(this,alpha1):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{alpha:t},s,i,a)}e&&!e.destroyed&&(this.clearTween(e),e.alpha=t,alpha1())}static toScale(e,t,a,s,i,o,n=!1,r=!1){function scale1(){let t=r||n?new Laya.Handler(this,scale2):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{scaleX:a,scaleY:a},s,i,t)}function scale2(){let a=r?new Laya.Handler(this,scale1):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{scaleX:t,scaleY:t},s,i,a)}e&&!e.destroyed&&(this.clearTween(e),e.scale(t,t),scale1())}static toPosition(e,t,a,s,i,o=!1,n=0){if(!e||e.destroyed)return;this.clearTween(e);let r={},l={};function pos1(){if(o)var t=0==n?new Laya.Handler(this,pos2):new Laya.Handler(this,pos3);else t=new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,l,a,s,t)}function pos2(){Laya.Tween.to(e,r,a,s,Laya.Handler.create(this,pos1))}function pos3(){e.pos(r.x,r.y),pos1()}null!=t.x&&(r.x=e.x,l.x=t.x),null!=t.y&&(r.y=e.y,l.y=t.y),pos1()}static toRotaion(e,t,a,s,i,o=!1,n=!1){if(!e||e.destroyed)return;this.clearTween(e);let r=e.rotation,l=r+t,h=r-t+r;function rotate2(){Laya.Tween.to(e,{rotation:h},2*a,s,Laya.Handler.create(this,rotate3))}function rotate3(){Laya.Tween.to(e,{rotation:l},2*a,s,Laya.Handler.create(this,rotate2))}function rotate4(){let t=new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,{rotation:r},a,s,t)}!function(){let t=n?new Laya.Handler(this,rotate2):o?new Laya.Handler(this,rotate4):new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,{rotation:l},a,s,t)}()}static showViewByScale(e,t,a=1,s=200){this.toScale(e,0,a,s,Laya.Ease.bounceOut,t,!0,!1)}static clearTween(e){Laya.Tween.clearAll(e)}}class U extends Laya.Script{onEnable(){let e=this.owner;O.toScale(e,.9,1.1,500,null,()=>{},!1,!0)}onDisable(){let e=this.owner;O.clearTween(e),e.scale(1,1)}}class T extends Laya.Script{onEnable(){let e=this.owner;Laya.timer.loop(10,this,()=>{e.rotation++})}onDisable(){let e=this.owner;O.clearTween(e),Laya.timer.clearAll(this)}}class z extends x{init(){Laya.timer.frameOnce(1,this,this.loadProgressUpdate)}initEvent(){L.on(a.Progress_Load_Update,this,this.loadProgressUpdate)}loadProgressUpdate(){let e=k.loadingList;0==e.length?(console.log("加载完毕"),k.goHome(),k.loadingCount=0):console.log("正在加载",e[0]),this.loadBar.value=e.length/k.loadingCount}}class E extends x{constructor(){super(...arguments),this.awardCount=0,this.isAll=!1}init(){let e=k.game.nowHeadData,t=0;for(let a=0;a<e.partsIds.length;a++)2==e.partsIds[a]&&t++,this.targetList.getChildAt(a).set_visible(2==e.partsIds[a]);t==e.partsIds.length&&(this.isAll=!0),this.awardCount=k.game.endTypes.length*k.game.itemsComp.nowType.length*10,this.isAll&&(this.awardCount*=2),this.awardCount*=.2*w.readHomeLevelUpData().money+1,this.awardValue.value=this.awardCount.toString(),this.moneyUIUpdate(),this.headName.skin="ui/game/jsym_rm_"+(e.headId-2)+".png",this.headName.set_visible(!1)}initEvent(){C.d2_AddClickEvent(this.btnContinue,this,this.onBtnContinueClick)}onBtnContinueClick(){this.btnContinue.offAllCaller(this),this.moneyAnim(()=>{w.AddCoin(this.awardCount),this.moneyUIUpdate(),k.game.isWin&&w.AddGrade(),k.goHome()})}moneyUIUpdate(){this.moneyValue.value=w.ReadCoin().toString()}moneyAnim(e){C.d2_coinCollectAnim("ui/game/jsym_xj_1.png",new Laya.Vector2(this.award.x,this.award.y),new Laya.Vector2(this.moneyBack.x,this.moneyBack.y),this.scene,this.isAll?20:10,this.isAll?1:.5,()=>{e&&e()})}}class R{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("Main/Scenes/Game.ts",D),e("Tools/nimo_Mods/ctrl/TouchCtrl.ts",V),e("Tools/nimo_Mods/ctrl/TouchScan.ts",A),e("Main/Scenes/Home.ts",N),e("Tools/nimo_Mods/uiTween/ScaleUITween.ts",U),e("Tools/nimo_Mods/uiTween/RotUITween.ts",T),e("Main/Scenes/Load.ts",z),e("Main/Scenes/Over.ts",E)}}R.width=750,R.height=1334,R.scaleMode="fixedwidth",R.screenMode="vertical",R.alignV="middle",R.alignH="center",R.startScene="scenes/Game.scene",R.sceneRoot="",R.debug=!1,R.stat=!1,R.physicsDebug=!1,R.exportSceneToJson=!0,R.init();new class{constructor(){window.Laya3D?Laya3D.init(R.width,R.height):Laya.init(R.width,R.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=R.scaleMode,Laya.stage.screenMode=R.screenMode,Laya.stage.alignV=R.alignV,Laya.stage.alignH=R.alignH,Laya.URL.exportSceneToJson=R.exportSceneToJson,(R.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),R.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),R.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){k.init()}}}();