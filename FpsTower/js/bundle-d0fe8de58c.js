!function(){"use strict";var t,e,i,a,s,o,n,r,l,h;!function(t){t.WX="wx",t.OPPO="oppo",t.VIVO="vivo",t.PC="pc",t.TT="tt"}(t||(t={})),function(t){t.TestPanel="prefab/testPanel.prefab"}(e||(e={})),function(t){t.Load="uiScene/Load.scene",t.Home="uiScene/Home.scene",t.Game="uiScene/Game.scene",t.Over="uiScene/Over.scene"}(i||(i={})),function(t){t[t.Load_Res_Msg_Event=0]="Load_Res_Msg_Event",t[t.Init_Game_Event=1]="Init_Game_Event",t[t.Play_Game_Event=2]="Play_Game_Event",t[t.Over_Game_Event=3]="Over_Game_Event",t[t.Open_Ui_Event=4]="Open_Ui_Event",t[t.Close_Ui_Event=5]="Close_Ui_Event",t[t.Update_Coin_Event=6]="Update_Coin_Event",t[t.Update_Skin_Event=7]="Update_Skin_Event",t[t.Close_Video_Event=8]="Close_Video_Event",t[t.Platform_Wake_Event=9]="Platform_Wake_Event",t[t.Platform_Sleep_Event=10]="Platform_Sleep_Event",t[t.Game_ShowAim_Event=11]="Game_ShowAim_Event",t[t.Game_ShowSmallAim_Event=12]="Game_ShowSmallAim_Event",t[t.KeyDown_Event=13]="KeyDown_Event",t[t.Game_RoundUpdate_Event=14]="Game_RoundUpdate_Event",t[t.Game_FireUpdate_Event=15]="Game_FireUpdate_Event",t[t.Game_BuildUIUpdate_Event=16]="Game_BuildUIUpdate_Event",t[t.Game_PlayerBaseUpdate_Event=17]="Game_PlayerBaseUpdate_Event"}(a||(a={})),function(t){t.BGM="Bgm",t.CLICK="Click",t.win="win",t.fail="fail",t.aim_in="aim_in",t.shoot="shoot",t.snipe1_reload_open="snipe1_reload_open",t.sniper1_reload_close="sniper1_reload_close",t.sniper1_reload_insert="sniper1_reload_insert",t.handgun_reload="handgun_reload",t.rifle1_reload="rifle1_reload",t.rifle2_reload="rifle2_reload"}(s||(s={})),function(t){t.Low="Low",t.Mid="Mid",t.High="High"}(o||(o={}));class d{constructor(){this.bannerId="",this.videoId="",this.interId="",this.gridId="",this.nativeId="",this.boxPortalId="",this.canSubPackage=!1,this.initAd(),this.regisiterCallback()}initAd(){console.warn("未初始化广告组件")}createBannerAd(t){console.warn("暂不支持Banner广告")}createVideoAd(){console.warn("暂不支持激励视频广告")}createInterAd(){console.warn("暂不支持插屏广告")}createGridAd(){console.warn("暂不支持格子广告")}createNativeAd(t,e){return console.warn("暂不支持原生广告"),null}createBoxProtalAd(){console.warn("暂不支持九宫格广告")}showBannerAd(){}hideBannerAd(){}destroyBannerAd(){}showVideoAd(t,e){t&&t()}destroyVideoAd(){}showInterAd(){}destroyInterAd(){}showGridAd(){}hideGridAd(){}destroyGridAd(){}showNativeAd(t,e){}loadNativeAd(t,e){}destroyNativeAd(t){}showBoxProtalAd(t,e){e&&e()}destroyBoxProtalAd(){}getSystemInfoSync(){return this.sysInfo||(this.sysInfo=this.platformApi.getSystemInfoSync()),this.sysInfo}showToast(t,e){}vibrateShort(){this.platformApi&&this.platformApi.vibrateShort()}vibrateLong(){this.platformApi&&this.platformApi.vibrateLong()}loadSubpackage(t,e,i){this.platformApi.loadSubpackage({name:t,success:function(a){X.ConsoleLog("分包加载成功：",t),i.call(a,e,!0)},fail:function(a){X.ConsoleError("分包加载失败：",t,JSON.stringify(a)),i.call(a,e,!1)}}).onProgressUpdate(t=>{X.ConsoleLog("分包================",JSON.stringify(t))})}loadSubpackagesSync(t,e,i){var a=t.length;for(let s=0;s<a;s++)this.loadSubpackage(t[s],e,(t,e)=>{e&&0==--a&&(X.ConsoleLog("全部分包加载完成"),i.call(this,t,e))})}regisiterCallback(){this.platformApi&&(this.platformApi.offShow(this.onShowEvent),this.platformApi.onShow(this.onShowEvent),this.platformApi.offHide(this.onHideEvent),this.platformApi.onHide(this.onHideEvent))}onShowEvent(t){X.Event.event(a.Platform_Wake_Event,{param:t})}onHideEvent(t){X.Event.event(a.Platform_Sleep_Event,{param:t})}createShortcut(t){}hasShortcut(t){}}class c{}class m extends d{initAd(){this.canSubPackage=!0,this.platformApi=Laya.Browser.window.qg,this.bannerId="368663",this.videoId="368667",this.nativeId="368665",this.boxPortalId="368668",this.createBannerAd(),this.createVideoAd(),this.createBoxProtalAd()}createBannerAd(t=!1){this.getPlatformVersionCode<1051?console.warn("版本过低暂不支持Banner广告组件"):(this.bannerAd&&this.destroyBannerAd(),this.bannerAd=Laya.Browser.window.qg.createBannerAd({adUnitId:this.bannerId}),this.bannerAd.onLoad(()=>{t&&this.bannerAd.show().then(()=>{}).catch(t=>{this.createBannerAd()}),console.log("Banner广告加载成功")}),this.bannerAd.onError(t=>{this.bannerAd=null,console.error("Banner广告加载失败",JSON.stringify(t))}),this.bannerAd.onResize(t=>{}))}showBannerAd(){this.bannerAd?this.bannerAd.show().then(()=>{}).catch(t=>{this.createBannerAd(!0)}):this.createBannerAd(!0)}hideBannerAd(){this.bannerAd&&this.bannerAd.hide()}destroyBannerAd(){this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}createVideoAd(){this.getPlatformVersionCode<1051?console.warn("版本过低暂不支持激励视频广告组件"):(this.videoAd&&this.destroyVideoAd(),this.videoAd=Laya.Browser.window.qg.createRewardedVideoAd({adUnitId:this.videoId}),this.videoAd.onLoad(t=>{console.log("激励视频广告加载成功")}),this.videoAd.onError(t=>{this.videoAd=null,console.error("激励视频广告加载失败",JSON.stringify(t))}),this.videoAd.onClose(t=>{t&&(t.isEnded?this.videoFinishCallback&&this.videoFinishCallback():this.videoCancelCallback&&this.videoCancelCallback(),this.videoFinishCallback=null,this.videoCancelCallback=null,this.videoAd.load())}))}showVideoAd(t,e){if(!this.videoAd)return this.createVideoAd(),void(t&&t());this.videoFinishCallback=t,this.videoCancelCallback=e,Laya.SoundManager.muted=!0,this.videoAd.show().then(()=>{}).catch(e=>{t&&t(),this.createVideoAd(),this.videoFinishCallback=null,this.videoCancelCallback=null,Laya.SoundManager.muted=!1})}destroyVideoAd(){this.videoAd&&(this.videoAd.destroy(),this.videoAd=null)}createBoxProtalAd(){this.getPlatformVersionCode<1076?console.warn("版本过低暂不支持九宫格广告组件"):(this.boxPortalAd=Laya.Browser.window.qg.createGamePortalAd({adUnitId:this.boxPortalId}),this.boxPortalAd.load(),this.boxPortalAd.onLoad(()=>{console.log("九宫格广告加载成功")}),this.boxPortalAd.onError(t=>{this.boxPortalAd=null,console.error("九宫格广告加载失败",JSON.stringify(t))}),this.boxPortalAd.onClose(()=>{this.boxPortalCloseCallback&&this.boxPortalCloseCallback(),this.boxPortalCloseCallback=null}))}showBoxProtalAd(t){if(!this.boxPortalAd)return t&&t(),void this.createBoxProtalAd();this.boxPortalAd.show().then(()=>{this.boxPortalCloseCallback=t}).catch(e=>{this.destroyBoxProtalAd(),t&&t()})}destroyBoxProtalAd(){this.boxPortalAd&&(this.boxPortalAd.destroy(),this.boxPortalAd=null,this.createBoxProtalAd())}createNativeAd(t){if(!(this.getPlatformVersionCode<1051)){var e=new c,i=Laya.Browser.window.qg.createNativeAd({adUnitId:t||this.nativeId});return i.load(),i.onLoad(t=>{if(t&&t.adList){e.nativeAd=i;let a=t.adList.pop();e.title=a.title,e.adId=a.adId.toString(),e.imgUrl=a.imgUrlList[0],e.desc=a.desc,console.log("原生广告加载成功")}}),i.onError(t=>{console.error("原生广告加载失败",JSON.stringify(t))}),e}console.warn("版本过低暂不支持原生广告组件")}showNativeAd(t){t&&(t.nativeAd.reportAdShow({adId:t.adId}),t.nativeAd.reportAdClick({adId:t.adId}))}loadNativeAd(t){t&&t.nativeAd.load()}destroyNativeAd(t){t&&(t.nativeAd.offLoad(),t=null)}get getPlatformVersionCode(){return this.getSystemInfoSync().platformVersionCode}showToast(t,e=1500){Laya.Browser.window.qg.showToast({title:t,duration:e})}}class u extends d{initAd(){this.canSubPackage=!0,this.platformApi=Laya.Browser.window.qg,this.bannerId="b0f1cd20a8fb46d5ad5fc76115c0f439",this.videoId="a8e27c60943c4160944608eedb1ab3eb",this.nativeId="f6396fe1edca4b6b93b069897d26fc23",this.boxPortalId="0f1a6cdf82c84dcd971812d710a54def",this.createBannerAd(),this.createVideoAd(),this.createBoxProtalAd()}createBannerAd(t=!1){this.getPlatformVersionCode<1031?console.warn("版本过低暂不支持Banner广告组件"):(this.bannerAd&&this.destroyBannerAd(),this.bannerAd=Laya.Browser.window.qg.createBannerAd({posId:this.bannerId,style:{},adIntervals:30}),this.bannerAd.onLoad(()=>{t&&this.bannerAd.show().then(()=>{}).catch(t=>{this.createBannerAd()}),console.log("Banner广告加载成功")}),this.bannerAd.onError(t=>{this.bannerAd=null,console.error("Banner广告加载失败",JSON.stringify(t))}),this.bannerAd.onClose(()=>{this.createBannerAd()}),this.bannerAd.onSize(t=>{}))}showBannerAd(){this.bannerAd?this.bannerAd.show().then(()=>{}).catch(t=>{this.createBannerAd(!0)}):this.createBannerAd(!0)}hideBannerAd(){this.bannerAd&&this.bannerAd.hide()}destroyBannerAd(){this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}createVideoAd(){this.getPlatformVersionCode<1041?console.warn("版本过低暂不支持激励视频广告组件"):(this.videoAd&&this.destroyVideoAd(),this.videoAd=Laya.Browser.window.qg.createRewardedVideoAd({posId:this.videoId}),this.videoAd.onLoad(t=>{console.log("激励视频广告加载成功")}),this.videoAd.onError(t=>{this.videoAd=null,console.error("激励视频广告加载失败",JSON.stringify(t))}),this.videoAd.onClose(t=>{t&&(t.isEnded?this.videoFinishCallback&&this.videoFinishCallback():this.videoCancelCallback&&this.videoCancelCallback(),this.videoFinishCallback=null,this.videoCancelCallback=null,this.videoAd.load())}))}showVideoAd(t,e){if(!this.videoAd)return this.createVideoAd(),void(t&&t());this.videoFinishCallback=t,this.videoCancelCallback=e,Laya.SoundManager.muted=!0,this.videoAd.show().then(()=>{}).catch(e=>{t&&t(),this.createVideoAd(),this.videoFinishCallback=null,this.videoCancelCallback=null,Laya.SoundManager.muted=!1})}destroyVideoAd(){this.videoAd&&(this.videoAd=null)}createBoxProtalAd(){Laya.Browser.window.qg.createBoxPortalAd?(this.boxPortalAd=Laya.Browser.window.qg.createBoxPortalAd({posId:this.boxPortalId,marginTop:.4*this.getSystemInfoSync().screenHeight}),this.boxPortalAd.onLoad(()=>{console.log("九宫格广告加载成功")}),this.boxPortalAd.onError(t=>{this.boxPortalAd=null,console.error("九宫格广告加载失败",JSON.stringify(t))}),this.boxPortalAd.onClose(()=>{this.boxPortalCloseCallback&&this.boxPortalCloseCallback(),this.boxPortalCloseCallback=null})):console.warn("版本过低暂不支持九宫格广告组件")}showBoxProtalAd(t){if(!this.boxPortalAd)return t&&t(),void this.createBoxProtalAd();this.boxPortalAd.show().then(()=>{this.boxPortalCloseCallback=t}).catch(e=>{this.destroyBoxProtalAd(),t&&t()})}destroyBoxProtalAd(){this.boxPortalAd&&(this.boxPortalAd.destroy(),this.boxPortalAd=null,this.createBoxProtalAd())}createNativeAd(t){if(!(this.getPlatformVersionCode<1053)){var e=new c,i=Laya.Browser.window.qg.createNativeAd({posId:t||this.nativeId});return i.onLoad(t=>{if(t&&t.adList){e.nativeAd=i;let a=t.adList.pop();e.title=a.title,e.adId=a.adId.toString(),e.imgUrl=a.imgUrlList[0],e.desc=a.desc,console.log("原生广告加载成功")}}),i.onError(t=>{console.error("原生广告加载失败",JSON.stringify(t))}),e}console.warn("版本过低暂不支持原生广告组件")}showNativeAd(t){t&&(t.nativeAd.reportAdShow({adId:t.adId}),t.nativeAd.reportAdClick({adId:t.adId}))}loadNativeAd(t){t&&t.nativeAd.load()}destroyNativeAd(t){t&&(t.nativeAd.offLoad(),t=null)}get getPlatformVersionCode(){return this.getSystemInfoSync().platformVersionCode}showToast(t,e=0){Laya.Browser.window.qg.showToast({message:t,duration:e})}}class y extends d{initAd(){this.canSubPackage=!0,this.platformApi=Laya.Browser.window.wx,this.bannerId="",this.videoId="",this.interId="",this.gridId="",this.showShareMenuWithTicket(!0),this.regisiterWXShareCallback()}createBannerAd(t=!1){if(this.compareSDKVersion("2.0.4"))return void console.warn("版本过低暂不支持Banner广告组件");this.bannerAd&&this.destroyBannerAd();let e=this.getSystemInfoSync();this.bannerAd=Laya.Browser.window.wx.createBannerAd({adUnitId:this.bannerId,style:{top:.8*e.screenHeight,width:300,left:e.screenWidth/2-150},adIntervals:30}),this.bannerAd.onLoad(()=>{t&&this.bannerAd.show().then(()=>{}).catch(t=>{this.createBannerAd()}),console.log("Banner广告加载成功")}),this.bannerAd.onError(t=>{this.bannerAd=null,console.error("Banner广告加载失败",JSON.stringify(t))}),this.bannerAd.onResize(t=>{let i=this.bannerAd.style.realHeight+.1;e.model.startsWith("iPhone X")&&(i+=40/Laya.Browser.height*at.height),this.bannerAd.style.top=e.screenHeight-i})}showBannerAd(){this.bannerAd?this.bannerAd.show().then(()=>{}).catch(t=>{this.createBannerAd(!0)}):this.createBannerAd(!0)}hideBannerAd(){this.bannerAd&&this.bannerAd.hide()}destroyBannerAd(){this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}createVideoAd(){this.compareSDKVersion("2.0.4")?console.warn("版本过低暂不支持激励视频广告组件"):(this.videoAd&&this.destroyVideoAd(),this.videoAd=Laya.Browser.window.wx.createRewardedVideoAd({adUnitId:this.videoId}),this.videoAd.onLoad(t=>{console.log("激励视频广告加载成功")}),this.videoAd.onError(t=>{this.videoAd=null,console.error("激励视频广告加载失败",JSON.stringify(t))}),this.videoAd.onClose(t=>{t&&(t.isEnded?this.videoFinishCallback&&this.videoFinishCallback():this.videoCancelCallback&&this.videoCancelCallback(),this.videoFinishCallback=null,this.videoCancelCallback=null,this.videoAd.load())}))}showVideoAd(t,e){if(!this.videoAd)return this.createVideoAd(),void(t&&t());this.videoFinishCallback=t,this.videoCancelCallback=e,Laya.SoundManager.muted=!0,this.videoAd.show().then(()=>{}).catch(e=>{t&&t(),this.createVideoAd(),this.videoFinishCallback=null,this.videoCancelCallback=null,Laya.SoundManager.muted=!1})}destroyVideoAd(){this.videoAd&&(this.videoAd.destroy(),this.videoAd=null)}get getPlatformVersionCode(){return this.getSystemInfoSync().SDKVersion}compareSDKVersion(t="1.0.0"){let e=this.getPlatformVersionCode.split("."),i=t.split("."),a=!1;for(let t=0;t<e.length&&!(e[t]>i[t]);t++)e[t]!=i[t]&&(a=!0);return a}showToast(t,e=1500){Laya.Browser.window.wx.showToast({title:t,duration:e})}showShareMenuWithTicket(t){wx.showShareMenu({withShareTicket:t,success:function(){},fail:function(){},complete:function(){}})}regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var t={title:"分享",image:""};Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:t.title,imageUrl:t.image,query:"share_id=1"}})}}}class p extends d{constructor(){super(...arguments),this.isRecording=!1,this.videoPath=""}initAd(){this.canSubPackage=!0,this.platformApi=Laya.Browser.window.tt,this.videoId="2ka6315g9a3a2orxua",this.interId="tfmsrei55720jflc8e",this.initRecorder(),this.createVideoAd(),this.createInterAd()}createVideoAd(){this.compareSDKVersion("1.3.0")?console.warn("版本过低暂不支持激励视频广告组件"):(this.videoAd&&this.destroyVideoAd(),this.videoAd=Laya.Browser.window.tt.createRewardedVideoAd({adUnitId:this.videoId}),this.videoAd.onLoad(t=>{console.log("激励视频广告加载成功")}),this.videoAd.onError(t=>{this.videoAd=null,console.error("激励视频广告加载失败",JSON.stringify(t))}),this.videoAd.onClose(t=>{(t||void 0===t)&&(t&&t.isEnded?this.videoFinishCallback&&this.videoFinishCallback():(this.showToast("未看完视频",2e3),this.videoCancelCallback&&this.videoCancelCallback()),this.videoFinishCallback=null,this.videoCancelCallback=null,this.videoAd.load(),X.Event.event(a.Close_Video_Event,{isEnded:t.isEnded}))}))}showVideoAd(t,e){if(!this.videoAd)return this.createVideoAd(),void this.showToast("广告暂未准备好,请稍后再试",2e3);this.videoFinishCallback=t,this.videoCancelCallback=e,this.videoAd.show().then(()=>{}).catch(t=>{this.createVideoAd(),this.videoFinishCallback=null,this.videoCancelCallback=null,this.showToast("广告暂未准备好,请稍后再试",2e3)})}destroyVideoAd(){this.videoAd&&(this.videoAd.destroy(),this.videoAd=null)}createInterAd(t){this.compareSDKVersion("1.71.0")?console.warn("版本过低暂不支持插屏广告组件"):(this.interAd=Laya.Browser.window.tt.createInterstitialAd({adUnitId:this.interId}),this.interAd.onLoad(()=>{console.log("插屏广告加载成功"),t&&this.interAd.show()}),this.interAd.onError(t=>{console.error("插屏广告加载失败"),this.interAd.destroy(),this.interAd=null}))}showInterAd(){this.interAd?this.interAd.load().then(()=>{this.interAd.show()}).catch(t=>{console.error(t)}):this.createInterAd(!0)}initRecorder(){p.recorder=Laya.Browser.window.tt.getGameRecorderManager(),this.stopListener(),this.onInterrupBegin(),this.onInterrupEnd(),console.log("录屏组件初始化")}recordStart(){p.recorder&&(console.log("录屏开始"),p.recorder.start({duration:300}),this.isRecording=!0)}recordPause(){p.recorder&&(console.log("录屏暂停"),p.recorder.pause())}recordResume(){p.recorder&&(console.log("录屏继续"),p.recorder.resume())}recordStop(t){p.recorder&&this.isRecording&&(console.log("录屏停止"),p.recorder.stop(),this.recorderVideoCB=t)}clipVideo(t=30){if(p.recorder&&this.isRecording){var e=this;p.recorder.clipVideo({path:this.videoPath,timeRange:[t,0],success(t){console.log("录屏剪辑成功"),e.videoPath=t.videoPath},fail(t){console.log("录屏剪辑失败")}})}}stopListener(){p.recorder.onStop(t=>{console.log("录屏结束：",t.videoPath),this.videoPath=t.videoPath,this.isRecording=!1,this.recorderVideoCB&&this.recorderVideoCB()})}onInterrupBegin(){p.recorder.onInterruptionBegin(()=>{console.log("录屏被打断开始"),this.recordPause()})}onInterrupEnd(){p.recorder.onInterruptionEnd(()=>{console.log("录屏被打断结束"),this.recordResume()})}shareVideo(t,e=["变形机甲超人","抖音小游戏"]){""!=this.videoPath?Laya.Browser.window.tt.shareAppMessage({channel:"video",extra:{videoPath:this.videoPath,videoTopics:e,createChallenge:!0},success:()=>{console.log("分享成功"),t&&t(!0)},fail:e=>{console.log("分享失败"),X.Platform.showToast("分享失败！",2e3),t&&t(!1)}}):this.showToast("没有录制视频",2e3)}get getPlatformVersionCode(){return this.getSystemInfoSync().SDKVersion}compareSDKVersion(t="1.0.0"){let e=this.getPlatformVersionCode.split("."),i=t.split("."),a=!1;for(let t=0;t<e.length&&!(e[t]>i[t]);t++)e[t]!=i[t]&&(a=!0);return a}showToast(t,e=1500){Laya.Browser.window.tt.showToast({title:t,duration:e})}}p.recorder=null;class g{static add(t,e){var i=new Laya.Vector3;return Laya.Vector3.add(t,e,i),i.clone()}static subtract(t,e){var i=new Laya.Vector3;return Laya.Vector3.subtract(t,e,i),i.clone()}static mull(t,e){var i=new Laya.Vector3;return Laya.Vector3.scale(t,e,i),i.clone()}static dot(t,e){return Laya.Vector3.dot(t,e)}static cross(t,e){var i=new Laya.Vector3;return Laya.Vector3.cross(t,e,i),i.clone()}static normalized(t){var e=new Laya.Vector3;return Laya.Vector3.normalize(t,e),e.clone()}static distance(t,e){var i=g.subtract(t,e);return Laya.Vector3.scalarLength(i)}}class v extends Laya.Script3D{onAwake(){this.self=this.owner,this.init()}init(...t){}onDestroy(){Laya.timer.clearAll(this),X.Event.offAllCaller(this)}}class w{static BoxToBox(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY&&t.minZ<=e.maxZ&&t.maxZ>=e.minZ}static SphereToSphere(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2)<Math.pow(t.radius,2)+Math.pow(e.radius,2)}static SphereToBox(t,e){var i=Math.max(e.minX,Math.min(t.x,e.maxX)),a=Math.max(e.minY,Math.min(t.y,e.maxY)),s=Math.max(e.minZ,Math.min(t.z,e.maxZ));return Math.sqrt((i-t.x)*(i-t.x)+(a-t.y)*(a-t.y)+(s-t.z)*(s-t.z))<t.radius}static calcBounds(t){let e=[];t.meshFilter.sharedMesh.getPositions(e);let i=new Laya.Sprite3D;t.addChild(i);for(let t=0;t<e.length;t++)i.transform.localPosition=new Laya.Vector3(e[t].x,e[t].y,e[t].z),e[t]=i.transform.position.clone();let a=e[0].x,s=e[0].y,o=e[0].z,n=a,r=s,l=o;for(var h=0;h<e.length;h++)a=Math.max(a,e[h].x),s=Math.max(s,e[h].y),o=Math.max(o,e[h].z),n=Math.min(n,e[h].x),r=Math.min(r,e[h].y),l=Math.min(l,e[h].z);return{maxX:a,maxY:s,maxZ:o,minX:n,minY:r,minZ:l}}static calculateDistance(t,e,i){let a=g.subtract(e,t),s=g.subtract(i,t),o=g.normalized(a.clone()),n=g.normalized(s.clone()),r=Math.abs(g.dot(o,n)),l=g.subtract(i,e),h=g.subtract(t,e),d=g.normalized(l.clone()),c=g.normalized(h.clone());if(Math.abs(g.dot(d,c))>0&&r>0){let a=Math.sqrt(1-r*r);return{pt1:t,pt2:e,pt:i,distance:g.distance(t,i)*a}}return null}}class L extends v{constructor(){super(...arguments),this.bigColliderAxis=.012,this.damage=1,this.isThrough=!1,this.goWay=new Laya.Vector3,this.speed=10,this.nowDis=0}init(...t){0!=t.length&&(this.damage=t[0],this.isThrough=t[1],this.self.transform.getForward(this.goWay),Laya.timer.once(2e3,this,this.autoDestroy),this.hitAllEnemyData=[],this.pointA=this.self.transform.position.clone(),this.pointB=g.add(this.pointA,g.mull(this.goWay,1e4)),this.oneWayScale=Laya.Vector3.scalarLength(this.goWay),this.bulletWillHit())}onUpdate(){let t=Laya.timer.delta/1e3*Laya.timer.scale;this.self.transform.translate(g.mull(this.goWay,t*this.speed*-1),!1),this.nowDis-=this.oneWayScale*t*this.speed*-1,this.enemyHitCheck(this.nowDis)}bulletWillHit(){let t,e=X.Level.enemys,i=1e5;for(let a=e.length-1;a>=0;a--){if(e[a].nowHp<=0)continue;let s=e[a].colliders;for(let e=0;e<s.length;e++){let a=s[e].obj.transform.position.clone(),o=w.calculateDistance(this.pointA,this.pointB,a),n=g.distance(a,this.pointA);o&&o.distance<s[e].raidus+this.bigColliderAxis&&(n<i&&(t=s[e],i=n),this.isThrough&&this.hitAllEnemyData.push({collider:s[e],dis:n}))}}t&&(this.hitEnemyData={collider:t,dis:i})}enemyHitCheck(t){if(this.hitEnemyData)if(this.isThrough){if(0==this.hitAllEnemyData.length)return;for(let e=this.hitAllEnemyData.length-1;e>=0;e--)if(t>this.hitAllEnemyData[e].dis){let t=this.hitAllEnemyData[e].collider,i=t.obj.name.split("_");i[2],t.comp.hitInfo(i[2],this.damage)&&X.Level.bornFxDestroy("EffectGiantBoom",X.Level.mainScene,1e3,1.2,t.obj.transform.position.clone()),this.hitAllEnemyData.splice(e,1)}}else if(t>this.hitEnemyData.dis){let t=this.hitEnemyData.collider,e=t.obj.name.split("_");e[2],t.comp.hitInfo(e[2],this.damage)&&X.Level.bornFxDestroy("EffectGiantBoom",X.Level.mainScene,1e3,1.2,t.obj.transform.position.clone()),this.hit(!0)}}buildHitCheck(t){}hit(t=!1){Laya.timer.clear(this,this.autoDestroy),t&&this.self.destroy()}autoDestroy(){this.self.destroy()}}class f extends v{constructor(){super(...arguments),this.colliders=[],this.isDeadMove=!1,this.nowHp=0,this.walkSoundPlayTime=1,this.speed=1,this.pathId=0,this.isHurting=!1,this.isDead=!1,this.isMoving=!1,this.isAttack=!1,this.armLHitIndex=4,this.armRHitIndex=4,this.legLHitIndex=5,this.legRHitIndex=5}init(...t){0!=t.length&&(this.speed=X.Level.baseData[0].MonsterMoveSpeed,this.pathData=t[0],this.searchCollider(this.self),this.hpInit(),this.anim=this.self.getChildAt(0).getComponent(Laya.Animator),this.setGaintSpeed(X.Level.isAimSlow),this.thinkUpdate(!0),X.Event.on(a.Game_ShowAim_Event,this,this.setGaintSpeed))}hpInit(){this.nowHp=X.Level.stageData[0].MonsterHP}searchCollider(t){for(let e=0;e<t.numChildren;e++){let i=t.getChildAt(e),a=i.name.split("_");if("collider"==a[0]){let t=this,e=this.self.transform.localScaleX;this.colliders.push({obj:i,comp:t,raidus:parseFloat(a[1])/2*.1*e,type:a[2]})}this.searchCollider(i)}}onUpdate(){if(this.isDeadMove){let t=Laya.timer.delta/1e3*Laya.timer.scale,e=this.self.transform.position.clone();return e.y-=.5*t,void(this.self.transform.position=e)}if(this.isAttack||this.isHurting||this.isDead)return;let t=Laya.timer.delta/1e3*Laya.timer.scale;if(this.isMoving&&this.target&&!this.target.destroyed){let e=g.subtract(this.target.transform.position.clone(),this.self.transform.position.clone()),i=Math.atan2(e.x,e.z)/Math.PI*180;if(this.self.transform.rotationEuler=new Laya.Vector3(0,i,0),Laya.Vector3.scalarLength(e)>.05){let i=this.nowHp>10?1:.75;this.self.transform.translate(g.mull(g.normalized(e),t*this.speed*i),!1)}else this.thinkUpdate(!0);this.walkSoundPlayTime-=t,this.walkSoundPlayTime<=0&&(this.walkSoundPlayTime=1)}}thinkUpdate(t=!1){this.isAttack||this.isHurting||this.isDead||(t&&this.search(),this.target?this.move():this.idle())}search(){let t=this.pathData;this.pathId<t.length?(this.target=t[this.pathId],this.pathId++):(X.Level.playerBaseHurt(),this.die(!0))}setGaintSpeed(t){this.speed=t?.5:1,this.anim.speed=t?.5:1}idle(){(this.isMoving||this.isHurting)&&(this.isMoving=!1,this.anim.crossFade("Idle",.1,0,0))}move(){this.isMoving||(this.isMoving=!0,this.nowHp>10?this.anim.crossFade("Walk",.1,0,Math.random()):this.anim.crossFade("WalkShaking",.1,0,0))}startAttack(){this.isAttack=!0,this.anim.crossFade("Attack",.1,0,0);let t=1e3*this.anim.getControllerLayer(0).getAnimatorState("Attack").clip.duration();Laya.timer.once(.8*t,this,this.doAttack)}doAttack(){X.Level.playerBaseHurt(),this.stopAttack()}stopAttack(t=!1){Laya.timer.clear(this,this.doAttack),this.isAttack=!1,t||this.die(!0)}hurt(t){if(!this.isDead)if(this.stopAttack(!0),this.nowHp-=t,X.ConsoleLog("巨人剩余血量",this.nowHp),this.nowHp>0){this.isHurting=!0,this.anim.crossFade("Hit",.1,0,0);let t=1e3*this.anim.getControllerLayer(0).getAnimatorState("Hit").clip.duration();Laya.timer.once(t,this,()=>{this.isMoving=!1,this.isHurting=!1,this.thinkUpdate()})}else this.die(),X.Level.fireAdd(X.Level.baseData[0].MonsterDeadCoin,z.d3_getSpritePosBySprite3DPoint(X.Level.mainCamera,this.self))}die(t=!1){if(!this.isDead)if(Laya.timer.clear(this,this.thinkUpdate),this.isDead=!0,t)X.Level.enemyDie(this),this.self.destroy();else{this.anim.crossFade("Deadth",.2,0,0),this.anim.speed=1,X.Level.enemyDie(this);let t=1e3*this.anim.getControllerLayer(0).getAnimatorState("Deadth").clip.duration();Laya.timer.once(t,this,()=>{this.isDeadMove=!0}),Laya.timer.once(t+2e3,this,()=>{this.self.destroy()})}}onDestroy(){this.self.destroy()}hitInfo(t,e=1){let i=!1;switch(t){case"head":X.ConsoleLog("爆头"),i=!0,e*=2;break;case"body":default:X.ConsoleLog("打中身体"),i=!0}return i&&(q.instance.hitAimEffect(),this.hurt(e)),i}}f.mat=null;class C{constructor(t){this.isCanShoot=!1,this.isNotControl=!1,this.handGrip=t;let e=t.getChildByName("Left").getComponent(Laya.Animator),i=t.getChildByName("Right").getComponent(Laya.Animator);this.anim=[e,i],this.init()}init(){this.idle()}shoot_Touch(){this.isNotControl?Laya.timer.frameOnce(1,this,this.shoot_Touch):this.holdIn()}shoot_Release(){this.isNotControl?Laya.timer.clear(this,this.shoot_Touch):this.holdOut()}idle(){this.animPlay("idle")}holdIn(){this.animPlay("holdIn"),Laya.timer.once(40/30*1e3,this,this.hold)}hold(){this.animPlay("hold")}holdOut(){Laya.timer.clear(this,this.hold),this.animPlay("holdOut"),this.isNotControl=!0,Laya.timer.once(200,this,()=>{this.isNotControl=!1,X.Level.rayDo(),this.idle()})}animPlay(t){for(let e=0;e<this.anim.length;e++)this.anim[e].play(t,0,0)}}class A{constructor(t){this.reloadTime=1e3,this.reloadSound="",this.shootDoTime=100,this.shootTime=73/60*1e3,this.shootSound="",this.damage=1,this.weaponName="Weapon0",this.bulletMaxCount=10,this.bulletCount=0,this.isCanShoot=!1,this.isNotControl=!1;let e=X.Level.weaponGrip.getChildByName(t),i=e.getChildByName("gun").getComponent(Laya.Animator);this.weapon=e,this.weaponName=t,this.anim=i,this.init()}initData(){}init(){this.initData(),this.idleWeaponPos=new Laya.Vector3(.01,0,.05),this.idelWeaponRot=new Laya.Vector3(12.5,0,0),this.idleWeaponFov=70,X.Level.weaponGrip.active=!0,X.Level.isAutoShoot=!0,this.bulletCount=this.bulletMaxCount,this.idle(),X.Level.isSmallAimShow=!0}shoot_Touch(){this.isNotControl?Laya.timer.frameOnce(1,this,this.shoot_Touch):(X.Level.weaponGrip.transform.localPosition=this.idleWeaponPos,X.Level.mainCamera.fieldOfView=this.idleWeaponFov,X.Level.weaponGrip.active=!0,this.isCanShoot=!0)}shoot_Release(){if(this.isNotControl)return Laya.timer.clear(this,this.shoot_Touch),void(this.isCanShoot=!1);X.Level.weaponGrip.active=!0,this.isCanShoot=!1}shoot(){if(this.isNotControl)return;let t=this.weapon,e=this.anim;this.isNotControl=!0,this.bulletCount--,Laya.timer.once(this.shootDoTime,this,()=>{X.Level.bornBullet(this.damage)}),e.play("fire",0,0),X.Sound.play(this.shootSound),X.Platform.vibrateShort();let i=z.d3_FindNodeByName(t,"EffectShot");X.Level.bornFxDestroy("EffectShot",i),Laya.timer.once(this.shootTime,this,()=>{this.isNotControl=!1,this.bulletCount>0?this.idle():this.reload()})}idle(){this.anim.play("idle",0,0),this.isNotControl=!1,X.Level.weaponGrip.transform.localPosition=this.idleWeaponPos,X.Level.weaponGrip.transform.localRotationEuler=this.idelWeaponRot,X.Level.mainCamera.fieldOfView=this.idleWeaponFov}reload(){this.isNotControl=!0;this.anim.play("reload",0,0),X.Sound.play(this.reloadSound),this.bulletCount=this.bulletMaxCount,Laya.timer.once(this.reloadTime,this,()=>{this.isNotControl=!1})}}class b extends A{initData(){this.bulletMaxCount=10,this.reloadTime=65/30*1e3,this.reloadSound=s.handgun_reload,this.shootDoTime=1/30*1e3,this.shootTime=500,this.shootSound=s.shoot,this.damage=2}}class S{constructor(t){this.reloadTime=1e3,this.reloadSound="",this.shootTime=100,this.shootDoTime=100,this.shootSound="",this.shootCD=100,this.damage=1,this.weaponName="Weapon0",this.bulletMaxCount=10,this.bulletCount=0,this.isCanShoot=!1,this.isNotControl=!1,this.isCanShootRifle=!1;let e=X.Level.weaponGrip.getChildByName(t),i=e.getChildByName("gun").getComponent(Laya.Animator);this.weapon=e,this.weaponName=t,this.anim=i,this.init()}initData(){}init(){this.initData(),this.idleWeaponPos=new Laya.Vector3(.01,0,.05),this.idelWeaponRot=new Laya.Vector3(12.5,0,0),this.idleWeaponFov=70,X.Level.weaponGrip.active=!0,X.Level.isAutoShoot=!0,this.bulletCount=this.bulletMaxCount,this.idle(),X.Level.isSmallAimShow=!0}shoot_Touch(){this.isNotControl?Laya.timer.frameOnce(1,this,this.shoot_Touch):(X.Level.weaponGrip.transform.localPosition=this.idleWeaponPos,X.Level.mainCamera.fieldOfView=this.idleWeaponFov,X.Level.weaponGrip.active=!0,this.isCanShoot=!0,this.isCanShootRifle=!0)}shoot_Release(){if(this.isNotControl)return Laya.timer.clear(this,this.shoot_Touch),void(this.isCanShoot=!1);X.Level.weaponGrip.active=!0,this.isCanShoot=!1}shoot(){if(!this.isCanShootRifle)return;if(this.isNotControl)return;let t=this.weapon,e=this.anim;this.isCanShootRifle=!1,this.bulletCount--,Laya.timer.once(this.shootDoTime,this,()=>{X.Level.bornBullet(this.damage)}),e.play("fire",0,0),X.Sound.play(this.shootSound),X.Platform.vibrateShort();let i=z.d3_FindNodeByName(t,"EffectShot");X.Level.bornFxDestroy("EffectShot",i),Laya.timer.once(this.shootCD,this,()=>{this.isCanShootRifle=!0,this.bulletCount>0||this.reload()}),Laya.timer.once(this.shootTime,this,this.shootEnd)}shootEnd(){this.isNotControl||this.idle()}idle(){this.anim.play("idle",0,0),this.isNotControl=!1,X.Level.weaponGrip.transform.localPosition=this.idleWeaponPos,X.Level.weaponGrip.transform.localRotationEuler=this.idelWeaponRot,X.Level.mainCamera.fieldOfView=this.idleWeaponFov}reload(){this.isNotControl=!0;this.anim.play("reload",0,0),X.Sound.play(this.reloadSound),this.bulletCount=this.bulletMaxCount,Laya.timer.once(this.reloadTime,this,()=>{this.isNotControl=!1})}}class E extends S{initData(){this.bulletMaxCount=30,this.reloadTime=89/30*1e3,this.reloadSound=s.rifle1_reload,this.shootDoTime=5/30*1e3,this.shootTime=25/30*1e3,this.shootSound=s.shoot,this.shootCD=100,this.damage=2}}class P extends S{initData(){this.bulletMaxCount=30,this.reloadTime=83/30*1e3,this.reloadSound=s.rifle2_reload,this.shootDoTime=5/30*1e3,this.shootTime=25/30*1e3,this.shootSound=s.shoot,this.shootCD=50,this.damage=1}}class _{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(t){return Math.round(10*t)}toTween(t,e,i,a,s,o=!0){this.target=t,this.isLocal=o;var n={},r={};if(e.pos){var l=o?t.transform.localPosition.clone():t.transform.position.clone();n.posX=l.x,n.posY=l.y,n.posZ=l.z,r.posX=e.pos.x,r.posY=e.pos.y,r.posZ=e.pos.z}if(e.rot){var h=o?t.transform.localRotationEuler.clone():t.transform.rotationEuler.clone();n.rotX=h.x,n.rotY=h.y,n.rotZ=h.z,r.rotX=e.rot.x,r.rotY=e.rot.y,r.rotZ=e.rot.z}if(e.sca){var d=t.transform.getWorldLossyScale().clone();n.scaX=d.x,n.scaY=d.y,n.scaZ=d.z,r.scaX=e.sca.x,r.scaY=e.sca.y,r.scaZ=e.sca.z}this.tween.to(n,{posX:r.posX,posY:r.posY,posZ:r.posZ,rotX:r.rotX,rotY:r.rotY,rotZ:r.rotZ,scaX:r.scaX,scaY:r.scaY,scaZ:r.scaZ},i,s,Laya.Handler.create(this,()=>{a&&a();var t=this.tweens.shift();t?this.toTween(this.target,t.value,t.time,t.completeFun,s):this.updateTweenCallback&&(this.updateTweenCallback=null)}));var c=0;return this.tween.update=new Laya.Handler(this,()=>{let a=(c+=Laya.timer.delta)/i;a>1&&(a=1),e.pos&&(o?t.transform.localPosition=new Laya.Vector3(n.posX,n.posY,n.posZ):t.transform.position=new Laya.Vector3(n.posX,n.posY,n.posZ)),e.rot&&(o?t.transform.localRotationEuler=new Laya.Vector3(n.rotX,n.rotY,n.rotZ):t.transform.rotationEuler=new Laya.Vector3(n.rotX,n.rotY,n.rotZ)),e.sca&&t.transform.setWorldLossyScale(new Laya.Vector3(n.scaX,n.scaY,n.scaZ)),this.updateTweenCallback&&this.updateTweenCallback(a)}),this}clearTween(t){this.tweens=[],this.tween.clear(),this.target&&t&&(t.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(t.pos.x,t.pos.y,t.pos.z):this.target.transform.position=new Laya.Vector3(t.pos.x,t.pos.y,t.pos.z)),t.rot&&(this.target.transform.rotationEuler=new Laya.Vector3(t.rot.x,t.rot.y,t.rot.z)),t.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(t.sca.x,t.sca.y,t.sca.z)))}then(t,e,i){return this.tweens.push({value:t,time:e,completeFun:i}),this}}class x{constructor(t){this.reloadTime=[28/30*1e3,23/60*1e3,32/30*1e3],this.reloadSound=["","",""],this.shootTime=73/60*1e3,this.shootSound="",this.daamge=4,this.aimProgress=0,this.weaponName="Weapon0",this.bulletMaxCount=10,this.bulletCount=0,this.isCanShoot=!1,this.isNotControl=!1;let e=X.Level.weaponGrip.getChildByName(t),i=e.getChildByName("gun").getComponent(Laya.Animator);this.weapon=e,this.weaponName=t,this.anim=i,this.init()}initData(){this.bulletMaxCount=5,this.reloadTime=[28/30*1e3,23/60*1e3,32/30*1e3],this.reloadSound=["","",""],this.shootTime=73/60*1e3,this.shootSound=""}init(){this.initData(),this.idleWeaponPos=new Laya.Vector3(.01,0,.05),this.idelWeaponRot=new Laya.Vector3(12.5,0,0),this.idleWeaponFov=70,this.aimWeaponPos=new Laya.Vector3(0,0,0),this.aimWeaponRot=new Laya.Vector3(0,0,0),this.aimWeaponFov=30,this.aimPrepareTime=0,this.aimTime=200,this.isCanAim=!0,this.isPreparingAim=!1,X.Level.isAutoShoot=!1,this.bulletCount=this.bulletMaxCount,this.aimTween=new _,this.idle(),X.Level.isSmallAimShow=!1}aimStart(){let t=X.Level,e=this;this.aimTween.updateTweenCallback=this.aimUpdate.bind(this),this.aimProgress=0,this.isPreparingAim=!1,this.anim.play("aim_in"),this.aimTween.toTween(X.Level.weaponGrip,{pos:e.aimWeaponPos,rot:e.aimWeaponRot},this.aimTime,()=>{e.aimProgress=1,X.Event.event(a.Game_ShowAim_Event,[!0]),t.weaponGrip.transform.localPosition=e.aimWeaponPos,t.weaponGrip.transform.localRotationEuler=e.aimWeaponRot,t.mainCamera.fieldOfView=e.aimWeaponFov,t.weaponGrip.active=!1,e.isCanShoot=!0})}aimUpdate(t){t>.75&&(X.Level.mainCamera.fieldOfView=this.idleWeaponFov-2*(t-.75)*(this.idleWeaponFov-this.aimWeaponFov)),this.aimProgress=t}aimBackUpdate(t){if(this.aimProgress>.75){let e=2*(this.aimProgress-.75)*(1-t);X.Level.mainCamera.fieldOfView=this.idleWeaponFov-e*(this.idleWeaponFov-this.aimWeaponFov)}}shoot_Touch(){this.isNotControl?Laya.timer.frameOnce(1,this,this.shoot_Touch):(this.isCanShoot=!1,this.isCanShoot=!1,X.Level.weaponGrip.transform.localPosition=this.idleWeaponPos,X.Level.mainCamera.fieldOfView=this.idleWeaponFov,this.isCanAim&&(this.isCanAim=!1,this.isPreparingAim=!0,Laya.timer.once(this.aimPrepareTime,this,this.aimStart)))}shoot_Release(){if(this.isNotControl)Laya.timer.clear(this,this.shoot_Touch);else if(X.Event.event(a.Game_ShowAim_Event,[!1]),this.aimTween.clearTween(),X.Level.weaponGrip.active=!0,this.isCanShoot)this.idle(),this.shoot();else if(!this.isNotControl)if(this.isPreparingAim)this.isPreparingAim=!1,this.isCanAim=!0,Laya.timer.clear(this,this.aimStart);else{let t=this.aimProgress;this.aimTween.updateTweenCallback=this.aimBackUpdate.bind(this),this.anim.play("aim_out"),this.aimTween.toTween(X.Level.weaponGrip,{pos:this.idleWeaponPos},.25*this.aimTime*t,()=>{this.aimProgress=0,this.idle(),this.isCanAim=!0})}}shoot(){if(this.isNotControl)return;let t=this.weapon,e=this.anim;this.isNotControl=!0,this.bulletCount--,X.Level.bornBullet(this.daamge,!0),e.play("fire",0,0),X.Sound.play(this.shootSound),X.Platform.vibrateShort();let i=z.d3_FindNodeByName(t,"EffectShot");X.Level.bornFxDestroy("EffectShot",i),Laya.timer.once(13/43*1e3,this,()=>{X.Sound.play(this.reloadSound[0])}),Laya.timer.once(25/43*1e3,this,()=>{X.Sound.play(this.reloadSound[3])}),Laya.timer.once(this.shootTime,this,()=>{this.bulletCount>0?this.idle():this.reload()})}idle(){this.anim.play("idle",0,0),this.isNotControl=!1,this.isCanAim=!0,X.Level.weaponGrip.transform.localPosition=this.idleWeaponPos,X.Level.weaponGrip.transform.localRotationEuler=this.idelWeaponRot,X.Level.mainCamera.fieldOfView=this.idleWeaponFov}reload(){this.isNotControl=!0;let t=this.anim,e=this,i=()=>{t.play("reload_insert",0,0),X.Sound.play(s.sniper1_reload_insert),Laya.timer.once(e.reloadTime[1],e,()=>{e.bulletCount++,e.bulletCount>=3?(e.bulletCount=e.bulletMaxCount,t.play("reload_close",0,0),X.Sound.play(s.sniper1_reload_close),Laya.timer.once(e.reloadTime[2],e,()=>{e.isNotControl=!1})):i()})};t.play("reload_open",0,0),X.Sound.play(s.snipe1_reload_open),Laya.timer.once(e.reloadTime[0],e,i)}}class T extends x{initData(){this.bulletMaxCount=10,this.reloadTime=[28/30*1e3,23/90*1e3,32/30*1e3],this.reloadSound=[s.snipe1_reload_open,s.sniper1_reload_insert,s.sniper1_reload_close],this.shootTime=73/60*1e3,this.shootSound=s.shoot,this.daamge=4}}!function(t){t[t.unBuild=0]="unBuild",t[t.level1=1]="level1",t[t.level2=2]="level2",t[t.level3=3]="level3"}(n||(n={}));class B extends v{constructor(){super(...arguments),this.damage=1,this.attackInvertal=2e3,this.isAttack=!1}init(...t){this.name=this.self.name,this.state=n.unBuild,this.normalModel=this.self.getChildByName("normal"),this.fadeModel=this.self.getChildByName("fade"),this.anim=this.normalModel.getChildAt(0).getComponent(Laya.Animator),this.colliders=[],this.initData(),this.stateUpdate(),this.searchCollider(this.self)}initData(){switch(this.name){case"1spikes":this.needFire=X.Level.baseData[0].CannonCreateCoin[0];break;case"2hand":this.needFire=X.Level.baseData[0].CannonCreateCoin[1];break;case"3punch":this.needFire=X.Level.baseData[0].CannonCreateCoin[2];break;case"4knife":this.needFire=X.Level.baseData[0].CannonCreateCoin[3];break;default:this.needFire=[0,0,0]}}searchCollider(t){for(let e=0;e<t.numChildren;e++){let i=t.getChildAt(e);if("collider"==i.name){let t=this;this.self.transform.localScaleX;this.colliders.push({obj:i,comp:t,raidus:.5})}this.searchCollider(i)}}chooseUpdate(t){let e=this.state==n.unBuild,i=this.needFire[this.state];if(e){let e=this.nowModel1,a=this.nowModel2,s=e.meshRenderer.material.clone(),o=a.meshRenderer.material.clone();s.albedoColor=t?X.Level.fireCount>=i?new Laya.Vector4(0,1,0,.5):new Laya.Vector4(1,0,0,.5):new Laya.Vector4(1,1,1,.3),o.albedoColor=t?X.Level.fireCount>=i?new Laya.Vector4(0,1,0,.5):new Laya.Vector4(1,0,0,.5):new Laya.Vector4(1,1,1,.3),e.meshRenderer.material=s,a.meshRenderer.material=o}else t&&this.state!=n.level3&&X.Level.fireCount;t&&this.state!=n.level3?X.Event.event(a.Game_BuildUIUpdate_Event,[!0,this.self,i]):X.Event.event(a.Game_BuildUIUpdate_Event,[!1])}stateUpdate(){let t=this.state==n.unBuild;switch(this.normalModel.active=!t,this.fadeModel.active=t,this.normalModel.getChildAt(0).getChildAt(0).active=!1,this.normalModel.getChildAt(0).getChildAt(1).active=!1,this.normalModel.getChildAt(0).getChildAt(2).active=!1,this.nowModel1=t?this.fadeModel.getChildAt(0):this.normalModel.getChildAt(0),this.state){case n.unBuild:this.nowModel2=this.fadeModel.getChildAt(0).getChildAt(0);break;case n.level1:this.nowModel2=this.normalModel.getChildAt(0).getChildAt(0);break;case n.level2:this.nowModel2=this.normalModel.getChildAt(0).getChildAt(1);break;case n.level3:this.nowModel2=this.normalModel.getChildAt(0).getChildAt(2)}this.nowModel1.active=!0,this.nowModel2.active=!0}levelUp(){this.state!=n.level3&&X.Level.fireCount>=this.needFire[this.state]&&(X.Level.fireCount-=this.needFire[this.state],q.instance.fireValue.value=X.Level.fireCount.toString(),this.state++,this.endAutoAttack(),this.startAutoAttack(),this.stateUpdate())}startAutoAttack(){this.isAttack=!1,Laya.timer.loop(this.attackInvertal,this,this.autoAttack)}autoAttack(){this.isAttack=!0,Laya.timer.once(500,this,()=>{this.isAttack=!1}),this.anim.play("attack",0,0)}endAutoAttack(){this.isAttack=!1,Laya.timer.clear(this,this.autoAttack)}onDestroy(){super.onDestroy(),this.endAutoAttack()}}class V extends v{constructor(){super(...arguments),this.colliders=[]}init(...t){this.searchCollider(this.self)}searchCollider(t){for(let e=0;e<t.numChildren;e++){let i=t.getChildAt(e);if("collider"==i.name){let t=this;this.colliders.push({obj:i,comp:t,raidus:1})}this.searchCollider(i)}}}!function(t){t.start="touchStart",t.move="touchMove",t.end="touchEnd",t.getAxis="GetAxis",t.slideWay="slideWay",t.singleTouchStart="singleTouchStart",t.singleTouchMove="singleTouchMove",t.singleTouchEnd="singleTouchEnd",t.secondTouchStart="secondTouchStart",t.secondTouchMove="secondTouchMove",t.secondTouchEnd="secondTouchEnd",t.getAxisAlways="getAxisAlways"}(r||(r={}));class M extends Laya.Script{constructor(){super(...arguments),this.isPressed=!1,this.hOriginal=0,this.vOriginal=0,this.hAxis=0,this.vAxis=0,this.outAxis=0,this.touchId=-1}onEnable(){M.instance=this}onMouseDown(t){X.Event.event(r.start,[t])}onMouseMove(t){X.Event.event(r.move,[t])}onMouseOut(t){X.Event.event(r.end,[t])}onMouseOver(t){X.Event.event(r.end,[t])}onMouseUp(t){X.Event.event(r.end,[t])}}class k{static Vector2Reduce(t,e){return new Laya.Vector2(t.x-e.x,t.y-e.y)}static vibrateSoft(t,e=1){this.isVibrating||(this.isVibrating=!0,Laya.timer.once(100,this,()=>{this.isVibrating=!1}),z.d3_objectShake(t,.1,.05*e))}static vibrateShort(t,e=1){this.isVibrating||(this.isVibrating=!0,Laya.timer.once(100,this,()=>{this.isVibrating=!1}),z.d3_objectShake(t,.1,.25*e))}static vibrateLong(t,e=1){this.isVibrating||(this.isVibrating=!0,Laya.timer.once(1e3,this,()=>{this.isVibrating=!1}),z.d3_objectShake(t,1,.25*e))}}k.isVibrating=!1;class I{constructor(){this.bullets=[],this.dropObj=[],this.levelPaths=[],this.levelObs=[],this.levelTower=[],this.enemys=[],this.roundCount=2,this.nowRound=0,this.playerBaseHp=20,this.isLevelEnd=!1,this.isSmallAimShow=!1,this.levelIndex=0,this.fireCount=0,this.roundCounts=[],this.isObjToJson=!1,this.nowBornEnemyCount=0,this.nowEndEnemyCount=0,this.needBorEnemyCount=0,this.isAutoShoot=!1,this.rayTower=null,this.rayObs=null,this.isHandBulid=!1,this.isChoosingObs=!1,this.weaponName="",this.bulletMaxCount=10,this.bulletCount=0,this.isCanShoot=!1,this.isReloadingOrChamring=!1,this.isSecond=!1,this.isSawCanControl=!1,this.rotateSawAxisSpeed=27,this.rotateSawHorizontalSpeed=15,this.maxLerpAxis=.15,this.minLerpAxis=.001,this.targetRot=new Laya.Vector3,this.nowRot=new Laya.Vector3,this.stageObj=[],this.init()}init(){if(X.GlData.isSubPackage&&X.Platform.canSubPackage){let t=["scene"];X.Res.addLoadRes("分包"),X.Platform.loadSubpackagesSync(t,this,(t,e)=>{e&&(t.load3DRes(),X.Res.removeLoadRes("分包"))})}else this.load3DRes();this.initEvent(),this.isObjToJson||this.readJson()}load3DRes(){X.Res.addLoadRes("场景");var t=[{url:X.GlData.sceneResUrl,clas:Laya.Scene3D,priority:1}];Laya.loader.create(t,Laya.Handler.create(this,this.onLoadFinished,[{target:"3dRes"}],!1),Laya.Handler.create(this,this.onLoading,null,!1)),Laya.loader.on(Laya.Event.ERROR,this,t=>{console.error("资源加载失败",t)})}onLoadFinished(t){X.ConsoleLog("资源加载完成",t),X.Res.removeLoadRes("场景")}onLoading(t){X.Res.updateLoadRes("场景",t,!1)}loadSceneRes(t=0){let e=Laya.loader.getRes(X.GlData.sceneResUrl);Laya.stage.addChild(e),Laya.stage.setChildIndex(e,t),this.mainScene=e;let i=z.d3_FindNodeByName(e,"Main Camera");return i?this.mainCamera=i:X.ConsoleWarn("未找到场景主相机"),e}loadModelRes(){return this.loadResByUrl(X.GlData.modelResUrl)}loadResByUrl(t){return Laya.loader.getRes(t)}createShadow(t,e=120){t.shadowMode=Laya.ShadowMode.SoftLow,t.shadowDistance=e,t.shadowResolution=1024,t.shadowCascadesMode=Laya.ShadowCascadesMode.TwoCascades,t.shadowNormalBias=.4}hideShadow(t){t.shadowMode=Laya.ShadowMode.None}useRetinalCanvas(){Laya.stage.useRetinalCanvas=!0}disabelRetinalCanvas(){Laya.stage.useRetinalCanvas=!1}setFog(t,e,i){e.enableFog=t,t&&(e.fogColor=i,e.fogStart=80,e.fogRange=100)}readJson(){let t=["res/json/levelsInfo.json","res/json/stageData.json","res/json/baseData.json"];X.Res.addLoadRes("关卡"),X.Res.addLoadRes("关卡配置"),X.Res.addLoadRes("数值配置");let e=()=>{Laya.loader.load(t,Laya.Handler.create(this,i=>{if(i)for(let e=0;e<t.length;e++)Laya.loader.load(t[e],Laya.Handler.create(this,t=>{switch(e){case 0:this.levelsInfo=t,X.Res.removeLoadRes("关卡");break;case 1:this.stageData=t,X.Res.removeLoadRes("关卡配置");break;case 2:this.baseData=t,X.Res.removeLoadRes("数值配置");break;default:console.log(t)}}),null,Laya.Loader.JSON);else console.log("load json fail,reload after 1s"),Laya.timer.once(1e3,this,e)}),null,Laya.Loader.JSON)};e()}JsonV3(t){return new Laya.Vector3(parseFloat(t.x),parseFloat(t.y),parseFloat(t.z))}V3ToJson(t){return{x:t.x.toString(),y:t.y.toString(),z:t.z.toString()}}onLoadResEvent(t){t.allComplete&&(this.loadSceneRes(),this.firstIn())}onInitGameEvent(t){this.roundInit(),X.UI.closeScene(i.Over),X.UI.openScene(i.Home)}onPlayGameEvent(t){this.gameStart(),X.UI.closeScene(i.Home),X.UI.openScene(i.Game)}onOverGameEvent(t){X.UI.closeScene(i.Game),X.UI.openScene(i.Over,!1,t)}initEvent(){X.Event.on(a.Load_Res_Msg_Event,this,this.onLoadResEvent),X.Event.on(a.Init_Game_Event,this,this.onInitGameEvent),X.Event.on(a.Play_Game_Event,this,this.onPlayGameEvent),X.Event.on(a.Over_Game_Event,this,this.onOverGameEvent),X.Event.on(a.Game_ShowAim_Event,this,this.isAimSlowUpdate)}firstIn(){for(let t=0;t<this.mainScene.numChildren;t++){let e=this.mainScene.getChildAt(t);switch(e.name){case"MainCam":this.mainCam=e;break;case"Prefabs":this.prefabs=e;break;case"Light":this.light=e;break;case"Fxs":this.fxs=e,Laya.timer.once(2e3,this,()=>{this.fxs.active=!1});break;case"Stage":if(this.stage=e,this.isObjToJson){let t=this.stage.getChildByName("Level"),e=[];for(let i=0;i<t.numChildren;i++){let a=t.getChildAt(i),s=[],o=[],n=[];for(let t=0;t<a.numChildren;t++){let e=a.getChildAt(t);switch(e.name){case"Obs":for(let t=0;t<e.numChildren;t++){let i=e.getChildAt(t);o.push({name:i.name.split(" ")[0],pos:this.V3ToJson(i.transform.localPosition.clone()),rot:this.V3ToJson(i.transform.localRotationEuler.clone())})}break;case"Tower":for(let t=0;t<e.numChildren;t++){let i=e.getChildAt(t);n.push({name:i.name.split(" ")[0],pos:this.V3ToJson(i.transform.localPosition.clone()),rot:this.V3ToJson(i.transform.localRotationEuler.clone())})}break;default:if(-1!=e.name.indexOf("P")&&e.numChildren>0){let t=[];for(let i=0;i<e.numChildren;i++){let a=e.getChildAt(i);t.push({name:a.name.split(" ")[0],pos:this.V3ToJson(a.transform.localPosition.clone()),rot:this.V3ToJson(a.transform.localRotationEuler.clone())})}s.push(t)}}}e.push({paths:s,obs:o,tower:n})}console.log(JSON.stringify(e)),this.levelsInfo=e,t.destroy()}break;case"Player":this.player=e,this.camPoint=e.getChildByName("CamPoint"),this.weaponGrip=e.getChildByName("WeaponGrip"),this.handGrip=e.getChildByName("HandGrip"),this.bulletPoint=e.getChildByName("CamPoint")}}X.checkPerformance(()=>{switch(X.equipmentPerformance){case o.High:case o.Mid:case o.Low:}}),this.useRetinalCanvas(),this.randomPlayMusic()}gameStart(){this.levelInit()}roundInit(){Laya.timer.clear(this,this.gameUpdate),this.stageObjClear(),this.bullets=[],this.dropObj=[],this.levelPaths=[],this.levelObs=[],this.levelTower=[],this.enemys=[];let t=X.Storage.storageData.level>5?z.randomInt(2,5):X.Storage.storageData.level;this.levelIndex=t,this.roundCount=this.stageData[t-1].Rounds,this.nowRound=0,this.roundCounts=this.stageData[t-1].RoundMonsterCount.split(","),this.playerBaseHp=this.baseData[0].CastleHP,this.isLevelEnd=!1,this.fireCount=this.stageData[t-1].BeginCoin,this.handGrip.active=!1,this.weaponGrip.active=!0,this.isHandBulid=!1,this.changeWeapon(0),this.handComp=new C(this.handGrip);let e=this.levelsInfo[t-1],i=e.paths,a=e.obs,s=e.tower;for(let t=0;t<i.length;t++)this.bornPaths(i[t]);for(let t=0;t<a.length;t++)this.bornObs(a[t]);for(let t=0;t<s.length;t++)this.bornTower(s[t],0==t?1:2);this.playerTp(this.levelTower[0]),this.light.transform.rotationEuler=new Laya.Vector3(-25.464,150,92.94),this.controlInit(),Laya.timer.frameLoop(1,this,this.gameUpdate)}roundEnd(t){this.isLevelEnd=!0,t&&X.Storage.passLevel(),X.Sound.play(t?s.win:s.fail),X.Event.event(a.Over_Game_Event,{isWin:t})}levelInit(){0==this.nowRound&&(this.controlOn(),Laya.timer.loop(16,this,this.fixUpdate)),this.nowRound++,1==this.nowRound?Laya.timer.once(1e3*this.baseData[0].RoundWaitTime,this,()=>{this.levelEnemyBornStart(this.roundCounts[this.nowRound-1].toString())}):this.levelEnemyBornStart(this.roundCounts[this.nowRound-1].toString())}levelEnd(t){this.isLevelEnd||(t?this.nowRound>=this.roundCount?(this.levelEnemyBornEnd(),this.controlOff(),Laya.timer.clear(this,this.fixUpdate),this.roundEnd(!0)):(Laya.timer.once(1e3*this.baseData[0].RoundWaitTime,this,this.levelInit),q.instance.timeCount(this.baseData[0].RoundWaitTime)):(this.levelEnemyBornEnd(),this.controlOff(),Laya.timer.clear(this,this.fixUpdate),this.roundEnd(!1)))}gameUpdate(){Laya.timer.delta;this.rotUpdate(),this.rayCheckWhenRot();for(var t=this.dropObj.length-1;t>=0;t--){this.dropObj[t].upforce-=X.GlData.Gravity;let e=this.dropObj[t].obj;e.transform.translate(new Laya.Vector3(this.dropObj[t].dir.x*this.dropObj[t].forwardfoce,this.dropObj[t].upforce,this.dropObj[t].dir.z*this.dropObj[t].horizontalforre),!1),e.transform.rotate(this.dropObj[t].rotate,!1),this.dropObj[t].obj.transform.position.y<-1&&(this.dropObj[t].obj.destroy(),this.dropObj.splice(t,1))}}fixUpdate(){this.obsToEnemyCheck()}obsToEnemyCheck(){for(let t=0;t<this.levelObs.length;t++){let e=this.levelObs[t].getComponent(B);if(e.isAttack)for(let t=0;t<this.enemys.length;t++){let i=this.enemys[t];if(!i.isDead&&!i.isHurting)for(let t=0;t<e.colliders.length;t++){let a=e.colliders[t].obj.transform.position.clone(),s=e.colliders[t].raidus;for(let t=0;t<i.colliders.length;t++){let o=i.colliders[t].obj.transform.position.clone(),n=i.colliders[t].raidus;if(z.CircleCheck_2D(a.z,a.x,s,o.z,o.x,n).isHit)return void i.hurt(e.damage)}}}}}levelEnemyBornStart(t){this.needBorEnemyCount=t,this.nowBornEnemyCount=0,this.nowEndEnemyCount=0;for(let t=0;t<this.levelPaths.length;t++){this.levelPaths[t][0].getChildAt(0).getComponent(Laya.Animator).play("open",0,0)}Laya.timer.loop(1e3*this.baseData[0].MonsterCreateTime,this,this.levelEnemyBorn),this.levelEnemyBorn(),X.Event.event(a.Game_RoundUpdate_Event,[this.nowRound,this.roundCount])}levelEnemyBorn(){let t="Enemy"+z.randomInt(1,7);this.bornEnemy(t,z.getRandomInArray(this.levelPaths)),this.nowBornEnemyCount++,this.nowBornEnemyCount>=this.needBorEnemyCount&&this.levelEnemyBornEnd()}levelEnemyBornEnd(){Laya.timer.clear(this,this.levelEnemyBorn);for(let t=0;t<this.levelPaths.length;t++){this.levelPaths[t][0].getChildAt(0).getComponent(Laya.Animator).play("close",0,0)}}rayCheckWhenRot(){let t=new Laya.Vector3;this.bulletPoint.transform.getForward(t);let e=this.bulletPoint.transform.position.clone(),i=g.add(e,g.mull(t,1e4)),a=this.isHandBulid,s=this.isAutoShoot&&this.weaponComp.isCanShoot,o=this.isHandBulid;if(a){let t=X.Level.levelTower,a=1e4,s=null;for(let o=0;o<t.length;o++){let n=t[o].getComponent(V);for(let r=0;r<n.colliders.length;r++){let l=n.colliders[r].obj.transform.position.clone(),h=w.calculateDistance(e,i,l),d=g.distance(l,e);d<a&&h&&h.distance<n.colliders[r].raidus&&(s=t[o],a=d)}}this.rayTower=s,this.rayTower}else{this.rayTower=null;let t=X.Level.levelTower;for(let e=0;e<t.length;e++);}let n=!1;if(s){let t=this.enemys,a=1e4;for(let s=t.length-1;s>=0&&!n;s--){if(t[s].nowHp<=0)continue;let o=t[s].colliders;for(let t=0;t<o.length;t++){let s=o[t].obj.transform.position.clone(),r=w.calculateDistance(e,i,s);if(g.distance(s,e)<a&&r&&r.distance<o[t].raidus+.012){n=!0;break}}}}if(n&&this.weaponComp.shoot(),o){let t=.5,a=this.levelObs,s=1e4,o=null;for(let n=0;n<a.length;n++){a[n].getComponent(B).chooseUpdate(!1);let r=a[n].transform.position.clone(),l=w.calculateDistance(e,i,r),h=g.distance(r,e);h<s&&l&&l.distance<t&&(o=a[n],s=h)}this.ObsUpdate(o),this.rayObs=o}else{this.rayObs=null;let t=this.levelObs;for(let e=0;e<t.length;e++)t[e].getComponent(B).chooseUpdate(!1)}}enemyDie(t){for(let e=this.enemys.length-1;e>=0;e--)this.enemys[e]===t&&this.enemys.splice(e,1);X.ConsoleLog("敌人死亡"),this.nowEndEnemyCount++,this.nowEndEnemyCount>=this.needBorEnemyCount&&this.levelEnd(!0)}playerBaseHurt(){X.ConsoleLog("友军基地受到伤害"),this.playerBaseHp--,this.playerBaseHp>=0&&X.Event.event(a.Game_PlayerBaseUpdate_Event,[this.playerBaseHp/this.baseData[0].CastleHP]),this.playerBaseHp<=0&&this.levelEnd(!1)}playerTp(t){if(t){let e=t.getChildByName("tpPoint").transform.position.clone();this.player.transform.position=e;let i=new Laya.Vector2(e.z,e.x),a=Math.atan2(i.y,i.x)/Math.PI*180;this.player.transform.localRotationEuler=new Laya.Vector3(0,a+180,0),this.targetRot=new Laya.Vector3(this.player.transform.localRotationEuler.x,this.player.transform.localRotationEuler.y,0),this.nowRot=this.targetRot}}fireAdd(t,e){this.fireCount+=t,X.Event.event(a.Game_FireUpdate_Event,[t,e])}isAimSlowUpdate(t){this.isAimSlow=t}changeHand(){this.weaponComp.shoot_Release(),this.isHandBulid=!this.isHandBulid,this.handGrip.active=this.isHandBulid,this.weaponGrip.active=!this.isHandBulid,q.instance.showBuildAim(this.isHandBulid),this.isHandBulid?q.instance.showSmallAim(!1):q.instance.showSmallAim(this.isSmallAimShow)}ObsUpdate(t){t?(t.getComponent(B).chooseUpdate(!0),this.isChoosingObs=!0,q.instance.showBuildAim(!this.isChoosingObs&&this.isHandBulid)):(this.isChoosingObs=!1,q.instance.showBuildAim(!this.isChoosingObs&&this.isHandBulid))}rayDo(){this.rayObs?this.rayObs.getComponent(B).levelUp():this.rayTower&&X.Level.playerTp(this.rayTower)}bornBullet(t=1,e=!1){let i=this.bornStageObj("Bullet");i.transform.position=this.bulletPoint.transform.position.clone(),i.transform.rotation=this.bulletPoint.transform.rotation.clone();let a=i.addComponent(L);a.init(t,e),this.bullets.push(a),q.instance.smallAimEffect(),k.vibrateShort(this.mainCamera,.02)}bornPaths(t){let e=[];for(let i=0;i<t.length;i++){let a=t[i].name,s=this.JsonV3(t[i].pos),o=this.JsonV3(t[i].rot),n=this.bornLevelObj(a,s,o);e.push(n),-1!=a.indexOf("WatchTower")&&(n.active=!1)}this.levelPaths.push(e)}bornObs(t){let e=t.name,i=this.JsonV3(t.pos),a=this.JsonV3(t.rot),s=this.bornLevelObj(e,i,a);s.addComponent(B),this.levelObs.push(s)}bornTower(t,e=2){let i=t.name+(1==e?"":"2"),a=this.JsonV3(t.pos),s=this.JsonV3(t.rot),o=this.bornLevelObj(i,a,s);o.addComponent(V),this.levelTower.push(o)}bornLevelObj(t,e,i){let a=this.bornStageObj(t);return this.stage.addChild(a),a.transform.localPosition=e,a.transform.localRotationEuler=i,a}bornEnemy(t,e){let i=this.bornStageObj(t);i.transform.position=e[0].transform.position.clone();let a=i.addComponent(f);this.enemys.push(a),a.init(e)}changeWeapon(t){let e,i;switch(t%=this.weaponGrip.numChildren){case 0:i=new T(e="0Sniper1");break;case 1:i=new b(e="1HandGun1");break;case 2:i=new E(e="2Rifle1");break;case 3:i=new P(e="3Rifle2")}if(e!=this.weaponName){this.weaponName=e;for(let e=0;e<this.weaponGrip.numChildren;e++)this.weaponGrip.getChildAt(e).active=e==t;this.weaponComp=i}}shoot_Touch(){this.isHandBulid?this.handComp.shoot_Touch():this.weaponComp.shoot_Touch()}shoot_Release(){this.isHandBulid?this.handComp.shoot_Release():this.weaponComp.shoot_Release()}controlOn(){X.Event.on(r.getAxis,this,this.sawControl),X.Event.on(r.singleTouchStart,this,this.cubeTouch),X.Event.on(r.singleTouchEnd,this,this.cubeTouchEnd)}controlOff(){X.Event.off(r.getAxis,this,this.sawControl),X.Event.off(r.singleTouchStart,this,this.cubeTouch),X.Event.off(r.singleTouchEnd,this,this.cubeTouchEnd)}controlInit(){this.player.transform.localRotationEuler=new Laya.Vector3(15,193,0),this.targetRot=new Laya.Vector3(this.player.transform.localRotationEuler.x,this.player.transform.localRotationEuler.y,0),this.nowRot=this.targetRot}cubeTouch(t){this.isSawCanControl=!0,this.isSecond||this.shoot_Touch()}cubeTouchEnd(t){t.stageX,t.stageY;this.isSecond||this.shoot_Release()}rotUpdate(){let t=new Laya.Vector3;this.rotLerpAxis=this.maxLerpAxis,Laya.Vector3.lerp(this.nowRot,this.targetRot,this.rotLerpAxis,t),this.nowRot=t,this.player.transform.localRotationEuler=new Laya.Vector3(this.nowRot.x,this.nowRot.y,0),this.mainCam.transform.position=this.camPoint.transform.position.clone(),this.mainCam.transform.rotation=this.camPoint.transform.rotation.clone()}sawControl(t){if(!this.isSawCanControl)return;if(this.isSecond)return;let e,i,a=t.x,s=t.y,o=new Laya.Vector3(s*this.rotateSawAxisSpeed*.0025,-a*this.rotateSawHorizontalSpeed*.0075,0);(e=this.targetRot.x+o.x)>=90?e=90:e<=-20&&(e=-20),i=this.targetRot.y+o.y,this.targetRot=new Laya.Vector3(e,i,0)}randomPlayMusic(){}bornStageObj(t,e=this.mainScene){let i=this.prefabs.getChildByName(t);if(!i)return X.ConsoleWarn("生成物体不存在",t),null;let a=Laya.Sprite3D.instantiate(i,e);return a.transform.localPosition=new Laya.Vector3,this.stageObj.push(a),a}stageObjClear(){for(let t=this.stageObj.length-1;t>=0;t--)this.stageObj[t]&&!this.stageObj[t].destroyed&&this.stageObj[t].destroy();this.stageObj=[]}bornFxDestroy(t,e,i=1e3,a=1,s=new Laya.Vector3){let o=this.fxs.getChildByName(t).clone();return e.addChild(o),o.transform.localPosition=s,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(a,a,a),Laya.timer.once(i,this,()=>{o.destroy()}),o}bornFxStage(t,e,i=1,a=new Laya.Vector3){let s=this.fxs.getChildByName(t).clone();return e.addChild(s),s.transform.localPosition=a,s.transform.localRotationEuler=new Laya.Vector3,s.transform.localScale=new Laya.Vector3(i,i,i),this.stageObj.push(s),s}}!function(t){t.prefab3D="prefab3D"}(l||(l={})),function(t){t.Fxs3D="Fxs3D"}(h||(h={}));class R{constructor(){this.score=0,this.level=1,this.coin=0,this.freshTime=(new Date).getTime()-864e5,this.playCount=0,this.signDay=1,this.signWeek=1,this.isSign=!1,this.skinList=[[1],[1]],this.skinId=[1,1],this.gameVersion="1.0.0"}}class D{constructor(){this.storageData=new R,this.storageName=new R;for(let t in this.storageData){let e=this.readStorage(t);e?(this.storageData[t]=JSON.parse(e),X.ConsoleLog("加载缓存数据",t,this.storageData[t])):(this.writeStorage(t,this.storageName[t]),X.ConsoleLog("初始化缓存数据",t,this.storageName[t])),this.storageName[t]=t}this.refreshData()}writeStorage(t,e){Laya.LocalStorage.setItem(t,JSON.stringify(e)),this.storageData[t]=e}readStorage(t){return Laya.LocalStorage.getItem(t)}removeStorage(t){Laya.LocalStorage.removeItem(t)}refreshData(){Math.floor(this.storageData.freshTime/864e5)!=Math.floor((new Date).getTime()/864e5)&&(X.ConsoleLog("更新每日数据"),this.writeStorage(this.storageName.playCount,0),this.writeStorage(this.storageName.freshTime,(new Date).getTime()))}initSign(){this.writeStorage(this.storageName.isSign,!1),this.storageData.signDay>7&&(this.writeStorage(this.storageName.signDay,1),this.writeStorage(this.storageName.signWeek,this.storageData.signWeek+1))}sign(t){this.writeStorage(this.storageName.isSign,!0),this.writeStorage(this.storageName.signDay,this.storageData.signDay+1),t&&t()}passLevel(){this.writeStorage(this.storageName.level,this.storageData.level+1)}updateCoin(t,e){this.writeStorage(this.storageName.coin,this.storageData.coin+t),X.Event.event(a.Update_Coin_Event,{coin:this.storageData.coin}),e&&e(this.storageData.coin)}unlockSkin(t,e=0){this.hasSkin(t,e)||(this.storageData.skinList[e].push(t),this.writeStorage(this.storageName.skinList,this.storageData.skinList),this.changeSkin(t,e))}hasSkin(t,e=0){return-1!=this.storageData.skinList[e].indexOf(t)}changeSkin(t,e=0,i){this.storageData.skinId[e]=t,this.writeStorage(this.storageName.skinId,this.storageData.skinId),X.Event.event(a.Update_Skin_Event),i&&i()}}class O{constructor(){this.gameVersion="1.0.0",this.playCount=0,this.isShowLog=!0,this.isSubPackage=!0,this.subpackagesNames=["scene"],this.sceneResUrl="res/scene/Conventional/ResScene.ls",this.modelResUrl="res/model/Conventional/ResScene.lh",this.modelsResUrl=[],this.enemyBaseHp=20,this.enemyHeadShotDamage=20,this.enemyOtherShotDamage=10,this.enemyLegShotDamage=15,this.BoomHVMin=.1,this.BoomHVMax=.3,this.BoomVVMin=.1,this.BoomVVMax=.5,this.BoomUPMin=.1,this.BoomUPMax=.55,this.Gravity=.0155,this.RotMin=-.08,this.RotMax=.08}}class N{constructor(){for(var t in this.eventDispatcher=new Laya.EventDispatcher,a)t.length>1||(G[a[t]]=a[t])}getTypeKey(t){let e=G[a[t]];return e||(e=t),e}on(t,e,i,a){this.eventDispatcher.on(this.getTypeKey(t),e,i,a)}once(t,e,i,a){this.eventDispatcher.once(this.getTypeKey(t),e,i,a)}off(t,e,i,a){this.eventDispatcher.off(this.getTypeKey(t),e,i,a)}offAll(t){this.eventDispatcher.offAll(this.getTypeKey(t))}offAllCaller(t){this.eventDispatcher.offAllCaller(t)}event(t,e){this.eventDispatcher.event(this.getTypeKey(t),e)}hasListener(t){this.eventDispatcher.hasListener(this.getTypeKey(t))}isMouseEvent(t){this.eventDispatcher.isMouseEvent(this.getTypeKey(t))}}class G{}class H{constructor(){this.resList=[],this.resCount=0}addLoadRes(t){-1==this.resList.indexOf(t)&&(this.resCount++,this.resList.push(t),this.currentLoadType||(this.currentLoadType=t,X.Event.event(a.Load_Res_Msg_Event,{type:t,progress:0,isComplete:!1})))}removeLoadRes(t){let e=this.resList.indexOf(t);-1!=e&&(this.resList.splice(e,1),this.resCount--,X.Event.event(a.Load_Res_Msg_Event,{type:t,progress:1,isComplete:!0}),this.resList.length>0?(this.currentLoadType=this.resList[0],X.Event.event(a.Load_Res_Msg_Event,{type:this.resList[0],progress:0,isComplete:!1})):0==this.resCount?(X.ConsoleLog("全部资源加载完成"),X.Event.event(a.Load_Res_Msg_Event,{allComplete:!0})):this.currentLoadType=null)}updateLoadRes(t,e,i){X.Event.event(a.Load_Res_Msg_Event,{type:t,progress:e,isComplete:i})}}class U{constructor(){let t=[];for(let i in e)t.push(e[i]);t.length>0&&(X.Res.addLoadRes("预制体"),Laya.loader.load(t,Laya.Handler.create(this,this.loadComplete),Laya.Handler.create(this,this.loadProgress),Laya.Loader.PREFAB))}loadProgress(t){console.log("预制体资源加载中...",t)}loadComplete(){console.log("预制体资源加载完成!"),X.Res.removeLoadRes("预制体")}getItem(t){let e=Laya.loader.getRes(t);return e?Laya.Pool.getItemByCreateFun(t,e.create,e):(console.warn("预制体加载失败：确认是否已添加PrefabType成员"),null)}recoverItem(t,e){Laya.Pool.recover(t,e),e.parent.removeChild(e)}}class W{constructor(){this.scenes=[]}get TopScene(){return this.topScene}openScene(t,e=!1,i,s,o){let n=this.scenes.filter(e=>e.url==t);if(n&&n.length>0&&(X.ConsoleLog("已打开此场景",n),n[0].close(),this.scenes.splice(this.scenes.indexOf(n[0]),1)),e)for(let t=this.scenes.length-1;t>=0;t--)this.closeScene(this.scenes[t].url);Laya.Scene.open(t,!1,i,Laya.Handler.create(this,t=>{o&&o.addChild(t),this.scenes.push(t),this.topScene=t,s&&s(t),X.Event.event(a.Open_Ui_Event,t.url)}))}closeScene(t,e){let i=null;t?this.scenes.forEach(e=>{e.url!=t||(i=e)}):this.topScene&&(i=this.topScene),i&&i instanceof Laya.Scene&&(this.scenes.splice(this.scenes.indexOf(i),1),this.scenes.length>0?this.topScene=this.scenes[this.scenes.length-1]:this.topScene=null,i.close(),X.Event.event(a.Close_Ui_Event,{url:i.url,param:e}))}}class F{constructor(){for(var t in this.soundType=".mp3",this._pathRoot="res/sound/",this._soundCtx={},this._soundFile=[],this.loopSounds=[],s){let e=s[t];this._soundFile.push(e)}X.ConsoleLog("音效：",this._soundFile),this.init()}init(){let t=this._pathRoot,e="",i=this._soundFile,a=this._soundFile.length;for(let s=0;s<a;++s){e=i[s];let a=new Laya.SoundChannel;a.url=t+e+this.soundType,Laya.SoundManager.addChannel(a),this._soundCtx[e]=!0}Laya.SoundManager.autoStopMusic=!0}setSoundVolume(t,e){this._soundCtx[t]&&Laya.SoundManager.setSoundVolume(e,this._pathRoot+t+this.soundType)}play(t,e=!1){this._soundCtx[t]&&(e&&-1==this.loopSounds.indexOf(t)?(this.loopSounds.push(t),Laya.SoundManager.playSound(this._pathRoot+t+this.soundType,0)):Laya.SoundManager.playSound(this._pathRoot+t+this.soundType))}stop(t,e=!1){if(this._soundCtx[t]){if(e){let e=this.loopSounds.indexOf(t);-1!=e&&this.loopSounds.splice(e,1)}Laya.SoundManager.stopSound(this._pathRoot+t+this.soundType)}}playMusic(t){Laya.SoundManager.stopMusic(),t?(Laya.SoundManager.playMusic(this._pathRoot+t+this.soundType,0),this.currentBgm=t):this.currentBgm?Laya.SoundManager.playMusic(this._pathRoot+this.currentBgm+this.soundType,0):Laya.SoundManager.playMusic(this._pathRoot+s.BGM+this.soundType,0)}stopMusic(){Laya.SoundManager.stopMusic()}}class j{}class X{static init(){this.GlData=new O,this.initPlatform(),this.UI=new W,this.Event=new N,this.Res=new H,this.Prefab=new U,this.Sound=new F,this.Net=new j,this.initStorage(),this.Level=new I}static initStorage(){this.Storage=new D,this.StorageKey=this.Storage.storageName,this.StorageData=this.Storage.storageData}static initPlatform(){Laya.Browser.onTTMiniGame?(this.GlData.platform=t.TT,this.Platform=new p):Laya.Browser.onWeiXin?(this.GlData.platform=t.WX,this.Platform=new y):Laya.Browser.onVVMiniGame?(this.GlData.platform=t.VIVO,this.Platform=new u):Laya.Browser.onQGMiniGame?(this.GlData.platform=t.OPPO,this.Platform=new m):(Laya.Browser.onPC||Laya.Browser.onMobile)&&(this.GlData.platform=t.PC,this.Platform=new d)}static ConsoleLog(...t){this.GlData.isShowLog&&console.log(...t)}static ConsoleWarn(...t){this.GlData.isShowLog&&console.warn(...t)}static ConsoleError(...t){this.GlData.isShowLog&&console.error(...t)}static get IsStartGame(){return this._isStartGame}static set IsStartGame(t){this._isStartGame=t}static get FPS(){return 1e3/Laya.timer.delta}static checkPerformance(t){let e=0,i=50,a=i;Laya.timer.loop(100,this,function addValue(){e+=X.FPS;a--;if(a<=0){Laya.timer.clear(this,addValue);let a=e/i;X.equipmentPerformance=a>50?o.High:a>40?o.Mid:o.Low,t&&t()}})}}X._isStartGame=!1;class z{static file_ExportVarByUIScene(t){Laya.loader.load(t,Laya.Handler.create(this,t=>{let e="遍历Var开始：\n",i=t=>{if(t&&t.props&&null!=t.props.var&&null!=t.props.var){let i=t.type,a=t.props.var;e+=a+":Laya."+i+"\n"}},a=t=>{let e=t.child?t.child:[];for(let t=0;t<e.length;t++){let s=e[t];i(s),s.child&&a(s)}};a(t),e+="遍历Var结束！",console.log(e)}),null,Laya.Loader.JSON)}static file_SaveForBrowser(t,e){console.log("浏览器");let i=new Blob([t],{type:"application/json"}),a=document.createElement("a");a.download=e,a.innerHTML="Download File",null!=window.webkitURL&&(a.href=window.webkitURL.createObjectURL(i)),a.click()}static file_LoadJson(t,e){Laya.loader.load(t,Laya.Handler.create(this,()=>{let i=Laya.Loader.getRes(t);e&&e(i)}),null,Laya.Loader.JSON)}static d3_getSpritePosBySprite3DPoint(t,e,i=new Laya.Vector2(0,0)){var a=e.transform.position.clone(),s=new Laya.Vector4;t.viewport.project(a,t.projectionViewMatrix,s);var o=new Laya.Vector2(s.x/Laya.stage.clientScaleX,s.y/Laya.stage.clientScaleY);return o.x+=i.x,o.y+=i.y,new Laya.Point(o.x,o.y)}static d3_FindNodeByName(t,e){let i=null,a=t=>{for(let s=0;s<t.numChildren;s++){if(t.getChildAt(s).name==e)return void(i=t.getChildAt(s));a(t.getChildAt(s))}};return a(t),i}static d3_GetRandomPointInCircle(t,e,i=0){let a=new Laya.Vector3,s=Math.random()*(t-i)+i;a.x=2*Math.random()-1,a.z=2*Math.random()-1,Laya.Vector3.normalize(a,a);let o=new Laya.Vector3;return Laya.Vector3.scale(a,s,a),Laya.Vector3.add(e,a,o),o}static d3_GetParticleSystem(t){return t.particleSystem}static d3_CloneSprite(t){return t&&t.clone?t.clone():null}static d2_AddClickEvent(t,e,i,a,o=!1,n=!0,r=!0){t.offAllCaller(e);let l=t.scaleX,h=.9*l,d=!1;t.on(Laya.Event.MOUSE_DOWN,e,e=>{d=!0,r&&Laya.Tween.to(t,{scaleX:h,scaleY:h},60),o&&e.stopPropagation},a);t.on(Laya.Event.MOUSE_UP,e,a=>{0!=d&&(d=!1,o&&a.stopPropagation,r&&Laya.Tween.to(t,{scaleX:l,scaleY:l},60),i&&i.call(e,a),n&&X.Sound.play(s.CLICK))},a);t.on(Laya.Event.MOUSE_OUT,e,e=>{0!=d&&(d=!1,r&&Laya.Tween.to(t,{scaleX:l,scaleY:l},60),o&&e.stopPropagation)},a)}static clamp01(t){return t>1?1:t<0?0:t}static clamp(t,e,i){return t<e?e:t>i?i:t}static get getCurrentTime(){return(new Date).getTime()}static get getCurrentTime_Second(){return Math.floor(Date.parse((new Date).toString())/1e3)}static math_gcd(t,e){return 0==e?t:this.math_gcd(e,t%e)}static numberTo(t,e,i){return Math.abs(e-t)<i?t=e:t<e?t+=i:t>e&&(t-=i),t}static randomNumber(t,e){return t+(e-t)*Math.random()}static randomInt(t,e){return Math.floor(t+(e+1-t)*Math.random())}static halfPercent(){return Math.random()<.5}static percent(t){return Math.random()<t}static getAngle(t,e){var i=Laya.Vector3.dot(t,e),a=Laya.Vector3.scalarLength(t)*Laya.Vector3.scalarLength(e);if(0==a){if(t.z>e.z)return 0;if(t.z<e.z)return 180;if(t.y>e.y)return 90;if(t.y<e.y)return-90}var s=i/a;return s<-1&&(s=-1),s>1&&(s=1),180*Math.acos(s)/Math.PI}static getAngleUp(t,e,i){let a=z.getAngle(t,e),s=new Laya.Vector3;return Laya.Vector3.cross(e,t,s),z.getAngle(i,s)>90&&(a*=-1),a}static getAngle2DWay(t,e){var i=Laya.Vector2.dot(t,e),a=Laya.Vector2.scalarLength(t)*Laya.Vector2.scalarLength(e),s=180*Math.acos(i/a)/Math.PI,o=t.x*e.y-e.x*t.y;return o>0?s*=1:o<0?s*=-1:s=0,s}static getProjection(t,e){let i=g.mull(e,g.dot(t,e));return g.subtract(t,i)}static cloneArray(t){return[].concat(t)}static getRandomInArray(t){if(t.length){let e=Math.random()*t.length;return t[e=Math.floor(e)]}return X.ConsoleLog("传入错误参数,返回空"),null}static takeRandomInArray(t){if(t.length){let e=Math.random()*t.length,i=t[e=Math.floor(e)];return t.splice(e,1),i}return X.ConsoleLog("传入错误参数,返回空"),null}static randomArray(t){let e=new Array(t.length),i=e.length;for(let a=0;a<i;a++){let i=this.takeRandomInArray(t);e[a]=i}return e}static BoxCheck_2D_Normal(t,e,i,a,s,o,n,r){let l=s-t,h=o-e,d=Math.abs(h),c=Math.abs(l),m=(a+r)/2,u=(i+n)/2;return{isHit:d<m&&c<u,axisDis:c,axisRange:u,horizontalDis:d,horizontalRange:m,axisWay:l,horizontalWay:h}}static CircleCheck_2D(t,e,i,a,s,o){let n=Math.pow(t-a,2)+Math.pow(e-s,2),r=Math.pow(i+o,2);return{isHit:n<r,distancePow2:n,rangePow2:r}}static objectScaleTips(t){let e=new _,i=t.transform.localScale.clone(),a=g.mull(i,.8),s=g.mull(i,1.2);e.toTween(t,{sca:a},50).then({sca:s},50).then({sca:i},50)}static d3_getRgbByHex(t){var e=[],i=[];let a=t.replace(/#/,"");if(3==a.length){for(var s=[],o=0;o<3;o++)s.push(a.charAt(o)+a.charAt(o));a=s.join("")}for(o=0;o<3;o++)e[o]="0x"+a.substr(2*o,2),i.push(parseInt(e[o]));return new Laya.Vector3(i[0]/255,i[1]/255,i[2]/255)}static d3_objectShake(t,e=1,i=.7){var a=e,s=1,o=t.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(a>0){var e=new Laya.Vector3;Laya.Vector3.scale((n=Math.random()>.5?Math.random():-Math.random(),r=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(n,r,0)),i,e),Laya.Vector3.add(o,e,e),t.transform.localPosition=e,a-=.02*s}else a=0,t.transform.localPosition=o,Laya.timer.clear(this,updateShake);var n,r})}static d2_coinCollectAnim(t,e,i,a,s=15,o=null,n=null){for(var r=s,l=0;l<s;l++){let s=Laya.Pool.getItemByClass("coin",Laya.Image);s.skin=t,s.x=e.x,s.y=e.y,s.scale(1,1),a.addChild(s);let l=300+100*Math.random()-50;Laya.Tween.to(s,{x:s.x+250*Math.random()-125,y:s.y+250*Math.random()-125},l),Laya.timer.once(l+50,this,function(){Laya.Tween.to(s,{x:i.x,y:i.y},400,null,new Laya.Handler(this,function(){a.removeChild(s),Laya.Pool.recover("coin",s),r--,n&&n(),0==r&&o&&o(a)}))})}}static d2_coinCollectAnimAni(t,e,i,a,s=15,o=null){for(var n=s,r=0;r<s;r++){let s=Laya.Pool.getItemByClass("coinAnim",Laya.Clip);s.skin=t.skin,s.index=t.index,s.clipX=t.clipX,s.clipY=t.clipY,s.autoPlay=t.autoPlay,s.x=e.x,s.y=e.y,s.scale(.8,.8),a.addChild(s);let r=300+100*Math.random()-50;Laya.Tween.to(s,{x:s.x+250*Math.random()-125,y:s.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(s,{x:i.x,y:i.y},400,null,new Laya.Handler(this,function(){a.removeChild(s),Laya.Pool.recover("coinAnim",s),0==--n&&o&&o(a)}))})}}static faceToast(t,e,i,a){let s=new Laya.Image(t);s.anchorX=.5,s.anchorY=.5,s.alpha=1,s.size(100,100),e.addChild(s),s.x=i.x,s.y=i.y,Laya.Tween.to(s,{x:a.x,y:a.y,alpha:.9},1e3,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{s&&!s.destroyed&&Laya.Tween.to(s,{x:a.x,y:a.y-100,alpha:0},1e3,null,Laya.Handler.create(this,()=>{s&&!s.destroyed&&s.destroy()}))}))}static d2_wordToast(t,e,i){if(!this.wordToastOk)return;z.wordToastOk=!1;let a=new Laya.Image(t);a.anchorX=.5,a.anchorY=.5,a.alpha=1,e.addChild(a),a.top=300,a.centerX=0;a.scaleX=0,a.scaleY=0,Laya.Tween.to(a,{scaleX:1,scaleY:1},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{z.wordToastOk=!0,a&&!a.destroyed&&Laya.Tween.to(a,{top:200,alpha:0},500,null,Laya.Handler.create(this,()=>{a&&!a.destroyed&&a.destroy()}))}))}}z.wordToastOk=!0;class Y{static toAlpha(t,e,i,a,s,o,n=!1,r=!1){function alpha1(){let e=r||n?new Laya.Handler(this,alpha2):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(t,{alpha:i},a,s,e)}function alpha2(){let i=r?new Laya.Handler(this,alpha1):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(t,{alpha:e},a,s,i)}t&&!t.destroyed&&(this.clearTween(t),t.alpha=e,alpha1())}static toScale(t,e,i,a,s,o,n=!1,r=!1){function scale1(){let e=r||n?new Laya.Handler(this,scale2):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(t,{scaleX:i,scaleY:i},a,s,e)}function scale2(){let i=r?new Laya.Handler(this,scale1):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(t,{scaleX:e,scaleY:e},a,s,i)}t&&!t.destroyed&&(this.clearTween(t),t.scale(e,e),scale1())}static toPosition(t,e,i,a,s,o=!1,n=0){if(!t||t.destroyed)return;this.clearTween(t);let r={},l={};function pos1(){if(o)var e=0==n?new Laya.Handler(this,pos2):new Laya.Handler(this,pos3);else e=new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(t,l,i,a,e)}function pos2(){Laya.Tween.to(t,r,i,a,Laya.Handler.create(this,pos1))}function pos3(){t.pos(r.x,r.y),pos1()}null!=e.x&&(r.x=t.x,l.x=e.x),null!=e.y&&(r.y=t.y,l.y=e.y),pos1()}static toRotaion(t,e,i,a,s,o=!1,n=!1){if(!t||t.destroyed)return;this.clearTween(t);let r=t.rotation,l=r+e,h=r-e+r;function rotate2(){Laya.Tween.to(t,{rotation:h},2*i,a,Laya.Handler.create(this,rotate3))}function rotate3(){Laya.Tween.to(t,{rotation:l},2*i,a,Laya.Handler.create(this,rotate2))}function rotate4(){let e=new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(t,{rotation:r},i,a,e)}!function(){let e=n?new Laya.Handler(this,rotate2):o?new Laya.Handler(this,rotate4):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(t,{rotation:l},i,a,e)}()}static showViewByScale(t,e,i=1,a=200){this.toScale(t,0,i,a,Laya.Ease.bounceOut,e,!0,!1)}static clearTween(t){Laya.Tween.clearAll(t)}}class J extends Laya.Script{onAwake(){this.self=this.owner,this.init()}init(...t){}onDestroy(){Laya.timer.clearAll(this),X.Event.offAllCaller(this),Y.clearTween(this.self)}}class K extends J{init(){let t=this.self.getChildByName("testBtn1");z.d2_AddClickEvent(t,this,()=>{X.Level.levelEnd(!0)});let e=this.self.getChildByName("testBtn2");z.d2_AddClickEvent(e,this,()=>{Laya.Stat.show()});let i=this.self.getChildByName("testBtn3");z.d2_AddClickEvent(i,this,()=>{Laya.Stat.hide()})}}class Z extends Laya.Scene{onAwake(){this.size(Laya.stage.width,Laya.stage.height),this.init(),this.initEvent()}onClosed(){X.Event.offAllCaller(this),Laya.timer.clearAll(this)}init(){}initEvent(){}}class q extends Z{constructor(){super(...arguments),this.smallAimAxis=1,this.switchBuildIcon=["ui/game/switchBuild_Icon1.png","ui/game/switchBuild_Icon2.png"],this.switchBulidWord=["ui/game/switchBuild_word1.png","ui/game/switchBuild_word2.png"],this.timeCountValue=0}init(){q.instance=this,this.showSmallAim(X.Level.isSmallAimShow),this.roundUpdate(X.Level.nowRound,X.Level.roundCount),this.TimeCount.set_visible(!1),this.timeCount(X.Level.baseData[0].RoundWaitTime),this.fireValue.value=X.Level.fireCount.toString(),this.barUpdate(1),Laya.timer.frameLoop(1,this,this.smallAimEffectUpdate)}initEvent(){X.Event.on(a.Game_ShowAim_Event,this,this.showAim),X.Event.on(a.KeyDown_Event,this,this.onKeyDown),X.Event.on(a.Game_RoundUpdate_Event,this,this.roundUpdate),X.Event.on(a.Game_FireUpdate_Event,this,this.fireUpdate),X.Event.on(a.Game_PlayerBaseUpdate_Event,this,this.barUpdate),X.Event.on(a.Game_BuildUIUpdate_Event,this,this.bulidShowUpdate),z.d2_AddClickEvent(this.switchBulidBtn,this,this.onSwitchBtnClick)}roundUpdate(t,e){this.roundValue.value=t.toString()+"/"+e.toString()}barUpdate(t){this.roundBar.value=t}bulidShowUpdate(t,e,i){if(t){let t=z.d3_getSpritePosBySprite3DPoint(X.Level.mainCamera,e,new Laya.Vector2(0,-175));this.buildShow.x=t.x,this.buildShow.y=t.y,this.buildNeedValue.value=i.toString()}else this.buildShow.x=-1e3}fireUpdate(t,e){let i=e,a=this.fireValue.parent.getChildByName("bright");z.d2_coinCollectAnim("ui/game/coinFire.png",i,new Laya.Vector2(this.fIreIcon.x+375-92-5,this.fIreIcon.y+147),this.scene,t,()=>{this.fireValue.value=(parseInt(this.fireValue.value)+t).toString()},()=>{Y.clearTween(a),Y.toAlpha(a,1,0,100)})}showAim(t){this.aim.set_visible(t)}showSmallAim(t){this.small_aim.set_visible(t)}showBuildAim(t){this.bulidAim.set_visible(t)}smallAimEffectUpdate(){this.small_aim.getChildAt(0).y=-5*this.smallAimAxis,this.small_aim.getChildAt(1).y=5*this.smallAimAxis,this.small_aim.getChildAt(2).x=-5*this.smallAimAxis,this.small_aim.getChildAt(3).x=5*this.smallAimAxis,this.smallAimAxis-=Laya.timer.delta/1e3*5*this.smallAimAxis,this.smallAimAxis<1&&(this.smallAimAxis=1)}smallAimEffect(){this.smallAimAxis+=4}hitAimEffect(){Y.clearTween(this.hitAim),Y.toAlpha(this.hitAim,.75,0,200)}onSwitchBtnClick(){X.Level.changeHand(),this.switchBulidBtn.getChildByName("icon").skin=X.Level.isHandBulid?this.switchBuildIcon[1]:this.switchBuildIcon[0],this.switchBulidBtn.getChildByName("word").skin=X.Level.isHandBulid?this.switchBulidWord[1]:this.switchBulidWord[0]}timeCount(t){this.TimeCount.set_visible(!0),this.timeCountValue=t;let e=this.TimeCount.getChildByName("value"),i=this,a=()=>{e.value=i.timeCountValue.toString(),i.timeCountValue--,0==i.timeCountValue?Laya.timer.once(1e3,this,()=>{this.TimeCount.set_visible(!1)}):Laya.timer.once(1e3,this,a)};a()}onKeyDown(t){switch(t.keyCode){case Laya.Keyboard.NUMBER_1:this.showTestPanel()}}showTestPanel(){let t=this.scene.getChildByName("testPanel");if(null!=t)return X.Prefab.recoverItem(e.TestPanel,t),void X.ConsoleLog("关闭测试界面");X.ConsoleLog("展示测试界面");let i=X.Prefab.getItem(e.TestPanel);i.getComponent(K);this.scene.addChild(i)}}class Q extends Laya.Script{constructor(){super(...arguments),this.calls=[],this.firstId=-1,this.secondId=-1,this.firstOriginalPoint=new Laya.Vector2,this.secondOriginalPoint=new Laya.Vector2,this.isSecond=!1,this.orignalHorizontal=0,this.orignalAxis=0,this.orignalHorizontalAlways=0,this.orignalAxisAlways=0,this.offset=new Laya.Vector3}onEnable(){X.Event.on(r.start,this,this.onMouseDown),X.Event.on(r.move,this,this.onMouseMove),X.Event.on(r.end,this,this.onMouseUp)}onDisable(){X.Event.off(r.start,this,this.onMouseDown),X.Event.off(r.move,this,this.onMouseMove),X.Event.off(r.end,this,this.onMouseUp)}onMouseDown(t){0==this.isSecond?-1==this.firstId?(this.checkOut(t),this.firstId=t.touchId,X.Event.event(r.singleTouchStart,t),this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):this.firstId!=t.touchId&&-1==this.secondId&&(this.secondId=t.touchId,this.isSecond=!0,X.Event.event(r.secondTouchStart,t),this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):-1==this.firstId?(this.firstId=t.touchId,this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):-1==this.secondId&&(this.secondId=t.touchId,this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),this.checkOutAlways(t)}onMouseMove(t){if(0==this.isSecond)t.touchId==this.firstId&&(this.checkWay(t),X.Event.event(r.singleTouchMove,t));else if(-1!=this.firstId&&-1!=this.secondId){let e,i={distance:0,angle:0},a=k.Vector2Reduce(this.secondOriginalPoint,this.firstOriginalPoint),s=Laya.Vector2.scalarLength(a);if(t.touchId==this.firstId?e=k.Vector2Reduce(this.secondOriginalPoint,new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):t.touchId==this.secondId&&(e=k.Vector2Reduce(new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height),this.firstOriginalPoint)),e){let t=Laya.Vector2.scalarLength(e);i.distance=t-s,i.angle=z.getAngle2DWay(a,e),X.Event.event(r.secondTouchMove,i)}}t.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),t.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),this.checkWayAlways(t)}onMouseUp(t){this.checkOutAlways(t),t.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),t.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),0==this.isSecond?t.touchId==this.firstId&&(this.checkOut(t),X.Event.event(r.singleTouchEnd,t),this.firstId=-1):(t.touchId==this.firstId&&(this.firstId=-1),t.touchId==this.secondId&&(this.secondId=-1),-1==this.firstId&&-1==this.secondId&&(this.isSecond=!1))}WayCheck(){let t=k.Vector2Reduce(this.nowPos,this.startPos);if(Laya.Vector2.scalarLength(t)>100){let e=Math.atan2(t.y,t.x)/Math.PI*180,i="none";e>-135&&e<-45?i="up":e>-45&&e<45?i="right":e<135&&e>45?i="down":(e<-135||e>135)&&(i="left"),this.isDown=!1}this.startPos=this.nowPos}onDestroy(){this.touchTimer&&clearTimeout(this.touchTimer)}checkWay(t){let e=t.stageX-this.orignalHorizontal,i=t.stageY-this.orignalAxis;this.checkOut(t),X.Event.event(r.getAxis,[{x:e,y:i}])}checkOut(t){this.orignalHorizontal=t.stageX,this.orignalAxis=t.stageY}checkWayAlways(t){let e=t.stageX/Laya.stage.width-this.orignalHorizontalAlways,i=t.stageY/Laya.stage.height-this.orignalAxisAlways;this.checkOutAlways(t),X.Event.event(r.getAxisAlways,[{x:e,y:i}])}checkOutAlways(t){this.orignalHorizontalAlways=t.stageX/Laya.stage.width,this.orignalAxisAlways=t.stageY/Laya.stage.height}modelRotateControlDown(){let t=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);this.startPosition=t.clone(),this.prePosition=t.clone()}modelRotateControlMove(){let t=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);Laya.Vector3.subtract(t,this.prePosition,this.offset),this.prePosition=t.clone();var e=new Laya.Vector3(this.offset.x,this.offset.y,0);let i=new Laya.Vector3;Laya.Vector3.cross(e,new Laya.Vector3(0,0,1),i),Laya.Vector3.normalize(i,i)}modelRotateControlUp(){new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0)}onKeyDown(t){X.Event.event(a.KeyDown_Event,t)}}class $ extends Laya.Script{onEnable(){let t=this.owner;Laya.timer.loop(10,this,()=>{t.rotation++})}onDisable(){let t=this.owner;Y.clearTween(t),Laya.timer.clearAll(this)}}class tt extends Z{constructor(){super(...arguments),this.nowWeapon=0}initEvent(){z.d2_AddClickEvent(this.btnStart,this,this.onStartClick),z.d2_AddClickEvent(this.btnVideo,this,this.onVideoClick),z.d2_AddClickEvent(this.btnLeft,this,this.onLeftClick),z.d2_AddClickEvent(this.btnRight,this,this.onRightClick),this.btnStart.set_visible(0==this.nowWeapon),this.btnVideo.set_visible(0!=this.nowWeapon),this.stageValue.value=X.Storage.storageData.level.toString()}onStartClick(){X.Level.changeWeapon(0),X.UI.closeScene(i.Home),X.Event.event(a.Play_Game_Event)}onVideoClick(){X.Platform.showVideoAd(()=>{X.UI.closeScene(i.Home),X.Event.event(a.Play_Game_Event)})}onLeftClick(){this.nowWeapon--,this.nowWeapon<0&&(this.nowWeapon=X.Level.weaponGrip.numChildren-1),X.Level.changeWeapon(this.nowWeapon),this.btnStart.set_visible(0==this.nowWeapon),this.btnVideo.set_visible(0!=this.nowWeapon)}onRightClick(){this.nowWeapon++,this.nowWeapon>X.Level.weaponGrip.numChildren-1&&(this.nowWeapon=0),X.Level.changeWeapon(this.nowWeapon),this.btnStart.set_visible(0==this.nowWeapon),this.btnVideo.set_visible(0!=this.nowWeapon)}}class et extends Z{init(){this.showLoading()}showCompanyLogo(t){this.plCompanyLogoBg.visible=!0,Y.toAlpha(this.imgCompanyLogo,0,1,200,null,()=>{Laya.timer.once(500,this,()=>{Y.toAlpha(this.imgCompanyLogo,1,0,500,null,()=>{this.plCompanyLogoBg.visible=!1,t&&t()})})})}showLoading(){if(X.Event.on(a.Load_Res_Msg_Event,this,this.loadResMsgEvent),0==X.Res.resList.length)this.loadResMsgEvent({allComplete:!0});else{let t=X.Res.currentLoadType;this.loadResMsgEvent({type:t,progress:0,isComplete:!1}),this.changePointTimer=0,this.curPointCount=3,Laya.timer.frameLoop(1,this,this.frameLoadProgress)}}loadResMsgEvent(t){if(t.allComplete)this.lbLoadMsg.text="资源加载完成",this.barLoadPgs.value=1,Laya.timer.clear(this,this.frameLoadProgress),X.UI.closeScene(i.Load),X.Event.event(a.Init_Game_Event);else{if(t.type!=X.Res.currentLoadType)return;let e=this.lbLoadMsg.text,i="";for(let t=0;t<this.curPointCount;t++)i+=".";e=t.type+"资源加载中"+i,this.lbLoadMsg.text=e,t.isComplete?this.barLoadPgs.value=1:0==t.progress?this.barLoadPgs.value=0:this.barLoadPgs.value=Math.max(t.progress,this.barLoadPgs.value)}}frameLoadProgress(){if(this.changePointTimer+=Laya.timer.delta,this.changePointTimer>200){this.changePointTimer=0;let t="";for(let e=0;e<this.curPointCount;e++)t+=".";this.curPointCount++,this.curPointCount>3&&(this.curPointCount=1);let e="";for(let t=0;t<this.curPointCount;t++)e+=".";let i=this.lbLoadMsg.text;i=i.replace(t,e),this.lbLoadMsg.text=i}this.barLoadPgs.value+=.01}}class it extends Z{onOpened(t){t&&(this.imgStatus.skin=t.isWin?"ui/game/success.png":"ui/game/fail.png",this.btnContinue.skin=t.isWin?"ui/game/continueBtn.png":"ui/game/backMenu.png")}onClosed(){super.onClosed(),X.GlData.playCount++}initEvent(){z.d2_AddClickEvent(this.btnContinue,this,this.onContinueClick)}onContinueClick(){X.UI.closeScene(i.Over),X.Event.event(a.Init_Game_Event)}}class at{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("uiScenes/Game.ts",q),t("nimo_Mods/ctrl/TouchScan.ts",M),t("nimo_Mods/ctrl/TouchWayCheck.ts",Q),t("nimo_Mods/uiTween/RotUITween.ts",$),t("uiScenes/Home.ts",tt),t("uiScenes/Load.ts",et),t("uiScenes/Over.ts",it),t("d2Components/TestPanel.ts",K)}}at.width=750,at.height=1334,at.scaleMode="fixedwidth",at.screenMode="vertical",at.alignV="middle",at.alignH="center",at.startScene="uiScene/Game.scene",at.sceneRoot="",at.debug=!1,at.stat=!1,at.physicsDebug=!1,at.exportSceneToJson=!0,at.init();new class{constructor(){window.Laya3D?Laya3D.init(at.width,at.height):Laya.init(at.width,at.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=at.scaleMode,Laya.stage.screenMode=at.screenMode,Laya.stage.alignV=at.alignV,Laya.stage.alignH=at.alignH,Laya.URL.exportSceneToJson=at.exportSceneToJson,(at.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),at.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),at.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){X.init(),X.UI.openScene(i.Load)}}}();