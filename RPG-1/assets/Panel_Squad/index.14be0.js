window.__require=function t(i,e,n){function o(s,l){if(!e[s]){if(!i[s]){var a=s.split("/");if(a=a[a.length-1],!i[a]){var h="function"==typeof __require&&__require;if(!l&&h)return h(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var c=e[s]={exports:{}};i[s][0].call(c.exports,function(t){return o(i[s][1][t]||t)},c,c.exports,t,i,e,n)}return e[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)o(n[s]);return o}({Panel_Squad:[function(t,i,e){"use strict";cc._RF.push(i,"55876sDlFVNQI+rGlyTz8Z/","Panel_Squad");var n,o=this&&this.__extends||(n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),r=this&&this.__decorate||function(t,i,e,n){var o,r=arguments.length,s=r<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,i,e,n);else for(var l=t.length-1;l>=0;l--)(o=t[l])&&(s=(r<3?o(s):r>3?o(i,e,s):o(i,e))||s);return r>3&&s&&Object.defineProperty(i,e,s),s};Object.defineProperty(e,"__esModule",{value:!0});var s=t("../../../Bundle1_Loading/Scripts/Config/EnumTypes"),l=t("../../../Bundle1_Loading/Scripts/Mgr/EventMgr"),a=t("../../../Bundle1_Loading/Scripts/Tool/Tool"),h=t("../../../Bundle2_Main/Scripts/Mgr/IconMgr"),c=t("../../../Bundle2_Main/Scripts/Mgr/RoleMgr"),d=t("../../../Bundle2_Main/Scripts/Mod/ScaleAuto"),p=t("../../../Bundle2_Main/Scripts/Panel/Panel"),u=t("../../../Bundle2_Main/SeverTest/SeverMgr"),f=cc._decorator,g=f.ccclass,m=f.property,C=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.showContent=null,i.listContent=null,i.showItemNode=null,i.switchBtn=null,i.confirmBtn=null,i.formation=[],i.hasRoles=[],i.isSwitching=!1,i.nowSelectIndex="",i}return o(i,t),i.prototype.init=function(){this.formation=a.Tool.cloneArray_normal(u.default.instance.localData.nowFormation),this.hasRoles=JSON.parse(JSON.stringify(u.default.instance.localData.hasRoles)),this.initData(),this.updateData()},i.prototype.openCb=function(){},i.prototype.closeCb=function(){},i.prototype.initData=function(){this.isSwitching=!1;var t=this.showContent.children[0];t.addComponent(d.default);for(var i=1;i<c.default.maxFormationCount;i++)this.showContent.addChild(cc.instantiate(t));t=this.listContent.children[0];var e=[];for(var n in this.hasRoles)e.push(n);var o=36-e.length;for(o<0&&(o=0),i=1;i<e.length+o;i++)this.listContent.addChild(cc.instantiate(t));var r=cc.instantiate(t);for(this.showItemNode.addChild(r),r.x=0,r.y=0,i=0;i<this.showContent.children.length;i++){var s=this.showContent.children.length-1-i;a.Tool.addClickEvent(this.showContent.children[i],this.onShowClick,this,[e[s]])}for(i=0;i<this.listContent.children.length;i++)a.Tool.addClickEvent(this.listContent.children[i],this.onListClick,this,[e[i]]);a.Tool.addClickEvent(this.switchBtn,this.onSwitchClick,this),a.Tool.addClickEvent(this.confirmBtn,this.onConfirmClick,this),a.Tool.addClickEvent(r,this.onCancelClick,this)},i.prototype.updateData=function(){for(var t,i=0;i<this.showContent.children.length;i++){var e=this.showContent.children[i],n=this.showContent.children.length-1-i;n>=this.formation.length?this.itemDealEmpty(e):(t=this.hasRoles[this.formation[n]],this.itemDeal(e,t,!1,this.isSwitching||this.formation[n]==this.nowSelectIndex)),this.showContent.children[i].getComponent(d.default).enabled=this.isSwitching}if(this.listContent.active=!this.isSwitching,this.showItemNode.active=this.isSwitching,this.isSwitching)this.itemDeal(this.showItemNode.children[0],this.hasRoles[this.nowSelectIndex],!1,!0);else{var o=[];for(var r in this.hasRoles)o.push(r);for(i=0;i<this.listContent.children.length;i++)i>=o.length?this.itemDealEmpty(this.listContent.children[i]):(t=this.hasRoles[o[i]],this.itemDeal(this.listContent.children[i],t,-1!=this.formation.indexOf(t.index),t.index==this.nowSelectIndex));var s="\u4e0a\u9635";this.formation.length>=c.default.maxFormationCount&&(s="\u66ff\u6362"),-1!=this.formation.indexOf(this.nowSelectIndex)&&(s="\u4e0b\u9635"),this.switchBtn.getChildByName("label").getComponent(cc.Label).string=s}},i.prototype.itemDeal=function(t,i,e,n){for(var o=0;o<t.children.length;o++)t.children[o].opacity="empty"!=t.children[o].name?255:0;var r=t.getChildByName("icon"),s=(t.getChildByName("tips"),t.getChildByName("level")),l=t.getChildByName("star"),a=t.getChildByName("isChoose"),c=t.getChildByName("empty"),d=t.getChildByName("select");for(d&&(d.opacity=n?255:0),c.opacity=0,a&&(a.opacity=e?255:0),h.default.loadIcon(i.id,r.getComponent(cc.Sprite)),s.getComponent(cc.Label).string=i.level.toString(),o=0;o<l.children.length;o++)l.children[o].children[0].opacity=o<i.quality?255:0},i.prototype.itemDealEmpty=function(t){for(var i=0;i<t.children.length;i++)t.children[i].opacity="empty"==t.children[i].name?255:0},i.prototype.onShowClick=function(t){var i=t[0];i>=this.formation.length||(this.isSwitching?(this.formation[i]=this.nowSelectIndex,this.isSwitching=!1):this.nowSelectIndex=this.formation[i],this.updateData())},i.prototype.onListClick=function(t){var i=t[0];i&&(this.nowSelectIndex=i,this.updateData())},i.prototype.onSwitchClick=function(){var t=this.formation.indexOf(this.nowSelectIndex);if(-1!=t)return this.formation.length<=1?void l.EventMgr.event(s.EventType.Tips_Toast_Event,"\u81f3\u5c11\u4e0a\u9635\u4e00\u4e2a\u89d2\u8272"):(this.formation.splice(t,1),void this.updateData());this.formation.length>=c.default.maxFormationCount?this.isSwitching=!0:this.formation.push(this.nowSelectIndex),this.updateData()},i.prototype.onCancelClick=function(){this.isSwitching=!1,this.updateData()},i.prototype.onConfirmClick=function(){u.default.instance.changeRoleFormation(this.formation),this.close()},r([m(cc.Node)],i.prototype,"showContent",void 0),r([m(cc.Node)],i.prototype,"listContent",void 0),r([m(cc.Node)],i.prototype,"showItemNode",void 0),r([m(cc.Node)],i.prototype,"switchBtn",void 0),r([m(cc.Node)],i.prototype,"confirmBtn",void 0),r([g],i)}(p.default);e.default=C,cc._RF.pop()},{"../../../Bundle1_Loading/Scripts/Config/EnumTypes":void 0,"../../../Bundle1_Loading/Scripts/Mgr/EventMgr":void 0,"../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../../Bundle2_Main/Scripts/Mgr/IconMgr":void 0,"../../../Bundle2_Main/Scripts/Mgr/RoleMgr":void 0,"../../../Bundle2_Main/Scripts/Mod/ScaleAuto":void 0,"../../../Bundle2_Main/Scripts/Panel/Panel":void 0,"../../../Bundle2_Main/SeverTest/SeverMgr":void 0}]},{},["Panel_Squad"]);