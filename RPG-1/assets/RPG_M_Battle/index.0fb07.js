window.__require=function t(e,o,n){function i(r,l){if(!o[r]){if(!e[r]){var s=r.split("/");if(s=s[s.length-1],!e[s]){var c="function"==typeof __require&&__require;if(!l&&c)return c(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+r+"'")}r=s}var d=o[r]={exports:{}};e[r][0].call(d.exports,function(t){return i(e[r][1][t]||t)},d,d.exports,t,e,o,n)}return o[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<n.length;r++)i(n[r]);return i}({BattleAI:[function(t,e,o){"use strict";cc._RF.push(e,"89480dzlj1EVafB2aQBgjTo","BattleAI");var n=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,r=(i.property,function(){function t(){this.role=null}return t.prototype.init=function(t){this.role=t},t.prototype.update=function(){},n([a],t)}());o.default=r,cc._RF.pop()},{}],BattleBoard:[function(t,e,o){"use strict";cc._RF.push(e,"c10916fY9lDX610cq43hVlg","BattleBoard");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,l=r.ccclass,s=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.monsters=[],e.roles=[],e.links=[],e}return i(e,t),a([l],e)}(cc.Component));o.default=s,cc._RF.pop()},{}],BattleComp_Number:[function(t,e,o){"use strict";cc._RF.push(e,"b7f2717U9hAMrBkMlxLFhZ/","BattleComp_Number");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../Bundle1_Loading/Scripts/Tool/Tool"),l=cc._decorator,s=l.ccclass,c=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.numberHeight=50,e}return i(e,t),e.prototype.update=function(t){for(var e=0;e<this.node.children.length;e++)this.node.children[e].y+=this.numberHeight*t,this.node.children[e].opacity-=255*t},e.prototype.showNumber=function(t,e,o,n){for(var i,a=0;a<this.node.children.length;a++)if(0==this.node.children[a].opacity){i=this.node.children[a];break}i||(i=cc.instantiate(this.node.children[0]),this.node.addChild(i),i.opacity=0);var l=0;for(a=0;a<this.node.children.length;a++)this.node.children[a].opacity>=200&&l++;var s=l*this.numberHeight/2;o.y+=s,o.x+=r.Tool.randomNumber(-5,5),i.getComponent(cc.Label).string=t,i.color=e,i.setPosition(o),i.opacity=255,i.scale=0,cc.tween(i).to(.25,{scale:n?1.5:1},{easing:"elasticOut"}).start()},a([s],e)}(cc.Component));o.default=c,cc._RF.pop()},{"../../../Bundle1_Loading/Scripts/Tool/Tool":void 0}],BattleLink:[function(t,e,o){"use strict";cc._RF.push(e,"679629aWoJNIKozZFjjqOZH","BattleLink");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,l=r.ccclass,s=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.linkBoards=[],e}return i(e,t),a([l],e)}(cc.Component));o.default=s,cc._RF.pop()},{}],BattleMap:[function(t,e,o){"use strict";cc._RF.push(e,"29079Dfj4JHM6OPVA9Hcn3/","BattleMap");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,l=r.ccclass,s=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boards=[],e.links=[],e}return i(e,t),a([l],e)}(cc.Component));o.default=s,cc._RF.pop()},{}],BattleMgr:[function(t,e,o){"use strict";cc._RF.push(e,"b6d89G69BRIfYoY8e1UW0As","BattleMgr");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r,l=t("../../../Bundle1_Loading/Scripts/Config/DataClass"),s=t("../../../Bundle1_Loading/Scripts/Config/EnumTypes"),c=t("../../../Bundle1_Loading/Scripts/Mgr/BundleMgr"),d=t("../../../Bundle1_Loading/Scripts/Mgr/CfgMgr"),p=t("../../../Bundle1_Loading/Scripts/Mgr/EventMgr"),h=t("../../../Bundle1_Loading/Scripts/Tool/Tool"),u=t("../../../Bundle2_Main/Scripts/Mgr/AssetsMgr"),f=t("../../../Bundle2_Main/Scripts/Mgr/RoleMgr"),m=t("../../../Bundle2_Main/Scripts/Mgr/SkillMgr"),_=t("../../../Bundle2_Main/SeverTest/SeverData"),y=t("../../../Bundle2_Main/SeverTest/SeverMgr"),g=t("../Config/Battle_EnumType"),v=t("../Special/AI/BattleRoleAI"),k=t("./BattleBoard"),B=t("./BattleLink"),b=t("./BattleMap"),S=t("./BattleRole"),T=cc._decorator,C=T.ccclass,O=T.property;(function(t){t.normal="normal",t.copy1="copy1",t.copyTest="copyTest",t.skillTest="skillTest"})(r||(r={}));var M=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.battelNumberCompPrefab=null,e.battleState=r.normal,e.copy1Reward=[],e.battleAssets=[],e.nextBornBattleUid=0,e.isLoadingBattle=!1,e.isBattleInCopy=!1,e.findEnemyClosestError=100,e}var o;return i(e,t),o=e,e.prototype.onLoad=function(){o.instance=this},e.prototype.start=function(){this.mapNode=this.node.getChildByName("Map"),this.heroNode=this.node.getChildByName("Hero"),this.monsterNode=this.node.getChildByName("Enemy"),this.goNormal()},e.prototype.onEnable=function(){p.EventMgr.on(s.EventType.Role_Update_Event,this.goNormal,this),p.EventMgr.on(s.EventType.Battle_Go_Normal,this.goNormal,this),p.EventMgr.on(s.EventType.Battle_GoCopyTest_Event,this.goCopyTest,this),p.EventMgr.on(s.EventType.Battle_Go_Copy,this.goCopy1,this),p.EventMgr.on(s.EventType.Battle_GoCopySkillTest_Event,this.goCopySkillTest,this),p.EventMgr.on(s.EventType.Battle_Role_Die,this.roleDie,this),p.EventMgr.on(s.EventType.Battle_Monster_Die,this.monsterDie,this),p.EventMgr.on(s.EventType.Battle_NormalMap_Change,this.goNormal,this)},e.prototype.goNormal=function(){var t=d.CfgMgr.instance.getCfg("MapData").main.find(function(t){return t.id==y.default.instance.localData.nowChoosingNormalMapId});this.battleState=r.normal;for(var e=[],o=y.default.instance.localData.hasRoles,n=h.Tool.cloneArray_normal(y.default.instance.localData.nowFormation),i=0;i<n.length;i++)e.push(o[n[i]]);var a=t.monsters,l=[];for(i=0;i<a.length;i++){var s=new _.RoleData,c=a[i];s.id=c.name,s.quality=1,s.level=c.level;var p=f.default.getJsonData(s);s.mass=p.mass,s.str=p.str,s.agile=p.agile,s.speed=p.speed,s.mental=p.mental,s.massAdd=0,s.strAdd=0,s.agileAdd=0,s.speedAdd=0,s.mentalAdd=0,s.BPPoint=0,s.ownSkill=[],s.BPPoint=0,l.push(s)}var u={map:t.map,roles:e,monsters:l,isCopy:!1};this.initBattle(u)},e.prototype.goCopy1=function(t){this.battleState=r.copy1;for(var e=[],o=JSON.parse(JSON.stringify(y.default.instance.localData.hasRoles)),n=h.Tool.cloneArray_normal(y.default.instance.localData.nowFormation),i=0;i<n.length;i++)e.push(o[n[i]]);var a=t.map,s=t.formation;this.copy1Reward.length=0;var c=t.reward,p=function(t){var e=c[t],o=d.CfgMgr.instance.getCfg("Item").find(function(t){return t.id==e}).name;u.copy1Reward.push(new l.RewardData(e,o))},u=this;for(i=0;i<c.length;i++)p(i);var f={map:a,roles:e,monsters:s,isCopy:!0};this.initBattle(f)},e.prototype.goCopyTest=function(t,e){this.battleState=r.copyTest,this.initBattle({map:"Map_Copy_Montain_1",roles:t,monsters:e,isCopy:!0})},e.prototype.goCopySkillTest=function(){this.battleState=r.skillTest;for(var t=[],e=y.default.instance.localData.hasRoles,o=h.Tool.cloneArray_normal(y.default.instance.localData.nowFormation),n=0;n<o.length;n++)t.push(e[o[n]]);var i=[{name:30001,level:100},{name:30002,level:100}],a=[];for(n=0;n<i.length;n++){var l=new _.RoleData,s=i[n];l.id=s.name,l.quality=1,l.level=1;var c=f.default.getJsonData(l);l.mass=c.mass,l.str=c.str,l.agile=c.agile,l.speed=c.speed,l.mental=c.mental,l.massAdd=0,l.strAdd=0,l.agileAdd=0,l.speedAdd=0,l.mentalAdd=0,l.BPPoint=0,l.ownSkill=[],l.BPPoint=0,a.push(l)}var d={map:"Map_Copy_Montain_1",roles:t,monsters:a,isCopy:!0};this.initBattle(d)},e.prototype.loadAssets=function(t,e){var o=this;c.default.getBundle(t,function(n){n.load(t,cc.Prefab,function(n,i){n?console.error("\u52a0\u8f7d",t,"\u5931\u8d25",n):(o.battleAssets.push(i),i.addRef(),e&&e())})})},e.prototype.bornMap=function(t){var e=this,o=this.battleAssets.find(function(e){return e.name==t.map}),n=cc.instantiate(o);this.mapNode.addChild(n),n.x=0,n.y=0;var i=n.addComponent(b.default);this.nowMapData=i;for(var a=function(o,n){for(var i=h.Tool.findAllNodeHasName(o,"heroBorn"),a=0;a<i.length;a++){var l=i[a],s=parseInt(l.name.split("_")[1]);if(l&&s<t.roles.length){var c=h.Tool.convertToNodeSpaceAR(e.node,l),d=!t.isCopy&&0==s;n.roles.push(e.bornRole(t.roles[s],c,n.id,g.Battle_Camp.player,{isCamFollow:d}))}}var p,u=h.Tool.findAllNodeHasName(o,"monsterBorn");for(a=0;a<u.length;a++){var f=!1;switch(e.battleState){case r.normal:p=h.Tool.getRandomInArray(t.monsters);break;default:a>=t.monsters.length?f=!0:p=t.monsters[a]}if(f)break;for(var m=u[a].children,_=[],y=0;y<m.length;y++)_.push(h.Tool.convertToNodeSpaceAR(e.node,m[y]));c=h.Tool.convertToNodeSpaceAR(e.node,u[a]),n.monsters.push(e.bornRole(p,c,n.id,g.Battle_Camp.enemy,{poses:_}))}},l=h.Tool.findAllNodeHasName(n,"road"),s=0;s<l.length;s++){var c=l[s],d=c.addComponent(k.default);d.id=parseInt(c.name.split("_")[1]),i.boards.push(d),a(c,d)}var p=h.Tool.findAllNodeHasName(n,"link"),u=function(t){var e=p[t],o=e.addComponent(B.default);o.id=e.name.split("_")[1];var n=parseInt(e.name.split("_")[2]),a=parseInt(e.name.split("_")[3]),r=i.boards.find(function(t){return t.id==n}),l=i.boards.find(function(t){return t.id==a});o.linkBoards.push(r),o.linkBoards.push(l),r.links.push(o),l.links.push(o),i.links.push(o)};for(s=0;s<p.length;s++)u(s)},e.prototype.bornRole=function(t,e,o,n,i){var a,l=t.id<3e4,s=l?"Role_":"Monster_";switch(n){case g.Battle_Camp.player:a=this.heroNode;break;case g.Battle_Camp.enemy:a=this.monsterNode}s+=t.id;var c,d=this.battleAssets.find(function(t){return t.name==s}),p=cc.instantiate(d);a.addChild(p),p.x=e.x,p.y=e.y;var h="";l&&(h=f.default.getJsonData(t).class);var u=function(){(c=p.addComponent("BattleRole"+h)).aiComp=new v.default,c.aiComp.init(c)};switch(this.battleState){case r.normal:l?u():((c=p.addComponent("BattleMonsterNormal")).movePoses=i.poses,c.moveSpeed=50,c.maxHp=10);break;case r.skillTest:c=p.addComponent("BattleRole"+h),l&&p.addComponent("BattlePlayerCtr").init(c);break;case r.copy1:case r.copyTest:default:u()}c.maxHp=f.default.calHP(t),c.maxMp=f.default.calMP(t),c.attackValue=f.default.calAtk(t),c.defValue=f.default.calDef(t),c.attackInvertal=f.default.calAtkInvertal(t),c.range=f.default.calRange(t),c.moveSpeed=f.default.calMoveSpeed(t),c.nimble=f.default.calNimble(t),c.aim=f.default.calAim(t),c.dodge=f.default.calDodge(t),c.crit=f.default.calCrit(t),c.critDamage=f.default.calCritDamage(t),c.nowSkillIds=f.default.getBattleSkill(t);var m=!!i&&i.isCamFollow;return c.init(o,n,m),c.born(),c.battleUid=this.nextBornBattleUid,this.nextBornBattleUid++,p},e.prototype.initBattle=function(t){var e=this;if(this.isLoadingBattle)console.log("\u6b63\u5728\u751f\u6210\u6218\u573a\uff0c\u8bf7\u52ff\u91cd\u590d\u751f\u6210");else{this.isLoadingBattle=!0,this.isBattleInCopy=t.isCopy,this.battleClear(),this.camInit();var o=[],n=[];o.push(t.map);for(var i=[],a=[],r=0;r<t.roles.length;r++){var l=(t.roles[r].id>3e4?"Monster_":"Role_")+t.roles[r].id;-1==a.indexOf(l)&&a.push(l);for(var s=t.roles[r].ownSkill,c=0;c<s.length;c++)if("passive"!=m.default.getJsonData(s[c].id).type){var d="Skill_"+s[c].id;-1==i.indexOf(d)&&i.push(d)}}var p=[];for(r=0;r<t.monsters.length;r++)for(l=(t.monsters[r].id>3e4?"Monster_":"Role_")+t.monsters[r].id,-1==p.indexOf(l)&&p.push(l),s=t.monsters[r].ownSkill,c=0;c<s.length;c++)"passive"!=m.default.getJsonData(s[c].id).type&&(d="Skill_"+s[c].id,console.log(d),-1==i.indexOf(d)&&i.push(d));for(o=(o=(o=o.concat(a)).concat(p)).concat(i),console.log("\u52a0\u8f7d\u524d\u7f13\u5b58:",this.battleAssets),console.log("\u9700\u8981\u52a0\u8f7d\u7684\u8d44\u6e90:",o),r=0;r<this.battleAssets.length;r++)-1==o.indexOf(this.battleAssets[r].name)&&n.push(this.battleAssets[r].name);var h=function(t){u.battleAssets.find(function(e){if(e.name==o[t])return!0})&&o.splice(t,1)},u=this;for(r=o.length-1;r>=0;r--)h(r);for(console.log("\u5bf9\u6bd4\u540e\u8ba1\u7b97\uff0c\u771f\u5b9e\u9700\u8981\u52a0\u8f7d\u7684\u8d44\u6e90\uff1a",o,"\n\u9700\u8981\u91ca\u653e\u7684\u8d44\u6e90\uff1a",n),r=this.battleAssets.length-1;r>=0;r--)-1!=n.indexOf(this.battleAssets[r].name)&&(this.battleAssets[r].decRef(),this.battleAssets.splice(r,1));var f=o.length,_=function(){console.log("\u751f\u6210\u64cd\u4f5c"),e.bornMap(t),e.isLoadingBattle=!1},y=function(){--f<=0&&_()};for(0==f&&_(),r=0;r<o.length;r++)this.loadAssets(o[r],y)}},e.prototype.battleClear=function(){this.mapNode.destroyAllChildren(),this.heroNode.destroyAllChildren(),this.monsterNode.destroyAllChildren(),this.nextBornBattleUid=0},e.prototype.monsterDie=function(){if(this.isBattleInCopy){for(var t=!0,e=0;e<this.monsterNode.children.length;e++)if(!this.monsterNode.children[e].getComponent(S.default).isDead){t=!1;break}t&&this.copyEnd(!0)}},e.prototype.roleDie=function(){if(this.isBattleInCopy){for(var t=!0,e=0;e<this.heroNode.children.length;e++)if(!this.heroNode.children[e].getComponent(S.default).isDead){t=!1;break}t&&this.copyEnd(!1)}},e.prototype.copyEnd=function(t){if(t){if(p.EventMgr.event(s.EventType.Tips_Toast_Event,"\u526f\u672c\u6311\u6218\u6210\u529f"),this.battleState==r.copy1){for(var e=0;e<this.copy1Reward.length;e++)y.default.instance.addItem(this.copy1Reward[e].id);u.default.Instance.showGetReward(this.copy1Reward)}}else p.EventMgr.event(s.EventType.Tips_Toast_Event,"\u526f\u672c\u6311\u6218\u5931\u8d25");this.scheduleOnce(function(){p.EventMgr.event(s.EventType.Battle_Go_Normal)},2)},e.prototype.findBoardById=function(t){return this.nowMapData.boards.find(function(e){return e.id==t})},e.prototype.findLinkById=function(t){return this.nowMapData.links.find(function(e){return e.id==t})},e.prototype.findBoardLinkToIds=function(t){for(var e=t.links,o=[],n=0;n<e.length;n++)e[n].linkBoards.forEach(function(e){t.id!=e.id&&o.push(e.id)});return o},e.prototype.findBoardLinkDatas=function(t){for(var e=t.links,o=[],n=function(n){e[n].linkBoards.forEach(function(i){t.id!=i.id&&o.push({linkId:e[n].id,toId:i.id})})},i=0;i<e.length;i++)n(i);return o},e.prototype.findPathToBoard=function(t,e){var n=[],i=function(t,a){for(var r=o.instance.findBoardById(t),l=o.instance.findBoardLinkDatas(r),s=[],c=0;c<l.length;c++)if(-1==n.indexOf(l[c].toId)){if(l[c].toId==e)return a.push(l[c].linkId),a;n.push(l[c].toId),s.push(l[c])}for(c=0;c<s.length;c++){var d=h.Tool.cloneArray_normal(a);d.push(s[c].linkId);var p=i(s[c].toId,d);if(p)return p}return null};return n.push(t),i(t,[])},e.prototype.findNextEnemy_boardVer=function(t){var e=this;if(!o.instance.nowMapData)return null;var n=[],i=function(a){var r=o.instance.findBoardById(a),l=e.findBoardAliveEnemy(t,r);if(l)return{boradId:r.id,monster:l};for(var s=o.instance.findBoardLinkToIds(r),c=[],d=0;d<s.length;d++)-1==n.indexOf(s[d])&&(n.push(s[d]),c.push(s[d]));var p=[];for(d=0;d<c.length;d++){var h=i(c[d]);h&&p.push(h)}if(0==p.length)return null;var u=Number.MAX_VALUE,f=void 0;for(d=0;d<p.length;d++){var m=cc.Vec2.squaredDistance(p[d].monster.getPosition(),t.node.getPosition());m<u&&(u=m,f=p[d])}return f};return n.push(t.nowBoardId),i(t.nowBoardId)},e.prototype.findNextEnemy_Closest=function(t){for(var e=Number.MAX_VALUE,o=null,n=h.Tool.randomNumber(-this.findEnemyClosestError,this.findEnemyClosestError),i=t.camp==g.Battle_Camp.player?this.monsterNode:this.heroNode,a=0;a<i.children.length;a++){var r=i.children[a].getComponent(S.default);if(!r.isDead){var l=cc.Vec2.squaredDistance(r.node.getPosition(),t.node.getPosition());(l+=n)<e&&(e=l,o=i.children[a])}}return o?{boradId:o.getComponent(S.default).nowBoardId,monster:o}:null},e.prototype.findBoardAliveEnemy=function(t,e){var o=[];if(t.camp==g.Battle_Camp.player)for(var n=0;n<e.monsters.length;n++)o.push(e.monsters[n]);else for(n=0;n<e.roles.length;n++)o.push(e.roles[n]);for(n=o.length-1;n>=0;n--)o[n].getComponent(S.default).isDead&&o.splice(n,1);if(o.length>0){var i=void 0,a=Number.MAX_VALUE;for(n=0;n<o.length;n++){var r=cc.Vec2.squaredDistance(o[n].getPosition(),t.node.getPosition());r<a&&(a=r,i=o[n])}return i}return null},e.prototype.camInit=function(){this.node.scale=1.5,this.node.x=0,this.node.y=0},e.prototype.camFollowUpdate=function(t,e,o){if(null!=this.nowMapData){var n=new cc.Vec2(-(t.x+e.x),-(t.y+e.y)),i=10*o;i>1&&(i=1);var a=this.nowMapData.node,r=-(a.height-this.node.parent.height),l=(a.width-this.node.parent.width)/2,s=-(a.width-this.node.parent.width)/2;n.y>0&&(n.y=0),n.y<r&&(n.y=r),n.x>l&&(n.x=l),n.x<s&&(n.x=s),this.node.x=cc.misc.lerp(this.node.x,n.x*this.node.scaleX,i),this.node.y=cc.misc.lerp(this.node.y,n.y*this.node.scaleY,i)}},a([O(cc.Prefab)],e.prototype,"battelNumberCompPrefab",void 0),o=a([C],e)}(cc.Component);o.default=M,cc._RF.pop()},{"../../../Bundle1_Loading/Scripts/Config/DataClass":void 0,"../../../Bundle1_Loading/Scripts/Config/EnumTypes":void 0,"../../../Bundle1_Loading/Scripts/Mgr/BundleMgr":void 0,"../../../Bundle1_Loading/Scripts/Mgr/CfgMgr":void 0,"../../../Bundle1_Loading/Scripts/Mgr/EventMgr":void 0,"../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../../Bundle2_Main/Scripts/Mgr/AssetsMgr":void 0,"../../../Bundle2_Main/Scripts/Mgr/RoleMgr":void 0,"../../../Bundle2_Main/Scripts/Mgr/SkillMgr":void 0,"../../../Bundle2_Main/SeverTest/SeverData":void 0,"../../../Bundle2_Main/SeverTest/SeverMgr":void 0,"../Config/Battle_EnumType":"Battle_EnumType","../Special/AI/BattleRoleAI":"BattleRoleAI","./BattleBoard":"BattleBoard","./BattleLink":"BattleLink","./BattleMap":"BattleMap","./BattleRole":"BattleRole"}],BattleMonsterNormal:[function(t,e,o){"use strict";cc._RF.push(e,"bbc07HvNKlPJKufPu62E0GY","BattleMonsterNormal");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../Bundle1_Loading/Scripts/Config/EnumTypes"),l=t("../../../Bundle1_Loading/Scripts/Mgr/EventMgr"),s=t("../../../Bundle1_Loading/Scripts/Tool/Tool"),c=t("../../../Bundle2_Main/Scripts/Panel/PanelMgr"),d=t("../Config/Battle_EnumType"),p=t("../Normal/BattleRole"),h=cc._decorator,u=h.ccclass,f=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.waitTime=2,e.idleTime=0,e.moveWay=new cc.Vec2(0,0),e.movePoses=[],e.movePosIndex=0,e}return i(e,t),e.prototype.update=function(t){if(!this.isDead)switch(this.state){case d.Battle_State.idle:this.idleUpdate(t);break;case d.Battle_State.move:this.moveUpdate(t)}},e.prototype.idleUpdate=function(t){this.idleTime-=t,this.idleTime<=0&&this.move()},e.prototype.moveUpdate=function(t){var e=this.movePoses[this.movePosIndex],o=e.x-this.node.x;0==this.moveWay.x&&(o>0?(this.moveWay.x=1,this.anim.node.scaleX=1):o<0&&(this.moveWay.x=-1,this.anim.node.scaleX=-1)),o*this.moveWay.x<this.moveSpeed*t?(this.node.x=e.x,this.idle()):this.node.x+=this.moveSpeed*this.moveWay.x*t},e.prototype.idle=function(){t.prototype.idle.call(this),this.moveWay.x=0,this.idleTime=this.waitTime+s.Tool.randomNumber(-1,1)},e.prototype.move=function(){this.movePosIndex++,this.movePosIndex>=this.movePoses.length&&(this.movePosIndex=0),this.state=d.Battle_State.move,this.anim.walk()},e.prototype.die=function(){if(t.prototype.die.call(this),this.scheduleOnce(this.born,s.Tool.randomInt(3,5)),0==c.default.ui_1.children.length&&0==c.default.ui_2.children.length&&0==c.default.ui_3.children.length){var e=c.default.canvas.getChildByName("Top").getChildByName("btn_MapAward");l.EventMgr.event(r.EventType.FlyItem_Fly_Event,"coin",s.Tool.randomInt(2,5),this.node,e)}},a([u],e)}(p.default));o.default=f,cc._RF.pop()},{"../../../Bundle1_Loading/Scripts/Config/EnumTypes":void 0,"../../../Bundle1_Loading/Scripts/Mgr/EventMgr":void 0,"../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../../Bundle2_Main/Scripts/Panel/PanelMgr":void 0,"../Config/Battle_EnumType":"Battle_EnumType","../Normal/BattleRole":"BattleRole"}],BattlePlayerCtr:[function(t,e,o){"use strict";cc._RF.push(e,"d5557GFnopJubZLSTMAN4O4","BattlePlayerCtr");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../../Bundle1_Loading/Scripts/Config/EnumTypes"),l=t("../../../../Bundle1_Loading/Scripts/Mgr/EventMgr"),s=cc._decorator,c=s.ccclass,d=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(t){this.role=t},e.prototype.onEnable=function(){l.EventMgr.on(r.EventType.KeyBoard_Test_Event,this.keyBoardTest,this)},e.prototype.onDisable=function(){l.EventMgr.clearTarget(this)},e.prototype.keyBoardTest=function(t){console.log("keyBoard",t);var e="attack";switch(t){case 0:e="attack";break;case 1:e="skill_50001";break;case 2:e="skill_50002";break;case 3:e="skill_50003";break;case 4:e="skill_50004";break;case 5:e="skill_50005";break;case 6:e="skill_50006";break;case 7:e="skill_50007";break;case 8:e="skill_50008";break;case 9:e="skill_50009"}this.role[e]&&this.role[e]()},a([c],e)}(cc.Component));o.default=d,cc._RF.pop()},{"../../../../Bundle1_Loading/Scripts/Config/EnumTypes":void 0,"../../../../Bundle1_Loading/Scripts/Mgr/EventMgr":void 0}],BattleRoleAI:[function(t,e,o){"use strict";cc._RF.push(e,"f276ed/h+BAV4ffTtDkAeyN","BattleRoleAI");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../../Bundle1_Loading/Scripts/Tool/Tool"),l=t("../../Config/Battle_EnumType"),s=t("../../Normal/BattleMgr"),c=t("../../Normal/BattleRole"),d=t("./BattleAI"),p=cc._decorator,h=p.ccclass,u=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.targetPos=null,e.moveWay=null,e.moveType="board",e.targetBoardId=null,e.boardPath=[],e.thinkTimeDeltaMin=.5,e.thinkTimeDeltaMax=3,e.thinkWaitTime=0,e}return i(e,t),e.prototype.update=function(t){if(!this.role.isDead){switch(this.role.state){case l.Battle_State.idle:this.role.idleWaitTime<=0&&(this.thinkWaitTime=0,this.searchUpdate());break;case l.Battle_State.move:this.moveUpdate(t);break;case l.Battle_State.attack:case l.Battle_State.hurt:}this.role.idleWaitTime>0&&(this.role.idleWaitTime-=t),this.thinkWaitTime>0&&(this.thinkWaitTime-=t)}},e.prototype.moveUpdate=function(t){var e=this;if(this.targetPos||this.moveTargetPosCheck(),"board"==this.moveType){if(!this.searchUpdate())return;if(!this.role.targetEnemy||this.role.targetEnemy.getComponent(c.default).isDead)return void this.role.idle()}var o,n=this.role.moveSpeed*t,i="board"==this.moveType?this.targetPos.x:this.targetPos.y,a="board"==this.moveType?this.role.node.x:this.role.node.y,l=function(){"board"==e.moveType?e.role.node.x=o:e.role.node.y=o},s=i-a;if("board"==this.moveType&&(this.role.anim.node.scaleX=s>0?Math.abs(this.role.anim.node.scaleX):-Math.abs(this.role.anim.node.scaleX),this.role.targetEnemy.getComponent(c.default).nowBoardId==this.role.nowBoardId)){for(var d=Math.abs(this.role.targetEnemy.x-this.role.node.x),p=["normalAttack"],h=[[0,r.Tool.randomNumber(this.role.range-10,this.role.range+10)]],u=0;u<this.role.nowSkillIds.activeS.length;u++)if(this.role["isSkill_"+this.role.nowSkillIds.activeS[u]+"_On"]){p.unshift("skill_"+this.role.nowSkillIds.activeS[u].toString()),h.unshift(this.role["skill_"+this.role.nowSkillIds.activeS[u]+"_range"]);break}for(u=0;u<p.length;u++)if(d<=h[u][1]&&d>=h[u][0]){this.role.attack(p[u]);break}}Math.abs(s)<n?(o=i,l(),this.moveTargetPosCheck()):(o=i>a?a+n:a-n,l())},e.prototype.moveTargetPosCheck=function(){this.boardPath&&this.boardPath.length>0?this.goToLink():this.goToEnemy()},e.prototype.searchUpdate=function(){if(this.thinkWaitTime>0)return!0;this.thinkWaitTime=r.Tool.randomNumber(this.thinkTimeDeltaMin,this.thinkTimeDeltaMax);var t=r.Tool.halfPercent()?s.default.instance.findNextEnemy_Closest(this.role):s.default.instance.findNextEnemy_boardVer(this.role);return t?(this.targetPos=null,this.targetBoardId=t.boradId,this.role.targetEnemy=t.monster,this.boardPath=s.default.instance.findPathToBoard(this.role.nowBoardId,this.targetBoardId),this.role.move(),this.moveTargetPosCheck(),!0):(this.role.idle(),!1)},e.prototype.goToLink=function(){var t=this.boardPath[0],e=s.default.instance.findLinkById(t);this.role.node.x!=e.node.x?(this.targetPos=new cc.Vec2(e.node.x,this.role.node.y),this.moveType="board"):(this.boardPath.shift(),this.linkMove(e))},e.prototype.goToEnemy=function(){this.moveType="board",this.role.targetEnemy&&(this.targetPos=this.role.targetEnemy.getPosition())},e.prototype.linkMove=function(t){var e=t.node.getPosition(),o=new cc.Vec2(e.x,e.y+t.node.height),n=Math.abs(e.y-this.role.node.y),i=Math.abs(o.y-this.role.node.y);this.targetPos=n>i?e:o,this.moveType="link";for(var a=0;a<t.linkBoards.length;a++)if(t.linkBoards[a].id!=this.role.nowBoardId){this.role.nowBoardId=t.linkBoards[a].id;break}},a([h],e)}(d.default));o.default=u,cc._RF.pop()},{"../../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../Config/Battle_EnumType":"Battle_EnumType","../../Normal/BattleMgr":"BattleMgr","../../Normal/BattleRole":"BattleRole","./BattleAI":"BattleAI"}],BattleRoleArcher:[function(t,e,o){"use strict";cc._RF.push(e,"83501xG/15BpaTCp4irZpr9","BattleRoleArcher");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../../Bundle1_Loading/Scripts/Mgr/PrefabMgr"),l=t("../../../../Bundle1_Loading/Scripts/Tool/Tool"),s=t("../../../../Bundle2_Main/Scripts/Mgr/SkillMgr"),c=t("../../Normal/BattleMgr"),d=t("../../Normal/BattleRole"),p=cc._decorator,h=p.ccclass,u=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.idleAnimName="archer_idle",e.walkAnimName="archer_walk",e.attackAnimName="archer_skill2_bf",e.deadAnimName="archer_alert",e.attackDoTime=.5333333,e.attackEndTime=.88,e.skillData=[{name:"Skill_50004_self",x:0,y:0,angle:0},{name:"Skill_50004_enemy",x:0,y:0,angle:0},{name:"Skill_50005",x:0,y:0,angle:0},{name:"Skill_50006",x:0,y:0,angle:0}],e.isSkill_50004_On=!0,e.skill_50004_doTime=.6,e.skill_50004_endTime=1.43,e.skill_50004_range=[0,e.range],e.isSkill_50005_On=!0,e.skill_50005_range=[20,150],e.isSkill_50006_On=!0,e.skill_50006_range=[20,220],e}return i(e,t),e.prototype.animInit=function(){t.prototype.animInit.call(this),this.anim.idleAnim=this.idleAnimName,this.anim.walkAnim=this.walkAnimName,this.anim.attackAnim=this.attackAnimName,this.anim.deadAnim=this.deadAnimName,this.anim.attackDoTime=this.attackDoTime,this.anim.attackEndTime=this.attackEndTime;for(var e=function(t){var e=o.skillData[t];r.default.bornPrefab(e.name,o.anim.node,function(t){t&&(t.x=e.x,t.y=e.y,t.angle=e.angle)})},o=this,n=0;n<this.skillData.length;n++)e(n)},e.prototype.skill_50004=function(){var t=this;if(this.isSkill_50004_On){this.isSkill_50004_On=!1,this.anim.spine.setAnimation(0,"archer_skill3",!1);var e=this.anim.node.getChildByName(this.skillData[0].name);if(e){var o=e.getComponent(sp.Skeleton).skeletonData.name;null==e||e.getComponent(sp.Skeleton).setAnimation(0,o,!1),e.setPosition(0,5)}var n=this.anim.node.getChildByName(this.skillData[1].name);if(n&&this.targetEnemy){var i=l.Tool.convertToNodeSpaceAR(this.anim.node,this.targetEnemy);o=n.getComponent(sp.Skeleton).skeletonData.name,null==n||n.getComponent(sp.Skeleton).setAnimation(0,o,!1),n.opacity=255,n.setPosition(i),this.scheduleOnce(function(){if(t.bulletNode){var e=t.bulletNode.children[0];e.opacity=255,e.x=0,e.scaleX=2*t.anim.node.scaleX,e.scaleY=2*t.anim.node.scaleY;var o=l.Tool.convertToNodeSpaceAR(t.bulletNode,t.targetEnemy);o.y=0,cc.tween(e).to(Math.abs(o.x)/200*.25,{x:o.x}).call(function(){e.opacity=0;var o=s.default.getJsonData(50004).property.damage/100;t.attackCal_Solo(t.targetEnemy.getComponent(d.default),t.attackValue*o,!0,!0),n.opacity=0}).start()}},this.skill_50004_doTime)}this.scheduleOnce(function(){t.attackEnd()},this.skill_50004_endTime),this.scheduleOnce(function(){t.isSkill_50004_On=!0},s.default.getJsonData(50004).property.cd)}},e.prototype.skill_50005=function(){var t=this;if(this.isSkill_50005_On){this.isSkill_50005_On=!1,this.anim.spine.setAnimation(0,"archer_skill4",!1);var e=this.anim.node.getChildByName(this.skillData[2].name);if(e){e.opacity=255;var o=e.getComponent("Skill_50005");o.nowRole=this;var n=s.default.getJsonData(50005).property.damage/100;o.damage=this.attackValue*n,o.skillOn(),e.getComponent(sp.Skeleton).setAnimation(0,"archer_skill4",!1),this.scheduleOnce(function(){e.opacity=0,o.skillOff()},2.4)}this.scheduleOnce(function(){t.attackEnd()},2.4),this.scheduleOnce(function(){t.isSkill_50005_On=!0},s.default.getJsonData(50005).property.cd)}},e.prototype.skill_50006=function(){var t=this;if(this.isSkill_50006_On){this.isSkill_50006_On=!1,this.anim.spine.setAnimation(0,"archer_skill5",!1);var e=this.anim.node.getChildByName(this.skillData[3].name);if(e){var o=e.getComponent(sp.Skeleton).skeletonData.name;null==e||e.getComponent(sp.Skeleton).setAnimation(0,o,!1),this.scheduleOnce(function(){var o=s.default.getJsonData(50006).property.damage/100,n=e.getChildByName("hitRect"),i=l.Tool.convertToNodeSpaceAR(c.default.instance.node,n),a=new cc.Rect(i.x-n.width/2,i.y-n.height/2,n.width,n.height);t.attackCal_Dot(t.attackValue*o,a,"buff_poison_50006_On")},.75)}this.scheduleOnce(this.attackEnd,1.5),this.scheduleOnce(function(){t.isSkill_50006_On=!0},s.default.getJsonData(50006).property.cd)}},a([h],e)}(d.default));o.default=u,cc._RF.pop()},{"../../../../Bundle1_Loading/Scripts/Mgr/PrefabMgr":void 0,"../../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../../../Bundle2_Main/Scripts/Mgr/SkillMgr":void 0,"../../Normal/BattleMgr":"BattleMgr","../../Normal/BattleRole":"BattleRole"}],BattleRoleMaster:[function(t,e,o){"use strict";cc._RF.push(e,"7aa5fd5Di9PM4733tAS4SPe","BattleRoleMaster");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../../Bundle1_Loading/Scripts/Mgr/PrefabMgr"),l=t("../../../../Bundle1_Loading/Scripts/Tool/Tool"),s=t("../../../../Bundle2_Main/Scripts/Mgr/SkillMgr"),c=t("../../Normal/BattleMgr"),d=t("../../Normal/BattleRole"),p=cc._decorator,h=p.ccclass,u=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.idleAnimName="master_idle",e.walkAnimName="master_walk",e.attackAnimName="master_skill1_bf",e.deadAnimName="master_alert",e.attackDoTime=.2,e.attackEndTime=.666667,e.skillData=[{name:"Skill_50007",x:0,y:0,angle:0},{name:"Skill_50008",x:0,y:0,angle:0},{name:"Skill_50009",x:0,y:0,angle:0}],e.isSkill_50007_On=!0,e.skill_50007_range=[75,175],e.isSkill_50008_On=!0,e.skill_50008_range=[75,225],e.isSkill_50009_On=!0,e.skill_50009_range=[135,335],e}return i(e,t),e.prototype.animInit=function(){t.prototype.animInit.call(this),this.anim.idleAnim=this.idleAnimName,this.anim.walkAnim=this.walkAnimName,this.anim.attackAnim=this.attackAnimName,this.anim.deadAnim=this.deadAnimName,this.anim.attackDoTime=this.attackDoTime,this.anim.attackEndTime=this.attackEndTime;for(var e=function(t){var e=o.skillData[t];r.default.bornPrefab(e.name,o.anim.node,function(t){t&&(t.x=e.x,t.y=e.y,t.angle=e.angle)})},o=this,n=0;n<this.skillData.length;n++)e(n)},e.prototype.skill_50007=function(){var t=this;if(this.isSkill_50007_On){this.isSkill_50007_On=!1,this.anim.spine.setAnimation(0,"master_skill3",!1);var e=this.anim.node.getChildByName(this.skillData[0].name);if(e){var o=e.getComponent(sp.Skeleton).skeletonData.name;null==e||e.getComponent(sp.Skeleton).setAnimation(0,o,!1),this.scheduleOnce(function(){var o=s.default.getJsonData(50007).property.damage/100,n=e.getChildByName("hitRect"),i=l.Tool.convertToNodeSpaceAR(c.default.instance.node,n),a=new cc.Rect(i.x-n.width/2,i.y-n.height/2,n.width,n.height);t.attackCal_AOE(t.attackValue*o,a,!1,!1)},.44)}this.scheduleOnce(this.attackEnd,1.07),this.scheduleOnce(function(){t.isSkill_50007_On=!0},s.default.getJsonData(50007).property.cd)}},e.prototype.skill_50008=function(){var t=this;if(this.isSkill_50008_On){this.isSkill_50008_On=!1,this.anim.spine.setAnimation(0,"master_skill4",!1);var e=this.anim.node.getChildByName(this.skillData[1].name);e&&(null==e||e.getComponent(sp.Skeleton).setAnimation(0,"light",!1),this.scheduleOnce(function(){var o=s.default.getJsonData(50008).property.damage/100,n=e.getChildByName("hitRect"),i=l.Tool.convertToNodeSpaceAR(c.default.instance.node,n),a=new cc.Rect(i.x-n.width/2,i.y-n.height/2,n.width,n.height);t.attackCal_AOE(t.attackValue*o,a,!1,!1)},.64)),this.scheduleOnce(this.attackEnd,1.53),this.scheduleOnce(function(){t.isSkill_50008_On=!0},s.default.getJsonData(50008).property.cd)}},e.prototype.skill_50009=function(){var t=this;if(this.isSkill_50009_On){this.isSkill_50009_On=!1,this.anim.spine.setAnimation(0,"master_skill6",!1);var e=this.anim.node.getChildByName(this.skillData[2].name);if(e){var o=e.getComponent(sp.Skeleton).skeletonData.name;null==e||e.getComponent(sp.Skeleton).setAnimation(0,o,!1),this.scheduleOnce(function(){var o=s.default.getJsonData(50008).property.damage/100,n=e.getChildByName("hitRect"),i=l.Tool.convertToNodeSpaceAR(c.default.instance.node,n),a=new cc.Rect(i.x-n.width/2,i.y-n.height/2,n.width,n.height);t.attackCal_AOE(t.attackValue*o,a,!1,!1)},.9)}this.scheduleOnce(this.attackEnd,2.5),this.scheduleOnce(function(){t.isSkill_50009_On=!0},s.default.getJsonData(50009).property.cd)}},a([h],e)}(d.default));o.default=u,cc._RF.pop()},{"../../../../Bundle1_Loading/Scripts/Mgr/PrefabMgr":void 0,"../../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../../../Bundle2_Main/Scripts/Mgr/SkillMgr":void 0,"../../Normal/BattleMgr":"BattleMgr","../../Normal/BattleRole":"BattleRole"}],BattleRoleWarrior:[function(t,e,o){"use strict";cc._RF.push(e,"184bck4FApEdJe8poPUEGv5","BattleRoleWarrior");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../../Bundle1_Loading/Scripts/Mgr/PrefabMgr"),l=t("../../../../Bundle2_Main/Scripts/Mgr/SkillMgr"),s=t("../../Config/Battle_EnumType"),c=t("../../Normal/BattleRole"),d=cc._decorator,p=d.ccclass,h=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.idleAnimName="warrior_idle",e.walkAnimName="warrior_walk",e.attackAnimName="warrior_skill2",e.deadAnimName="warrior_alert",e.attackDoTime=.45,e.attackEndTime=.9,e.skillData=[{name:"Warrior_Attack",x:0,y:0,angle:0},{name:"Skill_50001",x:-25,y:10,angle:-15},{name:"Skill_50002",x:0,y:0,angle:0},{name:"Skill_50003",x:0,y:10,angle:0}],e.isSkill_50001_On=!0,e.skill_50001_range=[0,e.range],e.isSkill_50002_On=!0,e.skill_50002_doTime=.83,e.skill_50002_endTime=1.5,e.skill_50002_range=[0,e.range],e.isSkill_50003_On=!0,e.skill_50003_doTime=.37,e.skill_50003_endTime=1,e.skill_50003_range=[0,e.range+50],e}return i(e,t),e.prototype.animInit=function(){t.prototype.animInit.call(this),this.anim.idleAnim=this.idleAnimName,this.anim.walkAnim=this.walkAnimName,this.anim.attackAnim=this.attackAnimName,this.anim.deadAnim=this.deadAnimName,this.anim.attackDoTime=this.attackDoTime,this.anim.attackEndTime=this.attackEndTime;for(var e=["Warrior_Attack"],o=0;o<this.nowSkillIds.activeS.length;o++)e.push("Skill_"+this.nowSkillIds.activeS[o].toString());for(o=0;o<this.nowSkillIds.triggerS.length;o++)e.push("Skill_"+this.nowSkillIds.triggerS[o].toString());var n=function(t){var o=i.skillData[t];if(-1==e.indexOf(o.name))return"continue";r.default.bornPrefab(o.name,i.anim.node,function(t){t&&(t.x=o.x,t.y=o.y,t.angle=o.angle)})},i=this;for(o=0;o<this.skillData.length;o++)n(o)},e.prototype.hurt=function(e,o,n){t.prototype.hurt.call(this,e,o,n),e&&this.skill_50001(e)},e.prototype.normalAttack=function(){var t=this.anim.node.getChildByName(this.skillData[0].name);if(t){var e=t.getComponent(sp.Skeleton).skeletonData.name;null==t||t.getComponent(sp.Skeleton).setAnimation(0,e,!1)}this.anim.attack(this.attackDo.bind(this),this.attackEnd.bind(this)),this.idleWaitTime=this.attackInvertal},e.prototype.skill_50001=function(t){var e=this;if(-1==this.nowSkillIds.triggerS.indexOf("50001"))return!1;if(!this.isSkill_50001_On)return!1;if(!t)return!1;if(Math.abs(t.node.x-this.node.x)>2*this.range)return!1;this.isSkill_50001_On=!1,this.state=s.Battle_State.attack;var o=l.default.getJsonData(50001);this.anim.spine.setAnimation(0,"warrior_skill1",!1);var n=this.anim.node.getChildByName(this.skillData[1].name);if(n){var i=n.getComponent(sp.Skeleton).skeletonData.name;null==n||n.getComponent(sp.Skeleton).setAnimation(0,i,!1)}return this.scheduleOnce(function(){var n=o.property.damage/100;e.attackCal_Solo(t.getComponent(c.default),e.attackValue*n)},.333),this.scheduleOnce(function(){e.attackEnd()},.84),this.scheduleOnce(function(){e.isSkill_50001_On=!0},o.property.cd),!0},e.prototype.skill_50002=function(){var t=this;if(!this.isSkill_50001_On)return!1;this.isSkill_50002_On=!1,this.anim.spine.setAnimation(0,"warrior_skill5",!1);var e=this.anim.node.getChildByName(this.skillData[2].name);if(e){var o=e.getComponent(sp.Skeleton).skeletonData.name;null==e||e.getComponent(sp.Skeleton).setAnimation(0,o,!1)}this.scheduleOnce(function(){var e=l.default.getJsonData(50002).property.damage/100;t.attackCal_Solo(t.targetEnemy.getComponent(c.default),t.attackValue*e,!0)},this.skill_50002_doTime),this.scheduleOnce(function(){t.attackEnd()},this.skill_50002_endTime),this.scheduleOnce(function(){t.isSkill_50002_On=!0},l.default.getJsonData(50002).property.cd)},e.prototype.skill_50003=function(){var t=this;if(!this.isSkill_50003_On)return!1;this.isSkill_50003_On=!1,this.anim.spine.setAnimation(0,"warrior_skill3",!1);var e=this.anim.node.getChildByName(this.skillData[3].name);if(e){var o=e.getComponent(sp.Skeleton).skeletonData.name;null==e||e.getComponent(sp.Skeleton).setAnimation(0,o,!1)}this.idleWaitTime*=2,this.scheduleOnce(function(){var e=l.default.getJsonData(50003).property.damage/100;t.attackCal_Solo(t.targetEnemy.getComponent(c.default),t.attackValue*e)},this.skill_50003_doTime),this.scheduleOnce(function(){t.attackEnd()},this.skill_50003_endTime),this.scheduleOnce(function(){t.isSkill_50003_On=!0},l.default.getJsonData(50003).property.cd)},a([p],e)}(c.default));o.default=h,cc._RF.pop()},{"../../../../Bundle1_Loading/Scripts/Mgr/PrefabMgr":void 0,"../../../../Bundle2_Main/Scripts/Mgr/SkillMgr":void 0,"../../Config/Battle_EnumType":"Battle_EnumType","../../Normal/BattleRole":"BattleRole"}],BattleRole:[function(t,e,o){"use strict";cc._RF.push(e,"b9a85tZeOxHya6wNspVAVdi","BattleRole");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../Bundle1_Loading/Scripts/Config/EnumTypes"),l=t("../../../Bundle1_Loading/Scripts/Mgr/EventMgr"),s=t("../../../Bundle1_Loading/Scripts/Tool/Tool"),c=t("../../../Bundle2_Main/Scripts/Battle/RoleAnim"),d=t("../../../Bundle2_Main/Scripts/Mgr/RoleMgr"),p=t("../../../Bundle2_Main/Scripts/Mgr/SkillMgr"),h=t("../Comp/BattleComp_Number"),u=t("../Config/Battle_EnumType"),f=t("./BattleMgr"),m=cc._decorator,_=m.ccclass,y=(m.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maxHp=10,e.maxMp=10,e.attackValue=1,e.defValue=1,e.attackInvertal=1,e.range=50,e.moveSpeed=200,e.nimble=1,e.aim=0,e.dodge=0,e.crit=0,e.critDamage=0,e.camp=u.Battle_Camp.player,e.battleUid=0,e.aiComp=null,e.nowBoardId=0,e.state=u.Battle_State.idle,e.idleWaitTime=0,e.targetEnemy=null,e.bulletSpeed=800,e.ballSpeed=300,e.isDead=!1,e.hp=1,e.numberComp=null,e.isCamFollow=!1,e.camOffset=new cc.Vec2(0,-300),e.is_buff_poison_50006_On=!1,e.buff_poison_50006_time=0,e.nowBuff_poison_50006_value=0,e.buff_poison_50006_dotCD=0,e}var o;return i(e,t),o=e,e.prototype.init=function(t,e,o){this.nowBoardId=t,this.camp=e,this.isCamFollow=o,this.animInit(),this.attackInit();var n=cc.instantiate(f.default.instance.battelNumberCompPrefab);this.node.addChild(n),n.x=0,n.y=0,this.numberComp=n.getComponent(h.default)},e.prototype.update=function(t){var e;null===(e=this.aiComp)||void 0===e||e.update(t),this.camFollowUpdate(t),this.buffUpdate(t)},e.prototype.animInit=function(){var t=this.node.getChildByName("anim");this.anim=t.getComponent(c.default)},e.prototype.idle=function(){this.isDead||(this.state=u.Battle_State.idle,this.anim.idle())},e.prototype.move=function(){this.isDead||(this.state=u.Battle_State.move,this.anim.walk())},e.prototype.attackInit=function(){this.bulletNode=this.node.getChildByName("bullets"),this.ballNode=this.node.getChildByName("balls")},e.prototype.attack=function(t){this.state=u.Battle_State.attack,this.idleWaitTime=this.attackInvertal,this[t]()},e.prototype.normalAttack=function(){this.anim.attack(this.attackDo.bind(this),this.attackEnd.bind(this))},e.prototype.attackDo=function(){var t=this,e=function(){t.attackCal_Solo(t.targetEnemy.getComponent(o),t.attackValue)};if(this.targetEnemy&&this.targetEnemy.isValid){if(this.bulletNode){this.bulletNode.x=this.anim.node.scaleX*Math.abs(this.bulletNode.x);var n=this.bulletNode.children[0];n.opacity=255,n.x=0,n.scaleX=this.anim.node.scaleX,n.scaleY=this.anim.node.scaleY;var i=s.Tool.convertToNodeSpaceAR(this.bulletNode,this.targetEnemy);return i.y=0,void cc.tween(n).to(Math.abs(i.x)/this.bulletSpeed,{x:i.x}).call(function(){n.opacity=0,e()}).start()}if(this.ballNode){var a=this.ballNode.children[0];a.opacity=255,a.x=0,a.scaleX=this.anim.node.scaleX,a.scaleY=this.anim.node.scaleY;var r=s.Tool.convertToNodeSpaceAR(this.ballNode,this.targetEnemy);r.y=0;var l=function(){var t=a.x/r.x,e=-4*Math.pow(t,2)+4*t,o=-8*t+4,n=s.Tool.getAngle2DWay(cc.v2(1,0),cc.v2(1,o));r.x<0&&(n*=-1),a.angle=.25*n,a.y=e*Math.abs(r.x)*.25};return this.schedule(l),void cc.tween(a).to(Math.abs(r.x)/this.ballSpeed*.5,{x:.5*r.x}).to(Math.abs(r.x)/this.ballSpeed*.5,{x:r.x}).call(function(){a.opacity=0,t.unschedule(l),e()}).start()}e()}},e.prototype.attackEnd=function(){this.idle()},e.prototype.attackCal_Solo=function(t,e,o,n){void 0===o&&(o=!1),void 0===n&&(n=!1);var i,a=t;if(i=d.default.calHitChance(this.nimble,a.nimble,this.aim,a.dodge),n&&(i=100),s.Tool.percent(i)){var r=s.Tool.percent(this.crit);(r||o)&&(e*=this.critDamage,r=!0),a.hurt(this,e,r)}else a.miss();a.hp<=0&&(this.targetEnemy=null)},e.prototype.attackCal_AOE=function(t,e,n,i,a){void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===a&&(a=[]);var r=n;r||(r=s.Tool.percent(this.crit)),r&&(t*=this.critDamage);for(var l=[],c=this.camp==u.Battle_Camp.player?f.default.instance.monsterNode:f.default.instance.heroNode,p=0;p<c.children.length;p++){var h=c.children[p],m=h.getComponent(o);if(!m.isDead&&-1==a.indexOf(m.battleUid)){var _=new cc.Rect(h.x,h.y,1,1);if(e.intersects(_)){var y,g=i;if(!g)y=d.default.calHitChance(this.nimble,m.nimble,this.aim,m.dodge),g=s.Tool.percent(y);g?m.hurt(this,t,r):m.miss(),l.push(m.battleUid)}}}return l},e.prototype.attackCal_Dot=function(t,e,n){for(var i=this.camp==u.Battle_Camp.player?f.default.instance.monsterNode:f.default.instance.heroNode,a=0;a<i.children.length;a++){var r=i.children[a],l=r.getComponent(o);if(!l.isDead){var s=new cc.Rect(r.x,r.y,1,1);e.intersects(s)&&l[n](t)}}},e.prototype.hpInit=function(){this.hp=this.maxHp,this.isDead=!1},e.prototype.hurt=function(t,e,o){var n=this;if(void 0===o&&(o=!1),!this.isDead){var i=d.default.calHurt(e,this.defValue);this.hp-=i,this.numberShow(Math.floor(i).toString(),o?cc.Color.ORANGE:this.camp==u.Battle_Camp.player?cc.Color.RED:cc.Color.YELLOW,o),this.hp<=0?this.die():cc.tween(this.anim.node).to(.1,{color:cc.Color.RED}).to(.1,{color:cc.Color.WHITE}).call(function(){n.hurtDone()}).start()}},e.prototype.miss=function(){this.numberShow("MISS",cc.Color.BLUE,!1)},e.prototype.hurtDone=function(){},e.prototype.die=function(){this.anim.dead(),this.isDead=!0,this.state=u.Battle_State.dead,cc.tween(this.node).to(.5,{color:cc.Color.RED}).to(1,{opacity:0}).start(),this.camp==u.Battle_Camp.player?l.EventMgr.event(r.EventType.Battle_Role_Die):l.EventMgr.event(r.EventType.Battle_Monster_Die)},e.prototype.born=function(){this.hpInit(),this.node.opacity=255,this.idle()},e.prototype.numberShow=function(t,e,o){if(this.numberComp){var n=s.Tool.convertToNodeSpaceAR(this.numberComp.node,this.node);n.y+=50,this.numberComp.showNumber(t,e,n,o)}},e.prototype.camFollowUpdate=function(t){this.isCamFollow&&f.default.instance.camFollowUpdate(this.node,this.camOffset,t)},e.prototype.buffUpdate=function(t){this.buff_poison_50006_Update(t)},e.prototype.buff_poison_50006_On=function(t){this.is_buff_poison_50006_On=!0;var e=p.default.getJsonData(50006);this.buff_poison_50006_time=e.property.lastTime,this.nowBuff_poison_50006_value+=t,this.buff_poison_50006_dotDo()},e.prototype.buff_poison_50006_Update=function(t){this.is_buff_poison_50006_On&&(this.buff_poison_50006_time-=t,this.buff_poison_50006_time<=0?this.buff_poison_50006_Off():(this.buff_poison_50006_dotCD-=t,this.buff_poison_50006_dotCD<=0&&this.buff_poison_50006_dotDo()))},e.prototype.buff_poison_50006_dotDo=function(){this.buff_poison_50006_dotCD=p.default.getJsonData(50006).property.dotCD,this.hurt(null,this.nowBuff_poison_50006_value,!1)},e.prototype.buff_poison_50006_Off=function(){this.is_buff_poison_50006_On=!1,this.nowBuff_poison_50006_value=0},o=a([_],e)}(cc.Component));o.default=y,cc._RF.pop()},{"../../../Bundle1_Loading/Scripts/Config/EnumTypes":void 0,"../../../Bundle1_Loading/Scripts/Mgr/EventMgr":void 0,"../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../../Bundle2_Main/Scripts/Battle/RoleAnim":void 0,"../../../Bundle2_Main/Scripts/Mgr/RoleMgr":void 0,"../../../Bundle2_Main/Scripts/Mgr/SkillMgr":void 0,"../Comp/BattleComp_Number":"BattleComp_Number","../Config/Battle_EnumType":"Battle_EnumType","./BattleMgr":"BattleMgr"}],Battle_EnumType:[function(t,e,o){"use strict";cc._RF.push(e,"809acE2mKFLSJe1IMDWLPhd","Battle_EnumType"),Object.defineProperty(o,"__esModule",{value:!0}),o.Battle_Camp=o.Battle_State=void 0,function(t){t[t.idle=0]="idle",t[t.move=1]="move",t[t.attack=2]="attack",t[t.hurt=3]="hurt",t[t.dead=4]="dead"}(o.Battle_State||(o.Battle_State={})),function(t){t[t.player=0]="player",t[t.enemy=1]="enemy"}(o.Battle_Camp||(o.Battle_Camp={})),cc._RF.pop()},{}]},{},["BattleComp_Number","Battle_EnumType","BattleBoard","BattleLink","BattleMap","BattleMgr","BattleRole","BattleAI","BattleRoleAI","BattleMonsterNormal","BattleRoleArcher","BattleRoleMaster","BattleRoleWarrior","BattlePlayerCtr"]);