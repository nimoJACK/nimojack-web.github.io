window.__require=function e(t,n,o){function r(a,l){if(!n[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var d="function"==typeof __require&&__require;if(!l&&d)return d(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return r(t[a][1][e]||e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<o.length;a++)r(o[a]);return r}({Panel_Hero:[function(e,t,n){"use strict";cc._RF.push(t,"81cedBoiohJ2IH+Aq/kvhYL","Panel_Hero");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../../Bundle1_Loading/Scripts/Comp/Bar"),l=e("../../../Bundle1_Loading/Scripts/Config/EnumTypes"),c=e("../../../Bundle1_Loading/Scripts/Mgr/CfgMgr"),d=e("../../../Bundle1_Loading/Scripts/Mgr/EventMgr"),u=e("../../../Bundle1_Loading/Scripts/Mgr/PrefabMgr"),p=e("../../../Bundle1_Loading/Scripts/Tool/Tool"),g=e("../../../Bundle2_Main/Scripts/Mgr/IconMgr"),s=e("../../../Bundle2_Main/Scripts/Mgr/RoleMgr"),f=e("../../../Bundle2_Main/Scripts/Panel/Panel"),v=e("../../../Bundle2_Main/Scripts/Panel/PanelMgr"),h=e("../../../Bundle2_Main/SeverTest/SeverMgr"),_=cc._decorator,C=_.ccclass,y=_.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mainItem=null,t.otherContent=null,t.roles=null,t}return r(t,e),t.prototype.init=function(){},t.prototype.openCb=function(){this.updateData(),d.EventMgr.on(l.EventType.Role_Update_Event,this.updateData,this)},t.prototype.closeCb=function(){d.EventMgr.off(l.EventType.Role_Update_Event,this.updateData,this)},t.prototype.updateData=function(){var e=this,t=c.CfgMgr.instance.getCfg("Roles"),n=h.default.instance.localData.nowFormation,o=h.default.instance.localData.hasRoles,r=[];for(var i in o)r.push(o[i]);for(var l=r.length,d=this.otherContent.childrenCount-1;d>=l;d--)this.otherContent.children[d].destroy();var f,v=l-this.otherContent.childrenCount,_=function(t){C.scheduleOnce(function(){f=cc.instantiate(e.mainItem),e.otherContent.addChild(f),f.x=0,t==v-1&&m()},.016*t)},C=this;for(d=0;d<v;d++)_(d);var y=function(t,n,r,i,l,c,d,u,s,f,v){var h=t.getChildByName("icon"),_=h.getChildByName("tips"),C=h.getChildByName("level").getComponent(cc.Label),y=h.getChildByName("lock"),m=h.getChildByName("isChoose"),B=h.getChildByName("star");g.default.loadIcon(n,h.getChildByName("icon").getComponent(cc.Sprite)),_.getComponent(cc.Sprite);for(var M=0;M<B.children.length;M++)B.children[M].getChildByName("active").opacity=M<d?255:0;y.opacity=s?255:0,m.opacity=!s&&f?255:0,C.string=l.toString(),p.Tool.addClickEvent(h,e.openHeroDetail,e,[o[r]]);var S=t.getChildByName("stat"),b=S.getChildByName("name").getComponent(cc.Label),N=S.getChildByName("exp_value").getComponent(cc.Label),P=S.getChildByName("exp_bar").getComponent(a.default),E=S.getChildByName("battle_value").getComponent(cc.Label);b.string=i,P.value=l/c,N.string=l+"/"+c,E.string=u.toString();var L=t.getChildByName("btn"),x=L.getChildByName("lock"),T=L.getChildByName("upgrade"),R=L.getChildByName("break");if(x.active=s,T.active=!s&&l<c,R.active=!s&&l>=c,s)L.targetOff(e);else{var D=T.getChildByName("coin").getChildByName("label").getComponent(cc.Label),w=R.getChildByName("coin").getChildByName("label").getComponent(cc.Label);D.string=v.toString(),w.string=v.toString(),p.Tool.addClickEvent(L,e.btnClick,e,[r])}},m=function(){for(var i,a,l,c,d,p,g,f,v,h=n,_=function(n){i=t.find(function(e){return e.id==r[n].id}),a=i.name+r[n].index,l=r[n].id,c=r[n].level,d=i.levelMax,p=r[n].quality,g=s.default.calPower(r[n]),f=-1!=h.indexOf(r[n].index),v=s.default.roleUpgradeCoin,y(e.otherContent.children[n],l,r[n].index,a,c,d,p,g,!1,f,v)},C=0;C<r.length;C++)_(C);var m=125*(s.default.maxFormationCount-1)/2;e.roles.destroyAllChildren();var B=function(n){var r=o[h[n]],i=(t.find(function(e){return e.id==r.id}),m-125*n);u.default.bornPrefab("Role_"+r.id,e.roles,function(e){e.x=i,e.y=0})};for(C=0;C<h.length;C++)B(C)};v<=0&&m()},t.prototype.openHeroDetail=function(e){var t=e[0];v.default.showPanel("Panel_HeroDetail",function(e){var n=e.getComponent("Panel_HeroDetail");n.nowShowIndex=t.index,n.roleUpdate()})},t.prototype.btnClick=function(e){var t=e[0],n=c.CfgMgr.instance.getCfg("Roles"),o=h.default.instance.localData.hasRoles[t],r=n.find(function(e){return e.id==o.id});s.default.roleUpgradeCoin>h.default.instance.localData.coin?d.EventMgr.event(l.EventType.Tips_Toast_Event,"\u91d1\u5e01\u4e0d\u8db3"):o.level>=r.levelMax?d.EventMgr.event(l.EventType.Tips_Toast_Event,"\u7b49\u7ea7\u5df2\u5230\u4e0a\u9650"):h.default.instance.upgradeRole(s.default.roleUpgradeCoin,t)},i([y(cc.Node)],t.prototype,"mainItem",void 0),i([y(cc.Node)],t.prototype,"otherContent",void 0),i([y(cc.Node)],t.prototype,"roles",void 0),i([C],t)}(f.default);n.default=m,cc._RF.pop()},{"../../../Bundle1_Loading/Scripts/Comp/Bar":void 0,"../../../Bundle1_Loading/Scripts/Config/EnumTypes":void 0,"../../../Bundle1_Loading/Scripts/Mgr/CfgMgr":void 0,"../../../Bundle1_Loading/Scripts/Mgr/EventMgr":void 0,"../../../Bundle1_Loading/Scripts/Mgr/PrefabMgr":void 0,"../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../../Bundle2_Main/Scripts/Mgr/IconMgr":void 0,"../../../Bundle2_Main/Scripts/Mgr/RoleMgr":void 0,"../../../Bundle2_Main/Scripts/Panel/Panel":void 0,"../../../Bundle2_Main/Scripts/Panel/PanelMgr":void 0,"../../../Bundle2_Main/SeverTest/SeverMgr":void 0}]},{},["Panel_Hero"]);