!function(){"use strict";class t{static on(t,e,a){this.eventDispatcher.on(t,e,a)}static event(t,e){this.eventDispatcher.event(t,e)}static off(t,e,a){this.eventDispatcher.off(t,e,a)}static offAllCaller(t){this.eventDispatcher.offAllCaller(t)}}var e,a,i,s,o,n,r,l;t.eventDispatcher=new Laya.EventDispatcher,function(t){t.Load="scenes/Load.scene",t.Home="scenes/Home.scene",t.Game="scenes/Game.scene",t.Over="scenes/Over.scene"}(e||(e={})),function(t){t.SubPackage="分包",t.Scene3D="3D场景"}(a||(a={})),function(t){t.Scene_Load_Open="Scene_Load_Open",t.Scene_Home_Open="Scene_Home_Open",t.Scene_Game_Open="Scene_Game_Open",t.Scene_Over_Open="Scene_Over_Open",t.Progress_Load_Update="Progress_Load_Update",t.Platform_Wake_Do="Platform_Wake_Do",t.Platform_Hide_Do="Platform_Hide_Do",t.Game_Coin_Update="Game_Coin_Update"}(i||(i={})),function(t){t.Bgm="Bgm",t.Button="Button",t.Get="Get",t.Brush="Brush",t.Blade="Blade",t.Candy="Candy",t.Complete="Complete",t.Drill="Drill",t.Fillin="Fillin",t.GetMoney="GetMoney",t.Upgrade="Upgrade",t.Win="Win"}(s||(s={})),function(t){t.Tooth="Tooth"}(o||(o={})),function(t){t.Tooth="Tooth",t.Tooth_Gum="Tooth_Gum",t.Brush_Stop="Brush_Stop",t.Brush_Move="Brush_Move",t.Pole="Pole",t.Candy_Saw_Short="Candy_Saw_Short",t.Dental_Drill="Dental_Drill",t.Gum_Tooth="Gum_Tooth",t.Gate="Gate"}(n||(n={}));class h{static AddGrade(){let t=this.GetPlayerData();t.grade++,parseInt(t.grade)>99&&(t.grade=99),this.SavePlayerData(t)}static ReadGrade(){let t=this.GetPlayerData();return parseInt(t.grade)}static AddCoin(e){let a=this.GetPlayerData();a.coin+=e,a.coin>9999&&(a.coin=9999),Math.floor(a.coin),this.SavePlayerData(a),t.event(i.Game_Coin_Update)}static ReadCoin(){let t=this.GetPlayerData();return Math.floor(t.coin)}static ReadMoneyLevel(){return this.GetPlayerData().moneyLevel}static AddMoneyLevel(){let t=this.GetPlayerData();t.moneyLevel++,t.moneyLevel>99&&(t.moneyLevel=99),this.SavePlayerData(t)}static ReadToothLevel(){return this.GetPlayerData().toothLevel}static AddToothLevel(){let t=this.GetPlayerData();t.toothLevel++,t.toothLevel>99&&(t.toothLevel=99),this.SavePlayerData(t)}static GetPlayerData(){let t;return(t=Laya.LocalStorage.getJSON("PlayerData"))||(t=this.data,Laya.LocalStorage.setJSON("PlayerData",t),t)}static SavePlayerData(t){Laya.LocalStorage.setJSON("PlayerData",t)}static ClearPlayerData(){Laya.LocalStorage.clear()}static CheckPlayerData(){let t;(t=Laya.LocalStorage.getJSON("PlayerData"))&&t.ver&&t.ver==this.data.ver||(t=this.data,Laya.LocalStorage.setJSON("PlayerData",t),console.log("触发存档重置条件"))}}h.data={ver:"ToothRun_1.0.0",grade:1,coin:0,moneyLevel:1,toothLevel:1};class d extends Laya.Scene{onAwake(){this.size(Laya.stage.width,Laya.stage.height),this.init(),this.initEvent()}onClosed(){t.offAllCaller(this),Laya.timer.clearAll(this)}init(){}initEvent(){}}class c extends d{init(){c.instance=this,this.updateCoinUI(),this.stageValue.value=h.ReadGrade().toString()}initEvent(){t.on(i.Game_Coin_Update,this,this.updateCoinUI)}updateCoinUI(){this.coinValue.value=h.ReadCoin().toString()}}class m{static init(){for(var t in this._soundCtx={},this._soundFile=[],this.loopSounds=[],s){let e=s[t];this._soundFile.push(e)}console.log("音效：",this._soundFile);let e=this._pathRoot,a="",i=this._soundFile,o=this._soundFile.length;for(let t=0;t<o;++t){a=i[t];let s=new Laya.SoundChannel;s.url=e+a+this.soundType,Laya.SoundManager.addChannel(s),this._soundCtx[a]=!0}Laya.SoundManager.autoStopMusic=!0}static setSoundVolume(t,e){this._soundCtx[t]&&Laya.SoundManager.setSoundVolume(e,this._pathRoot+t+this.soundType)}static play(t,e=!1){if(this._soundCtx[t])return e&&-1==this.loopSounds.indexOf(t)?(this.loopSounds.push(t),Laya.SoundManager.playSound(this._pathRoot+t+this.soundType,0)):Laya.SoundManager.playSound(this._pathRoot+t+this.soundType)}static stop(t,e=!1){if(this._soundCtx[t]){if(e){let e=this.loopSounds.indexOf(t);-1!=e&&this.loopSounds.splice(e,1)}Laya.SoundManager.stopSound(this._pathRoot+t+this.soundType)}}static playMusic(t){Laya.SoundManager.stopMusic(),t?(Laya.SoundManager.playMusic(this._pathRoot+t+this.soundType,0),this.currentBgm=t):this.currentBgm?Laya.SoundManager.playMusic(this._pathRoot+this.currentBgm+this.soundType,0):Laya.SoundManager.playMusic(this._pathRoot+s.Bgm+this.soundType,0)}static stopMusic(){Laya.SoundManager.stopMusic()}}m._pathRoot="res/sounds/",m.soundType=".mp3";class y{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(t){return Math.round(10*t)}toTween(t,e,a,i,s,o=!0){if(this.target=t,this.isLocal=o,t&&!t.destroyed){var n={},r={};if(e.pos){var l=o?t.transform.localPosition.clone():t.transform.position.clone();n.posX=l.x,n.posY=l.y,n.posZ=l.z,r.posX=e.pos.x,r.posY=e.pos.y,r.posZ=e.pos.z}if(e.rot){var h=o?t.transform.localRotationEuler.clone():t.transform.rotationEuler.clone();n.rotX=h.x,n.rotY=h.y,n.rotZ=h.z,r.rotX=e.rot.x,r.rotY=e.rot.y,r.rotZ=e.rot.z}if(e.sca){var d=t.transform.getWorldLossyScale().clone();n.scaX=d.x,n.scaY=d.y,n.scaZ=d.z,r.scaX=e.sca.x,r.scaY=e.sca.y,r.scaZ=e.sca.z}this.tween.to(n,{posX:r.posX,posY:r.posY,posZ:r.posZ,rotX:r.rotX,rotY:r.rotY,rotZ:r.rotZ,scaX:r.scaX,scaY:r.scaY,scaZ:r.scaZ},a,s,Laya.Handler.create(this,()=>{i&&i();var e=this.tweens.shift();t&&!t.destroyed&&(e?this.toTween(this.target,e.value,e.time,e.completeFun,s):this.updateTweenCallback&&(this.updateTweenCallback=null))}));var c=0;return this.tween.update=new Laya.Handler(this,()=>{if(!t||t.destroyed)return;let i=(c+=Laya.timer.delta)/a;i>1&&(i=1),e.pos&&(o?t.transform.localPosition=new Laya.Vector3(n.posX,n.posY,n.posZ):t.transform.position=new Laya.Vector3(n.posX,n.posY,n.posZ)),e.rot&&(o?t.transform.localRotationEuler=new Laya.Vector3(n.rotX,n.rotY,n.rotZ):t.transform.rotationEuler=new Laya.Vector3(n.rotX,n.rotY,n.rotZ)),e.sca&&t.transform.setWorldLossyScale(new Laya.Vector3(n.scaX,n.scaY,n.scaZ)),this.updateTweenCallback&&this.updateTweenCallback(i)}),this}}clearTween(t){this.tweens=[],this.tween.clear(),this.target&&t&&(t.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(t.pos.x,t.pos.y,t.pos.z):this.target.transform.position=new Laya.Vector3(t.pos.x,t.pos.y,t.pos.z)),t.rot&&(this.target.transform.rotationEuler=new Laya.Vector3(t.rot.x,t.rot.y,t.rot.z)),t.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(t.sca.x,t.sca.y,t.sca.z)))}then(t,e,a){return this.tweens.push({value:t,time:e,completeFun:a}),this}toScaleTween(t,e,a,i,s,o=Laya.Ease.elasticOut){t&&!t.destroyed&&(t.transform.localScale=e,this.toTween(t,{sca:a},i,s,o))}}class u{static add(t,e){var a=new Laya.Vector3;return Laya.Vector3.add(t,e,a),a.clone()}static subtract(t,e){var a=new Laya.Vector3;return Laya.Vector3.subtract(t,e,a),a.clone()}static mull(t,e){var a=new Laya.Vector3;return Laya.Vector3.scale(t,e,a),a.clone()}static dot(t,e){return Laya.Vector3.dot(t,e)}static cross(t,e){var a=new Laya.Vector3;return Laya.Vector3.cross(t,e,a),a.clone()}static normalized(t){var e=new Laya.Vector3;return Laya.Vector3.normalize(t,e),e.clone()}static distance(t,e){var a=u.subtract(t,e);return Laya.Vector3.scalarLength(a)}}class g{static d3_getSpritePosBySprite3DPoint(t,e,a=new Laya.Vector3(0,0,0)){var i=e.transform.position.clone();i.x+=a.x,i.y+=a.y,i.z+=a.z;var s=new Laya.Vector4;t.viewport.project(i,t.projectionViewMatrix,s);var o=new Laya.Vector2(s.x/Laya.stage.clientScaleX,s.y/Laya.stage.clientScaleY);return new Laya.Point(o.x,o.y)}static d3_FindNodeByName(t,e){let a=null,i=t=>{for(let s=0;s<t.numChildren;s++){if(t.getChildAt(s).name==e)return void(a=t.getChildAt(s));i(t.getChildAt(s))}};return i(t),a}static d3_FindNodeHasName(t,e){let a=null,i=t=>{for(let s=0;s<t.numChildren;s++){if(-1!=t.getChildAt(s).name.indexOf(e))return void(a=t.getChildAt(s));i(t.getChildAt(s))}};return i(t),a}static d3_switchAllMathInChildren(t,e){if(t.meshRenderer){let a=t.meshRenderer.material.clone();a.albedoColor=g.d3_getRgbByHex(e),t.meshRenderer.material=a}for(let a=0;a<t.numChildren;a++){let i=t.getChildAt(a);if(i.meshRenderer){let t=new Laya.BlinnPhongMaterial,a=g.d3_getRgbByHex(e);t.albedoColor=new Laya.Vector4(a.x,a.y,a.z,1),t.specularColor=new Laya.Vector4(0,0,0,1),i.meshRenderer.material=t}this.d3_switchAllMathInChildren(i,e)}}static d3_unactiveAllChildren(t){for(let e=0;e<t.numChildren;e++)t.getChildAt(e).active=!1}static d3_objectScaleTips(t){let e=new y,a=t.transform.localScale.clone(),i=u.mull(a,.8),s=u.mull(a,1.2);e.toTween(t,{sca:i},50).then({sca:s},50).then({sca:a},50)}static d3_getRgbByHex(t){var e=[],a=[];let i=t.replace(/#/,"");if(3==i.length){for(var s=[],o=0;o<3;o++)s.push(i.charAt(o)+i.charAt(o));i=s.join("")}for(o=0;o<3;o++)e[o]="0x"+i.substr(2*o,2),a.push(parseInt(e[o]));return new Laya.Vector3(a[0]/255,a[1]/255,a[2]/255)}static d3_objectShake(t,e=1,a=.7){var i=e,s=1,o=t.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(i>0){var e=new Laya.Vector3;Laya.Vector3.scale((n=Math.random()>.5?Math.random():-Math.random(),r=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(n,r,0)),a,e),Laya.Vector3.add(o,e,e),t.transform.localPosition=e,i-=.02*s}else i=0,t.transform.localPosition=o,Laya.timer.clear(this,updateShake);var n,r})}static getAngle(t,e){var a=Laya.Vector3.dot(t,e),i=Laya.Vector3.scalarLength(t)*Laya.Vector3.scalarLength(e);if(0==i){if(t.z>e.z)return 0;if(t.z<e.z)return 180;if(t.y>e.y)return 90;if(t.y<e.y)return-90}var s=a/i;return s<-1&&(s=-1),s>1&&(s=1),180*Math.acos(s)/Math.PI}static getAngleUp(t,e,a){let i=g.getAngle(t,e),s=new Laya.Vector3;return Laya.Vector3.cross(e,t,s),g.getAngle(a,s)>90&&(i*=-1),i}static getProjection(t,e){let a=u.mull(e,u.dot(t,e));return u.subtract(t,a)}static d2_AddClickEvent(t,e,a,i,o=!1,n=!0,r=!0){t.offAllCaller(e);let l=t.scaleX,h=.9*l,d=!1;t.on(Laya.Event.MOUSE_DOWN,e,e=>{d=!0,r&&Laya.Tween.to(t,{scaleX:h,scaleY:h},60),o&&e.stopPropagation},i);t.on(Laya.Event.MOUSE_UP,e,i=>{0!=d&&(d=!1,o&&i.stopPropagation,r&&Laya.Tween.to(t,{scaleX:l,scaleY:l},60),a&&a.call(e,i),n&&m.play(s.Button))},i);t.on(Laya.Event.MOUSE_OUT,e,e=>{0!=d&&(d=!1,r&&Laya.Tween.to(t,{scaleX:l,scaleY:l},60),o&&e.stopPropagation)},i)}static getAngle2DWay(t,e){var a=Laya.Vector2.dot(t,e),i=Laya.Vector2.scalarLength(t)*Laya.Vector2.scalarLength(e),s=180*Math.acos(a/i)/Math.PI,o=t.x*e.y-e.x*t.y;return o>0?s*=1:o<0?s*=-1:s=0,s}static d2_coinCollectAnim(t,e,a,i,s=15,o=1,n=null,r=null){for(var l=s,h=0;h<s;h++){let s=Laya.Pool.getItemByClass("coin",Laya.Image);s.skin=t,s.x=e.x,s.y=e.y,s.scale(o,o),i.addChild(s);let h=300+100*Math.random()-50;Laya.Tween.to(s,{x:s.x+250*Math.random()-125,y:s.y+250*Math.random()-125},h),Laya.timer.once(h+50,this,function(){Laya.Tween.to(s,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){i.removeChild(s),Laya.Pool.recover("coin",s),l--,r&&r(),0==l&&n&&n(i)}))})}}static d2_coinCollectAnimAni(t,e,a,i,s=15,o=null){for(var n=s,r=0;r<s;r++){let s=Laya.Pool.getItemByClass("coinAnim",Laya.Clip);s.skin=t.skin,s.index=t.index,s.clipX=t.clipX,s.clipY=t.clipY,s.autoPlay=t.autoPlay,s.x=e.x,s.y=e.y,s.scale(.8,.8),i.addChild(s);let r=300+100*Math.random()-50;Laya.Tween.to(s,{x:s.x+250*Math.random()-125,y:s.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(s,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){i.removeChild(s),Laya.Pool.recover("coinAnim",s),0==--n&&o&&o(i)}))})}}static faceToast(t,e,a,i){let s=new Laya.Image(t);s.anchorX=.5,s.anchorY=.5,s.alpha=1,s.scaleX=.3,s.scaleY=.3,e.addChild(s),s.x=a.x,s.y=a.y,Laya.Tween.to(s,{x:i.x,y:i.y,alpha:.9},1e3,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{s&&!s.destroyed&&Laya.Tween.to(s,{x:i.x,y:i.y-100,alpha:0},1e3,null,Laya.Handler.create(this,()=>{s&&!s.destroyed&&s.destroy()}))}))}static d2_fontClipToast(t,e,a,i,s){if(!this.wordToastOk)return;let o=Laya.Pool.getItemByClass("fontClip_d2",Laya.FontClip);o.skin=t,o.sheet="0123456789",o.value=e,o.anchorX=.5,o.anchorY=.5,o.alpha=1,o.scaleX=i,o.scaleY=i,a.addChild(o),o.x=s.x,o.y=s.y;let n=new Laya.Vector2(s.x+(g.halfPercent()?g.randomInt(-100,-75):g.randomInt(75,100)),s.y-50);Laya.Tween.to(o,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(o,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{a.removeChild(o),Laya.Pool.recover("fontClip_d2",o)}))}))}static d2_imageToast(t,e,a){if(!this.wordToastOk)return;g.wordToastOk=!1;let i=new Laya.Image(t);i.anchorX=.5,i.anchorY=.5,i.alpha=1,e.addChild(i),i.top=300,i.centerX=0;i.scaleX=0,i.scaleY=0,Laya.Tween.to(i,{scaleX:1,scaleY:1},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{g.wordToastOk=!0,i&&!i.destroyed&&Laya.Tween.to(i,{top:200,alpha:0},500,null,Laya.Handler.create(this,()=>{i&&!i.destroyed&&i.destroy()}))}))}static clamp01(t){return t>1?1:t<0?0:t}static clamp(t,e,a){return t<e?e:t>a?a:t}static get getCurrentTime(){return(new Date).getTime()}static get getCurrentTime_Second(){return Math.floor(Date.parse((new Date).toString())/1e3)}static math_gcd(t,e){return 0==e?t:this.math_gcd(e,t%e)}static numberTo(t,e,a){return Math.abs(e-t)<a?t=e:t<e?t+=a:t>e&&(t-=a),t}static randomNumber(t,e){return t+(e-t)*Math.random()}static randomInt(t,e){return Math.floor(t+(e+1-t)*Math.random())}static halfPercent(){return Math.random()<.5}static percent(t){return Math.random()<t}static cloneArray(t){return[].concat(t)}static getRandomInArray(t){if(t.length){let e=Math.random()*t.length;return t[e=Math.floor(e)]}return console.error("传入错误参数,返回空"),null}static takeRandomInArray(t){if(t.length){let e=Math.random()*t.length,a=t[e=Math.floor(e)];return t.splice(e,1),a}return console.error("传入错误参数,返回空"),null}static randomArray(t){let e=new Array(t.length),a=e.length;for(let i=0;i<a;i++){let a=this.takeRandomInArray(t);e[i]=a}return e}static BoxCheck_2D_Normal(t,e,a,i,s,o,n,r){let l=s-t,h=o-e,d=Math.abs(h),c=Math.abs(l),m=(i+r)/2,y=(a+n)/2;return{isHit:d<m&&c<y,axisDis:c,axisRange:y,horizontalDis:d,horizontalRange:m,axisWay:l,horizontalWay:h}}static CircleCheck_2D(t,e,a,i,s,o){let n=Math.pow(t-i,2)+Math.pow(e-s,2),r=Math.pow(a+o,2);return{isHit:n<r,distancePow2:n,rangePow2:r}}}g.wordToastOk=!0,function(t){t.start="touchStart",t.move="touchMove",t.end="touchEnd",t.getAxis="GetAxis",t.slideWay="slideWay",t.singleTouchStart="singleTouchStart",t.singleTouchMove="singleTouchMove",t.singleTouchEnd="singleTouchEnd",t.secondTouchStart="secondTouchStart",t.secondTouchMove="secondTouchMove",t.secondTouchEnd="secondTouchEnd",t.getAxisAlways="getAxisAlways",t.keyDown="keyDown"}(r||(r={}));class p extends Laya.Script{constructor(){super(...arguments),this.isPressed=!1,this.hOriginal=0,this.vOriginal=0,this.hAxis=0,this.vAxis=0,this.outAxis=0,this.touchId=-1}onEnable(){p.instance=this}onMouseDown(e){t.event(r.start,[e])}onMouseMove(e){t.event(r.move,[e])}onMouseOut(e){t.event(r.end,[e])}onMouseOver(e){t.event(r.end,[e])}onMouseUp(e){t.event(r.end,[e])}}class f extends Laya.Script{constructor(){super(...arguments),this.calls=[],this.firstId=-1,this.secondId=-1,this.firstOriginalPoint=new Laya.Vector2,this.secondOriginalPoint=new Laya.Vector2,this.isSecond=!1,this.orignalHorizontal=0,this.orignalAxis=0,this.orignalHorizontalAlways=0,this.orignalAxisAlways=0,this.offset=new Laya.Vector3}onEnable(){t.on(r.start,this,this.onMouseDown),t.on(r.move,this,this.onMouseMove),t.on(r.end,this,this.onMouseUp)}onDisable(){t.off(r.start,this,this.onMouseDown),t.off(r.move,this,this.onMouseMove),t.off(r.end,this,this.onMouseUp)}onMouseDown(e){0==this.isSecond?-1==this.firstId?(this.checkOut(e),this.firstId=e.touchId,t.event(r.singleTouchStart,e),this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):this.firstId!=e.touchId&&-1==this.secondId&&(this.secondId=e.touchId,this.isSecond=!0,t.event(r.secondTouchStart,e),this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):-1==this.firstId?(this.firstId=e.touchId,this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):-1==this.secondId&&(this.secondId=e.touchId,this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),this.checkOutAlways(e)}onMouseMove(e){if(0==this.isSecond)e.touchId==this.firstId&&(this.checkWay(e),this.checkOut(e),t.event(r.singleTouchMove,e));else if(-1!=this.firstId&&-1!=this.secondId){let a,i={distance:0,angle:0},s=this.Vector2Reduce(this.secondOriginalPoint,this.firstOriginalPoint),o=Laya.Vector2.scalarLength(s);if(e.touchId==this.firstId?a=this.Vector2Reduce(this.secondOriginalPoint,new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):e.touchId==this.secondId&&(a=this.Vector2Reduce(new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height),this.firstOriginalPoint)),a){let e=Laya.Vector2.scalarLength(a);i.distance=e-o,i.angle=g.getAngle2DWay(s,a),t.event(r.secondTouchMove,i)}}e.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),e.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),this.checkWayAlways(e)}onMouseUp(e){this.checkOutAlways(e),e.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),e.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),0==this.isSecond?e.touchId==this.firstId&&(this.checkOut(e),t.event(r.singleTouchEnd,e),this.firstId=-1):(e.touchId==this.firstId&&(this.firstId=-1),e.touchId==this.secondId&&(this.secondId=-1),-1==this.firstId&&-1==this.secondId&&(this.isSecond=!1))}WayCheck(){let t=this.Vector2Reduce(this.nowPos,this.startPos);if(Laya.Vector2.scalarLength(t)>100){let e=Math.atan2(t.y,t.x)/Math.PI*180,a="none";e>-135&&e<-45?a="up":e>-45&&e<45?a="right":e<135&&e>45?a="down":(e<-135||e>135)&&(a="left"),this.isDown=!1}this.startPos=this.nowPos}onDestroy(){this.touchTimer&&clearTimeout(this.touchTimer)}checkWay(e){let a=e.stageX-this.orignalHorizontal,i=e.stageY-this.orignalAxis;t.event(r.getAxis,[{x:a,y:i}])}checkOut(t){this.orignalHorizontal=t.stageX,this.orignalAxis=t.stageY}checkWayAlways(e){let a=e.stageX/Laya.stage.width-this.orignalHorizontalAlways,i=e.stageY/Laya.stage.height-this.orignalAxisAlways;this.checkOutAlways(e),t.event(r.getAxisAlways,[{x:a,y:i}])}checkOutAlways(t){this.orignalHorizontalAlways=t.stageX/Laya.stage.width,this.orignalAxisAlways=t.stageY/Laya.stage.height}modelRotateControlDown(){let t=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);this.startPosition=t.clone(),this.prePosition=t.clone()}modelRotateControlMove(){let t=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);Laya.Vector3.subtract(t,this.prePosition,this.offset),this.prePosition=t.clone();var e=new Laya.Vector3(this.offset.x,this.offset.y,0);let a=new Laya.Vector3;Laya.Vector3.cross(e,new Laya.Vector3(0,0,1),a),Laya.Vector3.normalize(a,a)}modelRotateControlUp(){new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0)}onKeyDown(e){t.event(r.keyDown,e)}Vector2Reduce(t,e){return new Laya.Vector2(t.x-e.x,t.y-e.y)}}class L{init(){}loadSubPackage(t,e){if(this.platformApi){this.platformApi.loadSubpackage({name:t,success:function(a){console.log("分包加载成功：",t),e.call(!0,a)},fail:function(a){console.error("分包加载失败：",t,JSON.stringify(a)),e.call(!1,a)}})}else console.log("没有平台API"),e(!0)}showToast(t,e=1e3){console.log(t,e.toString()+"ms")}vibrateShort(){this.platformApi&&this.platformApi.vibrateShort()}vibrateLong(){this.platformApi&&this.platformApi.vibrateLong()}regisiterCallback(){this.platformApi&&(this.platformApi.offShow(this.onShowEvent),this.platformApi.onShow(this.onShowEvent),this.platformApi.offHide(this.onHideEvent),this.platformApi.onHide(this.onHideEvent))}onShowEvent(e){t.event(i.Platform_Wake_Do,e)}onHideEvent(e){t.event(i.Platform_Hide_Do,e)}}class C extends L{init(){this.platformApi=Laya.Browser.window.wx,this.showShareMenuWithTicket(!0),this.regisiterWXShareCallback()}showToast(t,e=1500){Laya.Browser.window.wx.showToast({title:t,icon:"none",duration:e})}showShareMenuWithTicket(t){wx.showShareMenu({withShareTicket:t,success:function(){},fail:function(){},complete:function(){}})}regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var t={title:"分享",image:""};Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:t.title,imageUrl:t.image,query:"share_id=1"}})}}}class w{static init(t){this.isStatShow&&Laya.Stat.show(),this.game=t,this.goLoad(),this.addLoadRes(a.SubPackage),this.addLoadRes(a.Scene3D);let e=this.subPackageName,i=this.scene3DUrl;Laya.Browser.onWeiXin?this.platform=new C:this.platform=new L,this.platform.init();this.platform.loadSubPackage(e,t=>{t&&(this.removeLoadRes(a.SubPackage),this.load3DRes(i))}),m.init(),h.CheckPlayerData()}static goLoad(){this.openScene(e.Load)}static goHome(){this.closeScene(e.Load),this.closeScene(e.Over),this.openScene(e.Home),this.game.levelInit()}static goGame(){this.closeScene(e.Home),this.openScene(e.Game),this.game.gameStart()}static goOver(){this.closeScene(e.Game),this.openScene(e.Over)}static load3DRes(t){var e=[{url:t,clas:Laya.Scene3D,priority:1}];Laya.loader.create(e,Laya.Handler.create(this,this.onLoadFinished,[{target:"3dRes"}],!1),Laya.Handler.create(this,this.onLoading,null,!1)),Laya.loader.on(Laya.Event.ERROR,this,e=>{console.error("资源加载失败",e),this.load3DRes(t)})}static onLoadFinished(t){console.log("资源加载完成",t),this.loadSceneRes(),this.removeLoadRes(a.Scene3D)}static onLoading(t){}static loadSceneRes(){let t=Laya.loader.getRes(this.scene3DUrl);Laya.stage.addChild(t),Laya.stage.setChildIndex(t,0),this.game.mainScene=t,this.game.firstIn()}static addLoadRes(t){this.loadingList.push(t),this.loadingCount++}static removeLoadRes(e){let a=this.loadingList.indexOf(e);-1==a?console.log("完成了不存在的资源加载"):this.loadingList.splice(a,1),t.event(i.Progress_Load_Update)}static openScene(t,e){Laya.Scene.open(t,!1,null,Laya.Handler.create(this,t=>{Laya.stage.addChild(t),e&&e()}))}static closeScene(t,e){Laya.Scene.close(t)&&e&&e()}static checkPerformance(t,e,a){let i=0,s=100,o=s;Laya.timer.loop(100,this,function addValue(){i+=1e3/Laya.timer.delta;o--;if(o<=0){Laya.timer.clear(this,addValue);let o=i/s;o>50?t&&t():o>40?e&&e():a&&a()}})}}w.subPackageName="scene",w.scene3DUrl="res/scene/Conventional/ResScene.ls",w.isStatShow=!1,w.loadingList=[],w.loadingCount=0;class S extends Laya.Script3D{onAwake(){this.self=this.owner,this.selfTween=new y,this.init()}init(...t){}onDestroy(){Laya.timer.clearAll(this),this.selfTween.clearTween(),t.offAllCaller(this)}}class v extends S{constructor(){super(...arguments),this.forwardSpeed_Data=4.5,this.speedAxis=1,this.isCamCtrl=!0,this.axis=0,this.horizontal=0,this.isMove=!1,this.modelMoveRange=34,this.camPointMoveRange=20,this.forwardSpeed=1.25,this.horizontalSensity=.12,this.forwardSensity=.15,this.wayAxis=0,this.targetHorizontal=0,this.inHorizontal=0}init(){this.player=this.self,this.model=this.player.getChildByName("Model"),this.camPoint=this.player.getChildByName("CamPoint"),this.forwardSpeed=this.forwardSpeed_Data}reset(t,e){this.axis=t,this.horizontal=e,this.targetHorizontal=e,this.speedAxis=1;let a=this.player.transform.localPosition.clone();a.z=this.axis,this.player.transform.localPosition=a;let i=this.model.transform.localPosition.clone();i.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=i;let s=this.camPoint.transform.localPosition.clone();s.x=-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=s}onUpdate(){let t=Laya.timer.delta/16;this.forwardSpeed>=0?this.isMove&&(this.axis+=this.forwardSpeed*this.forwardSensity*t*this.speedAxis):this.forwardSpeed<0&&(this.axis+=this.forwardSpeed*this.forwardSensity*t*this.speedAxis),this.wayAxis=this.targetHorizontal-this.horizontal,this.horizontal+=this.wayAxis*this.horizontalSensity*t;let e=this.player.transform.localPosition.clone();e.z=this.axis,this.isMove&&(this.player.transform.localPosition=e);let a=this.model.transform.localPosition.clone();if(a.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=a,this.isCamCtrl){let t=this.camPoint.transform.localPosition.clone();t.x=k.instance.startCamPoint.transform.localPosition.x-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=t}}checkWay(t){let e=!1;return this.targetHorizontal=this.inHorizontal+t,this.targetHorizontal>.5?(this.targetHorizontal=.5,this.checkOut(),e=!0):this.targetHorizontal<-.5&&(this.targetHorizontal=-.5,this.checkOut(),e=!0),e}checkOut(){this.inHorizontal=this.targetHorizontal}Hit(){this.forwardSpeed=-.5,Laya.timer.frameLoop(1,this,this.HitUpdate)}HitUpdate(){this.forwardSpeed+=.05*Laya.timer.delta/16,this.forwardSpeed>=this.forwardSpeed_Data&&(Laya.timer.clear(this,this.HitUpdate),this.forwardSpeed=this.forwardSpeed_Data)}onDisable(){}}!function(t){t[t.bad=0]="bad",t[t.normal=1]="normal",t[t.shiny=2]="shiny",t[t.silver=3]="silver",t[t.gold=4]="gold"}(l||(l={}));class x extends S{constructor(){super(...arguments),this.range=1,this.width=1,this.raidus=1,this.colliderActive=!0,this.isBullet=!1,this.itemState=l.normal}init(...t){}setData(t,e,a=!1){this.range=t,this.width=e,this.raidus=this.range>this.width?this.range:this.width,this.colliderActive=!0,this.isBullet=a,this.changeState(l.normal)}changeState(t){this.itemState=t;let e=this.self.getChildAt(0),a=e.getChildByName("Model").getChildByName("Tooth_1"),i=e.getChildByName("Model").getChildByName("Tooth_2");i.active=!1,a.active=!0;let s=e.getComponent(S).selfTween;switch(s.clearTween(),e.transform.localScale=new Laya.Vector3(0,0,0),s.toTween(e,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut),t){case l.bad:a.active=!1,i.active=!0;break;case l.normal:a.meshRenderer.material=k.instance.itemMat[1];break;case l.shiny:k.instance.bornFxDestroy("isClearFx",this.self,1e3),a.meshRenderer.material=k.instance.itemMat[2];break;case l.silver:k.instance.bornFxDestroy("isClearFx",this.self,1e3),a.meshRenderer.material=k.instance.itemMat[3];break;case l.gold:let o=k.instance.bornFxDestroy("isClearFx",this.self,1e3).getChildAt(0),n=g.d3_getRgbByHex(k.instance.itemColor[4]),r=new Laya.Vector4(n.x,n.y,n.z,1);o.particleSystem.startColorConstant=r,o.getChildAt(0).particleSystem.startColorConstant=r,a.meshRenderer.material=k.instance.itemMat[4]}}}class M extends S{constructor(){super(...arguments),this.offsetX=0,this.offsetZ=4,this.size=4,this.itemLerpAxis=20,this.nowType=[]}init(...t){this.items=this.self.getChildByName("Items"),this.model=this.self.getChildByName("Model")}reset(){this.items.active=!0,this.nowType=[],this.nowType.push(o.Tooth);for(let t=this.items.numChildren-1;t>=0;t--)this.items.getChildAt(t).destroy();for(let t=0;t<0;t++)this.addItem()}addItem(t=1){let e=new Laya.Sprite3D("item");w.game.stageObj.push(e),this.items.addChild(e),e.transform.localPosition=new Laya.Vector3;for(let t=0;t<this.nowType.length;t++){let a=w.game.bornStageObj(this.getItemUrl(this.nowType[t]),e);a.addComponent(S).selfTween;a.transform.localPosition=new Laya.Vector3(0==t?0:Math.sin(t*Math.PI+Math.PI/2),0,0)}let a=e.addComponent(x);a.setData(this.size,this.size),a.changeState(t),m.play(s.Get)}getItemUrl(t){switch(t){case o.Tooth:return o.Tooth;default:return null}}onUpdate(){let t,e=this.model.transform.position.clone();e.x+=this.offsetX,e.z+=this.offsetZ;for(let a=0;a<this.items.numChildren;a++)if((t=this.items.getChildAt(a))&&!t.destroyed){let i=new Laya.Vector3,s=.016*this.itemLerpAxis;s>1&&(s=1),Laya.Vector3.lerp(t.transform.position.clone(),e,s,i),i.z=this.model.transform.position.z+this.offsetZ+a*this.size,t.transform.position=i,e=t.transform.position}}}class b extends S{constructor(){super(...arguments),this.yForceMin=1,this.yForceMax=2,this.xForceMin=.5,this.xForceMax=1,this.zForceMin=15,this.zForceMax=25,this.dir=new Laya.Vector3(0,1,0),this.gravity=0,this.yforce=0,this.xForce=0,this.zForce=0,this.rotate=new Laya.Vector3,this.dorpDeadY=-2,this.dropDeadChangeX=4,this.isDestory=!0,this.isActive=!0}init(){this.setData()}changeDropData(t,e,a,i,s,o){this.yForceMin=t.x,this.yForceMax=t.y,this.xForceMin=e.x,this.xForceMax=e.y,this.zForceMin=a.x,this.zForceMax=a.y,this.rotate=s,this.dir=i,this.gravity=o,this.setData()}setTimeDestroy(t=1e3){Laya.timer.once(t,this,()=>{this.self.destroy()})}setData(){this.xForce=g.randomNumber(this.xForceMin,this.xForceMax),this.yforce=g.randomNumber(this.yForceMin,this.yForceMax),this.zForce=g.randomNumber(this.zForceMin,this.zForceMax)}onUpdate(){if(!this.isActive)return;let t=Laya.timer.delta/1e3;this.yforce-=this.gravity*t;let e=this.self;e&&!e.destroyed&&(e.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*t,this.yforce*t,this.dir.z*this.zForce*t),!1),e.transform.rotate(u.mull(this.rotate,t),!0),Math.abs(this.self.transform.position.x)>this.dropDeadChangeX&&(this.dorpDeadY=-19.5),this.self.transform.position.y<this.dorpDeadY&&(this.isDestory?this.self.destroy():this.isActive=!1))}}class _ extends b{init(){super.init(),this.dorpDeadY=2,this.isDestory=!1,this.dropDeadChangeX=20,this.changeDropData(new Laya.Vector2(75,100),new Laya.Vector2(-12.5,12.5),new Laya.Vector2(50,100),new Laya.Vector3(1,1,1),new Laya.Vector3(g.randomNumber(-10,10),g.randomNumber(-10,10),g.randomNumber(-10,10)),250)}onUpdate(){let t=Laya.timer.delta/1e3;if(this.isActive){this.yforce-=this.gravity*t;let e=this.self,a=this.self.getChildAt(0).getChildByName("Model");e&&!e.destroyed&&(e.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*t,this.yforce*t,this.dir.z*this.zForce*t),!1),a.transform.rotate(u.mull(this.rotate,t),!0),Math.abs(this.self.transform.position.x)>this.dropDeadChangeX&&(this.dorpDeadY=-19.5,this.isDestory=!0),a.transform.position.y<this.dorpDeadY&&(this.isDestory?this.self.destroy():(e.transform.position=new Laya.Vector3(this.self.transform.position.x,0,this.self.transform.position.z),this.isActive=!1)))}else{let e=this.self,a=this.self.getChildAt(0).getChildByName("Model");if(e&&!e.destroyed){let i=this.dir.clone();Laya.Vector3.lerp(this.dir,new Laya.Vector3,4*t,i),this.dir=i,e.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*t,0,this.dir.z*this.zForce*t),!1),a.transform.rotate(new Laya.Vector3(this.dir.z*this.zForce*t*.5,0,0),!1)}}}colliderDo(){this.isActive||(w.game.itemsComp.addItem(this.self.getComponent(x).itemState),this.self.destroy(),w.game.vibrateShort())}}class T extends S{constructor(){super(...arguments),this.isCircle=!1,this.range=1,this.width=1,this.raidus=1,this.type=n.Tooth,this.colliderActive=!0,this.colliderSprite=[],this.isHarm=!1,this.hasColliderObj=[],this.needFixTooths=[]}init(...t){}setData(t){this.type=t,this.raidus=(this.range+this.width)/2,this.raidus*=.5,this.isCircle=!1;let e,a,i,o=g.d3_FindNodeHasName(this.self,"collider");switch(this.range=parseFloat(o.name.split("_")[2]),this.width=parseFloat(o.name.split("_")[3]),this.colliderSprite.push(o),t){case n.Tooth:this.self.getChildByName("Model").getChildByName("Tooth_2").active=!1,(a=this.self.getChildByName("Model").getChildByName("Tooth_1")).meshRenderer.material=k.instance.itemMat[1];break;case n.Tooth_Gum:(a=this.self.getChildByName("Tooth_1")).meshRenderer.material=k.instance.itemMat[1];break;case n.Brush_Stop:this.fx=g.d3_FindNodeByName(this.self,"burshFx"),k.instance.bornFxStage("burshFx",this.fx);break;case n.Brush_Move:this.fx=g.d3_FindNodeByName(this.self,"brushFx"),k.instance.bornFxStage("burshFx",this.fx);break;case n.Pole:this.fx=g.d3_FindNodeByName(this.self,"PoleFx"),k.instance.bornFxStage("PoleFx",this.fx);break;case n.Candy_Saw_Short:break;case n.Dental_Drill:(i=this.self.getChildAt(0).getComponent(Laya.Animator)).play("DentalDrill",0,0),this.colliderActive=!1,i.speed=.75,Laya.timer.frameLoop(1,this,()=>{this.playCloseSound(s.Drill)});let r=()=>{Laya.timer.once(950/i.speed,this,()=>{this.colliderActive=!0,Laya.timer.once(50/i.speed,this,()=>{this.colliderActive=!1,r()})})};r();break;case n.Gum_Tooth:(e=this.self.getChildAt(0)).getChildAt(1).transform.rotate(new Laya.Vector3(30,0,0),!0,!1),this.fx=g.d3_FindNodeByName(this.self,"GumToothFx"),k.instance.bornFxStage("GumToothFx",this.fx);for(let t=0;t<e.numChildren;t++){let i=e.getChildAt(t);for(let t=0;t<i.numChildren;t++)-1!=(a=i.getChildAt(t)).meshRenderer.material.name.indexOf("Tooth_4")&&(this.needFixTooths.push(a),a.meshRenderer.enable=!1)}break;case n.Gate:this.fx=g.d3_FindNodeByName(this.self,"GateFx"),k.instance.bornFxStage("GateFx",this.self)}}colliderDo(t=null){let e,a;switch(this.type){case n.Tooth:this.colliderActive&&(this.self.active=!1,w.game.itemsComp.addItem(),this.colliderActive=!1,w.game.vibrateShort());break;case n.Tooth_Gum:this.colliderActive&&(this.self.getChildByName("Tooth_1").active=!1,w.game.itemsComp.addItem(),this.colliderActive=!1,w.game.vibrateShort());break;case n.Brush_Stop:this.colliderActive&&t&&t&&(-1==this.hasColliderObj.indexOf(t)&&(t.itemState<=1&&(t.itemState++,t.changeState(t.itemState),w.game.vibrateShort()),this.hasColliderObj.push(t)),this.playLoopSound(s.Brush));break;case n.Brush_Move:this.colliderActive&&t&&(-1==this.hasColliderObj.indexOf(t)&&(t.itemState<=1&&(t.itemState++,t.changeState(t.itemState),w.game.vibrateShort()),this.hasColliderObj.push(t)),this.playLoopSound(s.Brush));break;case n.Pole:this.colliderActive&&t&&(-1==this.hasColliderObj.indexOf(t)&&(t.itemState>0&&t.itemState<=2&&(t.itemState--,t.changeState(t.itemState)),this.hasColliderObj.push(t),w.game.vibrateShort()),this.playLoopSound(s.Candy));break;case n.Candy_Saw_Short:if(this.colliderActive)if(t){let i=k.instance.bornFxDestroy("TeethBreakFX",this.self,2500,1.5,new Laya.Vector3(0,1,0));i&&(i.transform.position=this.colliderSprite[0].transform.position.clone()),e=t.self.transform.position.clone(),a=t.self.transform.rotation.clone(),k.instance.dropItemGrip.addChild(t.self),t.self.transform.position=e,t.self.transform.rotation=a,t.self.addComponent(_),w.game.vibrateShort(),k.instance.playBladeSound()}else k.instance.runMoveComp.Hit();break;case n.Dental_Drill:this.colliderActive&&t&&t&&0==this.hasColliderObj.length&&t.itemState>0&&t.itemState<=2&&(g.d3_FindNodeByName(this.self,"ToothGrip").addChild(t.self),t.self.transform.localPosition=new Laya.Vector3,t.self.transform.localRotation=new Laya.Quaternion,t.colliderActive=!1,this.hasColliderObj.push(t),k.instance.bornFxDestroy("DuangFX",this.self,1e3),w.game.vibrateShort());break;case n.Gum_Tooth:if(this.colliderActive)if(t&&0!=this.needFixTooths.length){let i=k.instance.itemsComp.items.numChildren;i=i>this.needFixTooths.length?this.needFixTooths.length:i;let o=t.self,n=t;e=o.transform.position.clone(),a=o.transform.rotation.clone(),this.self.addChild(o),o.transform.position=e,o.transform.rotation=a;let r=this.needFixTooths.splice(this.needFixTooths.length-1,1)[0];this.needFixTooths.length,n.selfTween.toTween(o,{pos:r.transform.position.clone(),rot:r.transform.rotation.clone(),sca:new Laya.Vector3(.5,.5,.5)},250,()=>{r.meshRenderer.enable=!0,this.toothChange(r,n.itemState),o.active=!1,m.play(s.Fillin)},Laya.Ease.expoIn,!1),w.game.vibrateShort()}else;break;case n.Gate:this.colliderActive&&t&&-1==this.hasColliderObj.indexOf(t)&&(t.itemState>=2&&t.itemState<4&&(t.itemState++,t.changeState(t.itemState)),this.hasColliderObj.push(t),w.game.vibrateShort(),m.play(s.Upgrade))}}playLoopSound(t){this.mistSoundChannel&&!this.mistSoundChannel.isStopped||(this.mistSoundChannel=m.play(t,!0)),this.mistSoundChannel&&(this.mistSoundChannel.volume=w.game.isSound?1:0),Laya.timer.frameOnce(1,this,this.soundStop)}soundStop(){this.mistSoundChannel&&(this.mistSoundChannel.volume=0)}playCloseSound(t){let e=Math.abs(this.self.transform.position.z-k.instance.player.transform.position.z),a=e<100?e/100:1;this.mistSoundChannel&&!this.mistSoundChannel.isStopped||(this.mistSoundChannel=m.play(t,!0)),this.mistSoundChannel&&(this.mistSoundChannel.volume=w.game.isSound?1-a:0)}toothChange(t,e=0){switch(e){case 0:t.meshRenderer.material=k.instance.itemMat[0];break;case 1:t.meshRenderer.material=k.instance.itemMat[1];break;case 2:k.instance.bornFxDestroy("isClearFx",t,1e3),t.meshRenderer.material=k.instance.itemMat[2];break;case 3:k.instance.bornFxDestroy("isClearFx",t,1e3),t.meshRenderer.material=k.instance.itemMat[3];break;case 4:k.instance.bornFxDestroy("isClearFx",t,1e3),t.meshRenderer.material=k.instance.itemMat[4]}if(k.instance.moneyCount+=e+1,0==this.needFixTooths.length){let t=this.self.getChildAt(0).getChildAt(1);this.fx.active=!1,this.selfTween.toTween(t,{rot:new Laya.Vector3},500,null,Laya.Ease.backIn,!0),m.play(s.Complete)}}}class k{constructor(){this.dropObjs=[],this.isFxOn=!0,this.colliders=[],this.isObjToJson=!1,this.isBornStage=!0,this.isJsonBorn=!0,this.itemColor=["FFFFFF","FFD37C","FFFFFF","C3D8EB","F0FF00"],this.itemMetallic=[0,.341,0,.254,.158],this.itemSmoothness=[0,0,0,.477,.314],this.itemMat=[],this.numberMat=[],this.headTooths=[],this.nowHeadIndex=0,this.moneyCount=0,this.nowRound=0,this.playCount=0,this.isWin=!1,this.isEnd=!1,this.isStart=!1,this.isPressed=!1,this.orignal=0,this.isVibrate=!0,this.isSound=!0,this.isBladeOk=!0,this.isGetOk=!0,this.stageObj=[],this.fxPool=[],k.instance=this,this.init()}init(){this.initEvent(),this.isJsonBorn&&this.readJson()}createShadow(t){t.shadowMode=Laya.ShadowMode.SoftLow,t.shadowDistance=200,t.shadowResolution=1024,t.shadowCascadesMode=Laya.ShadowCascadesMode.NoCascades,t.shadowNormalBias=.6,t.shadowStrength=.4}hideShadow(t){t.shadowMode=Laya.ShadowMode.None}useRetinalCanvas(){Laya.stage.useRetinalCanvas=!0}disabelRetinalCanvas(){Laya.stage.useRetinalCanvas=!1}setFog(t,e,a){e.enableFog=t,t&&(e.fogColor=a,e.fogStart=10,e.fogRange=30)}readJson(){w.addLoadRes("关卡");let t=["res/json/stageInfo.json"],e=()=>{Laya.loader.load(t,Laya.Handler.create(this,a=>{if(a){for(let e=0;e<t.length;e++)Laya.loader.load(t[e],Laya.Handler.create(this,t=>{switch(e){case 0:this.stageJson=t,console.log(t);break;default:console.log(t)}}),null,Laya.Loader.JSON);w.removeLoadRes("关卡")}else console.log("load json fail,reload after 1s"),Laya.timer.once(1e3,this,e)}),null,Laya.Loader.JSON)};t.length>0&&e()}JsonV3(t,e){if(e){let a=Math.round(parseFloat(t.x)*Math.pow(10,e))/Math.pow(10,e),i=Math.round(parseFloat(t.y)*Math.pow(10,e))/Math.pow(10,e),s=Math.round(parseFloat(t.z)*Math.pow(10,e))/Math.pow(10,e);return new Laya.Vector3(a,i,s)}return new Laya.Vector3(parseFloat(t.x),parseFloat(t.y),parseFloat(t.z))}V3ToJson(t){return{x:t.x.toString(),y:t.y.toString(),z:t.z.toString()}}JsonV4(t,e){if(e){let a=Math.round(parseFloat(t.x)*Math.pow(10,e))/Math.pow(10,e),i=Math.round(parseFloat(t.y)*Math.pow(10,e))/Math.pow(10,e),s=Math.round(parseFloat(t.z)*Math.pow(10,e))/Math.pow(10,e),o=Math.round(parseFloat(t.w)*Math.pow(10,e))/Math.pow(10,e);return new Laya.Vector4(a,i,s,o)}return new Laya.Vector4(parseFloat(t.x),parseFloat(t.y),parseFloat(t.z),parseFloat(t.w))}V4ToJson(t){return{x:t.x.toString(),y:t.y.toString(),z:t.z.toString(),w:t.w.toString()}}firstIn(){console.log("首次进入处理");for(let t=0;t<this.mainScene.numChildren;t++){let e=this.mainScene.getChildAt(t);switch(e.name){case"Prefabs":this.prefabs=e;break;case"Light":this.light=e;break;case"Fxs":this.fxs=e,Laya.timer.once(1e3,this,()=>{this.fxs.active=!1});break;case"Stage":this.stage=e,this.player=this.stage.getChildByName("Player"),this.runMoveComp=this.player.addComponent(v),this.itemsComp=this.player.addComponent(M),this.camPoint=this.player.getChildByName("CamPoint"),this.mainCam=this.camPoint.getChildByName("MainCam"),this.mainCamera=this.mainCam.getChildByName("Main Camera"),this.start=this.stage.getChildByName("Start"),this.end=this.stage.getChildByName("End"),this.startCamPoint=this.player.getChildByName("CamStartPoint"),this.endCamPoint=this.player.getChildByName("CamEndPoint"),this.dropItemGrip=this.stage.getChildByName("DropItemGrip")}}w.checkPerformance(()=>{},()=>{this.disabelRetinalCanvas()},()=>{this.hideShadow(this.light),this.disabelRetinalCanvas(),this.isFxOn=!1}),this.useRetinalCanvas(),this.createShadow(this.light),this.randomPlayMusic();for(let t=1;t<=8;t++){let e="res/scene/numberTexure/Number_"+t.toString()+".png";Laya.Texture2D.load(e,Laya.Handler.create(this,function(t){let e=new Laya.UnlitMaterial;e.renderMode=2,e.albedoTexture=t,this.numberMat.push(e),8==this.numberMat.length&&this.endNumberBorn()}))}let t=this.end.getChildByName("Head").getChildAt(0);for(let e=0;e<10;e++){let a=t.clone();this.end.getChildByName("Head").addChild(a),a.transform.localPosition=new Laya.Vector3(0,0,45+45*e)}for(let t=0;t<5;t++){let e;switch(t){case 0:let a=g.d3_FindNodeByName(k.instance.prefabs,"Tooth_2").meshRenderer.material.clone().albedoTexture;(e=new Laya.PBRStandardMaterial).albedoColor=g.d3_getRgbByHex(k.instance.itemColor[0]),e.metallic=k.instance.itemMetallic[0],e.smoothness=k.instance.itemSmoothness[0],e.albedoTexture=a;break;case 1:(e=new Laya.PBRStandardMaterial).albedoColor=g.d3_getRgbByHex(k.instance.itemColor[1]),e.metallic=k.instance.itemMetallic[1],e.smoothness=k.instance.itemSmoothness[1];break;case 2:(e=new Laya.BlinnPhongMaterial).albedoColor=g.d3_getRgbByHex(k.instance.itemColor[2]),e.metallic=k.instance.itemMetallic[2],e.smoothness=k.instance.itemSmoothness[2];break;case 3:(e=new Laya.PBRStandardMaterial).albedoColor=g.d3_getRgbByHex(k.instance.itemColor[3]),e.metallic=k.instance.itemMetallic[3],e.smoothness=k.instance.itemSmoothness[3];break;case 4:(e=new Laya.PBRStandardMaterial).albedoColor=g.d3_getRgbByHex(k.instance.itemColor[4]),e.metallic=k.instance.itemMetallic[4],e.smoothness=k.instance.itemSmoothness[4]}this.itemMat.push(e)}}initEvent(){}levelInit(){this.isEnd=!1,this.isStart=!1,Laya.timer.clear(this,this.gameUpdate),this.stageObjClear(),this.dropObjs=[],this.fxPool=[],this.colliders=[],this.headTooths=[],this.nowRound=0,this.nowHeadIndex=0,this.moneyCount=0;let t=h.ReadGrade()-1,e=new Laya.Vector3,a=new Laya.Vector3(0,0,200),i=u.add(e,a);this.start.transform.position=e;let s=this.isBornStage,o=this.isJsonBorn;if(s){let e,s,r,l=this.stage.getChildByName("Level");if(this.isObjToJson){let t=[];for(let e=0;e<l.numChildren;e++){let a=l.getChildAt(e),i={name:"",setInfo:[]};i.name=a.name;for(let t=0;t<a.numChildren;t++){let e=a.getChildAt(t),s={name:"",objInfo:[]};s.name=e.name;for(let t=0;t<e.numChildren;t++){let a=e.getChildAt(t),i=a.name,o=a.transform.localPosition.clone(),n=a.transform.rotation.clone(),r={name:i,pos:this.V3ToJson(o),rot:this.V4ToJson(n)};s.objInfo.push(r)}i.setInfo.push(s)}t.push(i)}console.log(JSON.stringify(t))}e=o?t%this.stageJson.length:t%(l=this.stage.getChildByName("Level")).numChildren,r=o?(s=this.stageJson[e]).setInfo.length:(s=l.getChildAt(e)).numChildren;let h=0;for(let t=0;t<r;t++){let e,r;r=o?(e=s.setInfo[t]).objInfo.length:(e=s.getChildAt(t)).numChildren;let l=new Laya.Sprite3D(e.name);this.stage.addChild(l),l.transform.position=i;for(let t=0;t<r;t++){let s,r,d,c,m,y,g;switch(o?(r=(s=e.objInfo[t]).name.split(" ")[0],d=u.add(this.JsonV3(s.pos),l.transform.position.clone()),c=this.JsonV4(s.rot)):(r=(s=e.getChildAt(t)).name.split(" ")[0],d=u.add(s.transform.localPosition.clone(),l.transform.position.clone()),c=s.transform.rotation.clone()),r){case"Road":i=u.add(i,a);let p=8;for(let t=0;t<p;t++)this.colliders.push([]),this.colliders.push([]);(m=this.bornStageObj(r,l)).transform.position=d;break;case n.Tooth:r=n.Tooth,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Tooth),y=this.colliderIndexJudge(d),this.colliders[y].push(g),h++;break;case n.Tooth_Gum:r=n.Tooth_Gum,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Tooth_Gum),y=this.colliderIndexJudge(d),this.colliders[y].push(g),h++;break;case n.Brush_Stop:r=n.Brush_Stop,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Brush_Stop),y=this.colliderIndexJudge(d),this.colliders[y].push(g);break;case n.Brush_Move:r=n.Brush_Move,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Brush_Move),y=this.colliderIndexJudge(d),this.colliders[y].push(g);break;case n.Brush_Stop:r=n.Brush_Stop,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Brush_Stop),y=this.colliderIndexJudge(d),this.colliders[y].push(g);break;case n.Candy_Saw_Short:r=n.Candy_Saw_Short,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Candy_Saw_Short),y=this.colliderIndexJudge(d),this.colliders[y].push(g);break;case n.Dental_Drill:r=n.Dental_Drill,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Dental_Drill),y=this.colliderIndexJudge(d),this.colliders[y].push(g);break;case n.Gum_Tooth:r=n.Gum_Tooth,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Gum_Tooth),y=this.colliderIndexJudge(d),this.colliders[y].push(g);break;case n.Gate:r=n.Gate,(m=this.bornStageObj(r,l)).transform.position=d,(g=m.addComponent(T)).setData(n.Gate),y=this.colliderIndexJudge(d),this.colliders[y].push(g);break;case n.Pole:r=n.Pole,(m=this.bornStageObj(r,l)).transform.position=d,m.transform.rotation=c,(g=m.addComponent(T)).setData(n.Pole),y=this.colliderIndexJudge(d),this.colliders[y].push(g);break;default:console.log("关卡物品预设里没有该类型物件",r)}}}}this.end.transform.position=i;let r=this.end.getChildByName("Head");for(let t=0;t<r.numChildren;t++){let e=r.getChildAt(t),a=e.getChildAt(0);e.getComponent(Laya.Animator).play("CharacterIdle",0,0);let i=g.randomInt(1,4),s=g.randomInt(3,6);for(let t=1;t<=4;t++){e.getChildAt(t).active=t==i,a.getChildAt(t+2).active=t+2==s}let o=g.randomInt(7,12);for(let t=7;t<=12;t++){a.getChildAt(t).active=t==o}let n=g.d3_FindNodeByName(e,"Dummy_Down").getChildAt(0).getChildAt(0),l=g.d3_FindNodeByName(e,"Dummy_Up").getChildAt(0).getChildAt(0),h=[];for(let t=0;t<5;t++)h.push(g.randomInt(0,23));let d=[];for(let t=0;t<24;t++){let e=t%12,a=(t<12?l:n).getChildAt(e);-1!=h.indexOf(t)?(d.push(a),a.skinnedMeshRenderer.enable=!1):(a.skinnedMeshRenderer.enable=!0,this.toothChange(a,2))}this.headTooths.push(d)}this.player.transform.position=e,this.camPoint.transform.localPosition=this.startCamPoint.transform.localPosition.clone(),this.camPoint.transform.localRotation=this.startCamPoint.transform.localRotation.clone(),this.runMoveComp.reset(190,0),this.runMoveComp.model.transform.localPosition=new Laya.Vector3(0,0,0),this.runMoveComp.model.transform.localRotationEuler=new Laya.Vector3(0,0,0),this.itemsComp.reset();let l=3*(h.ReadToothLevel()-1);l>15&&(l=15),this.runMoveComp.isCamCtrl=!0,Laya.SoundManager.muted=!0;for(let t=0;t<l;t++)this.itemsComp.addItem();Laya.SoundManager.muted=!this.isSound,Laya.timer.frameLoop(1,this,this.gameUpdate)}gameStart(){this.isStart=!0,this.controlOn(),this.roundInit(),this.playCount++,Laya.timer.loop(16,this,this.fixUpdate),this.runMoveComp.isMove=!0}levelEnd(t){this.isEnd=!0,this.isWin=t,m.play(s.Win),Laya.timer.clear(this,this.fixUpdate),w.goOver()}roundInit(){switch(this.nowRound){case 0:break;case 1:this.runMoveComp.isCamCtrl=!1,this.runMoveComp.speedAxis=1.5,(new y).toTween(this.camPoint,{pos:this.endCamPoint.transform.localPosition.clone(),rot:this.endCamPoint.transform.localRotationEuler.clone()},1e3,()=>{},null,!0);break;case 2:let t=1+.5*this.nowHeadIndex;this.moneyCount*=t;let e=h.ReadMoneyLevel()>6?1.6:1+.1*h.ReadMoneyLevel();this.moneyCount*=e,k.instance.moneyCount=Math.floor(this.moneyCount/10),this.controlOff(),this.onMouseUp(),this.runMoveComp.isMove=!1,this.levelEnd(!0);break;default:console.log("多次触发跳关了")}}roundEnd(){this.isEnd||(this.nowRound++,this.roundInit())}gameUpdate(){Laya.timer.delta;switch(this.nowRound){case 0:this.player.transform.position.z>this.end.transform.position.z&&this.roundEnd();break;case 1:let t=this.nowHeadIndex;for(let e=this.itemsComp.items.numChildren-1;e>=0;e--){let a=this.itemsComp.items.getChildAt(e),i=this.end.getChildByName("Head").getChildAt(t);if(i.transform.position.z-a.transform.position.z<10&&t>=0&&t<this.headTooths.length){let e=i.getChildByName("ToothGrip");if(e.numChildren<5){let o=a,n=a.getComponent(x),r=o.transform.position.clone(),l=o.transform.rotation.clone();if(e.addChild(o),o.transform.position=r,o.transform.rotation=l,this.headTooths[t].length>0){let e=this.headTooths[t].splice(this.headTooths[t].length-1,1)[0];0==this.headTooths[t].length&&(this.nowHeadIndex++,m.play(s.Complete),i.getComponent(Laya.Animator).play("CharacterSmile",0,0)),n.selfTween.toTween(o,{pos:e.transform.position.clone(),rot:e.transform.rotation.clone(),sca:new Laya.Vector3(.5,.5,.5)},250,()=>{e.skinnedMeshRenderer.enable=!0,m.play(s.Fillin),this.toothChange(e,n.itemState),o.active=!1},null,!1);break}}}}0==this.itemsComp.items.numChildren&&this.roundEnd()}}fixUpdate(){{this.nowRound;let t,e,a,i=this.itemsComp.items,s=new Laya.Vector3;if(s=this.runMoveComp.model.transform.position.clone(),(a=this.colliderIndexJudge(s))>=0&&a<this.colliders.length)for(let t=0;t<this.colliders[a].length;t++){let e,i=this.colliders[a][t];for(let o=0;o<this.colliders[a][t].colliderSprite.length;o++){let n=this.colliders[a][t].colliderSprite[o];if(n&&!n.destroyed){let t=n.transform.position.clone();if((e=i.isCircle?g.CircleCheck_2D(s.z,s.x,2,t.z,t.x,i.raidus):g.BoxCheck_2D_Normal(s.z,s.x,4,4,t.z,t.x,i.range,i.width)).isHit)break}}if(e&&e.isHit){i.colliderDo();break}}for(let o=0;o<i.numChildren;o++)if((t=i.getChildAt(o))&&!t.destroyed){if(s=t.transform.position.clone(),!(e=t.getComponent(x)).colliderActive)continue;if((a=this.colliderIndexJudge(s))>=0&&a<this.colliders.length)for(let t=0;t<this.colliders[a].length;t++){let i,o=this.colliders[a][t];for(let n=0;n<this.colliders[a][t].colliderSprite.length;n++){let r=this.colliders[a][t].colliderSprite[n];if(r&&!r.destroyed){let t=r.transform.position.clone();if((i=o.isCircle?g.CircleCheck_2D(s.z,s.x,e.raidus,t.z,t.x,o.raidus):g.BoxCheck_2D_Normal(s.z,s.x,e.range,e.width,t.z,t.x,o.range,o.width)).isHit)break}}if(i&&i.isHit){o.colliderDo(e);break}}}for(let o=0;o<this.dropItemGrip.numChildren;o++){let n=this.dropItemGrip.getChildAt(o);if(n&&!n.destroyed){let o,r=n.getComponent(_),l=n.transform.position.clone(),h=this.colliderIndexJudge(l);if(s=this.runMoveComp.model.transform.position.clone(),a=this.colliderIndexJudge(s),!r.isActive&&Math.abs(h-a)<=2&&(o=g.BoxCheck_2D_Normal(s.z,s.x,4,4,l.z,l.x,4,4)).isHit){r.colliderDo();break}for(let n=0;n<i.numChildren;n++)if((t=i.getChildAt(n))&&!t.destroyed){if(s=t.transform.position.clone(),!(e=t.getComponent(x)).colliderActive)continue;if(a=this.colliderIndexJudge(s),!r.isActive&&Math.abs(h-a)<=2&&(o=g.BoxCheck_2D_Normal(s.z,s.x,4,4,l.z,l.x,4,4)).isHit){r.colliderDo();break}}}}}}colliderIndexJudge(t){return Math.floor((t.z-200)/25)}endNumberBorn(){let t=this.end.getChildByName("Head");for(let e=0;e<t.numChildren;e++){let a=t.getChildAt(e).getChildByName("ScoreTimes"),i=a.getChildByName("T"),s=a.getChildByName("First"),o=a.getChildByName("Dot"),n=a.getChildByName("Last"),r=this.numberMat[e%8].clone();r.tilingOffset=new Laya.Vector4(1,1,0,.25),i.meshRenderer.material=r.clone(),r.tilingOffset=new Laya.Vector4(1,1,.5,.25),o.meshRenderer.material=r.clone();let l=10*(1+.5*e),h=Math.floor(l/10),d=l%10;r.tilingOffset=new Laya.Vector4(1,1,h%4*.25,.25*-Math.floor(h/4)),s.meshRenderer.material=r.clone(),r.tilingOffset=new Laya.Vector4(1,1,d%4*.25,.25*-Math.floor(d/4)),n.meshRenderer.material=r.clone()}}toothChange(t,e=0){switch(e){case 0:t.skinnedMeshRenderer.material=k.instance.itemMat[0];break;case 1:t.skinnedMeshRenderer.material=k.instance.itemMat[1];break;case 2:this.bornFxDestroy("isClearFx",t,1e3),t.skinnedMeshRenderer.material=k.instance.itemMat[2];break;case 3:this.bornFxDestroy("isClearFx",t,1e3),t.skinnedMeshRenderer.material=k.instance.itemMat[3];break;case 4:this.bornFxDestroy("isClearFx",t,1e3),t.skinnedMeshRenderer.material=k.instance.itemMat[4]}k.instance.moneyCount+=e+1}controlOn(){t.on(r.singleTouchStart,this,this.onMouseDown),t.on(r.singleTouchMove,this,this.onMouseMove),t.on(r.singleTouchEnd,this,this.onMouseUp)}controlOff(){t.off(r.singleTouchStart,this,this.onMouseDown),t.off(r.singleTouchMove,this,this.onMouseMove),t.off(r.singleTouchEnd,this,this.onMouseUp)}onMouseDown(t){this.isPressed=!0,this.orignal=t.stageX/Laya.stage.width,this.runMoveComp&&this.runMoveComp.checkOut()}onMouseMove(t){if(this.isPressed){let e=t.stageX/Laya.stage.width-this.orignal;this.runMoveComp&&this.runMoveComp.checkWay(2*e)&&(this.orignal=t.stageX/Laya.stage.width)}}onMouseUp(){this.isPressed=!1,this.runMoveComp&&this.runMoveComp.checkOut()}vibrateShort(){this.isVibrate&&w.platform.vibrateShort()}soundSwitch(t){this.isSound=t,Laya.SoundManager.musicVolume=this.isSound?1:0,Laya.SoundManager.soundVolume=this.isSound?1:0}randomPlayMusic(){m.playMusic("Bgm"),Laya.timer.once(35e3,this,this.randomPlayMusic)}playBladeSound(){this.isBladeOk&&(m.play(s.Blade),this.isBladeOk=!1,Laya.timer.once(100,this,()=>{this.isBladeOk=!0}))}playGetSound(){this.isGetOk&&(m.play(s.Get),this.isGetOk=!1,Laya.timer.once(100,this,()=>{this.isGetOk=!0}))}bornStageObj(t,e=this.mainScene){let a=this.prefabs.getChildByName(t);if(!a)return console.warn("生成物体不存在",t),null;let i=Laya.Sprite3D.instantiate(a,e);return i.transform.localPosition=new Laya.Vector3,this.stageObj.push(i),i}stageObjClear(){for(let t=this.stageObj.length-1;t>=0;t--)this.stageObj[t]&&!this.stageObj[t].destroyed&&this.stageObj[t].destroy();this.stageObj=[]}bornFxDestroy(t,e,a=1e3,i=1,s=new Laya.Vector3){if(!this.isFxOn)return null;let o=this.fxs.getChildByName(t).clone();return e.addChild(o),o.transform.localPosition=s,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(i,i,i),Laya.timer.once(a,this,()=>{o.destroy()}),o}bornFxFromPool(t,e,a=1e3,i=1,s=new Laya.Vector3){let o;for(let e=this.fxPool.length-1;e>=0;e--)if(this.fxPool[e].name==t){(o=this.fxPool.splice(e,1)[0]).active=!0;break}if(!o){let e=this.fxs.getChildByName(t);o=e.clone()}return e.addChild(o),this.stageObj.push(o),o.transform.localPosition=s,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(i,i,i),Laya.timer.once(a,this,()=>{o&&!o.destroyed&&(this.mainScene.addChild(o),o.active=!1,this.fxPool.push(o))}),o}bornFxStage(t,e,a=1,i=new Laya.Vector3){let s=this.fxs.getChildByName(t).clone();return e.addChild(s),s.transform.localPosition=i,s.transform.localRotationEuler=new Laya.Vector3,s.transform.localScale=new Laya.Vector3(a,a,a),this.stageObj.push(s),s}}class P extends d{constructor(){super(...arguments),this.upgradeVideoIndex=-1}init(){this.updateUpgarde(),this.updateCoinUI(),this.stageValue.value=h.ReadGrade().toString()}initEvent(){g.d2_AddClickEvent(this.btnStart,this,this.onBtnStartClick),t.on(i.Game_Coin_Update,this,this.updateCoinUI),g.d2_AddClickEvent(this.moneyUpgardBtn,this,this.onBtnIncomMoneyClick),g.d2_AddClickEvent(this.toothUpgardBtn,this,this.onBtnToothMoneyClick)}onBtnStartClick(){w.goGame()}onBtnIncomMoneyClick(){let t=h.ReadCoin(),e=200*h.ReadMoneyLevel();t<e?0==this.upgradeVideoIndex?this.onBtnIncomVideoClick():w.platform.showToast("金币不足"):(h.AddCoin(-e),h.AddMoneyLevel(),this.updateUpgarde(),w.platform.showToast("收入升级"))}onBtnIncomVideoClick(){console.log("视频"),h.AddMoneyLevel(),this.updateUpgarde(),w.platform.showToast("收入升级")}onBtnToothMoneyClick(){let t=h.ReadCoin(),e=200*h.ReadToothLevel();if(t<e)1==this.upgradeVideoIndex?this.onBtnToothVideoClick():w.platform.showToast("金币不足");else{h.AddCoin(-e),h.AddToothLevel(),this.updateUpgarde(),w.platform.showToast("牙齿数量升级");let t=h.ReadToothLevel(),a=3*((t=t>6?6:t)-1)-k.instance.itemsComp.items.numChildren;for(let t=0;t<a;t++)k.instance.itemsComp.addItem()}}onBtnToothVideoClick(){console.log("视频"),h.AddToothLevel(),this.updateUpgarde(),w.platform.showToast("牙齿数量升级");let t=h.ReadToothLevel(),e=3*((t=t>6?6:t)-1)-k.instance.itemsComp.items.numChildren;for(let t=0;t<e;t++)k.instance.itemsComp.addItem()}updateCoinUI(){this.coinValue.value=h.ReadCoin().toString()}updateUpgarde(){let t=-1,e=h.ReadCoin(),a=h.ReadMoneyLevel(),i=200*a,s=this.moneyUpgardBtn.getChildByName("moneyicon"),o=this.moneyUpgardBtn.getChildByName("coinValue"),n=this.moneyUpgardBtn.getChildByName("level");this.moneyUpgardBtn.getChildByName("icon");o.value=i.toString(),n.value=a>=99?"99":a.toString(),e<i?(this.moneyUpgardBtn.skin="ui/game/yxjm_dk_1.png",t=0):this.moneyUpgardBtn.skin="ui/game/yxjm_dk_3.png";let r=h.ReadToothLevel(),l=200*r,d=this.toothUpgardBtn.getChildByName("moneyicon"),c=this.toothUpgardBtn.getChildByName("coinValue"),m=this.toothUpgardBtn.getChildByName("level");this.toothUpgardBtn.getChildByName("icon");c.value=l.toString(),m.value=r>=99?"99":r.toString(),e<l?(this.toothUpgardBtn.skin="ui/game/yxjm_dk_1.png",t=0==t?2:1):this.toothUpgardBtn.skin="ui/game/yxjm_dk_3.png";let y=this.moneyUpgardBtn.getChildByName("video"),u=this.toothUpgardBtn.getChildByName("video");switch(y.set_visible(!1),u.set_visible(!1),d.set_visible(!0),c.set_visible(!0),s.set_visible(!0),o.set_visible(!0),t){case-1:break;case 0:this.moneyUpgardBtn.skin="ui/game/yxjm_dk_2.png",y.set_visible(!0),s.set_visible(!1),o.set_visible(!1);break;case 1:this.toothUpgardBtn.skin="ui/game/yxjm_dk_2.png",u.set_visible(!0),d.set_visible(!1),c.set_visible(!1);break;case 2:0==(t=g.randomInt(0,1))?(this.moneyUpgardBtn.skin="ui/game/yxjm_dk_2.png",y.set_visible(!0),s.set_visible(!1),o.set_visible(!1)):(this.toothUpgardBtn.skin="ui/game/yxjm_dk_2.png",u.set_visible(!0),d.set_visible(!1),c.set_visible(!1))}this.upgradeVideoIndex=t}}class A{static toAlpha(t,e,a,i,s,o,n=!1,r=!1){function alpha1(){let e=r||n?new Laya.Handler(this,alpha2):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(t,{alpha:a},i,s,e)}function alpha2(){let a=r?new Laya.Handler(this,alpha1):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(t,{alpha:e},i,s,a)}t&&!t.destroyed&&(this.clearTween(t),t.alpha=e,alpha1())}static toScale(t,e,a,i,s,o,n=!1,r=!1){function scale1(){let e=r||n?new Laya.Handler(this,scale2):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(t,{scaleX:a,scaleY:a},i,s,e)}function scale2(){let a=r?new Laya.Handler(this,scale1):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(t,{scaleX:e,scaleY:e},i,s,a)}t&&!t.destroyed&&(this.clearTween(t),t.scale(e,e),scale1())}static toPosition(t,e,a,i,s,o=!1,n=0){if(!t||t.destroyed)return;this.clearTween(t);let r={},l={};function pos1(){if(o)var e=0==n?new Laya.Handler(this,pos2):new Laya.Handler(this,pos3);else e=new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(t,l,a,i,e)}function pos2(){Laya.Tween.to(t,r,a,i,Laya.Handler.create(this,pos1))}function pos3(){t.pos(r.x,r.y),pos1()}null!=e.x&&(r.x=t.x,l.x=e.x),null!=e.y&&(r.y=t.y,l.y=e.y),pos1()}static toRotaion(t,e,a,i,s,o=!1,n=!1){if(!t||t.destroyed)return;this.clearTween(t);let r=t.rotation,l=r+e,h=r-e+r;function rotate2(){Laya.Tween.to(t,{rotation:h},2*a,i,Laya.Handler.create(this,rotate3))}function rotate3(){Laya.Tween.to(t,{rotation:l},2*a,i,Laya.Handler.create(this,rotate2))}function rotate4(){let e=new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(t,{rotation:r},a,i,e)}!function(){let e=n?new Laya.Handler(this,rotate2):o?new Laya.Handler(this,rotate4):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(t,{rotation:l},a,i,e)}()}static showViewByScale(t,e,a=1,i=200){this.toScale(t,0,a,i,Laya.Ease.bounceOut,e,!0,!1)}static clearTween(t){Laya.Tween.clearAll(t)}}class B extends Laya.Script{onEnable(){let t=this.owner;A.toScale(t,.9,1.1,500,null,()=>{},!1,!0)}onDisable(){let t=this.owner;A.clearTween(t),t.scale(1,1)}}class D extends d{init(){Laya.timer.frameOnce(1,this,this.loadProgressUpdate)}initEvent(){t.on(i.Progress_Load_Update,this,this.loadProgressUpdate)}loadProgressUpdate(){let t=w.loadingList;0==t.length?(console.log("加载完毕"),w.goHome(),w.loadingCount=0):console.log("正在加载",t[0]),this.loadBar.value=t.length/w.loadingCount}}class V extends d{constructor(){super(...arguments),this.coinUrl="ui/game/money.png"}init(){this.updateCoinUI(),this.stageValue.value=h.ReadGrade().toString(),this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?3*k.instance.moneyCount:k.instance.moneyCount).toString(),A.toScale(this.icon,0,1,500,Laya.Ease.elasticOut)}initEvent(){this.videoCheckBox.on("change",this,()=>{this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?3*k.instance.moneyCount:k.instance.moneyCount).toString()}),g.d2_AddClickEvent(this.btnContinue,this,this.onBtnContinueClick)}onBtnContinueClick(){this.btnContinue.offAllCaller(this);let t=this,e=()=>{h.AddCoin(t.videoCheckBox.selected?3*k.instance.moneyCount:k.instance.moneyCount),t.updateCoinUI(),m.play(s.GetMoney),g.d2_coinCollectAnim(this.coinUrl,new Laya.Vector2(t.btnContinue.x,t.btnContinue.y),new Laya.Vector2(t.coinValue.x,t.coinValue.y),t.scene,10,1,()=>{w.game.isWin&&h.AddGrade(),w.goHome()})};this.videoCheckBox,e()}updateCoinUI(){this.coinValue.value=h.ReadCoin().toString()}}class I{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("Main/Scenes/Game.ts",c),t("Tools/ctrl/TouchCtrl.ts",f),t("Tools/ctrl/TouchScan.ts",p),t("Main/Scenes/Home.ts",P),t("Tools/uiTween/ScaleUITween.ts",B),t("Main/Scenes/Load.ts",D),t("Main/Scenes/Over.ts",V)}}I.width=750,I.height=1334,I.scaleMode="fixedwidth",I.screenMode="vertical",I.alignV="middle",I.alignH="center",I.startScene="scenes/Game.scene",I.sceneRoot="",I.debug=!1,I.stat=!1,I.physicsDebug=!1,I.exportSceneToJson=!0,I.init();new class{constructor(){window.Laya3D?Laya3D.init(I.width,I.height):Laya.init(I.width,I.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=I.scaleMode,Laya.stage.screenMode=I.screenMode,Laya.stage.alignV=I.alignV,Laya.stage.alignH=I.alignH,Laya.URL.exportSceneToJson=I.exportSceneToJson,(I.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),I.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),I.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){w.init(new k)}}}();