!function(){"use strict";class e{static on(e,t,a){this.eventDispatcher.on(e,t,a)}static event(e,t){this.eventDispatcher.event(e,t)}static off(e,t,a){this.eventDispatcher.off(e,t,a)}static offAllCaller(e){this.eventDispatcher.offAllCaller(e)}}var t,a,o,i,s,n,r,l,h;e.eventDispatcher=new Laya.EventDispatcher,function(e){e.Load="scenes/Load.scene",e.Home="scenes/Home.scene",e.Game="scenes/Game.scene",e.Over="scenes/Over.scene"}(t||(t={})),function(e){e.SubPackage="分包",e.Scene3D="3D场景"}(a||(a={})),function(e){e.Scene_GoHome="Scene_GoHome",e.Scene_GoGame="Scene_GoGame",e.Scene_GoOver="Scene_GoOver",e.Progress_Load_Update="Progress_Load_Update",e.Platform_Wake_Do="Platform_Wake_Do",e.Platform_Hide_Do="Platform_Hide_Do",e.Game_Coin_Update="Game_Coin_Update",e.Game_Sold_Event="Game_Sold_Event",e.Home_ShowEndShop_Event="Home_ShowEndShop_Event",e.Home_CloseEndShop_Event="Home_CloseEndShop_Event"}(o||(o={})),function(e){e.Bgm="Bgm",e.Button="Button",e.Get="Get",e.Pusher="Pusher",e.Lose="Lose",e.LaserDoor="LaserDoor",e.Upgrade="Upgrade",e.Gate="Gate",e.Water="Water",e.Sell="Sell",e.Slot="Slot",e.Throw="Throw",e.Cheer="Cheer",e.RaiseMoney="RaiseMoney",e.Win="Win",e.Unclock="Unclock",e.GetMoney="GetMoney"}(i||(i={})),function(e){e.Stone="Stone"}(s||(s={})),function(e){e[e.Stone=0]="Stone",e[e.Gem=1]="Gem",e[e.Diamond=2]="Diamond",e[e.Jewelry=3]="Jewelry"}(n||(n={})),function(e){e.Stone="Stone",e.Obs_1="Obs_1",e.Obs_2="Obs_2",e.Obs_3="Obs_3",e.Pusher="Pusher",e.Door_Laser="Door_Laser",e.Jewelry="Jewelry",e.Pool="Pool",e.Door_Upgarde="Door_Upgarde",e.Door_Check="Door_Check",e.Door_Sold="Door_Sold"}(r||(r={})),function(e){e.Ring="Ring",e.Earring="Earring",e.Bracelet="Bracelet"}(l||(l={}));class d{constructor(){this.isSubPackage=!0,this.isVibrate=!0}init(){d.instance=this}loadSubPackage(e,t){if(this.platformApi&&this.isSubPackage){this.platformApi.loadSubpackage({name:e,success:function(a){console.log("分包加载成功：",e),t.call(!0,a)},fail:function(a){console.error("分包加载失败：",e,JSON.stringify(a)),t.call(!1,a)}})}else console.log("没有平台API"),t(!0)}showToast(e,t=1e3){console.log(e,t.toString()+"ms")}vibrateShort(){this.platformApi&&this.isVibrate&&this.platformApi.vibrateShort()}vibrateLong(){this.platformApi&&this.isVibrate&&this.platformApi.vibrateLong()}regisiterCallback(){this.platformApi&&(this.platformApi.offShow(this.onShowEvent),this.platformApi.onShow(this.onShowEvent),this.platformApi.offHide(this.onHideEvent),this.platformApi.onHide(this.onHideEvent))}onShowEvent(t){e.event(o.Platform_Wake_Do,t)}onHideEvent(t){e.event(o.Platform_Hide_Do,t)}showVideo(e,t){this.showToast("无视频，默认发放奖励"),e&&e()}}class c{static AddGrade(){let e=this.GetPlayerData();e.grade++,parseInt(e.grade)>99&&(e.grade=99),this.SavePlayerData(e)}static ReadGrade(){let e=this.GetPlayerData();return parseInt(e.grade)}static AddCoin(t){let a=this.GetPlayerData();a.coin+=t,a.coin>99999&&(a.coin=99999),Math.floor(a.coin),this.SavePlayerData(a),e.event(o.Game_Coin_Update)}static ReadCoin(){let e=this.GetPlayerData();return Math.floor(e.coin)}static ReadStoreLevel(){return this.GetPlayerData().storeLevel}static AddStoreLevel(e){let t=this.GetPlayerData();t.storeLevel[e]++,this.SavePlayerData(t)}static ReadHighScore(){return this.GetPlayerData().highScore}static WriteHighScore(e){let t=this.GetPlayerData();e>t.highScore?(t.highScore=e,this.SavePlayerData(t)):d.instance.showToast("输入值"+e.toString()+"不是最高分最高分是"+t.highScore)}static GetPlayerData(){let e;return(e=Laya.LocalStorage.getJSON("PlayerData"))||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),e)}static SavePlayerData(e){Laya.LocalStorage.setJSON("PlayerData",e)}static ClearPlayerData(){Laya.LocalStorage.clear()}static CheckPlayerData(){let e;(e=Laya.LocalStorage.getJSON("PlayerData"))&&e.ver&&e.ver==this.data.ver||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),console.log("触发存档重置条件"))}}c.data={ver:"DiamondRun_0.4.0",grade:1,coin:200,storeLevel:[0,0,0,0,0,0],highScore:0};class y extends Laya.Scene{onAwake(){this.size(Laya.stage.width,Laya.stage.height),this.init(),this.initEvent()}onClosed(){e.offAllCaller(this),Laya.timer.clearAll(this)}init(){}initEvent(){}}class m extends y{init(){m.instance=this,this.updateCoinUI(),this.stageValue.value=c.ReadGrade().toString()}initEvent(){e.on(o.Game_Coin_Update,this,this.updateCoinUI)}updateCoinUI(){this.coinValue.value=c.ReadCoin().toString()}}class g{static init(){for(var t in this._soundCtx={},this._soundFile=[],this.loopSounds=[],i){let e=i[t];this._soundFile.push(e)}console.log("音效：",this._soundFile);let a=this._pathRoot,s="",n=this._soundFile,r=this._soundFile.length;for(let e=0;e<r;++e){s=n[e];let t=new Laya.SoundChannel;t.url=a+s+this.soundType,Laya.SoundManager.addChannel(t),this._soundCtx[s]=!0}Laya.SoundManager.autoStopMusic=!0,e.on(o.Platform_Wake_Do,this,this.randomPlayMusic),this.randomPlayMusic()}static setSoundVolume(e,t){this._soundCtx[e]&&Laya.SoundManager.setSoundVolume(t,this._pathRoot+e+this.soundType)}static play(e,t=!1){if(this._soundCtx[e])return t&&-1==this.loopSounds.indexOf(e)?(this.loopSounds.push(e),Laya.SoundManager.playSound(this._pathRoot+e+this.soundType,0)):Laya.SoundManager.playSound(this._pathRoot+e+this.soundType)}static stop(e,t=!1){if(this._soundCtx[e]){if(t){let t=this.loopSounds.indexOf(e);-1!=t&&this.loopSounds.splice(t,1)}Laya.SoundManager.stopSound(this._pathRoot+e+this.soundType)}}static playMusic(e){let t;return Laya.SoundManager.stopMusic(),e?(t=Laya.SoundManager.playMusic(this._pathRoot+e+this.soundType,0),this.currentBgm=e):t=this.currentBgm?Laya.SoundManager.playMusic(this._pathRoot+this.currentBgm+this.soundType,0):Laya.SoundManager.playMusic(this._pathRoot+i.Bgm+this.soundType,0),t}static stopMusic(){Laya.SoundManager.stopMusic()}static randomPlayMusic(){let e=i.Bgm;g.playMusic(e);Laya.timer.once(29e3,this,this.randomPlayMusic)}static soundSwitch(e){this.isSound=e,Laya.SoundManager.soundMuted=!this.isSound}static muiscSwitch(e){this.isMusic=e,Laya.SoundManager.musicMuted=!this.isMusic}static playSoundLimit(e){let t=!0;if(this.CDs[e]&&0!=this.CDs[e]&&(t=!1),t){let t=this.play(e);t&&(this.CDs[e]=200*t.duration),Laya.timer.once(this.CDs[e],this,()=>{this.CDs[e]=0})}}}g._pathRoot="res/sounds/",g.soundType=".mp3",g.isSound=!0,g.isMusic=!0,g.CDs={};class u{static add(e,t){var a=new Laya.Vector3;return Laya.Vector3.add(e,t,a),a.clone()}static subtract(e,t){var a=new Laya.Vector3;return Laya.Vector3.subtract(e,t,a),a.clone()}static mull(e,t){var a=new Laya.Vector3;return Laya.Vector3.scale(e,t,a),a.clone()}static dot(e,t){return Laya.Vector3.dot(e,t)}static cross(e,t){var a=new Laya.Vector3;return Laya.Vector3.cross(e,t,a),a.clone()}static normalized(e){var t=new Laya.Vector3;return Laya.Vector3.normalize(e,t),t.clone()}static distance(e,t){var a=u.subtract(e,t);return Laya.Vector3.scalarLength(a)}}class p{static d3_getSpritePosBySprite3DPoint(e,t,a=new Laya.Vector3(0,0,0)){var o=t.transform.position.clone();o.x+=a.x,o.y+=a.y,o.z+=a.z;var i=new Laya.Vector4;e.viewport.project(o,e.projectionViewMatrix,i);var s=new Laya.Vector2(i.x/Laya.stage.clientScaleX,i.y/Laya.stage.clientScaleY);return new Laya.Point(s.x,s.y)}static d3_FindNodeByName(e,t){let a=null,o=e=>{for(let i=0;i<e.numChildren;i++){if(e.getChildAt(i).name==t)return void(a=e.getChildAt(i));o(e.getChildAt(i))}};return o(e),a}static d3_FindNodeHasName(e,t){let a=null,o=e=>{for(let i=0;i<e.numChildren;i++){if(-1!=e.getChildAt(i).name.indexOf(t))return void(a=e.getChildAt(i));o(e.getChildAt(i))}};return o(e),a}static d3_switchAllMathInChildren(e,t){if(e.meshRenderer){let a=e.meshRenderer.material.clone();a.albedoColor=p.d3_getRgbByHex(t),e.meshRenderer.material=a}for(let a=0;a<e.numChildren;a++){let o=e.getChildAt(a);if(o.meshRenderer){let e=new Laya.BlinnPhongMaterial,a=p.d3_getRgbByHex(t);e.albedoColor=new Laya.Vector4(a.x,a.y,a.z,1),e.specularColor=new Laya.Vector4(0,0,0,1),o.meshRenderer.material=e}this.d3_switchAllMathInChildren(o,t)}}static d3_unactiveAllChildren(e){for(let t=0;t<e.numChildren;t++)e.getChildAt(t).active=!1}static d3_addChildNotMove(e,t){let a=e.transform.position.clone(),o=e.transform.rotation.clone();t.addChild(e),e.transform.position=a,e.transform.rotation=o}static d3_getRgbByHex(e){var t=[],a=[];let o=e.replace(/#/,"");if(3==o.length){for(var i=[],s=0;s<3;s++)i.push(o.charAt(s)+o.charAt(s));o=i.join("")}for(s=0;s<3;s++)t[s]="0x"+o.substr(2*s,2),a.push(parseInt(t[s]));return new Laya.Vector4(a[0]/255,a[1]/255,a[2]/255,0)}static d3_objectShake(e,t=1,a=.7){var o=t,i=1,s=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(o>0){var t=new Laya.Vector3;Laya.Vector3.scale((n=Math.random()>.5?Math.random():-Math.random(),r=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(n,r,0)),a,t),Laya.Vector3.add(s,t,t),e.transform.localPosition=t,o-=.02*i}else o=0,e.transform.localPosition=s,Laya.timer.clear(this,updateShake);var n,r})}static getAngle(e,t){var a=Laya.Vector3.dot(e,t),o=Laya.Vector3.scalarLength(e)*Laya.Vector3.scalarLength(t);if(0==o){if(e.z>t.z)return 0;if(e.z<t.z)return 180;if(e.y>t.y)return 90;if(e.y<t.y)return-90}var i=a/o;return i<-1&&(i=-1),i>1&&(i=1),180*Math.acos(i)/Math.PI}static getAngleUp(e,t,a){let o=p.getAngle(e,t),i=new Laya.Vector3;return Laya.Vector3.cross(t,e,i),p.getAngle(a,i)>90&&(o*=-1),o}static getProjection(e,t){let a=u.mull(t,u.dot(e,t));return u.subtract(e,a)}static d2_AddClickEvent(e,t,a,o,s=!1,n=!0,r=!0){e.offAllCaller(t);let l=e.scaleX,h=.9*l,d=!1;e.on(Laya.Event.MOUSE_DOWN,t,t=>{d=!0,r&&Laya.Tween.to(e,{scaleX:h,scaleY:h},60),s&&t.stopPropagation},o);e.on(Laya.Event.MOUSE_UP,t,o=>{0!=d&&(d=!1,s&&o.stopPropagation,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),a&&a.call(t,o),n&&g.play(i.Button))},o);e.on(Laya.Event.MOUSE_OUT,t,t=>{0!=d&&(d=!1,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),s&&t.stopPropagation)},o)}static getAngle2DWay(e,t){var a=Laya.Vector2.dot(e,t),o=Laya.Vector2.scalarLength(e)*Laya.Vector2.scalarLength(t),i=180*Math.acos(a/o)/Math.PI,s=e.x*t.y-t.x*e.y;return s>0?i*=1:s<0?i*=-1:i=0,i}static d2_coinCollectAnim(e,t,a,o,i=15,s=1,n=null,r=null){for(var l=i,h=0;h<i;h++){let i=Laya.Pool.getItemByClass("coin",Laya.Image);i.skin=e,i.x=t.x,i.y=t.y,i.scale(s,s),o.addChild(i);let h=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},h),Laya.timer.once(h+50,this,function(){Laya.Tween.to(i,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){o.removeChild(i),Laya.Pool.recover("coin",i),l--,r&&r(),0==l&&n&&n(o)}))})}}static d2_coinCollectAnimAni(e,t,a,o,i=15,s=null){for(var n=i,r=0;r<i;r++){let i=Laya.Pool.getItemByClass("coinAnim",Laya.Clip);i.skin=e.skin,i.index=e.index,i.clipX=e.clipX,i.clipY=e.clipY,i.autoPlay=e.autoPlay,i.x=t.x,i.y=t.y,i.scale(.8,.8),o.addChild(i);let r=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(i,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){o.removeChild(i),Laya.Pool.recover("coinAnim",i),0==--n&&s&&s(o)}))})}}static faceToast(e,t,a,o){let i=new Laya.Image(e);i.anchorX=.5,i.anchorY=.5,i.alpha=1,i.scaleX=.3,i.scaleY=.3,t.addChild(i),i.x=a.x,i.y=a.y,Laya.Tween.to(i,{x:o.x,y:o.y,alpha:.9},1e3,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{i&&!i.destroyed&&Laya.Tween.to(i,{x:o.x,y:o.y-100,alpha:0},1e3,null,Laya.Handler.create(this,()=>{i&&!i.destroyed&&i.destroy()}))}))}static d2_fontClipToast(e,t,a,o,i){if(!this.wordToastOk)return;let s=Laya.Pool.getItemByClass("fontClip_d2",Laya.FontClip);s.skin=e,s.sheet="0123456789",s.value=t,s.anchorX=.5,s.anchorY=.5,s.alpha=1,s.scaleX=o,s.scaleY=o,a.addChild(s),s.x=i.x,s.y=i.y;let n=new Laya.Vector2(i.x+(p.halfPercent()?p.randomInt(-100,-75):p.randomInt(75,100)),i.y-50);Laya.Tween.to(s,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(s,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{a.removeChild(s),Laya.Pool.recover("fontClip_d2",s)}))}))}static d2_imageToast(e,t,a){if(!this.wordToastOk)return;p.wordToastOk=!1;let o=new Laya.Image(e);o.anchorX=.5,o.anchorY=.5,o.alpha=1,t.addChild(o),o.top=300,o.centerX=0;o.scaleX=0,o.scaleY=0,Laya.Tween.to(o,{scaleX:1,scaleY:1},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{p.wordToastOk=!0,o&&!o.destroyed&&Laya.Tween.to(o,{top:200,alpha:0},500,null,Laya.Handler.create(this,()=>{o&&!o.destroyed&&o.destroy()}))}))}static d2_labelToast(e,t,a,o,i){let s=Laya.Pool.getItemByClass("label_d2",Laya.Label);s.text=e,s.color=t,s.anchorX=.5,s.anchorY=.5,s.alpha=1,s.scaleX=o,s.scaleY=o,s.font="Microsoft YaHei",s.fontSize=50,s.bold=!0,a.addChild(s),s.x=i.x,s.y=i.y;let n=new Laya.Vector2(i.x+(p.halfPercent()?p.randomInt(-100,-75):p.randomInt(75,100)),i.y-50);Laya.Tween.to(s,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(s,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{a.removeChild(s),Laya.Pool.recover("label_d2",s)}))}))}static clamp01(e){return e>1?1:e<0?0:e}static clamp(e,t,a){return e<t?t:e>a?a:e}static get getCurrentTime(){return(new Date).getTime()}static get getCurrentTime_Second(){return Math.floor(Date.parse((new Date).toString())/1e3)}static math_gcd(e,t){return 0==t?e:this.math_gcd(t,e%t)}static numberTo(e,t,a){return Math.abs(t-e)<a?e=t:e<t?e+=a:e>t&&(e-=a),e}static randomNumber(e,t){return e+(t-e)*Math.random()}static randomInt(e,t){return Math.floor(e+(t+1-e)*Math.random())}static halfPercent(){return Math.random()<.5}static percent(e){return Math.random()<e}static cloneArray(e){return[].concat(e)}static getRandomInArray(e){if(e.length){let t=Math.random()*e.length;return e[t=Math.floor(t)]}return console.error("传入错误参数,返回空"),null}static takeRandomInArray(e){if(e.length){let t=Math.random()*e.length,a=e[t=Math.floor(t)];return e.splice(t,1),a}return console.error("传入错误参数,返回空"),null}static randomArray(e){let t=new Array(e.length),a=t.length;for(let o=0;o<a;o++){let a=this.takeRandomInArray(e);t[o]=a}return t}static BoxCheck_2D_Normal(e,t,a,o,i,s,n,r){let l=i-e,h=s-t,d=Math.abs(h),c=Math.abs(l),y=(o+r)/2,m=(a+n)/2;return{isHit:d<y&&c<m,axisDis:c,axisRange:m,horizontalDis:d,horizontalRange:y,axisWay:l,horizontalWay:h}}static CircleCheck_2D(e,t,a,o,i,s){let n=Math.pow(e-o,2)+Math.pow(t-i,2),r=Math.pow(a+s,2);return{isHit:n<r,distancePow2:n,rangePow2:r}}}p.wordToastOk=!0,function(e){e.start="touchStart",e.move="touchMove",e.end="touchEnd",e.getAxis="GetAxis",e.slideWay="slideWay",e.singleTouchStart="singleTouchStart",e.singleTouchMove="singleTouchMove",e.singleTouchEnd="singleTouchEnd",e.secondTouchStart="secondTouchStart",e.secondTouchMove="secondTouchMove",e.secondTouchEnd="secondTouchEnd",e.getAxisAlways="getAxisAlways",e.keyDown="keyDown"}(h||(h={}));class f extends Laya.Script{constructor(){super(...arguments),this.isPressed=!1,this.hOriginal=0,this.vOriginal=0,this.hAxis=0,this.vAxis=0,this.outAxis=0,this.touchId=-1}onEnable(){f.instance=this}onMouseDown(t){e.event(h.start,[t])}onMouseMove(t){e.event(h.move,[t])}onMouseOut(t){e.event(h.end,[t])}onMouseOver(t){e.event(h.end,[t])}onMouseUp(t){e.event(h.end,[t])}}class C extends Laya.Script{constructor(){super(...arguments),this.calls=[],this.firstId=-1,this.secondId=-1,this.firstOriginalPoint=new Laya.Vector2,this.secondOriginalPoint=new Laya.Vector2,this.isSecond=!1,this.orignalHorizontal=0,this.orignalAxis=0,this.orignalHorizontalAlways=0,this.orignalAxisAlways=0,this.offset=new Laya.Vector3}onEnable(){e.on(h.start,this,this.onMouseDown),e.on(h.move,this,this.onMouseMove),e.on(h.end,this,this.onMouseUp)}onDisable(){e.off(h.start,this,this.onMouseDown),e.off(h.move,this,this.onMouseMove),e.off(h.end,this,this.onMouseUp)}onMouseDown(t){0==this.isSecond?-1==this.firstId?(this.checkOut(t),this.firstId=t.touchId,e.event(h.singleTouchStart,t),this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):this.firstId!=t.touchId&&-1==this.secondId&&(this.secondId=t.touchId,this.isSecond=!0,e.event(h.secondTouchStart,t),this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):-1==this.firstId?(this.firstId=t.touchId,this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):-1==this.secondId&&(this.secondId=t.touchId,this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),this.checkOutAlways(t)}onMouseMove(t){if(0==this.isSecond)t.touchId==this.firstId&&(this.checkWay(t),this.checkOut(t),e.event(h.singleTouchMove,t));else if(-1!=this.firstId&&-1!=this.secondId){let a,o={distance:0,angle:0},i=this.Vector2Reduce(this.secondOriginalPoint,this.firstOriginalPoint),s=Laya.Vector2.scalarLength(i);if(t.touchId==this.firstId?a=this.Vector2Reduce(this.secondOriginalPoint,new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)):t.touchId==this.secondId&&(a=this.Vector2Reduce(new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height),this.firstOriginalPoint)),a){let t=Laya.Vector2.scalarLength(a);o.distance=t-s,o.angle=p.getAngle2DWay(i,a),e.event(h.secondTouchMove,o)}}t.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),t.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),this.checkWayAlways(t)}onMouseUp(t){this.checkOutAlways(t),t.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),t.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(t.stageX/Laya.stage.width,t.stageY/Laya.stage.height)),0==this.isSecond?t.touchId==this.firstId&&(this.checkOut(t),e.event(h.singleTouchEnd,t),this.firstId=-1):(t.touchId==this.firstId&&(this.firstId=-1),t.touchId==this.secondId&&(this.secondId=-1),-1==this.firstId&&-1==this.secondId&&(this.isSecond=!1))}WayCheck(){let e=this.Vector2Reduce(this.nowPos,this.startPos);if(Laya.Vector2.scalarLength(e)>100){let t=Math.atan2(e.y,e.x)/Math.PI*180,a="none";t>-135&&t<-45?a="up":t>-45&&t<45?a="right":t<135&&t>45?a="down":(t<-135||t>135)&&(a="left"),this.isDown=!1}this.startPos=this.nowPos}onDestroy(){this.touchTimer&&clearTimeout(this.touchTimer)}checkWay(t){let a=t.stageX-this.orignalHorizontal,o=t.stageY-this.orignalAxis;e.event(h.getAxis,[{x:a,y:o}])}checkOut(e){this.orignalHorizontal=e.stageX,this.orignalAxis=e.stageY}checkWayAlways(t){let a=t.stageX/Laya.stage.width-this.orignalHorizontalAlways,o=t.stageY/Laya.stage.height-this.orignalAxisAlways;this.checkOutAlways(t),e.event(h.getAxisAlways,[{x:a,y:o}])}checkOutAlways(e){this.orignalHorizontalAlways=e.stageX/Laya.stage.width,this.orignalAxisAlways=e.stageY/Laya.stage.height}modelRotateControlDown(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);this.startPosition=e.clone(),this.prePosition=e.clone()}modelRotateControlMove(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);Laya.Vector3.subtract(e,this.prePosition,this.offset),this.prePosition=e.clone();var t=new Laya.Vector3(this.offset.x,this.offset.y,0);let a=new Laya.Vector3;Laya.Vector3.cross(t,new Laya.Vector3(0,0,1),a),Laya.Vector3.normalize(a,a)}modelRotateControlUp(){new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0)}onKeyDown(t){e.event(h.keyDown,t)}Vector2Reduce(e,t){return new Laya.Vector2(e.x-t.x,e.y-t.y)}}class L extends y{init(){this.updateCoinUI(),this.stageValue.value=c.ReadGrade().toString()}initEvent(){p.d2_AddClickEvent(this.btnStart,this,this.onBtnStartClick),p.d2_AddClickEvent(this.endShopBtn,this,this.onBtnEndShopClick),e.on(o.Game_Coin_Update,this,this.updateCoinUI),e.on(o.Home_CloseEndShop_Event,this,()=>{this.mainPanel.set_visible(!0)})}onBtnStartClick(){e.event(o.Scene_GoGame)}onBtnEndShopClick(){e.event(o.Home_ShowEndShop_Event,this.endSoldPanel),this.mainPanel.set_visible(!1)}updateCoinUI(){this.coinValue.value=c.ReadCoin().toString()}}class w{static addLoadRes(e){this.loadingList.push(e),this.loadingCount++}static removeLoadRes(t){let a=this.loadingList.indexOf(t);-1==a?console.log("完成了不存在的资源加载"):this.loadingList.splice(a,1),e.event(o.Progress_Load_Update)}}w.loadingList=[],w.loadingCount=0;class S extends y{init(){Laya.timer.frameOnce(1,this,this.loadProgressUpdate)}initEvent(){e.on(o.Progress_Load_Update,this,this.loadProgressUpdate)}loadProgressUpdate(){let t=w.loadingList;0==t.length?(console.log("加载完毕"),e.event(o.Scene_GoHome)):console.log("正在加载",t[0]),this.loadBar.value=(w.loadingCount-t.length)/w.loadingCount}}class v{static toAlpha(e,t,a,o,i,s,n=!1,r=!1){function alpha1(){let t=r||n?new Laya.Handler(this,alpha2):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(e,{alpha:a},o,i,t)}function alpha2(){let a=r?new Laya.Handler(this,alpha1):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(e,{alpha:t},o,i,a)}e&&!e.destroyed&&(this.clearTween(e),e.alpha=t,alpha1())}static toScale(e,t,a,o,i,s,n=!1,r=!1){function scale1(){let t=r||n?new Laya.Handler(this,scale2):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(e,{scaleX:a,scaleY:a},o,i,t)}function scale2(){let a=r?new Laya.Handler(this,scale1):new Laya.Handler(this,()=>{s&&s(),s=null});Laya.Tween.to(e,{scaleX:t,scaleY:t},o,i,a)}e&&!e.destroyed&&(this.clearTween(e),e.scale(t,t),scale1())}static toPosition(e,t,a,o,i,s=!1,n=0){if(!e||e.destroyed)return;this.clearTween(e);let r={},l={};function pos1(){if(s)var t=0==n?new Laya.Handler(this,pos2):new Laya.Handler(this,pos3);else t=new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,l,a,o,t)}function pos2(){Laya.Tween.to(e,r,a,o,Laya.Handler.create(this,pos1))}function pos3(){e.pos(r.x,r.y),pos1()}null!=t.x&&(r.x=e.x,l.x=t.x),null!=t.y&&(r.y=e.y,l.y=t.y),pos1()}static toRotaion(e,t,a,o,i,s=!1,n=!1){if(!e||e.destroyed)return;this.clearTween(e);let r=e.rotation,l=r+t,h=r-t+r;function rotate2(){Laya.Tween.to(e,{rotation:h},2*a,o,Laya.Handler.create(this,rotate3))}function rotate3(){Laya.Tween.to(e,{rotation:l},2*a,o,Laya.Handler.create(this,rotate2))}function rotate4(){let t=new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,{rotation:r},a,o,t)}!function(){let t=n?new Laya.Handler(this,rotate2):s?new Laya.Handler(this,rotate4):new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,{rotation:l},a,o,t)}()}static showViewByScale(e,t,a=1,o=200){this.toScale(e,0,a,o,Laya.Ease.bounceOut,t,!0,!1)}static clearTween(e){Laya.Tween.clearAll(e)}}class b{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(e){return Math.round(10*e)}toTween(e,t,a,o,i,s=!0){if(this.target=e,this.isLocal=s,e&&!e.destroyed){var n={},r={};if(t.pos){var l=s?e.transform.localPosition.clone():e.transform.position.clone();n.posX=l.x,n.posY=l.y,n.posZ=l.z,r.posX=t.pos.x,r.posY=t.pos.y,r.posZ=t.pos.z}if(t.rot){var h=s?e.transform.localRotation.clone():e.transform.rotation.clone();n.rotX=h.x,n.rotY=h.y,n.rotZ=h.z,n.rotW=h.w,r.rotX=t.rot.x,r.rotY=t.rot.y,r.rotZ=t.rot.z,r.rotW=t.rot.w}if(t.sca){var d=e.transform.getWorldLossyScale().clone();n.scaX=d.x,n.scaY=d.y,n.scaZ=d.z,r.scaX=t.sca.x,r.scaY=t.sca.y,r.scaZ=t.sca.z}this.tween.to(n,{posX:r.posX,posY:r.posY,posZ:r.posZ,rotX:r.rotX,rotY:r.rotY,rotZ:r.rotZ,rotW:r.rotW,scaX:r.scaX,scaY:r.scaY,scaZ:r.scaZ},a,i,Laya.Handler.create(this,()=>{o&&o();var t=this.tweens.shift();e&&!e.destroyed&&(t?this.toTween(this.target,t.value,t.time,t.completeFun,i):this.updateTweenCallback&&(this.updateTweenCallback=null))}));var c=0;return this.tween.update=new Laya.Handler(this,()=>{if(!e||e.destroyed)return;let o=(c+=Laya.timer.delta)/a;o>1&&(o=1),t.pos&&(s?e.transform.localPosition=new Laya.Vector3(n.posX,n.posY,n.posZ):e.transform.position=new Laya.Vector3(n.posX,n.posY,n.posZ)),t.rot&&(s?e.transform.localRotation=new Laya.Quaternion(n.rotX,n.rotY,n.rotZ,n.rotW):e.transform.rotation=new Laya.Quaternion(n.rotX,n.rotY,n.rotZ,n.rotW)),t.sca&&e.transform.setWorldLossyScale(new Laya.Vector3(n.scaX,n.scaY,n.scaZ)),this.updateTweenCallback&&this.updateTweenCallback(o)}),this}}clearTween(e){this.tweens=[],this.tween.clear(),this.target&&e&&(e.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z):this.target.transform.position=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z)),e.rot&&(this.target.transform.rotation=new Laya.Quaternion(e.rot.x,e.rot.y,e.rot.z,e.rot.w)),e.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(e.sca.x,e.sca.y,e.sca.z)))}then(e,t,a){return this.tweens.push({value:e,time:t,completeFun:a}),this}toScaleTween(e,t,a,o,i,s=Laya.Ease.elasticOut){e&&!e.destroyed&&(e.transform.localScale=t,this.toTween(e,{sca:a},o,i,s))}}class x extends Laya.Script3D{onAwake(){this.self=this.owner,this.selfTween=new b,this.init()}init(...e){}onDestroy(){Laya.timer.clearAll(this),this.selfTween.clearTween(),e.offAllCaller(this)}tweenBornDo(){let e=this.selfTween;e.clearTween(),this.self.transform.localScale=new Laya.Vector3(0,0,0),e.toTween(this.self,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut)}}class P extends x{constructor(){super(...arguments),this.forwardSpeed_Data=.2,this.speedAxis=1,this.isCamCtrl=!0,this.axis=0,this.horizontal=0,this.isMove=!1,this.modelMoveRange=1.3,this.camPointMoveRange=.75,this.forwardSpeed=0,this.horizontalSensity=.12,this.forwardSensity=.15,this.wayAxis=0,this.targetHorizontal=0,this.inHorizontal=0}init(){P.instance=this,this.player=this.self,this.model=this.player.getChildByName("Model"),this.camPoint=this.player.getChildByName("CamPoint"),this.startCamPoint=this.player.getChildByName("CamStartPoint"),this.endCamPoint=this.player.getChildByName("CamEndPoint"),this.finalCamPoint=this.player.getChildByName("CamFinalPoint"),this.forwardSpeed=this.forwardSpeed_Data}reset(e,t){this.axis=e,this.horizontal=t,this.targetHorizontal=t,this.speedAxis=1;let a=this.player.transform.localPosition.clone();a.z=this.axis,this.player.transform.localPosition=a;let o=this.model.transform.localPosition.clone();o.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=o;let i=this.camPoint.transform.localPosition.clone();i.x=-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=i}onUpdate(){let e=Laya.timer.delta/16;this.forwardSpeed>=0?this.isMove&&(this.axis+=this.forwardSpeed*this.forwardSensity*e*this.speedAxis):this.forwardSpeed<0&&(this.axis+=this.forwardSpeed*this.forwardSensity*e*this.speedAxis),this.wayAxis=this.targetHorizontal-this.horizontal,this.horizontal+=this.wayAxis*this.horizontalSensity*e;let t=this.player.transform.localPosition.clone();t.z=this.axis,this.isMove&&(this.player.transform.localPosition=t);let a=this.model.transform.localPosition.clone();if(a.x=-this.modelMoveRange*this.horizontal,this.model.transform.localPosition=a,this.isCamCtrl){let e=this.camPoint.transform.localPosition.clone();e.x=this.startCamPoint.transform.localPosition.x-this.camPointMoveRange*this.horizontal,this.camPoint.transform.localPosition=e}}checkWay(e){let t=!1;return this.targetHorizontal=this.inHorizontal+e,this.targetHorizontal>.5?(this.targetHorizontal=.5,this.checkOut(),t=!0):this.targetHorizontal<-.5&&(this.targetHorizontal=-.5,this.checkOut(),t=!0),t}checkOut(){this.inHorizontal=this.targetHorizontal}Hit(){this.forwardSpeed=-.5,Laya.timer.frameLoop(1,this,this.HitUpdate)}HitUpdate(){this.forwardSpeed+=.03*Laya.timer.delta/16,this.forwardSpeed>=this.forwardSpeed_Data&&(Laya.timer.clear(this,this.HitUpdate),this.forwardSpeed=this.forwardSpeed_Data)}onDisable(){}}class M{static d2_numberLabelToast(e,t){let a=e>=0?this.greenColor:this.redColor,o=e>=0?"+":"-",i=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,t,new Laya.Vector3(0,.2,0));p.d2_labelToast(o+e+"$",a,Laya.stage,1,new Laya.Vector2(i.x,i.y))}static valueDeal(e){let t=0;t=3==e.itemState?30:10*(e.itemState+1);let a=e.diamondLevel-1;if(a<0&&(a=0),t+=10*a,3==e.itemState)switch(e.jewelryType){case l.Ring:t+=20;break;case l.Earring:t+=30;break;case l.Bracelet:t+=40}return e.isReal&&(t+=20),t+=10*e.isCleanState}}M.itemSize=.25,M.realItemPrecent=.8,M.endShopCost=[200,1800,5e3,9e3,15e3,25e3],M.greenColor="#00FF00",M.redColor="#FF0000";class _{static bornStageObj(e,t=this.mainScene){let a=this.prefabs.getChildByName(e);if(!a)return console.warn("生成物体不存在",e),null;let o=Laya.Sprite3D.instantiate(a,t);return o.transform.localPosition=new Laya.Vector3,this.stageObj.push(o),this.fxPool=[],o}static stageObjClear(){for(let e=this.stageObj.length-1;e>=0;e--)this.stageObj[e]&&!this.stageObj[e].destroyed&&this.stageObj[e].destroy();this.stageObj=[]}static bornFxDestroy(e,t,a=1e3,o=1,i=new Laya.Vector3){if(!this.isFxOn)return null;let s=this.fxs.getChildByName(e).clone();return t.addChild(s),s.transform.localPosition=i,s.transform.localRotationEuler=new Laya.Vector3,s.transform.localScale=new Laya.Vector3(o,o,o),Laya.timer.once(a,this,()=>{s.destroy()}),s}static bornFxFromPool(e,t,a=1e3,o=1,i=new Laya.Vector3){let s;for(let t=this.fxPool.length-1;t>=0;t--)if(this.fxPool[t].name==e){(s=this.fxPool.splice(t,1)[0]).active=!0;break}if(!s){let t=this.fxs.getChildByName(e);s=t.clone()}return t.addChild(s),this.stageObj.push(s),s.transform.localPosition=i,s.transform.localRotationEuler=new Laya.Vector3,s.transform.localScale=new Laya.Vector3(o,o,o),Laya.timer.once(a,this,()=>{s&&!s.destroyed&&(this.mainScene.addChild(s),s.active=!1,this.fxPool.push(s))}),s}static bornFxStage(e,t,a=1,o=new Laya.Vector3){let i=this.fxs.getChildByName(e).clone();return t.addChild(i),i.transform.localPosition=o,i.transform.localRotationEuler=new Laya.Vector3,i.transform.localScale=new Laya.Vector3(a,a,a),this.stageObj.push(i),i}}_.stageObj=[],_.isFxOn=!0,_.fxPool=[];class D extends x{constructor(){super(...arguments),this.yForceMin=1,this.yForceMax=2,this.xForceMin=.5,this.xForceMax=1,this.zForceMin=15,this.zForceMax=25,this.dir=new Laya.Vector3(0,1,0),this.gravity=0,this.yforce=0,this.xForce=0,this.zForce=0,this.rotate=new Laya.Vector3,this.dorpDeadY=-2,this.dropDeadChangeX=4,this.isDestory=!0,this.isActive=!0}init(){this.setData()}changeDropData(e,t,a,o,i,s){this.yForceMin=e.x,this.yForceMax=e.y,this.xForceMin=t.x,this.xForceMax=t.y,this.zForceMin=a.x,this.zForceMax=a.y,this.rotate=i,this.dir=o,this.gravity=s,this.setData()}setTimeDestroy(e=1e3){Laya.timer.once(e,this,()=>{this.self.destroy()})}setData(){this.xForce=p.randomNumber(this.xForceMin,this.xForceMax),this.yforce=p.randomNumber(this.yForceMin,this.yForceMax),this.zForce=p.randomNumber(this.zForceMin,this.zForceMax)}onUpdate(){if(!this.isActive)return;let e=Laya.timer.delta/1e3;this.yforce-=this.gravity*e;let t=this.self;t&&!t.destroyed&&(t.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*e,this.yforce*e,this.dir.z*this.zForce*e),!1),t.transform.rotate(u.mull(this.rotate,e),!0),Math.abs(this.self.transform.position.x)>this.dropDeadChangeX&&(this.dorpDeadY=-19.5),this.self.transform.position.y<this.dorpDeadY&&(this.isDestory?this.self.destroy():this.isActive=!1))}}class V extends x{constructor(){super(...arguments),this.range=1,this.width=1,this.raidus=1,this.colliderActive=!0,this.isBullet=!1,this.itemState=n.Stone,this.diamondType=1,this.diamondLevel=1,this.isCleanState=0,this.jewelryLevel=1,this.isReal=!1,this.isClearOrDirty=!0,this.isDrop=!1}init(...e){}setData(e,t,a=!1){this.range=e,this.width=t,this.raidus=this.range>this.width?this.range:this.width,this.colliderActive=!0,this.isBullet=a}changeState(e){let t,a,o,s=this.self.getChildAt(0),r=e=>{let t=e.getChildByName("Model");t.getChildAt(t.numChildren-1).active=!1;for(let e=0;e<t.numChildren-1;e++){let a=t.getChildAt(e).addComponent(D);a.dorpDeadY=0,a.isDestory=!1,a.dropDeadChangeX=.65,a.changeDropData(new Laya.Vector2(2,4),new Laya.Vector2(-1.5,1.5),new Laya.Vector2(-1.5,1.5),new Laya.Vector3(1,1,1),new Laya.Vector3(p.randomNumber(-10,10),p.randomNumber(-10,10),p.randomNumber(-10,10)),25)}},h=()=>{this.tweenBornDo()};if(this.itemState==e-1||2==this.itemState&&2==e)switch(this.itemState=e,e){case n.Stone:break;case n.Gem:_.mainScene.addChild(s),r(s),g.playSoundLimit(i.Pusher),_.bornStageObj("Gem",this.self),o=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self,new Laya.Vector3(0,.2,0)),p.d2_labelToast("+10$","#00ff00",Laya.stage,1,new Laya.Vector2(o.x,o.y));break;case n.Diamond:this.diamondObj?this.diamondObj.destroy():(_.mainScene.addChild(s),r(s),o=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self,new Laya.Vector3(0,.2,0)),p.d2_labelToast("+10$","#00ff00",Laya.stage,1,new Laya.Vector2(o.x,o.y))),a="Diamonds_"+this.diamondType.toString(),(t=_.bornStageObj(a,this.self)).transform.localPosition=new Laya.Vector3(0,.2,0),t.transform.localScale=new Laya.Vector3(1.5,1.5,1.5),this.diamondObj=t,this.cleanOrDirtyMatDo(),this.dimamondLevelUp(!1),g.playSoundLimit(i.LaserDoor);break;case n.Jewelry:_.mainScene.addChild(this.diamondObj);let d,c=this.self.getChildAt(0);for(let e=0;e<c.numChildren;e++)if((t=c.getChildAt(e)).active){d=t.getChildAt(0);break}switch(d.addChild(this.diamondObj),this.jewelryType!=l.Earring&&(_.bornStageObj("Diamonds_Trust",d),1!=this.diamondType&&this.diamondObj.transform.rotate(new Laya.Vector3(90,0,0),!0,!1)),this.diamondObj.transform.localPosition=new Laya.Vector3,this.diamondObj.transform.localScale=new Laya.Vector3(1,1,1),h(),g.playSoundLimit(i.Slot),this.jewelryType){case l.Ring:o=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self,new Laya.Vector3(0,.2,0)),p.d2_labelToast("+20$","#00ff00",Laya.stage,1,new Laya.Vector2(o.x,o.y));break;case l.Earring:o=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self,new Laya.Vector3(0,.2,0)),p.d2_labelToast("+30$","#00ff00",Laya.stage,1,new Laya.Vector2(o.x,o.y));break;case l.Bracelet:o=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self,new Laya.Vector3(0,.2,0)),p.d2_labelToast("+40$","#00ff00",Laya.stage,1,new Laya.Vector2(o.x,o.y))}}}cleanOrDirtyMatDo(){if(!this.diamondObj)return;let e=this.diamondObj.getChildAt(0).getChildAt(0),t=e.meshRenderer.material.clone();switch(this.isCleanState){case 0:t.albedoColor=new Laya.Vector4(.75,.75,.75,1),t.intensity=1.35,t.specularColor=new Laya.Vector4(.5,.5,.5,1),t.shininess=.1;break;case 1:t.albedoColor=new Laya.Vector4(1,1,1,1),t.intensity=1.35,t.specularColor=new Laya.Vector4(.75,.75,.75,1),t.shininess=.1;break;case-1:t.albedoColor=new Laya.Vector4(.5,.5,.5,1),t.intensity=1.35,t.specularColor=new Laya.Vector4(1,1,1,1),t.shininess=.1}e.meshRenderer.material=t}dimamondLevelUp(e=!0){let t=this.diamondLevel;if(e){t++,g.playSoundLimit(i.Upgrade);let e=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self,new Laya.Vector3(0,.2,0));p.d2_labelToast("+10$","#00ff00",Laya.stage,1,new Laya.Vector2(e.x,e.y))}if(t<=3&&this.diamondObj){let e=this.selfTween;e.clearTween(),this.self.transform.localScale=new Laya.Vector3(0,0,0),e.toTween(this.self,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut);let a=this.diamondObj.getChildAt(0).getChildAt(0),o=a.meshRenderer.material.clone(),i="res/scene/Texture/diamond"+t.toString()+".jpg";Laya.Texture2D.load(i,Laya.Handler.create(this,e=>{o.albedoTexture=e,a.meshRenderer.material=o})),this.diamondLevel=t}}dropState(){this.self.getChildAt(0);if(this.diamondObj)if(this.isClearOrDirty){if(1!=this.isCleanState){let e=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self,new Laya.Vector3(0,.2,0));p.d2_labelToast("+10$","#00ff00",Laya.stage,1,new Laya.Vector2(e.x,e.y)),this.isCleanState=1,this.cleanOrDirtyMatDo()}}else if(-1!=this.isCleanState){let e=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self,new Laya.Vector3(0,.2,0));p.d2_labelToast("-10$","#ff0000",Laya.stage,1,new Laya.Vector2(e.x,e.y)),this.isCleanState=-1,this.cleanOrDirtyMatDo()}this.isDrop||g.playSoundLimit(i.Water),this.isDrop=!0,this.jewelryType!=l.Earring?this.targetPosition=new Laya.Vector3(0,-.5,0):this.targetPosition=new Laya.Vector3(0,-.25,0),Laya.timer.frameOnce(3,this,this.dropBack)}onUpdate(){if(this.isDrop){let e=Laya.timer.delta/1e3,t=this.self.getChildAt(0),a=new Laya.Vector3;Laya.Vector3.lerp(t.transform.localPosition.clone(),this.targetPosition,60*e,a),t.transform.localPosition=a}}dropBack(){this.self.getChildAt(0);2==this.itemState?this.targetPosition=new Laya.Vector3(0,.2,0):this.jewelryType!=l.Earring?this.targetPosition=new Laya.Vector3:this.targetPosition=new Laya.Vector3(0,.8,0),this.waterFx&&!this.waterFx.destroyed||(this.waterFx=_.bornFxDestroy(this.isClearOrDirty?"ClearFX":"DirtyFX",this.self,3500,2,new Laya.Vector3(0,.2,0))),Laya.timer.once(500,this,this.dropStop)}dropStop(){2==this.itemState?this.targetPosition=new Laya.Vector3(0,.2,0):this.jewelryType!=l.Earring?this.targetPosition=new Laya.Vector3:this.targetPosition=new Laya.Vector3(0,.8,0),this.isDrop=!1}beReal(){this.tweenBornDo(),_.bornFxStage("CertifiedFX",this.diamondObj),g.playSoundLimit(i.Gate),M.d2_numberLabelToast(20,this.self)}beFake(e){let t=this.self.transform.position.clone(),a=this.self.transform.rotation.clone();e.addChild(this.self),this.self.transform.position=t,this.self.transform.rotation=a;let o=e.getChildAt(0).transform.localPosition.clone();this.selfTween.toTween(this.self,{pos:o,sca:new Laya.Vector3},500,null,Laya.Ease.backIn,!0),g.playSoundLimit(i.Throw),M.d2_numberLabelToast(-M.valueDeal(this),this.self)}sold(t){let a=t.getChildByName("SoldStart"),s=t.getChildByName("SoldEnd");t.addChild(this.self),this.self.transform.localPosition=a.transform.localPosition.clone(),this.selfTween.toTween(this.self,{pos:s.transform.localPosition.clone()},500,()=>{this.self.active=!1},null,!0),e.event(o.Game_Sold_Event,this),g.playSoundLimit(i.Sell)}}class A extends x{constructor(){super(...arguments),this.offsetX=0,this.offsetZ=-.05,this.itemLerpAxis=15,this.nowType=[]}init(...e){A.instance=this,this.items=this.self.getChildByName("Items"),this.model=this.self.getChildByName("Model"),this.size=M.itemSize}reset(){this.items.active=!0,this.nowType=[];for(let e=this.items.numChildren-1;e>=0;e--)this.items.getChildAt(e).destroy();for(let e=0;e<0;e++)this.addItem()}addItem(){let e=new Laya.Sprite3D("item");_.stageObj.push(e),this.items.addChild(e),e.transform.localPosition=new Laya.Vector3,_.bornStageObj(s.Stone,e).transform.localPosition=new Laya.Vector3;let t=e.addComponent(V);t.setData(this.size,this.size),t.changeState(n.Stone),g.playSoundLimit(i.Get)}addOldItem(e){this.items.addChild(e.self),e.self.transform.localPosition=new Laya.Vector3;e.self.getChildAt(0).getChildByName("Model").transform.rotation=new Laya.Quaternion,g.playSoundLimit(i.Get)}getItemUrl(e){switch(e){case s.Stone:return s.Stone;default:return null}}onUpdate(){let e,t=this.model.transform.position.clone();t.x+=this.offsetX,t.z+=this.offsetZ;for(let a=0;a<this.items.numChildren;a++)if((e=this.items.getChildAt(a))&&!e.destroyed){let o=new Laya.Vector3,i=.016*this.itemLerpAxis;i>1&&(i=1),Laya.Vector3.lerp(e.transform.position.clone(),t,i,o),o.z=this.model.transform.position.z+this.offsetZ+a*this.size,e.transform.position=o,t=e.transform.position}}}class T extends D{constructor(){super(...arguments),this.isColliderActive=!1,this.isLandRotate=!0}init(){super.init(),this.dorpDeadY=0,this.isDestory=!1,this.dropDeadChangeX=.65,this.isLandRotate=!0,this.isActive=!0,this.yforce=0,this.changeDropData(new Laya.Vector2(2.5,5),new Laya.Vector2(-1,1),new Laya.Vector2(2.5,5),new Laya.Vector3(1,1,1),new Laya.Vector3(p.randomNumber(-10,10),p.randomNumber(-10,10),p.randomNumber(-10,10)),25)}onUpdate(){let e=Laya.timer.delta/1e3;if(this.isActive){this.yforce-=this.gravity*e;let t=this.self,a=this.self.getChildAt(0).getChildByName("Model");t&&!t.destroyed&&(t.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*e,this.yforce*e,this.dir.z*this.zForce*e),!1),a.transform.rotate(u.mull(this.rotate,e),!0),Math.abs(this.self.transform.position.x)>this.dropDeadChangeX&&(this.dorpDeadY=-19.5,this.isDestory=!0),a.transform.position.y<this.dorpDeadY&&(this.isDestory?this.self.destroy():(t.transform.position=new Laya.Vector3(this.self.transform.position.x,0,this.self.transform.position.z),this.isActive=!1)))}else if(this.isLandRotate){this.isColliderActive=!0;let t=this.self,a=this.self.getChildAt(0).getChildByName("Model");if(t&&!t.destroyed){let o=this.dir.clone();Laya.Vector3.lerp(this.dir,new Laya.Vector3,4*e,o),o.x<.1&&o.z<.1&&(this.isLandRotate=!1),this.dir=o,Math.abs(this.self.transform.position.x)>this.dropDeadChangeX+.1?(this.yforce-=this.gravity*e*.1,t.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*e,this.yforce*e,this.dir.z*this.zForce*e),!1),a.transform.rotate(new Laya.Vector3(this.dir.z*this.zForce*e*.5,0,0),!1),a.transform.position.y<-5&&this.self.destroy()):(t.transform.translate(new Laya.Vector3(this.dir.x*this.xForce*e,0,this.dir.z*this.zForce*e),!1),a.transform.rotate(new Laya.Vector3(this.dir.z*this.zForce*e*.5,0,0),!1))}}}colliderDo(){this.isActive||(A.instance.addOldItem(this.self.getComponent(V)),d.instance.vibrateShort(),this.destroy())}}class B extends x{constructor(){super(...arguments),this.isCircle=!1,this.range=1,this.width=1,this.raidus=1,this.type=r.Stone,this.colliderActive=!0,this.colliderSprite=[],this.isDirty=!1,this.diamondType=1,this.jewelryType=l.Ring,this.jewelryLevel=1,this.hasColliderObj=[]}init(...e){}setData(e){let t;this.type=e,this.raidus=(this.range+this.width)/2,this.raidus*=.5,this.isCircle=!1;let a,o,i=p.d3_FindNodeHasName(this.self,"collider");switch(this.range=parseFloat(i.name.split("_")[2]),this.width=parseFloat(i.name.split("_")[3]),this.colliderSprite.push(i),e){case r.Stone:case r.Obs_1:case r.Obs_2:break;case r.Obs_3:this.colliderActive=!1;let s=()=>{Laya.timer.once(2800,this,()=>{this.colliderActive=!0,Laya.timer.once(200,this,()=>{this.colliderActive=!1,s()})})};Laya.timer.once(1400,this,()=>{s()});break;case r.Pusher:break;case r.Door_Laser:this.diamondType=p.randomInt(1,6),this.width-=M.itemSize/2,a="LaserDoor"+this.diamondType.toString();for(let e=0;e<this.self.numChildren;e++)-1!=(t=this.self.getChildAt(e)).name.indexOf("LaserDoor")&&(t.active=t.name==a);break;case r.Jewelry:switch(p.randomInt(1,3)){case 1:this.jewelryType=l.Ring;break;case 2:this.jewelryType=l.Earring;break;case 3:this.jewelryType=l.Bracelet}this.jewelryLevel=p.randomInt(1,6),o=this.jewelryType;let n=this.self.getChildByName(o);t=_.bornStageObj(o,n);for(let e=0;e<t.numChildren;e++)t.getChildAt(e).active=e==this.jewelryLevel-1;this.jewelryObj=t;break;case r.Pool:this.isDirty=p.halfPercent();let h=this.colliderSprite[0].getChildAt(0),d=h.getChildAt(0),c=h.getChildAt(1);d.active=this.isDirty,c.active=!this.isDirty;break;case r.Door_Upgarde:break;case r.Door_Check:this.rubbish=_.bornStageObj("Dustbin_1",_.mainScene);let y=this.self.transform.position.clone(),m=new Laya.Vector3;y.x>0?(y=new Laya.Vector3(1,y.y,y.z),m=new Laya.Vector3(0,0,0)):(y=new Laya.Vector3(-1,y.y,y.z),m=new Laya.Vector3(0,0,0)),this.rubbish.transform.position=y,this.rubbish.transform.rotate(m,!0,!1);break;case r.Door_Sold:break;default:console.log("关卡物品预设里没有该类型物件",e)}}colliderDo(e=null,t){let a,o=t=>{if(this.colliderActive)if(!e&&t)P.instance.Hit();else if(-1==this.hasColliderObj.indexOf(e)){this.hasColliderObj.push(e);let t=M.valueDeal(e);M.d2_numberLabelToast(-t,e.self);let a=e.self.transform.position.clone();_.dropItemsGrip.addChild(e.self),e.self.transform.position=a,e.self.addComponent(T),d.instance.vibrateShort(),g.playSoundLimit(i.Lose)}},s=t=>{this.colliderActive&&e&&-1==this.hasColliderObj.indexOf(e)&&(this.hasColliderObj.push(e),e.changeState(t),d.instance.vibrateShort())};switch(this.type){case r.Stone:this.colliderActive&&(M.d2_numberLabelToast(10,this.self),this.self.active=!1,A.instance.addItem(),this.colliderActive=!1,d.instance.vibrateShort());break;case r.Obs_1:case r.Obs_2:case r.Obs_3:o(!0);break;case r.Pusher:s(n.Gem);break;case r.Door_Laser:e&&(e.diamondType=this.diamondType,s(n.Diamond));break;case r.Jewelry:e&&2==e.itemState&&(a=this.jewelryObj.clone(),e.self.addChild(a),this.jewelryType!=l.Earring?a.transform.localPosition=new Laya.Vector3:a.transform.localPosition=new Laya.Vector3(0,.8,0),e.jewelryType=this.jewelryType,e.jewelryLevel=this.jewelryLevel,s(n.Jewelry));break;case r.Pool:e&&(e.isClearOrDirty=this.isDirty,e.dropState());break;case r.Door_Upgarde:e&&-1==this.hasColliderObj.indexOf(e)&&(this.hasColliderObj.push(e),e.dimamondLevelUp());break;case r.Door_Check:if(e&&e.diamondObj&&-1==this.hasColliderObj.indexOf(e)){this.hasColliderObj.push(e),p.percent(M.realItemPrecent)?e.beReal():e.beFake(this.rubbish)}break;case r.Door_Sold:if(e){let t="ui/game/ksy_tb_jq.png",a=p.d3_getSpritePosBySprite3DPoint(P.instance.mainCamera,this.self);-1==this.hasColliderObj.indexOf(e)&&(p.d2_coinCollectAnim(t,new Laya.Vector2(a.x,a.y),new Laya.Vector2(Laya.stage.width/2-25,75),Laya.stage,3,1,()=>{let e=_.bornStageObj("Money_Deck_1",_.moneyGrip);e.transform.localPosition=new Laya.Vector3(0,.09*_.moneyGrip.numChildren,0),e.addComponent(x).tweenBornDo()}),this.hasColliderObj.push(e),e.sold(this.self))}}}playLoopSound(e){this.mistSoundChannel&&!this.mistSoundChannel.isStopped||(this.mistSoundChannel=g.play(e,!0)),this.mistSoundChannel&&(this.mistSoundChannel.volume=g.isSound?1:0),Laya.timer.frameOnce(1,this,this.soundStop)}soundStop(){this.mistSoundChannel&&(this.mistSoundChannel.volume=0)}playCloseSound(e){let t=Math.abs(this.self.transform.position.z-P.instance.player.transform.position.z),a=t<100?t/100:1;this.mistSoundChannel&&!this.mistSoundChannel.isStopped||(this.mistSoundChannel=g.play(e,!0)),this.mistSoundChannel&&(this.mistSoundChannel.volume=g.isSound?1-a:0)}}class k{constructor(){this.dropObjs=[],this.colliders=[],this.moneyCount=0,this.nowRound=0,this.playCount=0,this.levelScale=2,this.roadLength=5*this.levelScale,this.colliderRange=5,this.isWin=!1,this.isEnd=!1,this.isFxOn=!0,this.isObjToJson=!1,this.isBornStage=!0,this.isJsonBorn=!0,this.nowHandSkinIndex=0,this.soldStores=[],this.endBoxColor=[["75A4FE","CBE5FE"],["2772EF","46E662"],["CBF8B7","17B721"],["FF7BDE","FFD1FF"],["FB47AA","DB8AFF"],["FFD4FF","A944D0"]],this.highBoxColor="FFE51C",this.isStart=!1,this.moneyUrl="ui/game/ksy_tb_jq.png",this.videoUrl="ui/game/yxz_tb_sp.png",this.isPressed=!1,this.orignal=0,k.instance=this,this.init()}init(){this.initEvent(),this.isJsonBorn&&this.readJson()}createShadow(e){e.shadowMode=Laya.ShadowMode.SoftLow,e.shadowDistance=20,e.shadowResolution=1024,e.shadowCascadesMode=Laya.ShadowCascadesMode.NoCascades,e.shadowNormalBias=.6,e.shadowStrength=.4}hideShadow(e){e.shadowMode=Laya.ShadowMode.None}useRetinalCanvas(){Laya.stage.useRetinalCanvas=!0}disabelRetinalCanvas(){Laya.stage.useRetinalCanvas=!1}setFog(e,t,a){t.enableFog=e,e&&(t.fogColor=a,t.fogStart=10,t.fogRange=30)}readJson(){w.addLoadRes("关卡");let e=["res/json/stageInfo.json"],t=()=>{Laya.loader.load(e,Laya.Handler.create(this,a=>{if(a){for(let t=0;t<e.length;t++)Laya.loader.load(e[t],Laya.Handler.create(this,e=>{switch(t){case 0:this.stageJson=e,console.log(e);break;default:console.log(e)}}),null,Laya.Loader.JSON);w.removeLoadRes("关卡")}else console.log("load json fail,reload after 1s"),Laya.timer.once(1e3,this,t)}),null,Laya.Loader.JSON)};e.length>0&&t()}JsonV3(e,t){if(t){let a=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),o=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector3(a,o,i)}return new Laya.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z))}V3ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString()}}JsonV4(e,t){if(t){let a=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),o=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t),s=Math.round(parseFloat(e.w)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector4(a,o,i,s)}return new Laya.Vector4(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z),parseFloat(e.w))}V4ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString(),w:e.w.toString()}}firstIn(){console.log("首次进入处理"),_.mainScene=this.mainScene;for(let e=0;e<this.mainScene.numChildren;e++){let t=this.mainScene.getChildAt(e);switch(t.name){case"Prefabs":_.prefabs=t,_.prefabs.active=!1;break;case"Light":this.light=t;break;case"Fxs":_.fxs=t,Laya.timer.once(1e3,this,()=>{_.fxs.active=!1});break;case"Stage":this.stage=t,this.player=this.stage.getChildByName("Player"),this.runMoveComp=this.player.addComponent(P),this.itemsComp=this.player.addComponent(A),this.camPoint=this.player.getChildByName("CamPoint"),this.mainCam=this.camPoint.getChildByName("MainCam"),this.mainCamera=this.mainCam.getChildByName("Main Camera"),this.runMoveComp.mainCamera=this.mainCamera,this.start=this.stage.getChildByName("Start"),this.end=this.stage.getChildByName("End"),this.dropItemGrip=this.stage.getChildByName("DropItemGrip"),this.homeEndShopCam=this.end.getChildByName("HomeShopCam"),this.homeEndShopCam.active=!1;let e=this.end.getChildByName("End_1");for(let t=0;t<e.numChildren;t++){let a=e.getChildAt(t);this.soldStores.push(a)}_.dropItemsGrip=this.dropItemGrip,this.endBox=this.end.getChildByName("End_2").getChildByName("End_Box"),this.moneyGrip=this.end.getChildByName("End_2").getChildByName("MoneyGrip"),_.moneyGrip=this.moneyGrip}}this.useRetinalCanvas(),this.createShadow(this.light);let e=this.endBox.getChildAt(0),t=e.getChildByName("word0"),a=e.getChildByName("word1"),o=e.getChildByName("number");t.active=!1,a.active=!1,o.transform.localPosition=new Laya.Vector3(.0375,.138,-.203);let i=e.meshRenderer.material.clone();i.albedoColor=p.d3_getRgbByHex(this.endBoxColor[0][0]),e.meshRenderer.material=i,this.numberDeal(o,50);let s=199-this.endBox.numChildren,n=this.endBox.numChildren;for(let t=n;t<n+s;t++){let a=e.clone();this.endBox.addChild(a),a.transform.localPosition=new Laya.Vector3(0,.275*t,0),o=a.getChildByName("number"),this.numberDeal(o,50+50*t);let i=a.meshRenderer.material.clone(),s=Math.floor(t/20),n=this.endBoxColor[s%this.endBoxColor.length];i.albedoColor=p.d3_getRgbByHex(n[t%2]),a.meshRenderer.material=i}for(let e=1;e<=6;e++)this.updateEndShop(null,this.mainCamera,e)}initEvent(){e.on(o.Game_Sold_Event,this,this.sold),e.on(o.Home_ShowEndShop_Event,this,this.checkStoreHome)}levelInit(){this.isEnd=!1,this.isStart=!1,Laya.timer.clear(this,this.gameUpdate),_.stageObjClear(),this.dropObjs=[],this.colliders=[],this.nowRound=0,this.moneyCount=0;let e=c.ReadGrade()-1,t=new Laya.Vector3,a=new Laya.Vector3(0,0,this.roadLength),o=u.add(t,a);this.start.transform.position=t;let i=this.isBornStage,s=this.isJsonBorn;if(i){let t,i,n,l=this.stage.getChildByName("Level");if(this.isObjToJson){let e=[];for(let t=0;t<l.numChildren;t++){let a=l.getChildAt(t),o={name:"",setInfo:[]};o.name=a.name;for(let e=0;e<a.numChildren;e++){let t=a.getChildAt(e),i={name:"",objInfo:[]};i.name=t.name;for(let e=0;e<t.numChildren;e++){let a=t.getChildAt(e),o=a.name,s=a.transform.localPosition.clone(),n=a.transform.rotation.clone(),r={name:o,pos:this.V3ToJson(s),rot:this.V4ToJson(n)};i.objInfo.push(r)}o.setInfo.push(i)}e.push(o)}console.log(JSON.stringify(e))}t=s?e%this.stageJson.length:e%(l=this.stage.getChildByName("Level")).numChildren,n=s?(i=this.stageJson[t]).setInfo.length:(i=l.getChildAt(t)).numChildren;for(let e=0;e<n;e++){let t,n;n=s?(t=i.setInfo[e]).objInfo.length:(t=i.getChildAt(e)).numChildren;let l=new Laya.Sprite3D(t.name);this.stage.addChild(l),l.transform.position=o;for(let e=0;e<n;e++){let i,n,h,d,c,y,m;if(s){n=(i=t.objInfo[e]).name.split(" ")[0];let a=this.JsonV3(i.pos);a.z*=this.levelScale,h=u.add(a,l.transform.position.clone()),d=this.JsonV4(i.rot)}else{n=(i=t.getChildAt(e)).name.split(" ")[0];let a=i.transform.localPosition.clone();a.z*=this.levelScale,h=u.add(a,l.transform.position.clone()),d=i.transform.rotation.clone()}let g=()=>{o=u.add(o,a);let e=this.roadLength/this.colliderRange;for(let t=0;t<e;t++)this.colliders.push([])},p=e=>{(m=c.addComponent(B)).setData(e),y=this.colliderIndexJudge(h),this.colliders[y].push(m)};switch((c=_.bornStageObj(n,l)).transform.position=h,c.transform.rotation=d,n){case"Road":g();break;case"Road_S1":case"Road_S2":g(),p(r.Pool);break;default:p(n)}}}}this.end.transform.position=o;for(let e=0;e<this.endBox.numChildren;e++){let t=this.endBox.getChildAt(e);t.transform.localPosition=new Laya.Vector3(0,.275*e,0);let a=t.getChildByName("number"),o=t.getChildByName("word0"),i=t.getChildByName("word1");o.active=!1,i.active=!1,a.active=!0,this.numberDeal(a,50+50*e);let s=t.meshRenderer.material.clone(),n=Math.floor(e/20),r=this.endBoxColor[n%this.endBoxColor.length];s.albedoColor=p.d3_getRgbByHex(r[e%2]),t.meshRenderer.material=s,a.transform.localPosition=new Laya.Vector3(.0375,a.transform.localPosition.y,a.transform.localPosition.z)}for(let e=0;e<this.soldStores.length;e++){this.soldStores[e].getChildByName("Scene1").getChildByName("Char").getComponent(Laya.Animator).play("idle",0,0)}this.player.transform.position=t,this.camPoint.transform.localPosition=this.runMoveComp.startCamPoint.transform.localPosition.clone(),this.camPoint.transform.localRotation=this.runMoveComp.startCamPoint.transform.localRotation.clone(),this.runMoveComp.reset(3.75*this.levelScale,0),this.runMoveComp.model.transform.localPosition=new Laya.Vector3(0,0,0),this.runMoveComp.model.transform.localRotationEuler=new Laya.Vector3(0,0,0);let n=this.runMoveComp.model.getChildAt(0),l=this.runMoveComp.model.getChildAt(1);n.transform.localRotation=l.transform.localRotation.clone(),n.transform.localPosition=l.transform.localPosition.clone();for(let e=0;e<n.numChildren;e++){n.getChildAt(e).active=e==this.nowHandSkinIndex}this.itemsComp.reset(),this.runMoveComp.isCamCtrl=!0,Laya.timer.frameLoop(1,this,this.gameUpdate)}gameStart(){this.isStart=!0,this.controlOn(),this.roundInit(),this.playCount++,Laya.timer.loop(16,this,this.fixUpdate),this.runMoveComp.isMove=!0}levelEnd(t){this.isEnd=!0,this.isWin=t,Laya.timer.clear(this,this.fixUpdate),e.event(o.Scene_GoOver)}roundInit(){let e;switch(this.nowRound){case 0:break;case 1:this.runMoveComp.targetHorizontal=0,this.controlOff(),this.onMouseUp(),this.runMoveComp.isCamCtrl=!1,this.runMoveComp.speedAxis=2,(e=new b).toTween(this.camPoint,{pos:this.runMoveComp.endCamPoint.transform.localPosition.clone(),rot:this.runMoveComp.endCamPoint.transform.localRotation.clone()},1e3,()=>{},null,!0);break;case 2:this.checkStore(),this.runMoveComp.isMove=!1;let t=A.instance.items,a=this.end.getChildByName("Dustbin_1");for(let e=t.numChildren-1;e>=0;e--){let o=t.getChildAt(e),s=o.getComponent(V);if(s.itemState<=1){g.playSoundLimit(i.Throw),p.d3_addChildNotMove(o,a),s.selfTween.toTween(o,{pos:new Laya.Vector3(p.randomNumber(-.05,.05),p.randomNumber(0,.1),p.randomNumber(-.05,.05)),sca:new Laya.Vector3(.5,.5,.5)},500,()=>{},Laya.Ease.backIn,!0)}}break;case 3:this.runMoveComp.isMove=!0,this.runMoveComp.speedAxis=2,(e=new b).toTween(this.camPoint,{pos:this.runMoveComp.startCamPoint.transform.localPosition.clone(),rot:this.runMoveComp.startCamPoint.transform.localRotation.clone()},1e3,()=>{let e=A.instance.items;for(let t=e.numChildren-1;t>=0;t--){let a=e.getChildAt(t),o=a.getComponent(V),i=this.end.getChildByName("End_2").getChildAt(t%4+1).getChildAt(0);p.d3_addChildNotMove(a,i),o.selfTween.toTween(a,{pos:new Laya.Vector3,rot:new Laya.Quaternion},500,()=>{p.d3_unactiveAllChildren(i),a.active=!0},null,!0)}},null,!0);break;case 4:this.runMoveComp.isMove=!1,this.moneyCount>9999&&(this.moneyCount=9999);let o=Math.floor(this.moneyCount/50),s=this.player.transform.position.clone();s.y+=.275*o;let n=new b,r=2e3;o<=20&&(r=100+100*o);let l=this.moneyCount>c.ReadHighScore();l&&c.WriteHighScore(this.moneyCount);let h=this.endBox.getChildAt(o),d=h.getChildByName("number");this.numberDeal(d,this.moneyCount);let y=h.meshRenderer.material.clone();y.albedoColor=p.d3_getRgbByHex(this.highBoxColor),h.meshRenderer.material=y;let m=Math.floor(c.ReadHighScore()/50),u=this.endBox.getChildAt(m);(y=u.meshRenderer.material.clone()).albedoColor=p.d3_getRgbByHex(this.highBoxColor),u.meshRenderer.material=y,d=u.getChildByName("number"),this.numberDeal(d,c.ReadHighScore());let f=h.getChildByName("word0"),C=h.getChildByName("word1");d=h.getChildByName("number"),f.active=!0,f.transform.localPosition=new Laya.Vector3(.158,f.transform.localPosition.y,f.transform.localPosition.z),d.transform.localPosition=new Laya.Vector3(-.171,d.transform.localPosition.y,d.transform.localPosition.z),f=u.getChildByName("word0"),C=u.getChildByName("word1"),d=u.getChildByName("number"),f.active=!1,C.active=!0,C.transform.localPosition=new Laya.Vector3(.189,f.transform.localPosition.y,f.transform.localPosition.z),d.transform.localPosition=new Laya.Vector3(-.114,d.transform.localPosition.y,d.transform.localPosition.z);let L=new b,w=this.runMoveComp.model.getChildAt(0),S=this.runMoveComp.model.getChildAt(2);L.toTween(w,{pos:S.transform.localPosition.clone(),rot:S.transform.localRotation.clone()},500,()=>{g.play(i.RaiseMoney),(e=new b).toTween(this.camPoint,{pos:this.runMoveComp.finalCamPoint.transform.localPosition.clone(),rot:this.runMoveComp.finalCamPoint.transform.localRotation.clone()},1e3,()=>{let e=A.instance.items;for(let t=e.numChildren-1;t>=0;t--){let a=e.getChildAt(t),o=a.getComponent(V),i=this.end.getChildByName("End_2").getChildAt(t%4+1).getChildAt(0);p.d3_addChildNotMove(a,i),o.selfTween.toTween(a,{pos:new Laya.Vector3,rot:new Laya.Quaternion},500,()=>{p.d3_unactiveAllChildren(i),a.active=!0},null,!0)}},null,!0),n.toTween(this.player,{pos:s},r,()=>{let e=()=>{Laya.timer.once(1e3,this,()=>{this.roundEnd()})};if(l){let t=u.getChildByName("fx");_.bornFxDestroy("ConfettiFX",t,2e3),e()}else Laya.timer.once(1e3,this,()=>{(s=this.camPoint.transform.position.clone()).y+=.275*(m-o),n.toTween(this.camPoint,{pos:s},1e3,()=>{e()},Laya.Ease.expoInOut,!1)})},Laya.Ease.expoInOut,!1)},null,!0);break;case 5:this.levelEnd(!0),g.play(i.Win);break;default:console.log("多次触发跳关了")}}roundEnd(){this.isEnd||(this.nowRound++,this.roundInit())}gameUpdate(){Laya.timer.delta;switch(this.nowRound){case 0:this.player.transform.position.z>this.end.transform.position.z&&this.roundEnd(),0==A.instance.items.numChildren?P.instance.speedAxis=1.25:P.instance.speedAxis=1;break;case 1:this.runMoveComp.speedAxis=2,this.player.transform.position.z>this.end.transform.position.z+this.roadLength&&this.roundEnd();break;case 3:this.player.transform.position.z>this.end.transform.position.z+2*this.roadLength&&this.roundEnd();case 4:let e=Math.round((this.player.transform.position.y-.275)/.275);e<0&&(e=0);let t=e-Math.floor(this.moneyGrip.numChildren/3);for(let a=0;a<t;a++)for(let t=0;t<3;t++){let a=_.bornStageObj("Money_Deck_1",this.moneyGrip);a.transform.localPosition=new Laya.Vector3(0,.275*e+.09*t,0),a.addComponent(x).tweenBornDo()}}}fixUpdate(){{this.nowRound;let e,t,a,o=this.itemsComp.items,i=new Laya.Vector3;if((i=this.runMoveComp.model.transform.position.clone()).z-=.25,(a=this.colliderIndexJudge(i))>=0&&a<this.colliders.length)for(let e=0;e<this.colliders[a].length;e++){let t,o=this.colliders[a][e];for(let s=0;s<this.colliders[a][e].colliderSprite.length;s++){let n=this.colliders[a][e].colliderSprite[s];if(n&&!n.destroyed){let e=n.transform.position.clone();if((t=o.isCircle?p.CircleCheck_2D(i.z,i.x,M.itemSize/2,e.z,e.x,o.raidus):p.BoxCheck_2D_Normal(i.z,i.x,M.itemSize,M.itemSize,e.z,e.x,o.range,o.width)).isHit)break}}if(t&&t.isHit){o.colliderDo();break}}for(let s=0;s<o.numChildren;s++)if((e=o.getChildAt(s))&&!e.destroyed){if(i=e.transform.position.clone(),!(t=e.getComponent(V)).colliderActive)continue;if((a=this.colliderIndexJudge(i))>=0&&a<this.colliders.length)for(let e=0;e<this.colliders[a].length;e++){let o,s=this.colliders[a][e];for(let n=0;n<this.colliders[a][e].colliderSprite.length;n++){let r=this.colliders[a][e].colliderSprite[n];if(r&&!r.destroyed){let e=r.transform.position.clone();if((o=s.isCircle?p.CircleCheck_2D(i.z,i.x,t.raidus,e.z,e.x,s.raidus):p.BoxCheck_2D_Normal(i.z,i.x,t.range,t.width,e.z,e.x,s.range,s.width)).isHit)break}}if(o&&o.isHit){s.colliderDo(t);break}}}for(let s=0;s<this.dropItemGrip.numChildren;s++){let n=this.dropItemGrip.getChildAt(s);if(n&&!n.destroyed){let s,r=n.getComponent(T),l=n.transform.position.clone(),h=this.colliderIndexJudge(l);if(i=this.runMoveComp.model.transform.position.clone(),a=this.colliderIndexJudge(i),!r.isActive&&Math.abs(h-a)<=2&&(s=p.BoxCheck_2D_Normal(i.z,i.x,M.itemSize,M.itemSize,l.z,l.x,M.itemSize,M.itemSize)).isHit){r.colliderDo();break}for(let n=0;n<o.numChildren;n++)if((e=o.getChildAt(n))&&!e.destroyed){if(i=e.transform.position.clone(),!(t=e.getComponent(V)).colliderActive)continue;if(a=this.colliderIndexJudge(i),!r.isActive&&Math.abs(h-a)<=1&&(s=p.BoxCheck_2D_Normal(i.z,i.x,M.itemSize,M.itemSize,l.z,l.x,M.itemSize,M.itemSize)).isHit){r.colliderDo();break}}}}}}colliderIndexJudge(e){return Math.floor((e.z-this.roadLength)/this.colliderRange)}sold(e){let t=0,a=1;t=3==e.itemState?30:10*(e.itemState+1);let o=e.diamondLevel-1;if(o<0&&(o=0),t+=10*o,3==e.itemState)switch(e.jewelryType){case l.Ring:t+=20;break;case l.Earring:t+=30;break;case l.Bracelet:t+=40}if(e.isReal&&(t+=20),t+=10*e.isCleanState,e.diamondObj){let t=0;e.diamondType>=2&&e.diamondType<=3?t=.1:e.diamondType>3&&(t=.1+.1*(e.diamondType-3)),a+=t}if(3==e.itemState){let t=0;e.jewelryLevel>=2&&e.jewelryLevel<=3?t=.1:e.jewelryLevel>3&&(t=.1+.1*(e.jewelryLevel-3)),a+=t}let i=c.ReadStoreLevel(),s=0;for(let e=0;e<i.length;e++)i[e]>0&&s++;let n=.13*s+1,r=Math.round(t*a*n);return this.moneyCount+=r,r}checkStore(){let e=m.instance.endSoldPanel;e.set_visible(!0);let t=e.getChildByName("soldBtn");p.d2_AddClickEvent(t,this,this.endSold);let a=this.mainCamera,o=t=>{this.updateEndShop(e,a,t)};for(let t=1;t<=6;t++){let a=e.getChildAt(t);o(t),p.d2_AddClickEvent(a,this,()=>{this.upgareShopDo(t-1)})}}checkStoreHome(e){this.homePanel=e,e.set_visible(!0);let t=e.getChildByName("soldBtn");this.homeEndShopCam.active=!0,p.d2_AddClickEvent(t,this,this.closeStoreHome);let a=this.homeEndShopCam.getChildAt(0).getChildAt(0),o=t=>{this.updateEndShop(e,a,t)};for(let t=1;t<=6;t++){let a=e.getChildAt(t);o(t),p.d2_AddClickEvent(a,this,()=>{this.upgareShopDo(t-1)})}}closeStoreHome(){this.shopClickOff(),this.homePanel&&(this.homeEndShopCam.active=!1,this.homePanel.set_visible(!1),e.event(o.Home_CloseEndShop_Event))}updateEndShop(e,t,a){let o=c.ReadStoreLevel(),i=this.soldStores[a-1].getChildByName("Scene0"),s=this.soldStores[a-1].getChildByName("Scene1");if(s.active=o[a-1]>0,i.active=!s.active,this.nowShopCam=t,this.nowShopPanel=e,this.shop3DUIUpdate(),e){this.shopClickOn();let i,s=e.getChildAt(a),n=s.getChildByName("levelValue"),r=s.getChildByName("value"),l=s.getChildByName("icon"),h=c.ReadCoin()>=M.endShopCost[a-1];n.value=o[a-1].toString(),h?(l.skin=this.moneyUrl,r.value=M.endShopCost[a-1].toString()):(l.skin=this.videoUrl,r.value="0/1"),o[a-1]>0?(i=p.d3_getSpritePosBySprite3DPoint(t,this.soldStores[a-1].getChildByName("Scene1").getChildByName("ui")),s.set_visible(!0)):(i=p.d3_getSpritePosBySprite3DPoint(t,this.soldStores[a-1]),s.set_visible(!1)),s.set_visible(!1),s.x=i.x,s.y=i.y}}shop3DUIUpdate(){for(let e=0;e<6;e++){let t,a=this.soldStores[e].getChildByName("Scene0").getChildAt(0),o=c.ReadCoin()>=M.endShopCost[e],i=a.getChildByName("Money"),s=a.getChildByName("Video"),n=a.getChildByName("Panel").getChildByName("OutLine"),r=n.meshRenderer.material.clone();r.albedoColor=o?new Laya.Vector4(1,0,0,1):new Laya.Vector4(1,1,1,1),n.meshRenderer.material=r,i.active=!0,s.active=!1,t=i.getChildByName("number"),this.numberDealEndShop(t,M.endShopCost[e])}}shopClickOn(){this.shopClickOff(),e.on(h.singleTouchStart,this,this.onShopEmptyClick)}onShopEmptyClick(e){let t=e.stageX,a=e.stageY,o=-1;for(let e=0;e<6;e++){let i=p.d3_getSpritePosBySprite3DPoint(this.nowShopCam,this.soldStores[e].getChildByName("Scene0").getChildAt(0)),s=Math.abs(t-i.x),n=Math.abs(a-i.y);s<100&&n<100&&(o=e)}o>=0&&0==c.ReadStoreLevel()[o]&&(this.upgareShopDo(o),g.play(i.Button))}shopClickOff(){e.off(h.singleTouchStart,this,this.onShopEmptyClick)}upgareShopDo(e){let t=()=>{c.AddStoreLevel(e),this.updateEndShop(this.nowShopPanel,this.nowShopCam,e+1);let t=this.soldStores[e].getChildByName("Scene1");t.active=!0;let a=t.getComponent(x);a||(a=t.addComponent(x)),a.tweenBornDo(),g.play(i.Unclock)};c.ReadCoin()>=M.endShopCost[e]?(c.AddCoin(-M.endShopCost[e]),t()):d.instance.showToast("金币不足")}endSold(){this.shopClickOff(),m.instance.endSoldPanel.set_visible(!1);let e=A.instance.items,t=[],a=c.ReadStoreLevel();for(let e=0;e<a.length;e++)a[e]>0&&t.push(this.soldStores[e]);let o=t.length;o>=e.numChildren&&(o=e.numChildren),g.play(i.GetMoney),Laya.timer.once(500,this,()=>{g.play(i.Cheer)});for(let a=e.numChildren-1;a>=0;a--){let i=e.getChildAt(a),s=i.getComponent(V),n=this.sold(s);if(a<o){n+=this.sold(s);let e=t[a].getChildByName("Scene1").getChildByName("Char").getComponent(Laya.Animator),o=t[a].getChildByName("Scene1").getChildByName("soldPoint");p.d3_addChildNotMove(i,o),s.selfTween.toTween(i,{pos:new Laya.Vector3},500,()=>{e.play("cheer",0,0);let o=p.d3_getSpritePosBySprite3DPoint(this.mainCamera,t[a]);for(let e=0;e<1;e++){let e=_.bornStageObj("Money_Deck_1",this.moneyGrip);e.transform.localPosition=new Laya.Vector3(0,.09*this.moneyGrip.numChildren,0),e.addComponent(x).tweenBornDo()}let i=p.d3_getSpritePosBySprite3DPoint(this.mainCamera,this.endBox);i.x-=35,i.y-=27,p.d2_coinCollectAnim("ui/game/ksy_tb_jq.png",new Laya.Vector2(o.x,o.y),new Laya.Vector2(i.x,i.y),m.instance.scene,10,1,()=>{})},null,!0)}}Laya.timer.once(1500,this,()=>{this.roundEnd()})}numberShow(e,t,a){let o=a%4*.25,i=.25*Math.floor(a/4),s=e.getChildAt(t),n=s.meshRenderer.material.clone(),r=new Laya.Vector4(1,1,o,-i);n.tilingOffset=r,s.meshRenderer.material=n}numberDeal(e,t){let a,o=Math.floor(t/1e3),i=Math.floor(t%1e3/100),s=Math.floor(t%100/10),n=Math.floor(t%10),r=(t,a)=>{this.numberShow(e,t,a)},l=1;switch(0!=o?(l=4,r(0,o),r(1,i),r(2,s)):0!=i?(l=3,r(1,i),r(2,s)):0!=s&&(l=2,r(2,s)),r(3,n),p.d3_unactiveAllChildren(e),l){case 1:(a=e.getChildAt(3)).transform.localPosition=new Laya.Vector3(-.0375,0,0),a.active=!0;break;case 2:for(let t=0;t<2;t++)(a=e.getChildAt(2+t)).transform.localPosition=new Laya.Vector3(0-.075*t,0,0),a.active=!0;break;case 3:for(let t=0;t<3;t++)(a=e.getChildAt(1+t)).transform.localPosition=new Laya.Vector3(.0375-.075*t,0,0),a.active=!0;break;case 4:for(let t=0;t<4;t++)(a=e.getChildAt(t)).transform.localPosition=new Laya.Vector3(.075-.075*t,0,0),a.active=!0}}numberDealEndShop(e,t){e.transform.localScale=new Laya.Vector3(1.5,1.5,1.5);let a,o=Math.floor(t/1e4),i=Math.floor(t%1e4/1e3),s=Math.floor(t%1e3/100),n=Math.floor(t%100/10),r=Math.floor(t%10),l=(t,a)=>{this.numberShow(e,t,a)},h=1;switch(0!=o?(h=5,l(0,o),l(1,i),l(2,s),l(3,n)):0!=i?(h=4,l(1,i),l(2,s),l(3,n)):0!=s?(h=3,l(2,s),l(3,n)):0!=n&&(h=2,l(3,n)),l(4,r),p.d3_unactiveAllChildren(e),h){case 1:(a=e.getChildAt(4)).transform.localPosition=new Laya.Vector3(-.0375,0,0),a.active=!0;break;case 2:for(let t=0;t<2;t++)(a=e.getChildAt(3+t)).transform.localPosition=new Laya.Vector3(0-.075*t,0,0),a.active=!0;break;case 3:for(let t=0;t<3;t++)(a=e.getChildAt(2+t)).transform.localPosition=new Laya.Vector3(.0375-.075*t,0,0),a.active=!0;break;case 4:for(let t=0;t<4;t++)(a=e.getChildAt(1+t)).transform.localPosition=new Laya.Vector3(.075-.075*t,0,0),a.active=!0;break;case 5:for(let t=0;t<5;t++)(a=e.getChildAt(t)).transform.localPosition=new Laya.Vector3(.1125-.075*t,0,0),a.active=!0}}controlOn(){e.on(h.singleTouchStart,this,this.onMouseDown),e.on(h.singleTouchMove,this,this.onMouseMove),e.on(h.singleTouchEnd,this,this.onMouseUp)}controlOff(){e.off(h.singleTouchStart,this,this.onMouseDown),e.off(h.singleTouchMove,this,this.onMouseMove),e.off(h.singleTouchEnd,this,this.onMouseUp)}onMouseDown(e){this.isPressed=!0,this.orignal=e.stageX/Laya.stage.width,this.runMoveComp&&this.runMoveComp.checkOut()}onMouseMove(e){if(this.isPressed){let t=e.stageX/Laya.stage.width-this.orignal;this.runMoveComp&&this.runMoveComp.checkWay(2*t)&&(this.orignal=e.stageX/Laya.stage.width)}}onMouseUp(){this.isPressed=!1,this.runMoveComp&&this.runMoveComp.checkOut()}}class O extends y{constructor(){super(...arguments),this.coinUrl="ui/game/ksy_tb_jq.png"}init(){this.updateCoinUI(),this.stageValue.value=c.ReadGrade().toString(),this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?3*k.instance.moneyCount:k.instance.moneyCount).toString(),v.toScale(this.icon,0,1,500,Laya.Ease.elasticOut)}initEvent(){this.videoCheckBox.on("change",this,()=>{this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?3*k.instance.moneyCount:k.instance.moneyCount).toString()}),p.d2_AddClickEvent(this.btnContinue,this,this.onBtnContinueClick)}onBtnContinueClick(){let t=this,a=a=>{this.btnContinue.offAllCaller(this),c.AddCoin(a?3*k.instance.moneyCount:k.instance.moneyCount),t.updateCoinUI(),g.play(i.GetMoney),p.d2_coinCollectAnim(this.coinUrl,new Laya.Vector2(t.btnContinue.x,t.btnContinue.y),new Laya.Vector2(t.coinValue.x,t.coinValue.y),t.scene,10,1,()=>{k.instance.isWin&&c.AddGrade(),e.event(o.Scene_GoHome)})};this.videoCheckBox.selected?d.instance.showVideo(()=>{a(!0)},()=>{d.instance.showToast("未看完视频，没有奖励")}):a(!1)}updateCoinUI(){this.coinValue.value=c.ReadCoin().toString()}}class R{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("Scenes/Game.ts",m),e("Tools/ctrl/TouchCtrl.ts",C),e("Tools/ctrl/TouchScan.ts",f),e("Scenes/Home.ts",L),e("Scenes/Load.ts",S),e("Scenes/Over.ts",O)}}R.width=750,R.height=1334,R.scaleMode="fixedwidth",R.screenMode="vertical",R.alignV="middle",R.alignH="center",R.startScene="scenes/Game.scene",R.sceneRoot="",R.debug=!1,R.stat=!1,R.physicsDebug=!1,R.exportSceneToJson=!0,R.init();class E extends d{init(){super.init(),this.platformApi=Laya.Browser.window.wx,this.showShareMenuWithTicket(!0),this.regisiterWXShareCallback()}showToast(e,t=1500){Laya.Browser.window.wx.showToast({title:e,icon:"none",duration:t})}showShareMenuWithTicket(e){wx.showShareMenu({withShareTicket:e,success:function(){},fail:function(){},complete:function(){}})}regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var e={title:"分享",image:""};Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:e.title,imageUrl:e.image,query:"share_id=1"}})}}}class z{static init(){this.isStatShow&&Laya.Stat.show(),this.game=new k,this.goLoad(),w.addLoadRes(a.SubPackage),w.addLoadRes(a.Scene3D),g.init(),c.CheckPlayerData(),Laya.Browser.onWeiXin?this.platform=new E:this.platform=new d,this.platform.init();this.platform.loadSubPackage(this.subPackageName,e=>{e&&(w.removeLoadRes(a.SubPackage),this.load3DRes(this.scene3DUrl))})}static sceneEventOn(){e.on(o.Scene_GoHome,this,this.goHome),e.on(o.Scene_GoGame,this,this.goGame),e.on(o.Scene_GoOver,this,this.goOver)}static goLoad(){this.sceneEventOn(),this.openScene(t.Load)}static goHome(){this.closeScene(t.Load),this.closeScene(t.Over),this.openScene(t.Home),this.game.levelInit()}static goGame(){this.closeScene(t.Home),this.openScene(t.Game),this.game.gameStart()}static goOver(){this.closeScene(t.Game),this.openScene(t.Over)}static load3DRes(e){var t=[{url:e,clas:Laya.Scene3D,priority:1}];Laya.loader.create(t,Laya.Handler.create(this,this.onLoadFinished,[{target:"3dRes"}],!1),Laya.Handler.create(this,this.onLoading,null,!1)),Laya.loader.on(Laya.Event.ERROR,this,t=>{console.error("资源加载失败",t),this.load3DRes(e)})}static onLoadFinished(e){console.log("资源加载完成",e),this.loadSceneRes(),w.removeLoadRes(a.Scene3D)}static onLoading(e){}static loadSceneRes(){let e=Laya.loader.getRes(this.scene3DUrl);Laya.stage.addChild(e),Laya.stage.setChildIndex(e,0),this.game.mainScene=e,this.game.firstIn()}static openScene(e,t){Laya.Scene.open(e,!1,null,Laya.Handler.create(this,e=>{Laya.stage.addChild(e),t&&t()}))}static closeScene(e,t){Laya.Scene.close(e)&&t&&t()}static checkPerformance(e,t,a){let o=0,i=100,s=i;Laya.timer.loop(100,this,function addValue(){o+=1e3/Laya.timer.delta;s--;if(s<=0){Laya.timer.clear(this,addValue);let s=o/i;s>50?e&&e():s>40?t&&t():a&&a()}})}}z.subPackageName="scene",z.scene3DUrl="res/scene/Conventional/ResScene.ls",z.isStatShow=!1;new class{constructor(){window.Laya3D?Laya3D.init(R.width,R.height):Laya.init(R.width,R.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=R.scaleMode,Laya.stage.screenMode=R.screenMode,Laya.stage.alignV=R.alignV,Laya.stage.alignH=R.alignH,Laya.URL.exportSceneToJson=R.exportSceneToJson,(R.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),R.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),R.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){z.init()}}}();