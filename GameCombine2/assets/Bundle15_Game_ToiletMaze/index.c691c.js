window.__require=function t(e,o,i){function n(r,c){if(!o[r]){if(!e[r]){var l=r.split("/");if(l=l[l.length-1],!e[l]){var a="function"==typeof __require&&__require;if(!c&&a)return a(l,!0);if(s)return s(l,!0);throw new Error("Cannot find module '"+r+"'")}r=l}var h=o[r]={exports:{}};e[r][0].call(h.exports,function(t){return n(e[r][1][t]||t)},h,h.exports,t,e,o,i)}return o[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<i.length;r++)n(i[r]);return n}({ToiletMaze_Game:[function(t,e,o){"use strict";cc._RF.push(e,"a5393xsZz9G243FUFB6B8Up","ToiletMaze_Game");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),s=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../Bundle1_Loading/Scripts/Config/EnumTypes"),c=t("../../../Bundle1_Loading/Scripts/Mgr/AssetMgr"),l=t("../../../Bundle1_Loading/Scripts/Mgr/EventMgr"),a=t("../../../Bundle1_Loading/Scripts/Mgr/SoundMgr"),h=t("../../../Bundle1_Loading/Scripts/Mgr/StorageMgr"),p=t("../../../Bundle1_Loading/Scripts/Tool/Tool"),u=t("../../../Bundle2_Res/Scripts/ResPanelOpen"),d=t("../../../Bundle2_Res/Scripts/ResPrefabBorn"),v=t("./ToiletMaze_Level"),_=t("./ToiletMaze_Role"),f=cc._decorator,g=f.ccclass,y=f.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mask=null,e.graphics=null,e.level=null,e.lblLevel=null,e.role=null,e.toilet=null,e.obsNode=null,e.finger=null,e.levels=[],e.levelsTips=[],e.wall=null,e.maxLevel=200,e._physicsMgr=cc.director.getPhysicsManager(),e._collisionMgr=cc.director.getCollisionManager(),e._points=[],e._lineLength=10,e._canDraw=!1,e._curLevel=1,e._curLevelComp=null,e._curLevelTips=[],e.heightAddHeight=0,e.isRight=!1,e.isEnd=!1,e}var o;return n(e,t),o=e,e.prototype.start=function(){l.EventMgr.on(r.EventType.Game_Retry_Event,this.restart,this),l.EventMgr.on(r.EventType.Game_NextLevel_Event,this.nextLevel,this),l.EventMgr.on(r.EventType.Game_PassLevel_Event,this.passLevel,this),l.EventMgr.on(r.EventType.Game_ShowTips_Event,this.onBtnTips,this),l.EventMgr.on(r.EventType.Game_PowerLess_Event,this.showPowerLessUI,this),this._physicsMgr.enabled=!0,this._collisionMgr.enabled=!0;var t=cc.find("Canvas");this.heightAddHeight=(t.height-1334)/2,this.canvas=t;var e=cc.instantiate(this.wall);e.parent=this.mask,e.setPosition(0,0,0);var o=h.default.instance.storageData.tolietMazeData;this._curLevel=o.maxLevel,this.initLevel(this._curLevel)},e.prototype.onDestroy=function(){},e.prototype.showPowerLessUI=function(){u.default.show_Game_PowerLess_Panel(cc.find("Canvas"))},e.prototype.initLevel=function(t){var e=this;if(h.default.instance.usePower(),this.isEnd=!1,this.level.destroyAllChildren(),this._curLevelTips=[],this.role.node.active=!1,this.toilet.active=!1,this.switchEvent(!1),this.lblLevel.string="\u7b2c"+this._curLevel+"\u5173",t>this.maxLevel&&(t=p.Tool.randomInt(1,this.maxLevel)),t<=3){var i=cc.instantiate(this.levels[t-1]);i.parent=this.level,this._curLevelComp=i.getComponent(v.default),this.role.node.active=!0,this.toilet.active=!0;var n=this._curLevelComp.getObs();if(n.childrenCount>0)for(var s=0;s<n.childrenCount;s++){var r=n.children[s],c=cc.instantiate(this.obsNode);c.parent=r,c.setPosition(0,0,0)}for(this.initData(),s=0;s<this.levelsTips[t-1].json.length;s++){var l=this.levelsTips[t-1].json[s];this._curLevelTips.push(new cc.Vec2(l.x,l.y))}1==this._curLevel&&(this.showTips(),this.showFinger())}else o.loadRes("Level/Level"+t,cc.Prefab,function(i,n){if(i)console.log(i,"error");else{var s=cc.instantiate(n);s.parent=e.level,e._curLevelComp=s.getComponent(v.default),e.role.node.active=!0,e.toilet.active=!0;var r=e._curLevelComp.getObs();if(r.childrenCount>0)for(var c=0;c<r.childrenCount;c++){var l=r.children[c],a=cc.instantiate(e.obsNode);a.parent=l,a.setPosition(0,0,0)}e.initData(),o.loadRes("Tips/Level"+t,cc.JsonAsset,function(t,o){if(t)console.log(t,"error");else{for(var i=0;i<o.json.length;i++){var n=o.json[i];e._curLevelTips.push(new cc.Vec2(n.x,n.y))}1==e._curLevel&&(e.showTips(),e.showFinger())}})}})},e.prototype.initData=function(){this.isEnd=!1,this.switchEvent(!0),cc.Tween.stopAllByTarget(this.role.node),this.unscheduleAllCallbacks(),this._points=[],this.graphics.clear(),this.role.setAni("Idle"),this.role.node.position=this._curLevelComp.getStartPointInWord(),this.role.node.scaleX=this._curLevelComp.getStartPointScaleX(),this.toilet.position=this._curLevelComp.getEndPointInWord(),this.resetRightAndWrong()},e.prototype.nextLevel=function(){this.resetRightAndWrong(),this.initLevel(this._curLevel)},e.prototype.restart=function(){this.isEnd||this.initData()},e.prototype.onBtnTips=function(){this.isEnd||this.showTips()},e.prototype.passLevel=function(){this.isEnd||(h.default.instance.addLevel(r.GameNames.tolietMaze),this._curLevel=h.default.instance.storageData.tolietMazeData.maxLevel,this.initLevel(this._curLevel),this.resetRightAndWrong())},e.prototype.resetRightAndWrong=function(){this.wrong&&this.wrong.isValid&&this.wrong.destroy(),this.right&&this.right.isValid&&this.right.destroy(),this.isRight=!1},e.prototype.onTouchStart=function(t){var e=t.getLocation(),o=this.graphics.node.parent.convertToNodeSpaceAR(t.getLocation());this.checkInNode(o,this.role.node)&&(1==this._curLevel&&this.showFinger(!1),this.graphics.clear(),this.graphics.strokeColor=new cc.Color(0,0,0,255),this.pushInPoints(o),this.graphics.moveTo(e.x,e.y))},e.prototype.onTouchMove=function(t){if(!(this._points.length<=0)){var e=t.getLocation(),o=this.graphics.node.parent.convertToNodeSpaceAR(t.getLocation());e.sub(this._points[this._points.length-1]).mag()>=this._lineLength&&this.checkRay(this._points[this._points.length-1],o)&&(this.graphics.lineTo(e.x,e.y),this.graphics.stroke(),this.pushInPoints(o))}},e.prototype.onTouchEnd=function(){this._points.length<=0||(this.switchEvent(!1),this.role.setAni("Run"),this.runRole())},e.prototype.checkPoint=function(t){return!!this._physicsMgr.testPoint(t)},e.prototype.checkRay=function(t,e){return t=this.mask.convertToWorldSpaceAR(t),e=this.mask.convertToWorldSpaceAR(e),0==this._physicsMgr.rayCast(t,e,cc.RayCastType.All).length},e.prototype.checkInNode=function(t,e){var o=e.parent.convertToWorldSpaceAR(e.getPosition());return t.x>=o.x-e.width/2&&t.x<=o.x+e.width/2&&t.y>=o.y&&t.y<=o.y+e.height},e.prototype.runRole=function(t,e){var o=this;if(void 0===t&&(t=0),void 0===e&&(e=.03),this.checkInNode(this._points[t],this.toilet))return this.isEnd=!0,console.log("\u6e38\u620f\u6210\u529f"),this.role.setAni("Idle"),a.default.instance.PlaySound(r.SoundType.True),d.default.gameOverFxCreate(!0,cc.find("Canvas")),h.default.instance.addLevel(r.GameNames.tolietMaze),this._curLevel=h.default.instance.storageData.tolietMazeData.maxLevel,void this.scheduleOnce(function(){a.default.instance.PlaySound(r.SoundType.Win),o.isEnd=!1,o.right&&o.right.isValid&&o.right.destroy(),u.default.show_Result_Success_Panel(cc.find("Canvas"))},1.5);if(t==this._points.length-1)return this.isEnd=!0,console.log("\u6e38\u620f\u5931\u8d25"),a.default.instance.PlaySound(r.SoundType.Lose),d.default.gameOverFxCreate(!1,cc.find("Canvas")),void this.scheduleOnce(this.initData,1.5);this._points[t-1]&&(this.role.node.scaleX=this._points[t].x>this._points[t-1].x?1:-1);var i=this._points[t].sub(this._points[t+1]).mag()/this._lineLength*.03;cc.tween(this.role.node).to(e,{x:this._points[t].x,y:this._points[t].y}).call(function(){o.runRole(t+1,i)}).start()},e.prototype.switchEvent=function(t){this._canDraw=t,t?(this.graphics.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.graphics.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.graphics.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)):(this.graphics.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.graphics.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.graphics.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this))},e.prototype.pushInPoints=function(t){t.x=Number(t.x.toFixed(2)),t.y=Number(t.y.toFixed(2)),this._points.push(t)},e.prototype.showTips=function(){if(this._curLevelTips.length>0&&this._canDraw){this.graphics.strokeColor=new cc.Color(255,0,0,255);for(var t=0;t<this._curLevelTips.length;t++){var e=this._curLevelTips[t];0==t?this.graphics.moveTo(e.x,e.y+this.heightAddHeight):this.graphics.lineTo(e.x,e.y+this.heightAddHeight)}this.graphics.stroke()}},e.prototype.showFinger=function(t){void 0===t&&(t=!0),t?this._curLevelTips.length>0&&(this.finger.setPosition(this._curLevelTips[0].x,this._curLevelTips[0].y,0),this.runFinger()):cc.Tween.stopAllByTarget(this.finger),this.finger.active=t},e.prototype.runFinger=function(t,e){var o=this;if(void 0===t&&(t=1),void 0===e&&(e=.01),t==this._curLevelTips.length-1)return this.finger.setPosition(this._curLevelTips[0].x,this._curLevelTips[0].y,0),void this.runFinger(1,.01);var i=this._curLevelTips[t].sub(this._curLevelTips[t+1]).mag()/this._lineLength*.01;cc.tween(this.finger).to(e,{position:new cc.Vec3(this._curLevelTips[t].x,this._curLevelTips[t].y,0)}).call(function(){o.runFinger(t+1,i)}).start()},e.loadRes=function(t,e,o){c.default.loadToiletMazeRes(t,e,o)},s([y(cc.Node)],e.prototype,"mask",void 0),s([y(cc.Graphics)],e.prototype,"graphics",void 0),s([y(cc.Node)],e.prototype,"level",void 0),s([y(cc.Label)],e.prototype,"lblLevel",void 0),s([y(_.default)],e.prototype,"role",void 0),s([y(cc.Node)],e.prototype,"toilet",void 0),s([y(cc.Node)],e.prototype,"obsNode",void 0),s([y(cc.Node)],e.prototype,"finger",void 0),s([y([cc.Prefab])],e.prototype,"levels",void 0),s([y([cc.JsonAsset])],e.prototype,"levelsTips",void 0),s([y(cc.Prefab)],e.prototype,"wall",void 0),o=s([g],e)}(cc.Component);o.default=T,cc._RF.pop()},{"../../../Bundle1_Loading/Scripts/Config/EnumTypes":void 0,"../../../Bundle1_Loading/Scripts/Mgr/AssetMgr":void 0,"../../../Bundle1_Loading/Scripts/Mgr/EventMgr":void 0,"../../../Bundle1_Loading/Scripts/Mgr/SoundMgr":void 0,"../../../Bundle1_Loading/Scripts/Mgr/StorageMgr":void 0,"../../../Bundle1_Loading/Scripts/Tool/Tool":void 0,"../../../Bundle2_Res/Scripts/ResPanelOpen":void 0,"../../../Bundle2_Res/Scripts/ResPrefabBorn":void 0,"./ToiletMaze_Level":"ToiletMaze_Level","./ToiletMaze_Role":"ToiletMaze_Role"}],ToiletMaze_Level:[function(t,e,o){"use strict";cc._RF.push(e,"0eb20kRkqdDFYiydKEEOvgY","ToiletMaze_Level");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),s=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass,l=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.startPoint=null,e.endPoint=null,e.obs=null,e}return n(e,t),e.prototype.start=function(){},e.prototype.getStartPointInWord=function(){return this.startPoint.parent.convertToWorldSpaceAR(this.startPoint.position)},e.prototype.getStartPointScaleX=function(){return this.startPoint.scaleX},e.prototype.getEndPointInWord=function(){return this.endPoint.parent.convertToWorldSpaceAR(this.endPoint.position)},e.prototype.getObs=function(){return this.obs},s([l(cc.Node)],e.prototype,"startPoint",void 0),s([l(cc.Node)],e.prototype,"endPoint",void 0),s([l(cc.Node)],e.prototype,"obs",void 0),s([c],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],ToiletMaze_Role:[function(t,e,o){"use strict";cc._RF.push(e,"65c67akaEpI/5pmsQmVLYun","ToiletMaze_Role");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),s=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass,l=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.roleAni=null,e._curAni=null,e}return n(e,t),e.prototype.start=function(){},e.prototype.setAni=function(t,e){void 0===e&&(e=!0),this._curAni!=t&&this.roleAni.setAnimation(0,t,e)},s([l(sp.Skeleton)],e.prototype,"roleAni",void 0),s([c],e)}(cc.Component);o.default=a,cc._RF.pop()},{}]},{},["ToiletMaze_Game","ToiletMaze_Level","ToiletMaze_Role"]);