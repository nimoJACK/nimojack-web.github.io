!function(){"use strict";class e extends Laya.Scene{onAwake(){this.height=Laya.stage.height,this.init()}init(){}}class t{static GetPlayerData(){let e;return(e=Laya.LocalStorage.getJSON("PlayerData"))||(e={ver:1,grade:1,coin:0,nowPeople:0,peopleActive:[!0,!1,!1,!1,!1,!1,!1,!1,!1],lockAxis:0,energy:20,lastEnergyTime:(new Date).getTime()},Laya.LocalStorage.setJSON("PlayerData",e),e)}static SavePlayerData(e){Laya.LocalStorage.setJSON("PlayerData",e)}static clearPlayerData(){Laya.LocalStorage.clear()}static CheckPlayerData(){let e;(e=Laya.LocalStorage.getJSON("PlayerData")).ver&&1==e.ver||(e={ver:1,grade:1,coin:0,nowPeople:0,peopleActive:[!0,!1,!1,!1,!1,!1,!1,!1,!1],lockAxis:0},Laya.LocalStorage.setJSON("PlayerData",e))}}var a,n,s,o,i,r,l;!function(e){e.Loading="UIScene/Loading.scene",e.BusyLoading="UIScene/BusyLoading.scene",e.Home="UIScene/Home.scene",e.Game="UIScene/Game.scene",e.Game3D="UIScene/Game3D.scene",e.Reborn="UIScene/Reborn.scene",e.Settlement="UIScene/Settlement.scene",e.Mission="UIScene/Mission.scene",e.Skin="UIScene/Skin.scene",e.FreeSkin="UIScene/FreeSkin.scene",e.Sign="UIScene/Sign.scene",e.Offline="UIScene/Offline.scene",e.Strength="UIScene/Strength.scene",e.SignTips="UIScene/SignTips.scene",e.Busy="UIScene/Busy.scene",e.Background="UIScene/Background.scene",e.Box="UIScene/Box.scene",e.Clean="UIScene/Clean.scene"}(a||(a={})),function(e){e.BoxItem="prefab/BoxItem.prefab",e.FontDamaged="prefab/FontDamaged.prefab",e.CompoundItem="prefab/CompoundItem.prefab"}(n||(n={})),function(e){e.BGM="Bgm",e.CLICK="Click",e.Select="Select",e.Win="Win"}(s||(s={}));class h{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(e){return Math.round(10*e)}toTween(e,t,a,n,s=!0){this.target=e,this.isLocal=s;var o={},i={};if(t.pos){var r=s?e.transform.localPosition.clone():e.transform.position.clone();o.posX=r.x,o.posY=r.y,o.posZ=r.z,i.posX=t.pos.x,i.posY=t.pos.y,i.posZ=t.pos.z}if(t.rot){var l=s?e.transform.localRotationEuler.clone():e.transform.rotationEuler.clone();o.rotX=l.x,o.rotY=l.y,o.rotZ=l.z,i.rotX=t.rot.x,i.rotY=t.rot.y,i.rotZ=t.rot.z}if(t.sca){var h=e.transform.getWorldLossyScale().clone();o.scaX=h.x,o.scaY=h.y,o.scaZ=h.z,i.scaX=t.sca.x,i.scaY=t.sca.y,i.scaZ=t.sca.z}return this.tween.to(o,{posX:i.posX,posY:i.posY,posZ:i.posZ,rotX:i.rotX,rotY:i.rotY,rotZ:i.rotZ,scaX:i.scaX,scaY:i.scaY,scaZ:i.scaZ},a,null,Laya.Handler.create(this,()=>{n&&n();var e=this.tweens.shift();e&&this.toTween(this.target,e.value,e.time,e.completeFun)})),this.tween.update=new Laya.Handler(this,()=>{t.pos&&(s?e.transform.localPosition=new Laya.Vector3(o.posX,o.posY,o.posZ):e.transform.position=new Laya.Vector3(o.posX,o.posY,o.posZ)),t.rot&&(s?e.transform.localRotationEuler=new Laya.Vector3(o.rotX,o.rotY,o.rotZ):e.transform.rotationEuler=new Laya.Vector3(o.rotX,o.rotY,o.rotZ)),t.sca&&e.transform.setWorldLossyScale(new Laya.Vector3(o.scaX,o.scaY,o.scaZ))}),this}clearTween(e){this.tweens=[],this.tween.clear(),this.target&&e&&(e.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z):this.target.transform.position=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z)),e.rot&&(this.target.transform.rotationEuler=new Laya.Vector3(e.rot.x,e.rot.y,e.rot.z)),e.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(e.sca.x,e.sca.y,e.sca.z)))}then(e,t,a){return this.tweens.push({value:e,time:t,completeFun:a}),this}}class c{static loadScene(e,t=0,a=(()=>{}),n=null){e&&Laya.Scene.open(e,!1,n,Laya.Handler.create(this,e=>{Laya.stage.addChild(e),e.zOrder=t,a()}))}static d2_AddClickEvent(e,t,a,n,o=!1,i=!0,r=!0){e.offAllCaller(t);let l=e.scaleX,h=.9*l,c=!1;e.on(Laya.Event.MOUSE_DOWN,t,t=>{c=!0,r&&Laya.Tween.to(e,{scaleX:h,scaleY:h},60),o&&t.stopPropagation},n);e.on(Laya.Event.MOUSE_UP,t,n=>{0!=c&&(c=!1,o&&n.stopPropagation,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),a&&a.call(t,n),g.soundController.play(s.CLICK))},n);e.on(Laya.Event.MOUSE_OUT,t,t=>{0!=c&&(c=!1,r&&Laya.Tween.to(e,{scaleX:l,scaleY:l},60),o&&t.stopPropagation)},n)}static TouchOn(e,t,a,n){Laya.stage.on(Laya.Event.MOUSE_DOWN,n,e),Laya.stage.on(Laya.Event.MOUSE_MOVE,n,t),Laya.stage.on(Laya.Event.MOUSE_UP,n,a),Laya.stage.on(Laya.Event.MOUSE_OUT,n,a)}static TouchOff(e,t,a,n){Laya.stage.off(Laya.Event.MOUSE_DOWN,n,e),Laya.stage.off(Laya.Event.MOUSE_MOVE,n,t),Laya.stage.off(Laya.Event.MOUSE_UP,n,a),Laya.stage.on(Laya.Event.MOUSE_OUT,n,a)}static buttonInit(e,t,a,n,o){if(e.offAllCaller(t),e instanceof Laya.Button&&!o){let o=e=>{g.soundController.play(s.CLICK),a&&a.call(t,e)};e.on(Laya.Event.CLICK,t,o,[n])}else{let o=60,i=1,r=e.scaleX*i,l=e.scaleY*i,h=.9*i,c=!1,d=t=>{c=!0,Laya.Tween.to(e,{scaleX:h,scaleY:h},o)};e.on(Laya.Event.MOUSE_DOWN,t,d,[n]);let u=n=>{0!=c&&(c=!1,Laya.Tween.to(e,{scaleX:r,scaleY:l},o),a&&a.call(t,n),g.soundController.play(s.CLICK))};e.on(Laya.Event.MOUSE_UP,t,u,[n]);let y=t=>{Laya.Tween.to(e,{scaleX:r,scaleY:l},o)};e.on(Laya.Event.MOUSE_OUT,t,y,[n])}}static imageButtonInit(e,t,a,n){e.offAllCaller(t);e.on(Laya.Event.MOUSE_UP,t,e=>{g.soundController.play(s.CLICK),a&&a.call(t,e)},[n])}static gameButtonOn(e,t,a,n){e.offAllCaller(t),e.on(Laya.Event.MOUSE_DOWN,t,a),e.on(Laya.Event.MOUSE_UP,t,n),e.on(Laya.Event.MOUSE_OUT,t,n)}static Vector3Add(e,t){let a=new Laya.Vector3;return Laya.Vector3.add(e,t,a),a}static Vector3Reduce(e,t){let a=new Laya.Vector3,n=c.Vector3Axis(t,-1);return a=this.Vector3Add(e,n)}static Vector2Add(e,t){return new Laya.Vector2(e.x+t.x,e.y+t.y)}static Vector2Reduce(e,t){return new Laya.Vector2(e.x-t.x,e.y-t.y)}static Vector2Scale(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}static getTransformForward(e){let t=new Laya.Vector3;return e.getForward(t),t=this.Vector3Axis(t,-1)}static Vector3Axis(e,t){let a=e.clone();return a.x*=t,a.y*=t,a.z*=t,a}static setTransRotEulerY(e,t){let a=e.localRotationEuler.clone();a.y=t,e.localRotationEuler=a}static setTransRotEulerX(e,t){let a=e.localRotationEuler.clone();a.x=t,e.localRotationEuler=a}static setTransRotEulerZ(e,t){let a=e.localRotationEuler.clone();a.z=t,e.localRotationEuler=a}static getRandomInArray(e){if(e.length){let t=Math.random()*e.length;return e[t=Math.floor(t)]}return console.log("传入错误参数,返回空"),null}static takeRandomInArray(e){if(e.length){let t=Math.random()*e.length,a=e[t=Math.floor(t)];return e.splice(t,1),a}return console.log("传入错误参数,返回空"),null}static getSpritePosBySprite3DPoint(e,t=new Laya.Vector2(0,0)){var a=e.transform.position.clone(),n=new Laya.Vector4;g.mainCam.viewport.project(a,g.mainCam.projectionViewMatrix,n);var s=new Laya.Vector2(n.x/Laya.stage.clientScaleX,n.y/Laya.stage.clientScaleY);return s.x+=t.x,s.y+=t.y,new Laya.Point(s.x,s.y)}static coinCollectAnim(e,t,a,n,s=15,o=null){for(var i=s,r=0;r<s;r++){let s=Laya.Pool.getItemByClass("coin",Laya.Image);s.skin=e,s.x=t.x,s.y=t.y,s.scale(.8,.8),n.addChild(s);let r=300+100*Math.random()-50;Laya.Tween.to(s,{x:s.x+250*Math.random()-125,y:s.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(s,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){n.removeChild(s),Laya.Pool.recover("coin",s),0==--i&&o&&o(n)}))})}}static coinCollectAnimAni(e,t,a,n,s=15,o=null){for(var i=s,r=0;r<s;r++){let s=Laya.Pool.getItemByClass("coinAnim",Laya.Clip);s.skin=e.skin,s.index=e.index,s.clipX=e.clipX,s.clipY=e.clipY,s.autoPlay=e.autoPlay,s.x=t.x,s.y=t.y,s.scale(.8,.8),n.addChild(s);let r=300+100*Math.random()-50;Laya.Tween.to(s,{x:s.x+250*Math.random()-125,y:s.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(s,{x:a.x,y:a.y},400,null,new Laya.Handler(this,function(){n.removeChild(s),Laya.Pool.recover("coinAnim",s),0==--i&&o&&o(n)}))})}}static numberTo(e,t,a){return e<t?e+=a:e>t&&(e-=a),Math.abs(t-e)<a&&(e=t),e}static findNodeByName(e,t){let a=null,n=e=>{for(let s=0;s<e.numChildren;s++){if(e.getChildAt(s).name==t)return void(a=e.getChildAt(s));n(e.getChildAt(s))}};return n(e),a}static loadJsonFile(e,t){Laya.loader.load(e,Laya.Handler.create(this,a=>{var n=Laya.loader.getRes(e);t(n)}),null,Laya.Loader.JSON)}static objectShake(e,t=1,a=.7){var n=t,s=1,o=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(n>0){var t=new Laya.Vector3;Laya.Vector3.scale((i=Math.random()>.5?Math.random():-Math.random(),r=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(i,r,0)),a,t),Laya.Vector3.add(o,t,t),e.transform.localPosition=t,n-=.02*s}else n=0,e.transform.localPosition=o,Laya.timer.clear(this,updateShake);var i,r})}static objectScaleTips(e){let t=new h,a=e.transform.localScale.clone(),n=c.Vector3Axis(a,.8),s=c.Vector3Axis(a,1.2);t.toTween(e,{sca:n},50).then({sca:s},50).then({sca:a},50)}static vibrateShort(){Laya.Browser.onWeiXin&&wx.vibrateShort({success:function(){},fail:function(){},complete:function(){}})}static delayCall(e,t){setTimeout(()=>{e()},t)}static RotateWithAxis(e,t,a,n){let s=new Laya.Vector3,o=Laya.Vector3.distance(e,t),i=new Laya.Vector3;Laya.Vector3.subtract(e,t,i),Laya.Vector3.normalize(i,i);let r=new Laya.Quaternion;return Laya.Vector3.normalize(a,a),Laya.Quaternion.createFromAxisAngle(a,n*Math.PI/180,r),Laya.Vector3.transformQuat(i,r,i),Laya.Vector3.scale(i,o,i),Laya.Vector3.add(t,i,s),s}static d3_getRgbByHex(e){var t=[],a=[];let n=e.replace(/#/,"");if(3==n.length){for(var s=[],o=0;o<3;o++)s.push(n.charAt(o)+n.charAt(o));n=s.join("")}for(o=0;o<3;o++)t[o]="0x"+n.substr(2*o,2),a.push(parseInt(t[o]));return new Laya.Vector3(a[0]/255,a[1]/255,a[2]/255)}}!function(e){e[e.Custom=0]="Custom",e[e.RubberDuck=1]="RubberDuck",e[e.HardRubber=2]="HardRubber",e[e.Jelly=3]="Jelly",e[e.SoftLatex=4]="SoftLatex"}(o||(o={}));class d extends Laya.Script3D{constructor(){super(...arguments),this.m_Presets=o.Jelly,this.m_EffectIntensity=1,this.m_Damping=.7,this.m_Mass=1,this.m_Stiffness=.2,this.V3_WorkingMesh=[],this.sleeping=!0,this.last_world_position=new Laya.Vector3,this.last_world_rotation=new Laya.Quaternion,this.maxX=0,this.minX=0,this.maxY=0,this.minY=0,this.maxZ=0,this.minZ=0}TransformPoint(e){let t=this.self.transform.position.clone();return c.Vector3Add(t,e)}InverseTransformPoint(e){let t=this.self.transform.position.clone();return c.Vector3Reduce(e,t)}getExtent(){}calcBounds(e){for(var t=0;t<e.length;t++)this.maxX=Math.max(this.maxX,e[t].x),this.maxY=Math.max(this.maxY,e[t].y),this.maxZ=Math.max(this.maxZ,e[t].z),this.minX=Math.min(this.minX,e[t].x),this.minY=Math.min(this.minY,e[t].y),this.minZ=Math.min(this.minZ,e[t].z);let a=new Laya.Vector3(this.maxX,this.maxY,this.maxZ);this.Renderer.bounds.setExtent(a);let n=this.self.transform.position.clone();this.Renderer.bounds.setMin(c.Vector3Add(n,a)),this.Renderer.bounds.setMax(c.Vector3Reduce(n,a)),this.size=new Laya.Vector3(this.maxX-this.minX,this.maxY-this.minY,this.maxZ-this.minZ)}onStart(){this.self=this.owner,this.checkPreset();var e=this.self.meshFilter;this.OriginalMesh=e.sharedMesh,this.WorkingMesh=this.OriginalMesh.clone(),e.sharedMesh=this.WorkingMesh;for(var t=[],a=0;a<this.WorkingMesh.vertexCount;a++)t.push(a);let n=[];this.WorkingMesh.getPositions(n),this.vr=[];for(a=0;a<t.length;a++){var s=t[a];this.vr[a]=new u(this.TransformPoint(n[s]),this.m_Mass,this.m_Stiffness,this.m_Damping),this.vr[a].indexId=s}this.Renderer=this.self.meshRenderer,this.calcBounds(n),this.WakeUp()}WakeUp(){for(var e=0;e<this.vr.length;e++)this.vr[e].sleeping=!1;this.sleeping=!1}onUpdate(){let e=this.self.transform.rotation.clone(),t=this.last_world_rotation.clone(),a=new Laya.Vector4(e.x,e.y,e.z,e.w),n=new Laya.Vector4(t.x,t.y,t.z,t.w);if(Laya.Vector3.equals(this.self.transform.position,this.last_world_position)&&Laya.Vector4.equals(a,n)||this.WakeUp(),!this.sleeping){this.OriginalMesh.getPositions(this.V3_WorkingMesh);for(var s=0,o=0;o<this.vr.length;o++)if(this.vr[o].sleeping)s++;else{var i=this.TransformPoint(this.V3_WorkingMesh[this.vr[o].indexId]);this.vr[o].mass=this.m_Mass,this.vr[o].stiffness=this.m_Stiffness,this.vr[o].damping=this.m_Damping,this.vr[o].intensity=(1-(this.Renderer.bounds.getMax().y-i.y)/this.size.y)*this.m_EffectIntensity,this.vr[o].update(i),i=this.InverseTransformPoint(this.vr[o].pos);let e=new Laya.Vector3;Laya.Vector3.lerp(this.V3_WorkingMesh[this.vr[o].indexId],i,this.vr[o].intensity,e),this.V3_WorkingMesh[this.vr[o].indexId]=e}this.WorkingMesh.setPositions(this.V3_WorkingMesh),Laya.Vector3.equals(this.self.transform.position,this.last_world_position)&&Laya.Vector4.equals(a,n)&&s==this.vr.length?this.sleeping=!0:(this.last_world_position=this.self.transform.position.clone(),this.last_world_rotation=this.self.transform.rotation.clone())}}checkPreset(){switch(this.m_Presets){case o.HardRubber:this.m_Mass=8,this.m_Stiffness=.5,this.m_Damping=.9,this.m_EffectIntensity=.5;break;case o.Jelly:this.m_Mass=3,this.m_Stiffness=.9,this.m_Damping=.75,this.m_EffectIntensity=.9;break;case o.RubberDuck:this.m_Mass=1,this.m_Stiffness=.6,this.m_Damping=.7,this.m_EffectIntensity=.01;break;case o.SoftLatex:this.m_Mass=.9,this.m_Stiffness=.3,this.m_Damping=.25,this.m_EffectIntensity=1}this.m_Mass=Math.max(this.m_Mass,0),this.m_Stiffness=Math.max(this.m_Stiffness,0),this.m_EffectIntensity=this.clamp(this.m_EffectIntensity,0,1)}clamp(e,t,a){return e<t?t:e>a?a:e}}class u{constructor(e,t,a,n){this.v_sleeping=!1,this.STOP_LIMIT=.001,this.vel=new Laya.Vector3,this.mass=t,this.stiffness=a,this.damping=n,this.intensity=1,this.pos=this.target=e.clone(),this.sleeping=!1}set sleeping(e){this.v_sleeping=e}get sleeping(){return this.v_sleeping}update(e){this.v_sleeping||(this.force=c.Vector3Axis(c.Vector3Reduce(e,this.pos),this.stiffness),this.acc=c.Vector3Axis(this.force,1/this.mass),this.vel=c.Vector3Axis(c.Vector3Add(this.vel,this.acc),this.damping),this.pos=c.Vector3Add(this.pos,this.vel),Laya.Vector3.scalarLength(c.Vector3Add(c.Vector3Add(this.vel,this.force),this.acc))<this.STOP_LIMIT&&(this.pos=e,this.v_sleeping=!0))}}class y{static Init(){Laya.timer.clearAll(this);for(let e=0;e<g.usingPrefabs.length;e++)g.usingPrefabs[e].destroy();this.canPickCubes=[],this.roadCubes=[],this.spring=[],this.beacon=[],this.endPos=[],this.startPos=[],this.wormHoleIn={},this.wormHoleOut={},this.trailPos=[],this.stageID=0,this.stop=[],g.collider.ColliderInit(),this.loadStageConfigs()}static PlayerInit(){g.model=g.player.getChildByName("Model");let e=this.BornObj(c.findNodeByName(g.prefabs,"qiu"));g.model.addChild(e),e.transform.localPosition=new Laya.Vector3(0,0,0),g.model.transform.localPosition=new Laya.Vector3(0,2,0);let t=e.getChildByName("qiu_0");t.getComponent(d)||t.addComponent(d),g.model.active=!0,t.meshRenderer.material=this.stageColor[2]}static loadStageConfigs(){((t.GetPlayerData().grade-1)%14+1).toString();let e=c.getRandomInArray([["ff0011","40bdff"],["00ff8a","ff60ff"],["00a3ff","ffa048"],["ffc600","9e7aff"]]),a=[];for(let t=0;t<3;t++){let n,s=new Laya.PBRStandardMaterial;0==t?(n=c.d3_getRgbByHex("FFFFFF"),s.metallic=.1,s.smoothness=0):(n=c.d3_getRgbByHex(e[t-1]),s.metallic=0,s.smoothness=.2),s.albedoColor=new Laya.Vector4(.6*n.x,.6*n.y,.6*n.z,1),a.push(s)}this.stageColor=a,c.loadJsonFile("res/Stages/StagesConfig.json",e=>{let t=e;this.roadCubes=new Array(t.length),this.endPos=new Array(t.length),this.startPos=new Array(t.length),this.canPickCubes=new Array(t.length),this.trailPos=new Array(t.length),this.cubeCount=0,this.trailCubeCount=0;let a=g.readGrade(),n=0;n=a<=t.length?a-1:Math.floor(19*Math.random())+2-1,this.stageID=0,this.roadCubes[0]=[],this.endPos[0]=[],this.startPos[0]=[],this.canPickCubes[0]=[],this.trailPos[0]=[],this.StageBornDo(t[n].stage);let s=this.cubeCount-this.trailCubeCount,o=Math.floor(s/5);this.endItemCount=o})}static StageBornDo(e){for(let t=0;t<e.length;t++){let a=e[t].name.split("_"),n=new Laya.Vector3(parseFloat(e[t].position.x),parseFloat(e[t].position.y),parseFloat(e[t].position.z)),s=new Laya.Vector3(parseFloat(e[t].rotation.x),parseFloat(e[t].rotation.y),parseFloat(e[t].rotation.z)),o=new Laya.Vector3(parseFloat(e[t].scale.x),parseFloat(e[t].scale.y),parseFloat(e[t].scale.z));switch(a[0]){case"Ground":this.BornGround(n,s,o);break;case"BlockCube":this.BornBlockCube(n,s,o);break;case"PickCube":this.BornPickCube(n);break;case"StartPoint":0==this.stageID&&this.SetPlayerPos(n),this.startPos[this.stageID]=n,this.roadCubes[this.stageID].push(n);break;case"CamPoint":n.z-=2.5,g.mainCam.transform.position=n,s.y+=180,g.mainCam.transform.rotationEuler=s,g.mainCam.transform.rotate(new Laya.Vector3(-5,0,0),!1,!1);break;case"Trail":this.BornTrail(n,s,o);break;case"TrailGround":this.BornTrailGround(n);break;case"EndPoint":this.roadCubes[this.stageID].push(n);break;case"Spring":this.BornSpring(n,s);break;case"Beacon":this.BornBeacon(n,s);break;case"SpringStage":this.BornSpringStage(n,s);break;case"Wormhole":this.BornWormhole(n,a[1],a[2]);break;case"Stop":this.BornStop(n)}}}static BornGround(e,t,a){}static BornBlockCube(e,t,a){let n=c.findNodeByName(g.prefabs,"BlockCube"),s=this.BornObj(n,e);s.transform.localRotationEuler=t,s.transform.localScale=a,s.meshRenderer.material=this.stageColor[0]}static BornPickCube(e){for(let t=0;t<this.canPickCubes[this.stageID].length;t++)if(Laya.Vector3.equals(this.canPickCubes[this.stageID][t].transform.position.clone(),e))return;let t=c.findNodeByName(g.prefabs,"PickCube"),a=this.BornObj(t,e);this.changePickCubeMat(a,1),this.roadCubes[this.stageID].push(a.transform.position.clone()),this.canPickCubes[this.stageID].push(a),this.cubeCount++}static BornTrail(e,t,a){let n="Trail"+this.stageColor[1].toString(),s=c.findNodeByName(g.prefabs,n),o=this.BornObj(s,e);o.transform.localRotationEuler=t,o.transform.localScale=a;let i=c.getTransformForward(o.transform);if(Laya.Vector3.normalize(i,i),e.z%1==.5)for(let t=0;t<=a.z;t++){let a=c.Vector3Axis(i,t),n=c.Vector3Add(e,a);this.addTrail(n)}else if(e.z%1==0){let t=a.z-.5,n=c.Vector3Add(e,c.Vector3Axis(i,.5));for(let e=0;e<=t;e++){let t=c.Vector3Axis(i,e),a=c.Vector3Add(n,t);this.addTrail(a)}}}static addTrail(e){for(let t=0;t<this.trailPos[this.stageID].length;t++)if(Laya.Vector3.equals(this.trailPos[this.stageID][t],e))return;this.roadCubes[this.stageID].push(e),this.trailPos[this.stageID].push(e),this.trailCubeCount++}static BornTrailGround(e){let t="TrailGround"+this.stageColor[1].toString(),a=c.findNodeByName(g.prefabs,t);this.BornObj(a,e)}static BornSpring(e,t){let a=c.findNodeByName(g.prefabs,"Spring"),n=this.BornObj(a,e);n.transform.localRotationEuler=t,this.spring.push(n)}static BornBeacon(e,t){let a=c.findNodeByName(g.prefabs,"Beacon"),n=this.BornObj(a,e);n.transform.localRotationEuler=t,this.beacon.push(n)}static BornSpringStage(e,t){let a=c.findNodeByName(g.prefabs,"SpringStage"),n=this.BornObj(a,e);n.transform.localRotationEuler=t,this.spring.push(n)}static BornWormhole(e,t,a){let n=c.findNodeByName(g.prefabs,"Wormhole"),s=this.BornObj(n,e);"In"==a?this.wormHoleIn[t]=s.transform.position.clone():"Out"==a&&(this.wormHoleOut[t]=s.transform.position.clone())}static BornStop(e){let t=c.findNodeByName(g.prefabs,"Stop"),a=this.BornObj(t,e);this.stop.push(a.transform.position.clone())}static BornEndItem(e,t){for(let t=0;t<e;t++){let e="EndItem"+(t%7+1).toString(),a=c.findNodeByName(g.prefabs,e),n=this.endPos[this.endPos.length-1].clone();n.z+=20+7*t;let s=this.BornObj(a,n),o=s.getChildByName("first"),i=s.getChildByName("second"),r=s.getChildByName("point"),l=s.getChildByName("x");this.BornNumber(1+Math.floor(t/10),o.transform.position.clone()),this.BornNumber(t%10,i.transform.position.clone()),this.BornPoint(r.transform.position.clone()),this.BornAxis(l.transform.position.clone()),o.destroy(),i.destroy(),r.destroy(),l.destroy()}let a=g.scene3D.getChildByName("End").getChildByName("Chest"),n=a.transform.localPosition.clone();n.z=20+7*e+.5,n.y=.31+.3*t,a.transform.localPosition=n}static BornNumber(e,t){let a=e.toString(),n=c.findNodeByName(g.prefabs,a);this.BornObj(n,t)}static BornPoint(e){let t=c.findNodeByName(g.prefabs,"point");this.BornObj(t,e)}static BornAxis(e){let t=c.findNodeByName(g.prefabs,"axis");this.BornObj(t,e)}static SetPlayerPos(e){g.player.transform.position=e}static changePickCubeMat(e,t){let a=c.findNodeByName(e,"Cube_0"),n=e.getChildByName("qiu").getChildByName("qiu_0"),s=c.findNodeByName(e,"yuanhuan_0"),o=e.getChildByName("Face").getChildByName("qiu_0");a.meshRenderer.material=this.stageColor[t],n.meshRenderer.material=this.stageColor[t],s.meshRenderer.material=this.stageColor[t],o.meshRenderer.material=this.stageColor[t]}static BornObj(e,t=new Laya.Vector3(0,0,0)){let a=e.clone();return a&&(g.scene3D.addChild(a),a.transform.position=t,g.usingPrefabs.push(a)),a}}y.wallBornCount=0,y.roadCubes=[],y.canPickCubes=[],y.trailPos=[],y.spring=[],y.beacon=[],y.stageID=0,y.endPos=[],y.startPos=[],y.wormHoleIn={},y.wormHoleOut={},y.stop=[],y.stageColor=[],y.cubeCount=0,y.trailCubeCount=0,y.endItemCount=0,function(e){e.LOADING="scenes/Loading.scene",e.STARTMENU="scenes/StartMenu.scene",e.STAGEUI="scenes/StageUI.scene",e.ENDMENU="scenes/EndMenu.scene"}(i||(i={}));class g{static AddGrade(){let e=t.GetPlayerData();e.grade++,3==parseInt(e.grade)?e.peopleActive[1]=!0:10==parseInt(e.grade)?e.peopleActive[2]=!0:parseInt(e.grade)>99&&(e.grade=99),t.SavePlayerData(e)}static readGrade(){let e=t.GetPlayerData();return parseInt(e.grade)}static AddCoin(e){let a=t.GetPlayerData();a.coin+=e,t.SavePlayerData(a)}static readCoin(){let e=t.GetPlayerData();return parseInt(e.coin)}static unlock(e){let a=t.GetPlayerData();a.peopleActive[e]=!0,t.SavePlayerData(a)}static choose(e){let a=t.GetPlayerData();a.nowPeople=e,t.SavePlayerData(a),y.PlayerInit()}static addEnergy(e){let a=t.GetPlayerData();a.energy+=e,a.energy>99&&(a.energy=99),t.SavePlayerData(a),g.readEnergy()>=20&&g.setLastEnergyTime()}static reduceEnergy(){g.addEnergy(-5),20==g.readEnergy()&&g.setLastEnergyTime()}static setEnergy(e){let a=t.GetPlayerData();a.energy=e,t.SavePlayerData(a)}static readEnergy(){let e=t.GetPlayerData();return parseInt(e.energy)}static readLastEnergyTime(){let e=t.GetPlayerData();return parseInt(e.lastEnergyTime)}static setLastEnergyTime(){let e=t.GetPlayerData();e.lastEnergyTime=(new Date).getTime(),t.SavePlayerData(e)}static checkEnergy(){if(g.readEnergy()<20){let e=(new Date).getTime()-g.readLastEnergyTime(),t=Math.floor(e/6e4);if(t>0){let a=g.readEnergy();if((a+=t)>=20)return a=20,g.setEnergy(a),g.setLastEnergyTime(),null;g.setEnergy(a),g.setLastEnergyTime(),e=(new Date).getTime()-g.readLastEnergyTime()}if(e>=0)return e}return null}}g.isPure=!0,g.nowScene=0,g.usingPrefabs=[],g.isSuccess=!1,g.endAxis=0,g.endCoin=0;class m{static init(){Laya.Browser.onWeiXin&&(this.showShareMenuWithTicket(!0),this.regisiterWXShareCallback())}static FirstIn(e){e&&e()}static StartMenuIn(){console.log("打开游戏开始界面")}static StartMenuOut(e){e&&e()}static StageIn(){}static StageOut(){}static EndIn(){}static EndOut(e){e&&e()}static showShareMenuWithTicket(e){wx.showShareMenu({withShareTicket:e,success:function(){},fail:function(){},complete:function(){}})}static regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var e={title:"分享",image:""};Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:e.title,imageUrl:e.image,query:"share_id=1"}})}}}class p extends e{constructor(){super(...arguments),this.isVideoPass=!0}init(){g.nowScene=3,g.isPure||m.EndIn(),this.EnergyInit(),c.d2_AddClickEvent(this.restartButton,this,this.restartGame),c.d2_AddClickEvent(this.videoConfirm,this,this.videoConfirmSwitch);t.GetPlayerData();g.AddCoin(g.endCoin)}restartGame(){let e=()=>{m.EndOut(()=>{y.Init(),Laya.Scene.destroy(i.ENDMENU),c.loadScene(i.STARTMENU)})};this.isVideoPass?(g.addEnergy(10),e()):e()}videoConfirmSwitch(){this.isVideoPass=!this.isVideoPass,this.videoConfirm.alpha=this.isVideoPass?1:0}EnergyInit(){this.EnergyUpdate(),c.d2_AddClickEvent(this.energyNeedBtn,this,()=>{this.openEnergyPanel()}),c.d2_AddClickEvent(this.energyCancelBtn,this,this.closeEnergyPanel),c.d2_AddClickEvent(this.energyVideoBtn,this,()=>{g.addEnergy(10),this.EnergyUpdate()}),Laya.timer.loop(1e3,this,this.EnergyUpdate)}openEnergyPanel(){this.energyPanel.set_visible(!0)}closeEnergyPanel(){this.energyPanel.set_visible(!1)}EnergyUpdate(){let e=g.checkEnergy();if(this.energyValue.value=g.readEnergy().toString(),null!=e){this.energyTime.set_visible(!0),e=6e4-e;let t,a,n=Math.floor(e/1e3),s=Math.floor(n/60);n%=60;let o=(t=s<10?"0"+s.toString():s.toString())+":"+(a=n<10?"0"+n.toString():n.toString());this.energyTime.value=o}else{this.energyTime.set_visible(!1)}}}class f{constructor(){this.enable=!1,this.rubbishPos=new Laya.Vector3(-1e3,-1e3,-1e3),this.ColliderInit()}ColliderInit(){this.enable=!0}ColliderUpdate(){this.enable}NormalBoxCheck_2D(e,t,a,n,s,o){let i=Math.abs(n.x-e.x),r=Math.abs(n.z-e.z);return i<t+s&&r<a+o}}class L{constructor(){for(var e in this.popCD=50,this.isPop=!0,this._pathRoot="res/Sounds/",this._soundCtx={},this._soundFile=[],s){let t=s[e];this._soundFile.push(t)}console.log(this._soundFile),this.init()}init(){let e=this._pathRoot,t="",a=this._soundFile,n=this._soundFile.length;for(let s=0;s<n;++s){t=a[s];let n=new Laya.SoundChannel;n.url=e+t+".mp3",-1!=t.indexOf("PoliceSiren")&&(n.loops=0),Laya.SoundManager.addChannel(n),this._soundCtx[t]=!0}Laya.loader.load(["res/Sounds/Bgm.mp3"],Laya.Handler.create(this,()=>{this.playMusic("Bgm")})),Laya.SoundManager.autoReleaseSound=!1}play(e){this._soundCtx[e]&&Laya.SoundManager.playSound(this._pathRoot+e+".mp3")}playPopSound(){this.isPop&&(this.play(s.Select),this.isPop=!1,Laya.timer.once(this.popCD,this,()=>{this.isPop=!0}))}playLoop(e){this._soundCtx[e]&&Laya.SoundManager.playSound(this._pathRoot+e+".mp3",0)}stop(e){this._soundCtx[e]&&Laya.SoundManager.stopSound(this._pathRoot+e+".mp3")}playMusic(e){Laya.SoundManager.stopMusic(),e?(Laya.SoundManager.playMusic(this._pathRoot+e+".mp3",0),this.currentMusic=e):Laya.SoundManager.playMusic(this._pathRoot+this.currentMusic+".mp3",0)}stopMusic(){Laya.SoundManager.stopMusic()}}class w{vibrateShort(e){c.objectShake(e,Laya.timer.delta/1e3,.1)}}class C{constructor(){this.fxs=[],this.fireWork=[],this.PopFxs=[],this.MoveFxs=[],this.init()}init(){this.chestLight=g.fxs.getChildByName("ChestLightFX"),this.fireWorkBoom=g.fxs.getChildByName("FireworkFX"),this.fireWorkAlawys=g.fxs.getChildByName("ConfettiSplashFX"),this.fireWokrRain=g.fxs.getChildByName("ConfettiRainFX"),this.moveSmokeFx=g.fxs.getChildByName("MoveSmokeFX"),this.finishFx=g.fxs.getChildByName("FinishFX"),this.PopFx=g.fxs.getChildByName("PopFX"),this.MoveFx=g.fxs.getChildByName("MoveFX")}cleanFxs(){for(let e=0;e<this.fxs.length;e++)this.fxs[e].destroy()}BornFireWorksAlways(e){this.fireWork.push(this.BornFx(e,this.fireWorkAlawys))}clearFireWork(){for(let e=0;e<this.fireWork.length;e++)this.fireWork[e].destroy()}BornChestAllFx(e){this.BornFx(c.Vector3Add(e,new Laya.Vector3(0,1,6.5)),this.chestLight)}BornMoveSmokeFx(){if(this.smokeFx)return;let e=this.BornFxOnly(g.player.transform.position.clone(),this.moveSmokeFx);g.player.addChild(e),e.transform.localPosition=new Laya.Vector3(0,-1e3,0),this.smokeFx=e}BornFinishFx(){let e=g.mainCam.transform.position.clone();e.y=0,e.z+=1,this.finishFx.transform.position=e,this.finishFx.getChildAt(0).particleSystem.play()}BornPopFx(e){let t;if(this.PopFxs.length>0)(t=this.PopFxs.pop()).transform.position=e,t.active=!0;else{let a=this.PopFx.clone();g.scene3D.addChild(a),a.transform.position=e,t=a}t.getChildAt(0).particleSystem.startColorConstant=y.stageColor[2].albedoColor,Laya.timer.once(1e3,this,()=>{t.active=!1,this.PopFxs.push(t)})}BornMoveFx(e){let t;if(this.MoveFxs.length>0)(t=this.MoveFxs.pop()).transform.position=e,t.active=!0;else{let a=this.MoveFx.clone();g.scene3D.addChild(a),a.transform.position=e,t=a}t.getChildAt(0).particleSystem.startColorConstant=y.stageColor[2].albedoColor,Laya.timer.once(1e3,this,()=>{t.active=!1,this.MoveFxs.push(t)})}BornFx(e,t){let a=t.clone();return g.scene3D.addChild(a),a.transform.position=e,this.fxs.push(a),a}BornFxOnly(e,t){let a=t.clone();return g.scene3D.addChild(a),a.transform.position=e,a}}class S extends e{constructor(){super(...arguments),this.SceneDone=!1,this.FxDone=!0,this.isLoading=!0}init(){this.initLoading(),this.updateLoading(0),Laya.Browser.onWeiXin,this.init1()}init1(){this.updateLoading(.25);g.isPure,t.GetPlayerData();t.CheckPlayerData(),this.initGame(),m.init()}initGame(){this.updateLoading(.5),g.soundController=new L,g.camShake=new w;Laya.Scene3D.load("res/main/Conventional/main.ls",Laya.Handler.create(this,this.onComplete))}StartGame(){if(this.SceneDone&&this.FxDone){this.updateLoading(1);let e=()=>{Laya.stage.addChild(g.scene3D),this.SceneInit(),y.Init(),g.isPure?(Laya.Scene.destroy(i.LOADING),c.loadScene(i.STARTMENU,0)):m.FirstIn(()=>{Laya.Scene.destroy(i.LOADING),c.loadScene(i.STARTMENU,0)})};setTimeout(()=>{e()},500)}}SceneInit(){g.player=g.scene3D.getChildByName("Player"),g.mainCam=g.scene3D.getChildByName("Main Camera"),g.anim=g.player.getChildByName("Model").getComponent(Laya.Animator),g.collider=new f,g.fxController=new C;let e=g.scene3D.getChildByName("Directional Light");e.shadowMode=Laya.ShadowMode.SoftLow,e.shadowDistance=50,e.shadowResolution=1024,e.shadowCascadesMode=Laya.ShadowCascadesMode.NoCascades,g.mainCam.enableHDR=!1,Laya.stage.useRetinalCanvas=!0}initLoading(){}updateLoading(e){this.bar.value=e}exitLoading(){Laya.Tween.clearTween(this.tween),this.isLoading=!1}onComplete(e){this.updateLoading(.75),g.scene3D=e,g.prefabs=g.scene3D.getChildByName("Prefabs"),g.fxs=e.getChildByName("Fx"),this.SceneDone=!0,this.StartGame()}onFxComplete(e){this.updateLoading(.75),g.fxs=e.getChildByName("Fx"),this.FxDone=!0,this.StartGame()}}class _ extends Laya.Script{onUpdate(){H.instance.isStart}}class E extends Laya.Script{constructor(){super(...arguments),this.calls=[]}onAwake(){this.init()}init(){Laya.timer.frameLoop(1,this,this.update)}update(){}onMouseDown(e){this.touchTimer&&clearTimeout(this.touchTimer),this.isDown=!0,this.startPos=new Laya.Vector2(e.stageX,e.stageY),this.nowPos=this.startPos}onMouseMove(e){this.isDown&&(this.nowPos=new Laya.Vector2(e.stageX,e.stageY),this.WayCheck())}onMouseUp(e){this.isDown=!1}WayCheck(){let e=c.Vector2Reduce(this.nowPos,this.startPos);if(c.Vector2Scale(e)>5){let t=Math.atan2(e.y,e.x)/Math.PI*180,a="none";t>-135&&t<-45?a="up":t>-45&&t<45?a="right":t<135&&t>45?a="down":(t<-135||t>135)&&(a="left"),"none"!=a&&(this.calls.length<2?this.calls.push(a):H.instance.isCalling?this.calls[1]=a:(this.calls[1]=this.calls[0],this.calls[0]=a),H.instance.callUpdate())}this.startPos=this.nowPos}onDestroy(){this.touchTimer&&clearTimeout(this.touchTimer)}}class v{constructor(){this.forceHide=!1,this.init()}init(){this.scenes=[]}get getTopScene(){return this.topScene}openScene(e,t=!1,a,n,s){Laya.Scene.open(e,t,a,Laya.Handler.create(this,t=>{let a=this.scenes.filter(t=>t.url==e);a&&a.length>0?(console.log("已打开此场景",a),a[0].close()):(n?n.addChild(t):Laya.stage.addChild(t),this.scenes.push(t),this.topScene=this.scenes[this.scenes.length-1],s&&s(t))}))}closeScene(e){if(e?"string"==typeof e&&this.scenes.forEach(t=>{t.url!=e||(e=t)}):null!=this.topScene&&(e=this.topScene),e&&e instanceof Laya.Scene){var t=this.scenes.indexOf(e);-1!=t&&(this.scenes.splice(t,1),this.topScene=this.scenes[this.scenes.length-1]),e.close(),U.Platform.hideBanner(),Laya.timer.once(100,this,()=>{var e=this.topScene;e.canShowAd&&!e.isWuchu&&0==F.instance.openSceneCount&&(U.Platform.showBanner(),console.log("UIMgr ShowBanner",e.url))})}}}class b{constructor(){this.appId="wxa49498a30cf837f6",this.gameVersion="1.0.4",this.gameType="3D",this.sceneResUrl="res/scene/Conventional/ResScene.ls",this.modelResUrl="res/model/Conventional/ResScene.lh",this.rebornCount=0,this.playCount=0}get shareContext(){return["请分享到活跃的群！","请分享到不同群！","请分享给好友！","请分享给20人以上的群！"][Math.floor(4*Math.random())]}}class x{static add(e,t){var a=new Laya.Vector3;return Laya.Vector3.add(e,t,a),a.clone()}static subtract(e,t){var a=new Laya.Vector3;return Laya.Vector3.subtract(e,t,a),a.clone()}static mull(e,t){var a=new Laya.Vector3;return Laya.Vector3.scale(e,t,a),a.clone()}static dot(e,t){return Laya.Vector3.dot(e,t)}static cross(e,t){var a=new Laya.Vector3;return Laya.Vector3.cross(e,t,a),a.clone()}static normalized(e){var t=new Laya.Vector3;return Laya.Vector3.normalize(e,t),t.clone()}static distance(e,t){var a=x.subtract(e,t);return Laya.Vector3.scalarLength(a)}}class P{addClickEvent(e,t,a,n,s){if(e.offAllCaller(t),e instanceof Laya.Button&&!s){let s=e=>{a&&a.call(t,e)};e.on(Laya.Event.CLICK,t,s,[n])}else{let s=60,o=1,i=e.scaleX*o,r=e.scaleY*o,l=.9*o,h=!1,c=t=>{h=!0,Laya.Tween.to(e,{scaleX:l,scaleY:l},s)};e.on(Laya.Event.MOUSE_DOWN,t,c,[n]);let d=n=>{0!=h&&(h=!1,Laya.Tween.to(e,{scaleX:i,scaleY:r},s),a&&a.call(t,n))};e.on(Laya.Event.MOUSE_UP,t,d,[n]);let u=t=>{Laya.Tween.to(e,{scaleX:i,scaleY:r},s)};e.on(Laya.Event.MOUSE_OUT,t,u,[n])}}getRGB(e){var t=[],a=[];let n=e.replace(/#/,"");if(3==n.length){for(var s=[],o=0;o<3;o++)s.push(n.charAt(o)+n.charAt(o));n=s.join("")}for(o=0;o<3;o++)t[o]="0x"+n.substr(2*o,2),a.push(parseInt(t[o]));return new Laya.Vector3(a[0]/255,a[1]/255,a[2]/255)}getColorString(e){var t=15&e,a=t>9?this.getHexValue(Number(t))+"":t+"";return((t=15&e>>>4)>9?this.getHexValue(Number(t))+"":t+"")+a}getHexValue(e){switch(e){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F"}}getCurrentTime(){return Math.floor(Date.parse((new Date).toString())/1e3)}inverseLerp(e,t,a){return(a-e)/(t-e)}linearEquation(e,t){var a=(e.y-t.y)/(e.x-e.y);return[a,e.y-a*e.x]}loadJsonFile(e,t){Laya.loader.load(e,Laya.Handler.create(this,a=>{var n=Laya.loader.getRes(e);t(n)}),null,Laya.Loader.JSON)}getRandomArray(e,t){var a=[],n=[];n=(n=n.concat(e)).sort(function(){return.5-Math.random()});for(var s=0;s<t;s++)a.push(n[s]);return a}loadSubpackage(e,t,a){if(Laya.Browser.onWeiXin){wx.loadSubpackage({name:e,success:function(n){console.log("分包加载成功：",e),a.call(n,t,!0)},fail:function(n){console.error("分包加载失败：",e),a.call(n,t,!1)}}).onProgressUpdate(e=>{console.log(e,"分包================")})}}loadSubpackagesSync(e,t,a){for(var n=e.length,s=0;s<n;s++)this.loadSubpackage(e[s],t,(e,s)=>{s&&0==--n&&(console.log("全部分包加载完成"),a.call(this,t,!0))})}loadSubpackages(e,t,a){var n=e.length;!function loadSubpackage(){var s=e[n-1];null!=s?U.Utils.loadSubpackage(s,t,(e,t)=>{t&&(n--,loadSubpackage())}):(console.log("全部分包加载完成"),0==n?a.call(this,t,!0):a.call(this,t,!1))}()}getTimeLeft2BySecond(e){let t=Math.round((e-30)/60)%60,a=e%60;return(t>0?t>9?t+":":"0"+t+":":"00:")+(a>0?(a>9?a+"":"0"+a)+"":"00")}objectShake(e,t=1,a=.7){var n=t,s=1,o=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(n>0){var t=new Laya.Vector3;Laya.Vector3.scale((i=Math.random()>.5?Math.random():-Math.random(),r=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(i,r,0)),a,t),Laya.Vector3.add(o,t,t),e.transform.localPosition=t,n-=.02*s}else n=0,e.transform.localPosition=o,Laya.timer.clear(this,updateShake);var i,r})}objectShake2D(e,t=1,a=.7){this.originPos&&(Laya.timer.clear(this,this.updateShake),e.pos(this.originPos.x,this.originPos.y)),this.shakeTime=t;this.originPos=new Laya.Vector2(e.x,e.y),Laya.timer.frameLoop(1,this,this.updateShake,[a,e,1])}randomPos(){var e=Math.random()>.5?Math.random():-Math.random(),t=Math.random()>.5?Math.random():-Math.random();return new Laya.Vector2(e,t)}updateShake(e,t,a){if(this.shakeTime>0){var n=new Laya.Vector2;Laya.Vector2.scale(this.randomPos(),e,n),n.setValue(n.x+this.originPos.x,n.y+this.originPos.y),t.pos(n.x,n.y),this.shakeTime-=.02*a}else this.shakeTime=0,t.pos(this.originPos.x,this.originPos.y),Laya.timer.clear(this,this.updateShake),this.originPos=null}sameSide(e,t,a,n){var s=x.subtract(t,e),o=x.subtract(a,e),i=x.subtract(n,e),r=x.cross(s,o),l=x.cross(s,i);return x.dot(r,l)>=0}pointInTriangle(e,t,a,n){return this.sameSide(e,t,a,n)&&this.sameSide(t,a,e,n)&&this.sameSide(a,e,t,n)}findNodeByName(e,t){let a=null,n=e=>{for(let s=0;s<e.numChildren;s++){if(e.getChildAt(s).name==t)return void(a=e.getChildAt(s));n(e.getChildAt(s))}};return n(e),a}coinCollectAnim(e,t,a,n=15,s=null){for(var o=n,i=0;i<n;i++){let n=Laya.Pool.getItemByClass("coin",Laya.Image);n.skin="ui/sy_jb_01.png",n.x=e.x,n.y=e.y,n.scale(.6,.6),a.addChild(n);let i=300+100*Math.random()-50;Laya.Tween.to(n,{x:n.x+250*Math.random()-125,y:n.y+250*Math.random()-125},i),Laya.timer.once(i+50,this,function(){Laya.Tween.to(n,{x:t.x,y:t.y},400,null,new Laya.Handler(this,function(){a.removeChild(n),Laya.Pool.recover("coin",n),0==--o&&s&&s(a)}))})}}fixCameraField(e){let t=(Laya.stage.displayHeight-1334<0?0:Laya.stage.displayHeight-1334)/290*10;e.fieldOfView+=t}changeMatColor(e,t){e.meshRenderer&&(e.meshRenderer.sharedMaterial.albedoColor=t)}getSpritePosBySprite3DPoint(e){var t=e.transform.position.clone();t.y="Npc1"==e.name?2:1;var a=new Laya.Vector4;U.CommonData.mainCamera.viewport.project(t,U.CommonData.mainCamera.projectionViewMatrix,a);var n=new Laya.Vector2(a.x/Laya.stage.clientScaleX,a.y/Laya.stage.clientScaleY);return new Laya.Point(n.x,n.y)}getRandom(){return this.getRandomArray([0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],1)[0]}getAngle(e,t){var a=Laya.Vector3.dot(e,t),n=Laya.Vector3.scalarLength(e)*Laya.Vector3.scalarLength(t);if(0==n){if(e.z>t.z)return 0;if(e.z<t.z)return 180;if(e.y>t.y)return 90;if(e.y<t.y)return-90}var s=a/n;return 180*Math.acos(s)/Math.PI}transform(e){let t=["","",""],a=1e3,n=3;for(var s=1;e/a>=1;)a*=10,n+=1;if(n<=4)t[1]="k",t[0]=(e/1e3).toFixed(2);else if(n<=9){let a=parseInt((n-4).toFixed(0))/2>1?"m":"k";s="k"===a?1e3:1e6,t[1]=a;let o=(e/s).toFixed(2);t[0]=o+""}else if(n<=16){let a="b",n=1;"m"===a?n=1e6:"b"===a&&(n=1e9),t[1]=a,t[0]=(e/n).toFixed(2)}return e<1e3&&(t[1]="",t[0]=Number(e).toFixed(0)+""),t.join("")}static createTriangle(e,t,a){void 0===e&&(e=1),void 0===t&&(t=1),void 0===a&&(a=1);Laya.VertexMesh.getVertexDeclaration("POSITION,NORMAL,UV");var n=e/2,s=t/2,o=a/2;new Float32Array([-n,s,-o,0,1,0,0,0,n,s,-o,0,1,0,1,0,n,s,o,0,1,0,1,1,-n,-s,-o,0,-1,0,0,0,n,-s,-o,0,-1,0,-1,0,n,-s,o,0,-1,0,-1,-1,-n,s,-o,0,-1,0,0,0,n,s,-o,0,-1,0,-1,0,n,-s,-o,0,-1,0,0,-1,-n,-s,-o,0,-1,0,-1,-1,n,s,-o,0,1,0,0,0,n,s,o,0,1,0,1,0,n,-s,-o,0,1,0,0,1,n,-s,o,0,1,0,1,1,-n,s,-o,0,1,0,0,0,n,s,o,0,1,0,0,0,n,-s,o,0,1,0,0,1,-n,-s,-o,0,1,0,1,1]),new Uint16Array([0,1,2,5,4,3,6,9,8,8,7,6,11,10,12,12,13,11,14,15,16,16,17,14])}getNormal(e,t,a){var n=x.subtract(t,e),s=x.subtract(a,e);return x.normalized(x.cross(s,n))}missTouch(e,t=300){U.Platform.hideBanner(),e.bottom=30;var a=F.instance.dataConfig.front_banner_appear,n=F.instance.dataConfig.front_button_up;Laya.timer.once(a,e,()=>{U.Platform.showBanner(),Laya.Tween.to(e,{bottom:t},n)})}clearMissTouch(e){Laya.timer.clearAll(e)}lerpVec3(e,t,a){return a=this.Clamp01(a),new Laya.Vector3(e.x+(t.x-e.x)*a,e.y+(t.y-e.y)*a,e.z+(t.z-e.z)*a)}Clamp01(e){return e>1?1:e<0?0:e}}P.showPoint=function(e,t){for(var a=0;a<e.length;a++){e[a],P.createBox(.1,.1,.1);var n=new Laya.MeshSprite3D;U.CommonData.mainScene.addChild(n)}},P.createMesh=function(e,t){Laya.Resource.destroyUnusedResources();Laya.VertexMesh.getVertexDeclaration("POSITION,NORMAL");for(var a=[],n=new Laya.Vector3(-1,0,0),s=0;s<e.length;s++){var o=e[s];a.push(o.x),a.push(o.y),a.push(o.z),a.push(n.x),a.push(n.y),a.push(n.z)}new Float32Array(a),new Uint16Array(t)},P.createBox2=function(e,t,a){void 0===e&&(e=1),void 0===t&&(t=1),void 0===a&&(a=1);Laya.VertexMesh.getVertexDeclaration("POSITION");var n=e/2,s=t/2,o=a/2;new Float32Array([-n,s,-o,n,s,-o,n,s,o,-n,s,o,-n,-s,-o,n,-s,-o,n,-s,o,-n,-s,o,-n,s,-o,-n,s,o,-n,-s,o,-n,-s,-o,n,s,-o,n,s,o,n,-s,o,n,-s,-o,-n,s,o,n,s,o,n,-s,o,-n,-s,o,-n,s,-o,n,s,-o,n,-s,-o,-n,-s,-o]),new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20])},P.createBox=function(e,t,a){void 0===e&&(e=1),void 0===t&&(t=1),void 0===a&&(a=1);Laya.VertexMesh.getVertexDeclaration("POSITION,NORMAL,UV");var n=e/2,s=t/2,o=a/2;new Float32Array([-n,s,-o,0,1,0,0,0,n,s,-o,0,1,0,1,0,n,s,o,0,1,0,1,1,-n,s,o,0,1,0,0,1,-n,-s,-o,0,-1,0,0,1,n,-s,-o,0,-1,0,1,1,n,-s,o,0,-1,0,1,0,-n,-s,o,0,-1,0,0,0,-n,s,-o,-1,0,0,0,0,-n,s,o,-1,0,0,1,0,-n,-s,o,-1,0,0,1,1,-n,-s,-o,-1,0,0,0,1,n,s,-o,1,0,0,1,0,n,s,o,1,0,0,0,0,n,-s,o,1,0,0,0,1,n,-s,-o,1,0,0,1,1,-n,s,o,0,0,1,0,0,n,s,o,0,0,1,1,0,n,-s,o,0,0,1,1,1,-n,-s,o,0,0,1,0,1,-n,s,-o,0,0,-1,1,0,n,s,-o,0,0,-1,0,0,n,-s,-o,0,0,-1,0,1,-n,-s,-o,0,0,-1,1,1]),new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20])};class M{}M.AD_LOAD_EVENT="",M.AD_SHOW_EVENT="",M.AD_VIDEO_CLOSE_EVENT="",M.PLATFORM_WAKE_EVENT="",M.PLATFORM_SLEEP_EVENT="",M.LOAD_FINISH_EVENT="",M.GAME_INIT_EVENT="",M.GAME_PLAY_EVENT="",M.GAME_REBORN_EVENT="",M.GAME_OVER_EVENT="",M.MOUSE_EVENT="",M.CHANGE_SKIN_EVENT="",M.CHANGE_BRICK_EVENT="",M.CHANGE_LEVEL_EVENT="",M.CHANGE_COIN_EVENT="",M.SHOW_TIPS_EVENT="",M.UPDATE_SHARE_COUNT="",M.UPDATE_CHECK_SV="",M.LOGIN_EVENT="",M.SHARE_BACK_EVENT="";class B{constructor(){Laya.loader.load(this.url,Laya.Handler.create(this,this.loadComplete),Laya.Handler.create(this,this.loadProgress),Laya.Loader.PREFAB)}getItem(e){let t=Laya.loader.getRes(e);return t?Laya.Pool.getItemByCreateFun(e,t.create,t):null}recoverItem(e,t){Laya.Pool.recover(e,t),t.parent.removeChild(t)}loadProgress(e){console.log("预制体资源加载中...",e)}loadComplete(){console.log("预制体资源加载完成!")}}class I{constructor(){this._isPlay=!1,this._isOver=!1,this._isPause=!1,this._isPressed=!1,Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDownClick),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUpClick),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMoveClick)}get isPressed(){return this._isPressed}set isPressed(e){this._isPressed=e}get isPlay(){return this._isPlay}set isPlay(e){this._isPlay=e}get isOver(){return this._isOver}set isOver(e){this._isOver=e}get isPause(){return this._isPause}set isPause(e){this._isPause=e,Laya.timer.scale=e?0:1}set gameScale(e){Laya.timer.scale=e}onMouseDownClick(e){U.Event.event(M.MOUSE_EVENT,{type:"down",evt:e})}onMouseUpClick(e){U.Event.event(M.MOUSE_EVENT,{type:"up",evt:e})}onMouseMoveClick(e){U.Event.event(M.MOUSE_EVENT,{type:"move",evt:e})}getThrowX(e,t,a,n){return e*Math.pow(n,2)+t*n+a}}class V{toScale(e,t,a,n,s,o=!1,i=null){if(e){var r=null;e.scale(t,t),scale1()}function scale1(){r=o||s?new Laya.Handler(this,scale2):null,Laya.Tween.to(e,{scaleX:a,scaleY:a},n,i,r)}function scale2(){r=o?new Laya.Handler(this,scale1):null,Laya.Tween.to(e,{scaleX:t,scaleY:t},n,i,r)}}toAlpha(e,t,a,n,s,o=!1,i=null){if(e){var r=null;e.alpha=t,alpha1()}function alpha1(){r=o||s?new Laya.Handler(this,alpha2):null,Laya.Tween.to(e,{alpha:a},n,i,r)}function alpha2(){r=o?new Laya.Handler(this,alpha1):null,Laya.Tween.to(e,{alpha:t},n,i,r)}}toPosition(e,t,a,n=!1,s=0){let o=new Laya.Vector2(e.x,e.y);function pos1(){if(n)switch(s){case 0:var o=new Laya.Handler(this,pos2);break;case 1:o=new Laya.Handler(this,pos3)}Laya.Tween.to(e,{x:t.x,y:t.y},a,null,o)}function pos2(){Laya.Tween.to(e,{x:o.x,y:o.y},a,null,Laya.Handler.create(this,pos1))}function pos3(){e.x=o.x,e.y=o.y,pos1()}pos1()}toPosition3D(e,t,a,n,s,o,i){s&&(e.transform.position=s);var r=new Laya.Tween,l=e.transform.position.clone();r.to(l,{x:t.x,y:t.y,z:t.z},a,n,Laya.Handler.create(this,()=>{e.transform.position=t,o&&o()})),r.update=new Laya.Handler(this,()=>{e.transform.position=l,i&&i(e,l)})}toRotaion(e,t,a,n=!1,s=!1){var o=e.rotation;function rotate2(){Laya.Tween.to(e,{rotation:-t},2*a,null,Laya.Handler.create(this,rotate3))}function rotate3(){Laya.Tween.to(e,{rotation:t},2*a,null,Laya.Handler.create(this,rotate2))}function rotate4(){Laya.Tween.to(e,{rotation:o},a)}!function(){if(n)var o=new Laya.Handler(this,rotate2);else if(s)var o=new Laya.Handler(this,rotate4);Laya.Tween.to(e,{rotation:t},a,null,o)}()}clear(e){Laya.Tween.clearAll(e)}}class A{constructor(){this.carStorage={carConfig:{currentUseSkinId:1},carData:[{skinId:1,level:1}]},this.passMissionCount=0,this.missionConfig=[{type:"video",reward:750,totalCount:1,currentCount:0},{type:"comboX3",reward:500,totalCount:1,currentCount:0},{type:"dontHit",reward:500,totalCount:1,currentCount:0},{type:"lowHpPass",reward:500,totalCount:1,currentCount:0},{type:"overtake20",reward:500,totalCount:20,currentCount:0},{type:"pass3level",reward:500,totalCount:3,currentCount:0}],this.currentMission=[],this.totalMission=[]}createSmoke(){return this.cloneObj(this.carFx.getChildByName("TireSmoke1"))}createDamageSmoke1(){return this.cloneObj(this.carFx.getChildByName("DamageSmoke1"))}createDamageSmoke2(){return this.cloneObj(this.carFx.getChildByName("DamageSmoke2"))}createBomb(){return this.cloneObj(this.carFx.getChildByName("BoomFX"))}createDash(){return this.cloneObj(this.carFx.getChildByName("DashFX"))}cloneObj(e){return e.clone()}init(e,t){}loadLevel(){if(Math.random()>.5)var e=[0,1],t=this.road1Mat.clone();else e=[2,3],t=this.road2Mat.clone();this.road.getChildAt(0).meshRenderer.sharedMaterial=t;for(var a=0;a<7;a++){var n=U.Utils.getRandomArray(e,1)[0],s=this.cloneObj(this.scenes.getChildAt(n));this.parent.addChild(s),s.transform.position=new Laya.Vector3(0,0,160*a);for(var o=0;o<16;o++){var i=this.cloneObj(this.road);this.parent.addChild(i),i.transform.position=new Laya.Vector3(0,.1,160*a+10*o)}}var r=this.cloneObj(this.end);this.parent.addChild(r),this.endPosZ=700,r.transform.position=new Laya.Vector3(0,.11,this.endPosZ)}saveCarStorage(){}upgradeCar(e){this.carStorage.carData.filter(t=>t.skinId==e+1)[0].level++,this.saveCarStorage()}updateMissions(){this.totalMission.push(0),this.totalMission=this.totalMission.concat(U.Utils.getRandomArray([1,2,3,4,5],5))}getCurrentMission(e){if(null!=e){var t=this.totalMission.shift();return this.missionConfig[this.currentMission[this.currentMission.indexOf(e)]].currentCount=0,this.currentMission[this.currentMission.indexOf(e)]=t,this.passMissionCount++,this.totalMission.length<3&&this.updateMissions(),U.Event.event("Update_Mission_Event"),t}for(var a=this.currentMission.length;a<3;a++)this.currentMission.push(this.totalMission.shift()),0==this.totalMission.length&&this.updateMissions()}updateMission(e,t){for(var a=0;a<this.currentMission.length;a++)if(e==this.currentMission[a]){var n=this.missionConfig[e];t&&n.currentCount<n.totalCount?n.currentCount=0:n.currentCount++}U.Event.event("Update_Mission_Event")}get finishMission(){for(var e=0;e<this.currentMission.length;e++){var t=this.missionConfig[this.currentMission[e]];if(t&&t.currentCount>=t.totalCount)return!0}return!1}}class T{constructor(){this.bannerId="",this.videoId="",this.interId="",this.existBannerAd=!1,this.existVideoAd=!1,this.existInterAd=!1,this.init()}init(){console.error("初始化平台失败")}loadBanner(){console.error("暂不支持调用接口: loadBanner")}showBanner(){console.error("暂不支持调用接口: showBanner")}hideBanner(){console.error("暂不支持调用接口: hideBanner")}loadVideoAd(){console.error("暂不支持调用接口: loadVideoAd")}showVideoAd(){console.error("暂不支持调用接口: showVideoAd")}}!function(e){e[e.WeiXin=0]="WeiXin",e[e.Qq=1]="Qq",e[e.Vivo=2]="Vivo",e[e.Oppo=3]="Oppo",e[e.ZiJieTiaoDong=4]="ZiJieTiaoDong",e[e.Mgc=5]="Mgc",e[e.Swan=6]="Swan",e[e.Android=7]="Android",e[e.Ios=8]="Ios"}(r||(r={}));class D{constructor(){this.currentIndex=0}static get Instance(){return D._instance||(D._instance=new D),D._instance}get sysInfo(){return this._sysInfo||(this._sysInfo=wx.getSystemInfoSync()),this._sysInfo}initAd(e,t,a=5,n=3e4,s=1,o=1,i=[],r=[]){this.bannerIds=r,e&&t?(this.changeTime=n,this.refreshNum=s,this.bannerNum=o,this.bannerIds=this.bannerIds.concat(i),this.useInnovation=!0,this.loadBannerNew(),this.showBanner=this.showBannerNew,this.hideBanner=this.hideBannerNew):(this.bannerCount=a,this.currentCount=a,this.useInnovation=!1,this.loadBannerOld(),this.showBanner=this.showBannerOld,this.hideBanner=this.hideBannerOld)}getBannerId(){var e=Math.floor(100*Math.random())%this.bannerIds.length;return this.currentBannerId=this.bannerIds[e],this.bannerIds[e]}setBannerTop(e){if(!this.currentBanner)return;let t=this.sysInfo;if(this.useInnovation)var a=this.currentBanner.banner;else a=this.currentBanner;let n=a.style.realHeight+.1;t.model.startsWith("iPhone X")&&(n+=40/Laya.Browser.height*z.height),a.style.top=t.screenHeight-n+e}loadBannerOld(){if(!Laya.Browser.onWeiXin)return;if(this.isLoading)return;this.isLoading=!0,this.currentBanner&&(this.currentBanner.destroy(),this.currentBanner=null);let e=this.sysInfo,t=this.getBannerId(),a=wx.createBannerAd({adUnitId:t,style:{top:.8*e.screenHeight,width:300,left:e.screenWidth/2-150}});a.onLoad(()=>{console.log("create banner success"),D.Instance.currentBanner=a,D.Instance.isLoading=!1,D.Instance.isLoadBannerError=!1,D.Instance.isloadAndShow&&(D.Instance.isloadAndShow=!1,D.Instance.showBannerOld())}),a.onError(e=>{console.log("create banner error",e),D.Instance.isLoading=!1,D.Instance.isLoadBannerError=!0,U.Event.event("Hide_Clear_View")}),a.onResize(t=>{let n=a.style.realHeight+.1;e.model.startsWith("iPhone X")&&(n+=40/Laya.Browser.height*z.height),a.style.top=e.screenHeight-n})}showBannerOld(){if(!this.currentBanner)return this.isloadAndShow=!0,void this.loadBannerOld();if(Laya.Browser.onWeiXin){if(!this.currentBanner)return;if(this.isShowBanner)return;this.isShowBanner=!0,this.currentBanner.show(),console.log("show banner"),this.setBannerTop(0)}}hideBannerOld(){if(Laya.Browser.onWeiXin){if(this.isloadAndShow=!1,0==this.isShowBanner)return;if(this.isShowBanner=!1,!this.currentBanner)return;this.currentBanner.hide(),console.log("hide banner",this.isShowBanner,this.currentBanner),this.countBanner()}}countBanner(){this.currentBanner&&(0==this.currentCount&&(this.currentCount=this.bannerCount,this.loadBannerOld()),this.currentCount--,console.log("banner剩余展示次数",this.bannerCount))}loadBannerNew(){if(!Laya.Browser.onWeiXin)return;console.log("create banner"),this.banners=[];let e=this.sysInfo,t=this.bannerIds.length*this.bannerNum,a=t;for(let n=0;n<this.bannerIds.length;n++){let s=this.bannerIds[n];for(let n=0;n<this.bannerNum;n++){let n=wx.createBannerAd({adUnitId:s,style:{top:.8*e.screenHeight,width:300,left:e.screenWidth/2-150}});n.onLoad(()=>{let e={banner:n,showCount:0};D.Instance.banners.push(e),D.Instance.isLoadBannerError=!1,0==--t&&(D.Instance.isloadAndShow&&D.Instance.showBanner(),console.log("front_banner_ids=========",this.banners))}),n.onError(e=>{console.log("create banner error",e),0==--a&&(D.Instance.isLoadBannerError=!0,U.Event.event("Hide_Clear_View"))}),n.onResize(t=>{let a=n.style.realHeight+.1;e.model.startsWith("iPhone X")&&(a+=40/Laya.Browser.height*z.height),n.style.top=e.screenHeight-a})}}}showBannerNew(){if(Laya.Browser.onWeiXin){if(this.hideBannerNew(),!this.banners||0==this.banners.length)return this.loadBannerNew(),void(this.isloadAndShow=!0);this.currentIndex>=this.banners.length&&(this.currentIndex=0);let e=this.banners[this.currentIndex];if(Laya.timer.once(this.changeTime,this,this.showBannerNew),!e||!e.banner)return;this.currentIndex++,e.banner.show(),e.showCount++,this.currentBanner=e,console.log("show banner",this.currentIndex-1),this.setBannerTop(0)}}hideBannerNew(){if(this.isloadAndShow=!1,Laya.Browser.onWeiXin){let e=this.currentBanner;if(!e)return;e.banner.hide(),e.showCount>=this.refreshNum&&(e.banner.destroy(),this.banners.splice(this.banners.indexOf(e),1),console.log("destroy banner")),console.log("hide banner",this.currentIndex-1),this.currentBanner=null,Laya.timer.clear(this,this.showBannerNew)}}}class N extends T{constructor(){super(...arguments),this.bannerTopFactor=0,this.isShowBanner=!1}init(){}initAd(){Laya.Browser.onWeiXin&&this.loadVideoAd()}getBannerId(){var e=Math.floor(100*Math.random())%this.bannerIds.length;return this.currentBannerId=this.bannerIds[e],this.bannerIds[e]}setBannerTop(e){D.Instance.setBannerTop(e)}countBanner(){this.existBannerAd&&(0==this.bannerCount&&(this.bannerCount=F.instance.showBannerCount,this.loadBanner()),this.bannerCount--,console.log("剩余展示次数",this.bannerCount))}loadVideoAd(){if(Laya.Browser.onWeiXin){var e,t=this;null!=(e=this.videoAd)&&(e.offLoad(onLoadVideo),e.offError(onErrorVideo),e.offClose(onCloseVideo)),(e=wx.createRewardedVideoAd({adUnitId:t.videoId})).onLoad(onLoadVideo),e.onError(onErrorVideo),e.onClose(onCloseVideo),this.videoAd=e}function onLoadVideo(){console.log("video 加载成功"),t.existVideoAd=!0}function onErrorVideo(e){console.error("video 加载错误",e),t.existVideoAd=!1}function onCloseVideo(e){let t=!!(e&&e.isEnded||void 0===e);U.Event.event(M.AD_VIDEO_CLOSE_EVENT,{isEnded:t})}}showVideoAd(){if(Laya.Browser.onWeiXin){if(!this.existVideoAd)return U.Platform.showToast("暂无视频",2e3),void this.videoAd.load();if(Laya.Browser.onWeiXin){var e=this.videoAd;e.show().then(()=>{}).catch(t=>{e.load().then(()=>e.show())})}}}loadBanner(e){if(Laya.Browser.onWeiXin&&(e&&(this.isloadAndShow=e),!this.isLoading)){this.isLoading=!0,this.existBannerAd=!1;var t=this,a=this.sysInfo,n=this.getBannerId(),s=wx.createBannerAd({adUnitId:n,style:{top:.8*a.screenHeight,width:300,left:a.screenWidth/2-150}});s.onLoad(()=>{var e;(console.log("Banner 加载成功"),t.existBannerAd=!0,t.bannerItem=s,t.isLoading=!1,t.bannerLoadError=!1,t.isloadAndShow)?(t.isloadAndShow=!1,(e=U.UI.getTopScene)&&e.canShowAd&&!e.isWuchu&&0==F.instance.openSceneCount&&t.showBanner()):t.isShowBanner||(e=U.UI.getTopScene)&&e.canShowAd&&!e.isWuchu&&0==F.instance.openSceneCount&&t.showBanner()}),s.onError(e=>{t.existBannerAd=!1,console.error("Banner 加载错误",e),t.isLoading=!1,t.bannerLoadError=!0,U.Event.event("Hide_Clear_View")}),s.onResize(e=>{if(!s)return;let n=s.style.realHeight+.1;s.style.top=a.screenHeight-n+t.bannerTopFactor})}}showBanner(e,t){Laya.Browser.onWeiXin&&D.Instance.showBanner()}hideBanner(){if(Laya.Browser.onWeiXin&&(D.Instance.hideBanner(),this.existBannerAd&&this.bannerItem&&0!=this.isShowBanner&&Laya.Browser.onWeiXin)){this.isShowBanner=!1;var e=this.bannerItem;if(!e)return;e.hide(),console.log("hide banner"),this.countBanner()}}getSystemInfoSync(){Laya.Browser.onWeiXin&&(this.sysInfo=wx.getSystemInfoSync())}regisiterWxCallback(){Laya.Browser.onWeiXin&&(wx.offShow(this.onShowEvent),wx.onShow(this.onShowEvent),wx.offHide(this.onHideEvent),wx.onHide(this.onHideEvent))}onShowEvent(e){g.soundController.playMusic(s.BGM)}onHideEvent(){console.log("onHide"),U.Event.event(M.PLATFORM_SLEEP_EVENT),U.Game.isPlay&&(U.Game.isPlay=!1)}showShareMenuWithTicket(e){wx.showShareMenu({withShareTicket:e,success:function(){},fail:function(){},complete:function(){}})}regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var e=F.instance.shareContext;wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:e.title,imageUrl:e.image,query:"share_id=1",success:function(e){},fail:function(){}}})}}showToast(e,t){Laya.Browser.onWeiXin&&wx.showToast({title:e,duration:t,icon:"none",success:function(){},fail:function(){},complete:function(){},image:"",mask:!1})}shareGame(e){if(Laya.Browser.onWeiXin){console.log("分享游戏");var t=F.instance.shareContext;this.JJShareAppMessage(t,e)}}playVibrateShort(){Laya.Browser.onWeiXin&&wx.vibrateShort({success:function(){},fail:function(){},complete:function(){}})}playVibrateLong(){Laya.Browser.onWeiXin&&wx.vibrateLong({success:function(){},fail:function(){},complete:function(){}})}showModal(e){if(Laya.Browser.onWeiXin){var t=this;wx.showModal({title:"提示",content:e,showCancel:!0,confirmText:"重新分享",success(e){e.confirm?(console.log("点击确定"),t.shareGame(t.shareCallBack)):e.cancel&&console.log("点击取消")}})}}aldSendEvent(e,t){}aldSendOpenid(e){}JJBannerAdShowCount(){var e=this;Laya.Browser.onWeiXin&&wx.JJBannerAdShowCount(()=>({adUnitId:e.currentBannerId,adUnitName:"banner",pageName:"all"}))}JJSendVideoAdCount(e,t){var a=this;Laya.Browser.onWeiXin&&wx.JJSendVideoAdCount(()=>({adUnitId:a.videoId,adUnitName:t,isEnded:e}))}JJShareAppMessage(e,t){wx.JJShareAppMessage(()=>({title:e.title,imageUrl:e.imageUrl,id:e.id})).then(e=>{t(e)})}JJOnShareAppMessage(e){wx.JJOnShareAppMessage(()=>({title:e.title,imageUrl:e.imageUrl,id:e.id}))}JJStageStart(e,t){Laya.Browser.onWeiXin&&wx.JJStage.onStart({stageId:e,stageName:t})}JJStageEnd(e,t,a="complete",n={desc:"关卡完成"}){Laya.Browser.onWeiXin&&wx.JJStage.onEnd({stageId:e,stageName:t,event:a,params:n})}set bannerLoadError(e){}get bannerLoadError(){return D.Instance.isLoadBannerError}}class k extends N{}class O{constructor(){this.host="https://api.jiujiuhuyu.com/",this.appKey="1a398b4ddd333191da6d1d20794d2fde",this.gameConfigs={}}request(e,t,a,n="get"){let s=new Laya.HttpRequest;s.once(Laya.Event.COMPLETE,this,a),s.once(Laya.Event.ERROR,this,this.errorHandler),s.on(Laya.Event.PROGRESS,this,this.progressHandler);let o=this.host+e;"get"==n?s.send(o+t,"","get","json"):"post"==n&&s.send(o,t,"post","json",["Content-Type","application/json;charset=UTF-8"])}errorHandler(e){console.error("HTTP 错误：",e)}progressHandler(e){}getJJGameConfigs(){let e={};e.version=U.CommonData.gameVersion,e.app_key=this.appKey,e=this.getParam(e),this.request("game/configs",e,function(e){console.log(e)})}getJJGameAds(e=""){let t={};t.app_key=this.appKey,t.position_id=e,t=this.getParam(t),this.request("ads",t,function(e){console.log(e)})}getParam(e){var t="?";for(let a in e)t+=a+"="+e[a]+"&";return t}}class U{static init(){for(var e in M)M[e]=e;U.UI,U.Storage,U.Prefab,U.CommonData,U.Utils,U.Event,U.Game,U.Tween,U.Level,U.Platform,U.Streng,U.Sound}static get UI(){return this.uiManager||(this.uiManager=new v),this.uiManager}static get Storage(){return this.storageManager||(this.storageManager=new StorageManager),this.storageManager}static get Utils(){return this.utils||(this.utils=new P),this.utils}static get CommonData(){return this.commonData||(this.commonData=new b),this.commonData}static get Event(){return this.event||(this.event=new Laya.EventDispatcher),this.event}static get Prefab(){return this.prefabManager||(this.prefabManager=new B),this.prefabManager}static get Game(){return this.gameManager||(this.gameManager=new I),this.gameManager}static get Tween(){return this.tweenManager||(this.tweenManager=new V),this.tweenManager}static get Level(){return this.levelManager||(this.levelManager=new A),this.levelManager}static get Platform(){return this.platformManager||(this.platformManager=new k),this.platformManager}static get Streng(){return null}static get Sound(){return this.soundManager||(this.soundManager=new L),this.soundManager}static get Net(){return this.netManager||(this.netManager=new O),this.netManager}}class R{static httpRequest(e,t,a="get",n){var s=new Laya.HttpRequest;s.http.timeout=5e3,s.once(Laya.Event.COMPLETE,this,n),s.once(Laya.Event.ERROR,this,this.httpRequest,[e,t,a,n]),"get"==a?s.send(e+"?"+t,"",a,"text"):"post"==a&&s.send(e,JSON.stringify(t),a,"text")}static shuffleArr(e){let t=e.length;for(;t;){let a=Math.floor(Math.random()*t--);[e[a],e[t]]=[e[t],e[a]]}return e}static fixNodeY(e){e.y=e.y*Laya.stage.displayHeight/Laya.stage.designHeight}static visibleDelay(e,t=1500){e.visible=!1,Laya.timer.once(t,this,()=>{e.visible=!0})}static tMove(e,t,a,n){Laya.Tween.to(e,{x:t},a,null,new Laya.Handler(this,()=>{n&&n()}))}static tMoveDraw(e,t,a,n,s){Laya.Tween.to(e,{x:t,y:a},n,null,new Laya.Handler(this,()=>{s&&s()}))}static allowScene(){if(Laya.Browser.onWeiXin){var e=wx.getLaunchOptionsSync();console.log("当前场景：",e.scene);var t=!0;let a=F.instance.dataConfig.front_wuchu_scene;if(null==a&&(t=!0),-1==a.search("|")){t=parseInt(a)!=e.scene}let n=a.split("|");for(let a=0;a<n.length;a++){parseInt(n[a])==e.scene&&(t=!1)}return t}return!0}}!function(e){e.SCENE_FRIENDGAME="JJExport/FriendGameUI.scene",e.SCENE_SCROLLUI="JJExport/ScrollUI.scene",e.SCENE_RECOMMENDUI="JJExport/RecommendUI.scene",e.SCENE_FULLGAMEUI="JJExport/FullGameUI.scene",e.SCENE_FINISHGAMEUI="JJExport/FinishGameUI.scene",e.SCENE_DRAWUI="JJExport/DrawUI.scene",e.SCENE_PROGRAMUI="JJExport/ProgramUI.scene",e.SCENE_WECHATUI="JJExport/WeChatUI.scene",e.SCENE_CLEAN="JJExport/Clean.scene",e.SCENE_CLEAN_END="JJExport/Clean1.scene"}(l||(l={}));class F{constructor(){this.is_rpt=!1,this.dataConfig={is_allow_area:!1,is_allow_export:!1,front_wuchu_scene:"1001|1002",front_pass_gate:1,front_wuchu_finish_gate:5,front_time_tag_switch:!1,front_share_number:1,front_all_export_switch:!0,front_homepage_ad_switch:!1,front_start_remen_chance:100,front_start_wanghong_chance:100,front_duilian_export_switch:!1,front_duilian_icon_number:4,front_jingxi_export_switch:!1,front_inside_remen_chance:100,front_inside_wanghong_chance:100,front_jiesuan_tiaozhuan_chance:100,front_jiesuan_next_export_chance:0,front_freetips_switch:!0,front_randompaly_start_level:1,front_game_number_official:1,front_first_box_gate:1,front_second_box_gate:1,front_box_chance:100,front_progress_bar_return:.006,front_progress_bar_reduce:6,front_box_clicks:[2,8],front_is_box_force:!1,front_banner_show_time:1e3,front_banner_hide_time:1e3,front_wuchu_wanghong_gate:1,front_wuchu_remen_gate:1,front_banner_appear:1e3,front_button_up:1e3,front_banner_ids:[],front_create_banner_num:2,front_banner_change_time:3e3,front_banner_refresh_num:2,front_banner_number:8,front_banner_switch:!1,front_homepage_video_switch:!1,front_start_game_switch:!1,front_start_video_number:1,front_top_gezi_gate:1,front_wx_duilian_switch:!1,front_gezi_number:4,front_wx_ad_switch:!1,front_shield_appids:[],front_startpage_num:100,front_rpt_scene:[],front_double_jump_chance:0},this.navDataArr=[],this.JJConfigUrl="https://jiujiu.99huyu.cn/m/dqtiancai/config.json",this.openSceneCount=0,this.isOpenDraw=!1}static get instance(){return this._instance||(this._instance=new F),this._instance}closeAllTrap(){this.dataConfig.is_allow_area=!1,this.dataConfig.front_jingxi_export_switch=!1,this.dataConfig.front_duilian_export_switch=!1,this.dataConfig.front_homepage_ad_switch=!1,this.dataConfig.front_wx_ad_switch=!1,this.dataConfig.front_wx_duilian_switch=!1}get shareAmount(){var e=this.dataConfig.front_share_number;return null!=e?e:4}set shareContext(e){this.shareConfig=e}get shareContext(){return this.shareConfig}get isOpenWuChu(){return R.allowScene()&&t.GetPlayerData().grade>=this.dataConfig.front_pass_gate&&this.dataConfig.is_allow_area}get showBannerCount(){return this.dataConfig.front_banner_number}openScene(e,t=!1,a,n,s){F.instance.dataConfig.front_all_export_switch&&(e==l.SCENE_DRAWUI&&this.isOpenDraw&&this.closeScene(l.SCENE_DRAWUI),Laya.Scene.open(e,t,a,Laya.Handler.create(this,t=>{e!=l.SCENE_DRAWUI&&e!=l.SCENE_FINISHGAMEUI&&e!=l.SCENE_SCROLLUI&&e!=l.SCENE_WECHATUI&&this.openSceneCount++,Laya.stage.addChild(t),s&&s()})))}closeScene(e){Laya.Scene.close(e)}NavigateApp(e,t,a){if(0!=this.navDataArr.length&&(console.log("跳转",this.navDataArr[e].appid),U.Platform.aldSendEvent("导出-总点击数"),Laya.Browser.onWeiXin)){var n=this;wx.JJNavigateToMiniProgram(()=>({appId:n.navDataArr[e].appid,path:n.navDataArr[e].path,id:n.navDataArr[e].id})).then(t=>{console.log("success"),U.Platform.aldSendEvent("导出成功-总用户数"),U.Platform.aldSendEvent("导出成功-"+n.navDataArr[e].title)},e=>{console.log("fail",e),t&&t()})}}getSubtitle(e,t=!0){return null==this.navDataArr[e]?" ":t&&this.navDataArr[e].subtitle&&""!=this.navDataArr[e].subtitle?this.navDataArr[e].subtitle:this.navDataArr[e].title}getTitle(e,t=!0){return null==e?" ":t&&e.subtitle&&""!=e.subtitle?e.subtitle:e.title}updateDataConfig(e){var t=e.data;this.dataConfig.is_allow_area=e.is_allow_area,this.dataConfig.front_wuchu_scene=e.front_wuchu_scene,this.dataConfig.is_allow_export=e.is_allow_export;for(let e in t)this.dataConfig[e]=t[e].config_val;console.log(this.dataConfig),U.Event.event(M.UPDATE_SHARE_COUNT,{amount:this.dataConfig.front_share_number})}updateNavData(e){this.navDataArr=[];for(var t=0;t<e.length;t++){var a=e[t],n=new W;n.appid=a.channel_game_appid,n.title=a.channel_game_name,n.path=a.path,n.subtitle=a.originality.copywriting,n.icon=a.originality.material,n.id=a.originality.id,this.navDataArr.push(n)}}}class W{}class X{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(e){return Math.round(10*e)}toTween(e,t,a,n,s,o=!0){this.target=e,this.isLocal=o;var i={},r={};if(t.pos){var l=o?e.transform.localPosition.clone():e.transform.position.clone();i.posX=l.x,i.posY=l.y,i.posZ=l.z,r.posX=t.pos.x,r.posY=t.pos.y,r.posZ=t.pos.z}if(t.rot){var h=o?e.transform.localRotationEuler.clone():e.transform.rotationEuler.clone();i.rotX=h.x,i.rotY=h.y,i.rotZ=h.z,r.rotX=t.rot.x,r.rotY=t.rot.y,r.rotZ=t.rot.z}if(t.sca){var c=e.transform.getWorldLossyScale().clone();i.scaX=c.x,i.scaY=c.y,i.scaZ=c.z,r.scaX=t.sca.x,r.scaY=t.sca.y,r.scaZ=t.sca.z}this.tween.to(i,{posX:r.posX,posY:r.posY,posZ:r.posZ,rotX:r.rotX,rotY:r.rotY,rotZ:r.rotZ,scaX:r.scaX,scaY:r.scaY,scaZ:r.scaZ},a,s,Laya.Handler.create(this,()=>{n&&n();var e=this.tweens.shift();e?this.toTween(this.target,e.value,e.time,e.completeFun,s):this.updateTweenCallback&&(this.updateTweenCallback=null)}));var d=0;return this.tween.update=new Laya.Handler(this,()=>{let n=(d+=Laya.timer.delta)/a;n>1&&(n=1),t.pos&&(o?e.transform.localPosition=new Laya.Vector3(i.posX,i.posY,i.posZ):e.transform.position=new Laya.Vector3(i.posX,i.posY,i.posZ)),t.rot&&(o?e.transform.localRotationEuler=new Laya.Vector3(i.rotX,i.rotY,i.rotZ):e.transform.rotationEuler=new Laya.Vector3(i.rotX,i.rotY,i.rotZ)),t.sca&&e.transform.setWorldLossyScale(new Laya.Vector3(i.scaX,i.scaY,i.scaZ)),this.updateTweenCallback&&this.updateTweenCallback(n)}),this}clearTween(e){this.tweens=[],this.tween.clear(),this.target&&e&&(e.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z):this.target.transform.position=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z)),e.rot&&(this.target.transform.rotationEuler=new Laya.Vector3(e.rot.x,e.rot.y,e.rot.z)),e.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(e.sca.x,e.sca.y,e.sca.z)))}then(e,t,a){return this.tweens.push({value:e,time:t,completeFun:a}),this}}class H extends e{constructor(){super(...arguments),this.isStart=!1,this.isSuccess=!0,this.isCalling=!1,this.nowCube=[],this.stageID=0,this.trailPos=[],this.trailPosTime=[]}init(){H.instance=this,this.update=this.getComponent(_),g.isPure||m.StageIn(),g.nowScene=2,this.ButtonInit(),this.ValueInit(),this.GameInit(),this.GameStart()}ButtonInit(){}ValueInit(){t.GetPlayerData().grade}Totarial(){var e=new Laya.Animation;e.loadAnimation("Anim/Totourial.ani"),e.x=this.scene.width/2,e.y=this.scene.height-300,this.scene.addChild(e),e.play(),this.TotarialAnim=e,this.TotarialUI.set_visible(!0),c.TouchOn(this.TotarialEnd,()=>{},()=>{},this)}TotarialEnd(){c.TouchOff(this.GameStart,()=>{},()=>{},this),this.TotarialAnim.destroy(),this.TotarialUI.destroy()}DrawUI(){c.loadScene(l.SCENE_FULLGAMEUI,200,()=>{},{autoChance:F.instance.dataConfig.front_inside_wanghong_chance})}BackUI(){c.loadScene(l.SCENE_RECOMMENDUI,200,()=>{},{autoChance:F.instance.dataConfig.front_inside_remen_chance})}GameInit(){}GameStart(){this.isStart=!0,this.PlayerStart(),g.reduceEnergy()}GameEnd(){this.isStart&&(this.callDoneAndCanel(),this.touchWayCheck.destroy(),this.isStart=!1,this.getComponent(_).destroy(),g.isSuccess=this.isSuccess,m.StageOut(),g.soundController.play(s.Win),Laya.timer.once(500,this,()=>{g.fxController.BornFinishFx(),Laya.timer.once(2e3,this,()=>{g.AddGrade(),Laya.Scene.destroy(i.STAGEUI),c.loadScene(i.ENDMENU)})}))}EndAnim(){let e=new h,t=g.scene3D.getChildByName("End").getChildByName("Chest"),a=t.transform.position.clone();a.y=0;let n=Math.floor(this.nowCube.length/5),s=this.nowCube.length%5,o=20+7*n+1+s,r=!1;n==y.endItemCount?(a.z-=.5,o=a.z-g.player.transform.position.clone().z,s=0,this.nowCube.length==y.cubeCount-y.trailCubeCount&&(r=!0)):a.z=g.player.transform.position.clone().z+o-.5;let l=50*o,d=new h,u=g.mainCam.transform.position.clone(),p=new Laya.Vector3(u.x+1e3*(a.x-u.x)/l-5,u.y-8,u.z+1e3*o/l),f=new Laya.Vector3(a.x-8,u.y-8,u.z+o),L=new Laya.Vector3(a.x,u.y-10,u.z+o+1),w=new Laya.Vector3(-35,-150,0),C=new Laya.Vector3(-40,-180,0);d.toTween(g.mainCam,{pos:p,rot:w},1e3).then({pos:f},l-1e3,()=>{r&&d.toTween(g.mainCam,{pos:L,rot:C},1e3)}),e.toTween(g.player,{pos:a},l,()=>{if(r){let a=g.model.transform.localPosition.clone();a.z+=2,setTimeout(()=>{this.coinAnimGo(t)},1e3),e.toTween(g.model,{pos:a,rot:new Laya.Vector3(0,0,0)},1e3,()=>{let a=t.getComponent(Laya.Animator);a.speed=.5,a.play("Play"),e.toTween(g.model,{rot:new Laya.Vector3(0,180,0)},500),setTimeout(()=>{m.StageOut(),Laya.Scene.destroy(i.STAGEUI),c.loadScene(i.ENDMENU)},2e3)})}else setTimeout(()=>{Laya.Scene.destroy(i.STAGEUI),c.loadScene(i.ENDMENU)},2e3)});for(let e=0;e<n;e++)for(let t=1;t<=5;t++){let a=20+7*e+.5+t,n=new Laya.Vector3(g.player.transform.position.clone().x,0,g.player.transform.position.clone().z+a),s=50*a;this.EndCubeSet(n,s)}for(let e=0;e<s;e++){let t=20+7*n+1.5+e,a=new Laya.Vector3(g.player.transform.position.clone().x,0,g.player.transform.position.clone().z+t),s=50*t;this.EndCubeSet(a,s)}g.endAxis=1+.1*n,g.endCoin=10*g.endAxis,r&&(g.endCoin+=30)}coinAnimGo(e){}EndCubeSet(e,t){return 0==this.nowCube.length||(setTimeout(()=>{let t=this.nowCube[this.nowCube.length-1];g.scene3D.addChild(t),t.transform.position=e,this.putDownCube(t),this.nowCube.splice(this.nowCube.length-1,1),g.model.transform.localPositionY=.3+.3*this.nowCube.length},t),!1)}PlayerStart(){y.PlayerInit(),(new X).toTween(g.model,{pos:new Laya.Vector3(0,.5,0)},250,()=>{this.Totarial(),this.pickPosCube(g.player.transform.position.clone()),this.touchWayCheck=this.addComponent(E)},Laya.Ease.cubicIn,!0)}callUpdate(){if(this.isCalling)return;this.isCalling=!0;let e=this.touchWayCheck.calls[0];this.doCall(e)}doCall(e){let t=g.player.transform.position.clone(),a=t;t.y=0,this.trailPos=[],this.trailPosTime=[],this.trailPos.push(a);this.getNextPos(t,e);let n=[],s=50,o=50,i=[];n.push(this.trailPos[0]),this.trailPosTime.push(0);for(let e=1;e<this.trailPos.length-1;e++)""!=this.checkPosSpecial(this.trailPos[e])?(n.push(this.trailPos[e]),this.trailPosTime.push(s),s=0):i.push({pos:this.trailPos[e],time:o}),o+=50,s+=50;for(let e=0;e<i.length;e++)Laya.timer.once(i[e].time,this,()=>{g.fxController.BornMoveFx(i[e].pos)});if(n.push(this.trailPos[this.trailPos.length-1]),this.trailPosTime.push(s),this.trailPos=n,this.trailPos.length>1){let t=0,a=(n=!1)=>{if(this.pickPosCube(this.trailPos[t],n)&&this.GameEnd(),Laya.Vector3.equals(this.trailPos[t],y.endPos[this.stageID]))this.doCall(e);else{if(Laya.Vector3.equals(this.trailPos[t],y.startPos[this.stageID])){if(this.stageID--,this.stageID>=0)return void this.doCall(e);this.stageID=0}if(0!=t){if(!this.checkPosTrail(this.trailPos[t]))return setTimeout(()=>{},2e3),void this.callDoneAndCanel();if(this.checkPosWorm(this.trailPos[t]))return;if(this.checkPosBeacon(this.trailPos[t]))return;if(this.checkPosSpring(this.trailPos[t],e))return;if(this.checkPosStop(this.trailPos[t]))return void this.callDone()}else if(!this.checkPosTrail(this.trailPos[t+1]))return setTimeout(()=>{},2e3),void this.callDoneAndCanel();if(++t<this.trailPos.length){(new h).toTween(g.player,{pos:this.trailPos[t]},this.trailPosTime[t],a)}else this.callDone()}};a(!0)}else this.callDone()}callDone(){let e=this.touchWayCheck.calls;if(e.splice(0,1),e.length>0){let t=e[0];this.doCall(t)}else this.isCalling=!1}callDoneAndCanel(){this.touchWayCheck.calls=[],this.isCalling=!1}getNextPos(e,t){let a=y.roadCubes[this.stageID],n=e;for(let s=0;s<a.length;s++){let o=c.Vector3Reduce(a[s],e);if(1==Laya.Vector3.scalarLength(o)){let e=Math.atan2(o.z,o.x)/Math.PI*180,i="none";if(90==e?i="up":180==e?i="right":-90==e?i="down":0==e&&(i="left"),t==i){n=a[s];break}}}return e!=n&&(this.trailPos.push(n),n=this.getNextPos(n,t)),n}getCanGoPos(e){}checkPosSpecial(e){let t=y.canPickCubes[this.stageID];for(let a=0;a<t.length;a++){let n=t[a];if(Laya.Vector3.equals(n.transform.position,e))return"pick"}if(Laya.Vector3.equals(e,y.endPos[this.stageID]))return"end";if(Laya.Vector3.equals(e,y.startPos[this.stageID]))return"start";let a=y.trailPos[this.stageID];for(let t=0;t<a.length;t++)if(Laya.Vector3.equals(e,a[t]))return"trail";let n=y.spring;for(let t=0;t<n.length;t++){let a=n[t].transform.position;if(Laya.Vector3.equals(e,a))return"spring"}let s=y.beacon;for(let t=0;t<s.length;t++){let a=s[t].transform.position;if(Laya.Vector3.equals(e,a))return"beacon"}let o=y.wormHoleIn,i=y.wormHoleOut;for(let t in o){let a=o[t];if(Laya.Vector3.equals(e,a))return"hole"}for(let t in i){let a=i[t];if(Laya.Vector3.equals(e,a))return"hole"}return""}pickPosCube(e,t=!1){let a=y.canPickCubes[this.stageID],n=!1;for(let t=0;t<a.length;t++){let s=a[t];if(Laya.Vector3.equals(s.transform.position,e)){if(a.splice(t,1),y.changePickCubeMat(s,2),s.getComponent(Laya.Animator).play("Pop",0,0),g.fxController.BornPopFx(e),g.soundController.playPopSound(),n=!0,c.vibrateShort(),0==a.length)return!0}}return n||t||(g.fxController.BornPopFx(e),c.vibrateShort()),!1}CubePickDo(e){}checkPosTrail(e){let t=y.trailPos[this.stageID];if(!t)return!0;for(let a=0;a<t.length;a++)if(Laya.Vector3.equals(e,t[a])){if(this.nowCube.length<=1)return!1;let t=this.nowCube[this.nowCube.length-1];return g.scene3D.addChild(t),t.transform.position=e,this.putDownCube(t),this.nowCube.splice(this.nowCube.length-1,1),y.trailPos[this.stageID].splice(a,1),g.model.transform.localPositionY=.3+.3*this.nowCube.length,!0}return!0}checkPosSpring(e,t){let a=y.spring;for(let n=0;n<a.length;n++){let s=a[n].transform.position;if(Laya.Vector3.equals(e,s)){c.objectScaleTips(a[n]);let e=c.getTransformForward(a[n].transform);return Laya.Vector3.normalize(e,e),1==e.z?"right"==t?this.doCall("down"):"up"==t&&this.doCall("left"):1==e.x?"left"==t?this.doCall("down"):"up"==t&&this.doCall("right"):-1==e.x?"right"==t?this.doCall("up"):"down"==t&&this.doCall("left"):-1==e.z&&("left"==t?this.doCall("up"):"down"==t&&this.doCall("right")),!0}}return!1}checkPosBeacon(e){let t=y.beacon;for(let a=0;a<t.length;a++){let n=t[a].transform.position;if(Laya.Vector3.equals(e,n)){c.objectScaleTips(t[a]);let e=c.getTransformForward(t[a].transform);return Laya.Vector3.normalize(e,e),1==e.z?this.doCall("left"):1==e.x?this.doCall("down"):-1==e.x?this.doCall("up"):-1==e.z&&this.doCall("right"),!0}}return!1}checkPosWorm(e){let t=y.wormHoleIn,a=y.wormHoleOut;for(let a in t){let n=t[a];if(Laya.Vector3.equals(e,n)){let t=new h,n=c.Vector3Reduce(e,new Laya.Vector3(0,.3*this.nowCube.length+1.5,0)),s=this.GoOutWorm(a),o=c.Vector3Reduce(s,new Laya.Vector3(0,.3*this.nowCube.length+1.5,0));return t.toTween(g.player,{pos:n},1e3,()=>{g.player.transform.position=o}).then({pos:s},1e3,()=>{this.callDoneAndCanel()}),!0}}for(let t in a){let n=a[t];if(Laya.Vector3.equals(e,n)){let a=new h,n=c.Vector3Reduce(e,new Laya.Vector3(0,.3*this.nowCube.length+2.5,0)),s=this.GoInWorm(t),o=c.Vector3Reduce(s,new Laya.Vector3(0,.3*this.nowCube.length+2.5,0));return a.toTween(g.player,{pos:n},1e3,()=>{g.player.transform.position=o}).then({pos:s},1e3,()=>{this.callDoneAndCanel()}),!0}}return!1}GoOutWorm(e){return y.wormHoleOut[e]}GoInWorm(e){return y.wormHoleIn[e]}putDownCube(e){let t=e.transform.position.clone(),a=e.transform.position.clone();a.y+=.3,e.transform.position=a,c.setTransRotEulerX(e.transform,0),(new h).toTween(e,{pos:t,rot:new Laya.Vector3(0,0,0)},500)}checkPosStop(e){let t=y.stop;for(let a=0;a<t.length;a++)if(Laya.Vector3.equals(t[a],e))return!0;return!1}}class G extends e{constructor(){super(...arguments),this.fingerScale=1,this.fingerAxis=1}init(){g.nowScene=1,this.zOrder=1,g.fxController.cleanFxs(),this.ButtonInit(),m.StartMenuIn(),this.EnergyInit()}EnergyInit(){this.EnergyUpdate(),c.d2_AddClickEvent(this.energyNeedBtn,this,()=>{this.openEnergyPanel()}),c.d2_AddClickEvent(this.energyCancelBtn,this,this.closeEnergyPanel),c.d2_AddClickEvent(this.energyVideoBtn,this,()=>{g.addEnergy(10),this.EnergyUpdate()}),Laya.timer.loop(1e3,this,this.EnergyUpdate)}openEnergyPanel(){this.energyPanel.set_visible(!0)}closeEnergyPanel(){this.energyPanel.set_visible(!1)}EnergyUpdate(){let e=g.checkEnergy();if(this.energyValue.value=g.readEnergy().toString(),null!=e){this.energyTime.set_visible(!0),e=6e4-e;let t,a,n=Math.floor(e/1e3),s=Math.floor(n/60);n%=60;let o=(t=s<10?"0"+s.toString():s.toString())+":"+(a=n<10?"0"+n.toString():n.toString());this.energyTime.value=o}else{this.energyTime.set_visible(!1)}}ButtonInit(){c.d2_AddClickEvent(this.startButton,this,this.StartGame)}StartGame(){g.readEnergy()<5?this.openEnergyPanel():g.isPure?(g.collider.enable=!0,Laya.Scene.destroy(i.STARTMENU),c.loadScene(i.STAGEUI)):m.StartMenuOut(()=>{g.collider.enable=!0,Laya.Scene.destroy(i.STARTMENU),c.loadScene(i.STAGEUI)})}MoreGame(){c.loadScene(l.SCENE_FULLGAMEUI,200,()=>{},{closeCallbackFun:()=>{},autoChance:Number(F.instance.dataConfig.front_inside_wanghong_chance)})}DrawUI(){c.loadScene(l.SCENE_DRAWUI)}EndAnimInit(){}OpenShop(){}}class z{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("scripts/EndMenu.ts",p),e("scripts/Loading.ts",S),e("scripts/Stage.ts",H),e("scripts/StageUpdate.ts",_),e("scripts/StartMenu.ts",G)}}z.width=750,z.height=1334,z.scaleMode="fixedwidth",z.screenMode="vertical",z.alignV="middle",z.alignH="center",z.startScene="Loading.scene",z.sceneRoot="",z.debug=!1,z.stat=!1,z.physicsDebug=!1,z.exportSceneToJson=!0,z.init();new class{constructor(){window.Laya3D?Laya3D.init(z.width,z.height):Laya.init(z.width,z.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=z.scaleMode,Laya.stage.screenMode=z.screenMode,Laya.stage.alignV=z.alignV,Laya.stage.alignH=z.alignH,Laya.URL.exportSceneToJson=z.exportSceneToJson,(z.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),z.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),z.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Laya.Scene.open(i.LOADING)}}}();