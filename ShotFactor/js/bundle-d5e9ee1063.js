!function(){"use strict";class e{static bornStageObj(e,t=this.mainScene){let s=this.prefabs.getChildByName(e);if(!s)return console.warn("生成物体不存在",e),null;let a=Laya.Sprite3D.instantiate(s,t);return a.transform.localPosition=new Laya.Vector3,this.stageObj.push(a),this.fxPool=[],a}static stageObjClear(){for(let e=this.stageObj.length-1;e>=0;e--)this.stageObj[e]&&!this.stageObj[e].destroyed&&this.stageObj[e].destroy();this.stageObj=[]}static bornFxDestroy(e,t,s=1e3,a=1,i=new Laya.Vector3){if(!this.isFxOn)return null;let o=this.fxs.getChildByName(e).clone();return t.addChild(o),o.transform.localPosition=i,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(a,a,a),Laya.timer.once(s,this,()=>{o.destroy()}),o}static bornFxFromPool(e,t,s=1e3,a=1,i=new Laya.Vector3){let o;for(let t=this.fxPool.length-1;t>=0;t--)if(this.fxPool[t].name==e){(o=this.fxPool.splice(t,1)[0]).active=!0;break}if(!o){let t=this.fxs.getChildByName(e);o=t.clone()}return t.addChild(o),this.stageObj.push(o),o.transform.localPosition=i,o.transform.localRotationEuler=new Laya.Vector3,o.transform.localScale=new Laya.Vector3(a,a,a),Laya.timer.once(s,this,()=>{o&&!o.destroyed&&(this.mainScene.addChild(o),o.active=!1,this.fxPool.push(o))}),o}static bornFxStage(e,t,s=1,a=new Laya.Vector3){let i=this.fxs.getChildByName(e).clone();return t.addChild(i),i.transform.localPosition=a,i.transform.localRotationEuler=new Laya.Vector3,i.transform.localScale=new Laya.Vector3(s,s,s),this.stageObj.push(i),i}}var t,s,a,i,o,n,l,r,h,d,c;e.stageObj=[],e.isFxOn=!0,e.fxPool=[],function(e){e.Load="scenes/Load.scene",e.Home="scenes/Home.scene",e.Game="scenes/Game.scene",e.Over="scenes/Over.scene"}(t||(t={})),function(e){e.SubPackage="分包",e.Scene3D="3D场景",e.SDK="SDK"}(s||(s={})),function(e){e.Scene_GoHome="Scene_GoHome",e.Scene_GoGame="Scene_GoGame",e.Scene_GoOver="Scene_GoOver",e.Progress_Load_Update="Progress_Load_Update",e.Platform_Wake_Do="Platform_Wake_Do",e.Platform_Hide_Do="Platform_Hide_Do",e.Game_Coin_Update="Game_Coin_Update",e.Game_DesignStat_Update="Game_DesignStat_Update",e.Game_DesginFinish_Event="Game_DesginFinish_Event",e.Game_SpeedLevel_Update="Game_SpeedLevel_Update",e.Game_CubeLevel_Update="Game_CubeLevel_Update",e.Game_SetOn_Event="Game_SetOn_Event",e.Game_EnemyReach_Event="Game_EnemyReach_Event",e.Game_EnemyDie_Event="Game_EnemyDie_Event"}(a||(a={})),function(e){e.Bgm="Bgm",e.Button="Button",e.Choose="Choose",e.Put="Put",e.Shot="Shot",e.Hit="Hit",e.Win="Win",e.FALSE="FALSE",e.GetMoney="GetMoney",e.Boom_01="Boom_01",e.Boom_02="Boom_02"}(i||(i={}));class u{static on(e,t,s,a){this.eventDispatcher.on(e,t,s,a)}static event(e,t){this.eventDispatcher.event(e,t)}static off(e,t,s){this.eventDispatcher.off(e,t,s)}static offAllCaller(e){this.eventDispatcher.offAllCaller(e)}}u.eventDispatcher=new Laya.EventDispatcher;class m{static init(){for(var e in this._soundCtx={},this._soundFile=[],this.loopSounds=[],i){let t=i[e];this._soundFile.push(t)}console.log("音效：",this._soundFile);let t=this._pathRoot,s="",o=this._soundFile,n=this._soundFile.length;for(let e=0;e<n;++e){s=o[e];let a=new Laya.SoundChannel;a.url=t+s+this.soundType,Laya.SoundManager.addChannel(a),this._soundCtx[s]=!0}Laya.SoundManager.autoStopMusic=!0,Laya.Browser.onWeiXin&&(u.on(a.Platform_Wake_Do,this,this.randomPlayMusic),Laya.timer.once(1e3,this,this.randomPlayMusic))}static setSoundVolume(e,t){this._soundCtx[e]&&Laya.SoundManager.setSoundVolume(t,this._pathRoot+e+this.soundType)}static play(e,t=!1){if(this._soundCtx[e])return t&&-1==this.loopSounds.indexOf(e)?(this.loopSounds.push(e),Laya.SoundManager.playSound(this._pathRoot+e+this.soundType,0)):Laya.SoundManager.playSound(this._pathRoot+e+this.soundType)}static stop(e,t=!1){if(this._soundCtx[e]){if(t){let t=this.loopSounds.indexOf(e);-1!=t&&this.loopSounds.splice(t,1)}Laya.SoundManager.stopSound(this._pathRoot+e+this.soundType)}}static playMusic(e){let t;return Laya.SoundManager.stopMusic(),e?(t=Laya.SoundManager.playMusic(this._pathRoot+e+this.soundType,0),this.currentBgm=e):t=this.currentBgm?Laya.SoundManager.playMusic(this._pathRoot+this.currentBgm+this.soundType,0):Laya.SoundManager.playMusic(this._pathRoot+i.Bgm+this.soundType,0),t}static stopMusic(){Laya.SoundManager.stopMusic()}static randomPlayMusic(){let e=i.Bgm;m.playMusic(e);Laya.timer.once(50500,this,this.randomPlayMusic)}static soundSwitch(e){this.isSound=e,Laya.SoundManager.soundMuted=!this.isSound}static muiscSwitch(e){this.isMusic=e,Laya.SoundManager.musicMuted=!this.isMusic}static playSoundLimit(e){let t=!0;if(this.CDs[e]&&0!=this.CDs[e]&&(t=!1),t){let t=this.play(e);t&&(this.CDs[e]=500*t.duration),Laya.timer.once(this.CDs[e],this,()=>{this.CDs[e]=0})}}}m._pathRoot="res/sounds/",m.soundType=".mp3",m.isSound=!0,m.isMusic=!0,m.CDs={};class p{static BornEnemyHitFx(t){this.isHitFxOk&&(e.bornFxFromPool("HitEnemyFX",e.mainScene,500,1,t),this.isHitFxOk=!1,Laya.timer.once(this.hitCD,this,()=>{this.isHitFxOk=!0})),m.playSoundLimit(i.Hit)}static BornEnemyHitGroundFx(t){this.isHitGroundFxOk&&(e.bornFxFromPool("HitGroundFX",e.mainScene,500,.01,t),this.isHitGroundFxOk=!1,Laya.timer.once(this.hitGroundCD,this,()=>{this.isHitGroundFxOk=!0}))}static BornDiamond(e,t,s=3){}}p.coinUrl="ui/game/gold.png",p.designMods=["mod_+1","mod_+2","mod_x2","mod_x3","cannon"],p.enemyMoveSpeed=3,p.enemyHpScale=1,p.boss1Hp={Boss_Body_Bottom:4,Boss_UpLeg_L:3,Boss_Leg_L:2,Boss_Foot_L:1,Boss_UpLeg_R:3,Boss_Leg_R:2,Boss_Foot_R:1,Boss_Body_Top:5,Boss_Arm_L:3,Boss_ForeArm_L:2,Boss_Hand_L:1,Boss_Head:6,Boss_Arm_R:3,Boss_ForeArm_R:2,Boss_Hand_R:1},p.boss1MoveSpeed=3,p.boss1MoveSpeed2=2.5,p.boss1CrawlSpeed=2,p.boss1MoveSpeed3=1.5,p.boss2MoveSpeed=2,p.boss2Hp=100,p.boss2AttackCD=2,p.boss2BulletMin=1,p.boss2BulletMax=9,p.boss2BulletSpeed=3,p.doubleCondition=10,p.doubleAxis=2,p.cannonCD=3,p.cannonDamage=10,p.endChestHp=50,p.passStageGet=15,p.gunLevelUpData=[{level:1,gunLevelAtk:1,gunLevelUpNeed:5},{level:2,gunLevelAtk:1.1,gunLevelUpNeed:9},{level:3,gunLevelAtk:1.2000000000000002,gunLevelUpNeed:13},{level:4,gunLevelAtk:1.3000000000000003,gunLevelUpNeed:17},{level:5,gunLevelAtk:1.4000000000000004,gunLevelUpNeed:21},{level:6,gunLevelAtk:1.5000000000000004,gunLevelUpNeed:25},{level:7,gunLevelAtk:1.6000000000000005,gunLevelUpNeed:29},{level:8,gunLevelAtk:1.7000000000000006,gunLevelUpNeed:33},{level:9,gunLevelAtk:1.8000000000000007,gunLevelUpNeed:37},{level:10,gunLevelAtk:1.9000000000000008,gunLevelUpNeed:41},{level:11,gunLevelAtk:2.000000000000001,gunLevelUpNeed:45},{level:12,gunLevelAtk:2.100000000000001,gunLevelUpNeed:49},{level:13,gunLevelAtk:2.200000000000001,gunLevelUpNeed:53},{level:14,gunLevelAtk:2.300000000000001,gunLevelUpNeed:57},{level:15,gunLevelAtk:2.4000000000000012,gunLevelUpNeed:61},{level:16,gunLevelAtk:2.5000000000000013,gunLevelUpNeed:65},{level:17,gunLevelAtk:2.6000000000000014,gunLevelUpNeed:69},{level:18,gunLevelAtk:2.7000000000000015,gunLevelUpNeed:73},{level:19,gunLevelAtk:2.8000000000000016,gunLevelUpNeed:77},{level:20,gunLevelAtk:2.9000000000000017,gunLevelUpNeed:81},{level:21,gunLevelAtk:3.0000000000000018,gunLevelUpNeed:85},{level:22,gunLevelAtk:3.100000000000002,gunLevelUpNeed:89},{level:23,gunLevelAtk:3.200000000000002,gunLevelUpNeed:93},{level:24,gunLevelAtk:3.300000000000002,gunLevelUpNeed:97},{level:25,gunLevelAtk:3.400000000000002,gunLevelUpNeed:101},{level:26,gunLevelAtk:3.500000000000002,gunLevelUpNeed:105},{level:27,gunLevelAtk:3.6000000000000023,gunLevelUpNeed:109},{level:28,gunLevelAtk:3.7000000000000024,gunLevelUpNeed:113},{level:29,gunLevelAtk:3.8000000000000025,gunLevelUpNeed:117},{level:30,gunLevelAtk:3.9000000000000026,gunLevelUpNeed:121},{level:31,gunLevelAtk:4.000000000000003,gunLevelUpNeed:125},{level:32,gunLevelAtk:4.100000000000002,gunLevelUpNeed:129},{level:33,gunLevelAtk:4.200000000000002,gunLevelUpNeed:133},{level:34,gunLevelAtk:4.300000000000002,gunLevelUpNeed:137},{level:35,gunLevelAtk:4.400000000000001,gunLevelUpNeed:141},{level:36,gunLevelAtk:4.500000000000001,gunLevelUpNeed:145},{level:37,gunLevelAtk:4.6000000000000005,gunLevelUpNeed:149},{level:38,gunLevelAtk:4.7,gunLevelUpNeed:153},{level:39,gunLevelAtk:4.8,gunLevelUpNeed:157},{level:40,gunLevelAtk:4.8999999999999995,gunLevelUpNeed:161},{level:41,gunLevelAtk:4.999999999999999,gunLevelUpNeed:165},{level:42,gunLevelAtk:5.099999999999999,gunLevelUpNeed:169},{level:43,gunLevelAtk:5.199999999999998,gunLevelUpNeed:173},{level:44,gunLevelAtk:5.299999999999998,gunLevelUpNeed:177},{level:45,gunLevelAtk:5.399999999999998,gunLevelUpNeed:181},{level:46,gunLevelAtk:5.499999999999997,gunLevelUpNeed:185},{level:47,gunLevelAtk:5.599999999999997,gunLevelUpNeed:189},{level:48,gunLevelAtk:5.699999999999997,gunLevelUpNeed:193},{level:49,gunLevelAtk:5.799999999999996,gunLevelUpNeed:197},{level:50,gunLevelAtk:5.899999999999996,gunLevelUpNeed:201},{level:51,gunLevelAtk:5.999999999999996,gunLevelUpNeed:205}],p.isCannon=!1,p.gunType="Gun_1_1",p.gunBullet=1,p.bulletDis=100,p.bulletRaidus=.15,p.setGroundY=[],p.cannonRaidus=5,p.hitCD=50,p.isHitFxOk=!0,p.hitGroundCD=25,p.isHitGroundFxOk=!0;class y{constructor(){this.isSubPackage=!0,this.isVibrate=!0}init(){y.instance=this}loadSubPackage(e,t){if(this.platformApi&&this.isSubPackage){this.platformApi.loadSubpackage({name:e,success:function(s){console.log("分包加载成功：",e),t.call(!0,s)},fail:function(s){console.error("分包加载失败：",e,JSON.stringify(s)),t.call(!1,s)}})}else console.log("没有平台API"),t(!0)}showToast(e,t=1e3){console.log(e,t.toString()+"ms")}vibrateShort(){this.platformApi&&this.isVibrate&&this.platformApi.vibrateShort()}vibrateLong(){this.platformApi&&this.isVibrate&&this.platformApi.vibrateLong()}regisiterCallback(){this.platformApi&&(this.platformApi.offShow(this.onShowEvent),this.platformApi.onShow(this.onShowEvent),this.platformApi.offHide(this.onHideEvent),this.platformApi.onHide(this.onHideEvent))}onShowEvent(e){u.event(a.Platform_Wake_Do,e)}onHideEvent(e){u.event(a.Platform_Hide_Do,e)}showVideo(e,t){this.showToast("无视频，默认发放奖励"),e&&e()}}class g{static AddGrade(){let e=this.GetPlayerData();e.grade++,parseInt(e.grade)>99&&(e.grade=99),this.SavePlayerData(e)}static ReadGrade(){let e=this.GetPlayerData();return parseInt(e.grade)}static AddSpeedLevel(){let e=this.GetPlayerData();e.speedLevel++,this.SavePlayerData(e)}static ReadSpeedLevel(){return this.GetPlayerData().speedLevel}static AddLockCube(){let e=this.GetPlayerData();e.lockCube++,this.SavePlayerData(e)}static ReadLockCube(){return this.GetPlayerData().lockCube}static AddCoin(e){let t=this.GetPlayerData();t.coin+=e,t.coin>99999&&(t.coin=99999),Math.floor(t.coin),this.SavePlayerData(t),u.event(a.Game_Coin_Update)}static CostCoin(e){let t=!1;return this.ReadCoin()>=e?(this.AddCoin(-e),t=!0):y.instance.showToast("金币不足"),t}static ReadCoin(){let e=this.GetPlayerData();return Math.floor(e.coin)}static GetPlayerData(){let e;return(e=Laya.LocalStorage.getJSON("PlayerData"))||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),e)}static SavePlayerData(e){Laya.LocalStorage.setJSON("PlayerData",e)}static ClearPlayerData(){Laya.LocalStorage.clear()}static CheckPlayerData(){let e;(e=Laya.LocalStorage.getJSON("PlayerData"))&&e.ver&&e.ver==this.data.ver||(e=this.data,Laya.LocalStorage.setJSON("PlayerData",e),console.log("触发存档重置条件")),console.log(this.GetPlayerData())}}g.data={ver:"ShotFactor_0.4.1",grade:1,coin:0,lockCube:0,speedLevel:0};class f{static toAlpha(e,t,s,a,i,o,n=!1,l=!1){function alpha1(){let t=l||n?new Laya.Handler(this,alpha2):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{alpha:s},a,i,t)}function alpha2(){let s=l?new Laya.Handler(this,alpha1):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{alpha:t},a,i,s)}e&&!e.destroyed&&(this.clearTween(e),e.alpha=t,alpha1())}static toScale(e,t,s,a,i,o,n=!1,l=!1){function scale1(){let t=l||n?new Laya.Handler(this,scale2):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{scaleX:s,scaleY:s},a,i,t)}function scale2(){let s=l?new Laya.Handler(this,scale1):new Laya.Handler(this,()=>{o&&o(),o=null});Laya.Tween.to(e,{scaleX:t,scaleY:t},a,i,s)}e&&!e.destroyed&&(this.clearTween(e),e.scale(t,t),scale1())}static toPosition(e,t,s,a,i,o=!1,n=0){if(!e||e.destroyed)return;this.clearTween(e);let l={},r={};function pos1(){if(o)var t=0==n?new Laya.Handler(this,pos2):new Laya.Handler(this,pos3);else t=new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,r,s,a,t)}function pos2(){Laya.Tween.to(e,l,s,a,Laya.Handler.create(this,pos1))}function pos3(){e.pos(l.x,l.y),pos1()}null!=t.x&&(l.x=e.x,r.x=t.x),null!=t.y&&(l.y=e.y,r.y=t.y),pos1()}static toRotaion(e,t,s,a,i,o=!1,n=!1){if(!e||e.destroyed)return;this.clearTween(e);let l=e.rotation,r=l+t,h=l-t+l;function rotate2(){Laya.Tween.to(e,{rotation:h},2*s,a,Laya.Handler.create(this,rotate3))}function rotate3(){Laya.Tween.to(e,{rotation:r},2*s,a,Laya.Handler.create(this,rotate2))}function rotate4(){let t=new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,{rotation:l},s,a,t)}!function(){let t=n?new Laya.Handler(this,rotate2):o?new Laya.Handler(this,rotate4):new Laya.Handler(this,()=>{i&&i(),i=null});Laya.Tween.to(e,{rotation:r},s,a,t)}()}static showViewByScale(e,t,s=1,a=200){this.toScale(e,0,s,a,Laya.Ease.bounceOut,t,!0,!1)}static clearTween(e){Laya.Tween.clearAll(e)}}class L extends Laya.Scene{onAwake(){this.size(Laya.stage.width,Laya.stage.height),this.init(),this.initEvent()}onClosed(){u.offAllCaller(this),Laya.timer.clearAll(this)}init(){}initEvent(){}}class w extends L{init(){w.instance=this;let e=new Laya.Sprite;this.scene.addChild(e),this.black=e,this.setCannonRange(0),this.cannon.set_visible(p.isCannon),this.roundBar.value=0,this.roundBar.getChildByName("nowStage").value=g.ReadGrade().toString();let t=g.ReadGrade()+1;t=t>=100?99:t,this.roundBar.getChildByName("nextStage").value=t.toString()}initEvent(){}setCannonRange(e){e=1-e;let t=this.cannon.getChildByName("light");e>1&&(e=1),1==e?0==t.visible&&(t.set_visible(!0),f.toScale(t,0,1.5,500)):t.set_visible(!1),e<0&&(e=0);let s=this.black;s.alpha=.5,s.graphics.clear(),s.graphics.drawTexture,s.graphics.drawPie(this.cannon.x+56,Laya.stage.height-this.cannon.bottom-56,56,-90,270-360*e,"#505050")}}class v{static add(e,t){var s=new Laya.Vector3;return Laya.Vector3.add(e,t,s),s.clone()}static subtract(e,t){var s=new Laya.Vector3;return Laya.Vector3.subtract(e,t,s),s.clone()}static mull(e,t){var s=new Laya.Vector3;return Laya.Vector3.scale(e,t,s),s.clone()}static dot(e,t){return Laya.Vector3.dot(e,t)}static cross(e,t){var s=new Laya.Vector3;return Laya.Vector3.cross(e,t,s),s.clone()}static normalized(e){var t=new Laya.Vector3;return Laya.Vector3.normalize(e,t),t.clone()}static distance(e,t){var s=v.subtract(e,t);return Laya.Vector3.scalarLength(s)}}class b{static d3_getSpritePosBySprite3DPoint(e,t,s=new Laya.Vector3(0,0,0)){var a=t.transform.position.clone();a.x+=s.x,a.y+=s.y,a.z+=s.z;var i=new Laya.Vector4;e.viewport.project(a,e.projectionViewMatrix,i);var o=new Laya.Vector2(i.x/Laya.stage.clientScaleX,i.y/Laya.stage.clientScaleY);return new Laya.Point(o.x,o.y)}static d3_FindNodeByName(e,t){let s=null,a=e=>{for(let i=0;i<e.numChildren;i++){if(e.getChildAt(i).name==t)return void(s=e.getChildAt(i));a(e.getChildAt(i))}};return a(e),s}static d3_FindNodeHasName(e,t){let s=null,a=e=>{for(let i=0;i<e.numChildren;i++){if(-1!=e.getChildAt(i).name.indexOf(t))return void(s=e.getChildAt(i));a(e.getChildAt(i))}};return a(e),s}static d3_FindAllNodeHasName(e,t){let s=[],a=e=>{for(let i=0;i<e.numChildren;i++)-1!=e.getChildAt(i).name.indexOf(t)&&s.push(e.getChildAt(i)),a(e.getChildAt(i))};return a(e),s}static d3_switchAllMathInChildren(e,t){if(e.meshRenderer){let s=e.meshRenderer.material.clone();s.albedoColor=b.d3_getRgbByHex(t),e.meshRenderer.material=s}for(let s=0;s<e.numChildren;s++){let a=e.getChildAt(s);if(a.meshRenderer){let e=new Laya.BlinnPhongMaterial,s=b.d3_getRgbByHex(t);e.albedoColor=new Laya.Vector4(s.x,s.y,s.z,1),e.specularColor=new Laya.Vector4(0,0,0,1),a.meshRenderer.material=e}this.d3_switchAllMathInChildren(a,t)}}static d3_swtichMatColor(e,t){let s=e.meshRenderer;s||(s=e.skinnedMeshRenderer);let a=s.material.clone();a.albedoColor=t,s.material=a}static d3_switchAllMatInChildren_Alpha(e,t){if(e.meshRenderer){let s=e.meshRenderer.material.clone();s.albedoColor.w=t,e.meshRenderer.material=s}for(let s=0;s<e.numChildren;s++){let a=e.getChildAt(s);this.d3_switchAllMatInChildren_Alpha(a,t)}}static d3_unactiveAllChildren(e){for(let t=0;t<e.numChildren;t++)e.getChildAt(t).active=!1}static d3_addChildNotMove(e,t){let s=e.transform.position.clone(),a=e.transform.rotation.clone();t.addChild(e),e.transform.position=s,e.transform.rotation=a}static d3_getRgbByHex(e){var t=[],s=[];let a=e.replace(/#/,"");if(3==a.length){for(var i=[],o=0;o<3;o++)i.push(a.charAt(o)+a.charAt(o));a=i.join("")}for(o=0;o<3;o++)t[o]="0x"+a.substr(2*o,2),s.push(parseInt(t[o]));return new Laya.Vector4(s[0]/255,s[1]/255,s[2]/255,0)}static d3_objectShake(e,t=1,s=.7){var a=t,i=1,o=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(a>0){var t=new Laya.Vector3;Laya.Vector3.scale((n=Math.random()>.5?Math.random():-Math.random(),l=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(n,l,0)),s,t),Laya.Vector3.add(o,t,t),e.transform.localPosition=t,a-=.02*i}else a=0,e.transform.localPosition=o,Laya.timer.clear(this,updateShake);var n,l})}static getAngle(e,t){var s=Laya.Vector3.dot(e,t),a=Laya.Vector3.scalarLength(e)*Laya.Vector3.scalarLength(t);if(0==a){if(e.z>t.z)return 0;if(e.z<t.z)return 180;if(e.y>t.y)return 90;if(e.y<t.y)return-90}var i=s/a;return i<-1&&(i=-1),i>1&&(i=1),180*Math.acos(i)/Math.PI}static getAngleUp(e,t,s){let a=b.getAngle(e,t),i=new Laya.Vector3;return Laya.Vector3.cross(t,e,i),b.getAngle(s,i)>90&&(a*=-1),a}static getProjection(e,t){let s=v.mull(t,v.dot(e,t));return v.subtract(e,s)}static d2_AddClickEvent(e,t,s,a,o=!1,n=!0,l=!0){e.offAllCaller(t);let r=e.scaleX,h=.9*r,d=!1;e.on(Laya.Event.MOUSE_DOWN,t,t=>{d=!0,l&&Laya.Tween.to(e,{scaleX:h,scaleY:h},60),o&&t.stopPropagation},a);e.on(Laya.Event.MOUSE_UP,t,a=>{0!=d&&(d=!1,o&&a.stopPropagation,l?Laya.Tween.to(e,{scaleX:r,scaleY:r},60,null,Laya.Handler.create(e,()=>{s&&s.call(t,a)})):s&&s.call(t,a),n&&m.play(i.Button))},a);e.on(Laya.Event.MOUSE_OUT,t,t=>{0!=d&&(d=!1,l&&Laya.Tween.to(e,{scaleX:r,scaleY:r},60),o&&t.stopPropagation)},a)}static getAngle2DWay(e,t){var s=Laya.Vector2.dot(e,t),a=Laya.Vector2.scalarLength(e)*Laya.Vector2.scalarLength(t),i=180*Math.acos(s/a)/Math.PI,o=e.x*t.y-t.x*e.y;return o>0?i*=1:o<0?i*=-1:i=0,i}static d2_coinCollectAnim(e,t,s,a,i=15,o=1,n=null,l=null){for(var r=i,h=0;h<i;h++){let i=Laya.Pool.getItemByClass("coin",Laya.Image);i.skin=e,i.x=t.x,i.y=t.y,i.scale(o,o),a.addChild(i);let h=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},h),Laya.timer.once(h+50,this,function(){Laya.Tween.to(i,{x:s.x,y:s.y},400,null,new Laya.Handler(this,function(){a.removeChild(i),Laya.Pool.recover("coin",i),r--,l&&l(),0==r&&n&&n(a)}))})}}static d2_coinCollectAnimAni(e,t,s,a,i=15,o=null){for(var n=i,l=0;l<i;l++){let i=Laya.Pool.getItemByClass("coinAnim",Laya.Clip);i.skin=e.skin,i.index=e.index,i.clipX=e.clipX,i.clipY=e.clipY,i.autoPlay=e.autoPlay,i.x=t.x,i.y=t.y,i.scale(.8,.8),a.addChild(i);let l=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},l),Laya.timer.once(l+50,this,function(){Laya.Tween.to(i,{x:s.x,y:s.y},400,null,new Laya.Handler(this,function(){a.removeChild(i),Laya.Pool.recover("coinAnim",i),0==--n&&o&&o(a)}))})}}static faceToast(e,t,s,a){let i=new Laya.Image(e);i.anchorX=.5,i.anchorY=.5,i.alpha=1,i.scaleX=.3,i.scaleY=.3,t.addChild(i),i.x=s.x,i.y=s.y,Laya.Tween.to(i,{x:a.x,y:a.y,alpha:.9},1e3,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{i&&!i.destroyed&&Laya.Tween.to(i,{x:a.x,y:a.y-100,alpha:0},1e3,null,Laya.Handler.create(this,()=>{i&&!i.destroyed&&i.destroy()}))}))}static d2_fontClipToast(e,t,s,a,i){if(!this.wordToastOk)return;let o=Laya.Pool.getItemByClass("fontClip_d2",Laya.FontClip);o.skin=e,o.sheet="0123456789",o.value=t,o.anchorX=.5,o.anchorY=.5,o.alpha=1,o.scaleX=a,o.scaleY=a,s.addChild(o),o.x=i.x,o.y=i.y;let n=new Laya.Vector2(i.x+(b.halfPercent()?b.randomInt(-100,-75):b.randomInt(75,100)),i.y-50);Laya.Tween.to(o,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(o,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{s.removeChild(o),Laya.Pool.recover("fontClip_d2",o)}))}))}static d2_imageToast(e,t,s){if(!this.wordToastOk)return;b.wordToastOk=!1;let a=new Laya.Image(e);a.anchorX=.5,a.anchorY=.5,a.alpha=1,t.addChild(a),a.top=300,a.centerX=0;a.scaleX=0,a.scaleY=0,Laya.Tween.to(a,{scaleX:1,scaleY:1},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{b.wordToastOk=!0,a&&!a.destroyed&&Laya.Tween.to(a,{top:200,alpha:0},500,null,Laya.Handler.create(this,()=>{a&&!a.destroyed&&a.destroy()}))}))}static d2_labelToast(e,t,s,a,i){let o=Laya.Pool.getItemByClass("label_d2",Laya.Label);o.text=e,o.color=t,o.anchorX=.5,o.anchorY=.5,o.alpha=1,o.scaleX=a,o.scaleY=a,o.font="Microsoft YaHei",o.fontSize=50,o.bold=!0,s.addChild(o),o.x=i.x,o.y=i.y;let n=new Laya.Vector2(i.x+(b.halfPercent()?b.randomInt(-100,-75):b.randomInt(75,100)),i.y-50);Laya.Tween.to(o,{x:n.x,y:n.y,alpha:.9},500,Laya.Ease.strongOut,Laya.Handler.create(this,()=>{Laya.Tween.to(o,{x:n.x,y:n.y-90,alpha:0},500,null,Laya.Handler.create(this,()=>{s.removeChild(o),Laya.Pool.recover("label_d2",o)}))}))}static clamp01(e){return e>1?1:e<0?0:e}static clamp(e,t,s){return e<t?t:e>s?s:e}static get getCurrentTime(){return(new Date).getTime()}static get getCurrentTime_Second(){return Math.floor(Date.parse((new Date).toString())/1e3)}static math_gcd(e,t){return 0==t?e:this.math_gcd(t,e%t)}static numberTo(e,t,s){return Math.abs(t-e)<s?e=t:e<t?e+=s:e>t&&(e-=s),e}static randomNumber(e,t){return e+(t-e)*Math.random()}static randomInt(e,t){return Math.floor(e+(t+1-e)*Math.random())}static halfPercent(){return Math.random()<.5}static percent(e){return Math.random()<e}static cloneArray(e){return[].concat(e)}static getRandomInArray(e){if(e.length){let t=Math.random()*e.length;return e[t=Math.floor(t)]}return console.error("传入错误参数,返回空"),null}static takeRandomInArray(e){if(e.length){let t=Math.random()*e.length,s=e[t=Math.floor(t)];return e.splice(t,1),s}return console.error("传入错误参数,返回空"),null}static randomArray(e){let t=new Array(e.length),s=t.length;for(let a=0;a<s;a++){let s=this.takeRandomInArray(e);t[a]=s}return t}static BoxCheck_2D_Normal(e,t,s,a,i,o,n,l){let r=i-e,h=o-t,d=Math.abs(h),c=Math.abs(r),u=(a+l)/2,m=(s+n)/2;return{isHit:d<u&&c<m,axisDis:c,axisRange:m,horizontalDis:d,horizontalRange:u,axisWay:r,horizontalWay:h,pushAxisWay:(s+n-c)*(r>=0?1:-1),pushHorizontalWay:(t+o-d)*(h>=0?1:-1)}}static CircleCheck_2D(e,t,s,a,i,o){let n=Math.pow(e-a,2)+Math.pow(t-i,2),l=Math.pow(s+o,2);return{isHit:n<l,distancePow2:n,rangePow2:l}}}b.wordToastOk=!0,function(e){e.start="touchStart",e.move="touchMove",e.end="touchEnd",e.getAxis="GetAxis",e.slideWay="slideWay",e.singleTouchStart="singleTouchStart",e.singleTouchMove="singleTouchMove",e.singleTouchEnd="singleTouchEnd",e.secondTouchStart="secondTouchStart",e.secondTouchMove="secondTouchMove",e.secondTouchEnd="secondTouchEnd",e.getAxisAlways="getAxisAlways",e.keyDown="keyDown"}(o||(o={}));class C extends Laya.Script{constructor(){super(...arguments),this.isPressed=!1,this.hOriginal=0,this.vOriginal=0,this.hAxis=0,this.vAxis=0,this.outAxis=0,this.touchId=-1}onEnable(){C.instance=this}onMouseDown(e){u.event(o.start,[e])}onMouseMove(e){u.event(o.move,[e])}onMouseOut(e){u.event(o.end,[e])}onMouseOver(e){u.event(o.end,[e])}onMouseUp(e){u.event(o.end,[e])}}class _ extends Laya.Script{constructor(){super(...arguments),this.calls=[],this.firstId=-1,this.secondId=-1,this.firstOriginalPoint=new Laya.Vector2,this.secondOriginalPoint=new Laya.Vector2,this.isSecond=!1,this.orignalHorizontal=0,this.orignalAxis=0,this.orignalHorizontalAlways=0,this.orignalAxisAlways=0,this.offset=new Laya.Vector3}onEnable(){u.on(o.start,this,this.onMouseDown),u.on(o.move,this,this.onMouseMove),u.on(o.end,this,this.onMouseUp)}onDisable(){u.off(o.start,this,this.onMouseDown),u.off(o.move,this,this.onMouseMove),u.off(o.end,this,this.onMouseUp)}onMouseDown(e){0==this.isSecond?-1==this.firstId?(this.checkOut(e),this.firstId=e.touchId,u.event(o.singleTouchStart,e),this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):this.firstId!=e.touchId&&-1==this.secondId&&(this.secondId=e.touchId,this.isSecond=!0,u.event(o.secondTouchStart,e),this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):-1==this.firstId?(this.firstId=e.touchId,this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):-1==this.secondId&&(this.secondId=e.touchId,this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),this.checkOutAlways(e)}onMouseMove(e){if(0==this.isSecond)e.touchId==this.firstId&&(this.checkWay(e),this.checkOut(e),u.event(o.singleTouchMove,e));else if(-1!=this.firstId&&-1!=this.secondId){let t,s={distance:0,angle:0},a=this.Vector2Reduce(this.secondOriginalPoint,this.firstOriginalPoint),i=Laya.Vector2.scalarLength(a);if(e.touchId==this.firstId?t=this.Vector2Reduce(this.secondOriginalPoint,new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)):e.touchId==this.secondId&&(t=this.Vector2Reduce(new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height),this.firstOriginalPoint)),t){let e=Laya.Vector2.scalarLength(t);s.distance=e-i,s.angle=b.getAngle2DWay(a,t),u.event(o.secondTouchMove,s)}}e.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),e.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),this.checkWayAlways(e)}onMouseUp(e){this.checkOutAlways(e),e.touchId==this.firstId&&(this.firstOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),e.touchId==this.secondId&&(this.secondOriginalPoint=new Laya.Vector2(e.stageX/Laya.stage.width,e.stageY/Laya.stage.height)),0==this.isSecond?e.touchId==this.firstId&&(this.checkOut(e),u.event(o.singleTouchEnd,e),this.firstId=-1):(e.touchId==this.firstId&&(this.firstId=-1),e.touchId==this.secondId&&(this.secondId=-1),-1==this.firstId&&-1==this.secondId&&(this.isSecond=!1))}WayCheck(){let e=this.Vector2Reduce(this.nowPos,this.startPos);if(Laya.Vector2.scalarLength(e)>100){let t=Math.atan2(e.y,e.x)/Math.PI*180,s="none";t>-135&&t<-45?s="up":t>-45&&t<45?s="right":t<135&&t>45?s="down":(t<-135||t>135)&&(s="left"),this.isDown=!1}this.startPos=this.nowPos}onDestroy(){this.touchTimer&&clearTimeout(this.touchTimer)}checkWay(e){let t=e.stageX-this.orignalHorizontal,s=e.stageY-this.orignalAxis;u.event(o.getAxis,[{x:t,y:s}])}checkOut(e){this.orignalHorizontal=e.stageX,this.orignalAxis=e.stageY}checkWayAlways(e){let t=e.stageX/Laya.stage.width-this.orignalHorizontalAlways,s=e.stageY/Laya.stage.height-this.orignalAxisAlways;this.checkOutAlways(e),u.event(o.getAxisAlways,[{x:t,y:s}])}checkOutAlways(e){this.orignalHorizontalAlways=e.stageX/Laya.stage.width,this.orignalAxisAlways=e.stageY/Laya.stage.height}modelRotateControlDown(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);this.startPosition=e.clone(),this.prePosition=e.clone()}modelRotateControlMove(){let e=new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0);Laya.Vector3.subtract(e,this.prePosition,this.offset),this.prePosition=e.clone();var t=new Laya.Vector3(this.offset.x,this.offset.y,0);let s=new Laya.Vector3;Laya.Vector3.cross(t,new Laya.Vector3(0,0,1),s),Laya.Vector3.normalize(s,s)}modelRotateControlUp(){new Laya.Vector3(Laya.MouseManager.instance.mouseX,Laya.MouseManager.instance.mouseY,0)}onKeyDown(e){u.event(o.keyDown,e)}Vector2Reduce(e,t){return new Laya.Vector2(e.x-t.x,e.y-t.y)}}class S extends Laya.Script{onAwake(){this.self=this.owner,this.init()}init(){}onDestroy(){Laya.timer.clearAll(this),u.offAllCaller(this)}}class P extends S{init(...e){this.value=this.self.getChildByName("value"),this.coinUpdate(),u.on(a.Game_Coin_Update,this,this.coinUpdate)}coinUpdate(){this.value.value=g.ReadCoin().toString()}}class M extends Laya.Script{onEnable(){let e=this.owner;Laya.timer.loop(10,this,()=>{e.rotation++})}onDisable(){let e=this.owner;f.clearTween(e),Laya.timer.clearAll(this)}}class x{static addLoadRes(e){this.loadingList.push(e),this.loadingCount++}static removeLoadRes(e){let t=this.loadingList.indexOf(e);-1==t?console.log("完成了不存在的资源加载"):this.loadingList.splice(t,1),u.event(a.Progress_Load_Update)}}x.loadingList=[],x.loadingCount=0;class k{constructor(){this.tween=new Laya.Tween,this.tweens=[]}getTimeByFrame(e){return Math.round(10*e)}toTween(e,t,s,a,i,o=!0){if(this.target=e,this.isLocal=o,e&&!e.destroyed){var n={},l={};if(t.pos){var r=o?e.transform.localPosition.clone():e.transform.position.clone();n.posX=r.x,n.posY=r.y,n.posZ=r.z,l.posX=t.pos.x,l.posY=t.pos.y,l.posZ=t.pos.z}if(t.rot){var h=o?e.transform.localRotation.clone():e.transform.rotation.clone();n.rotX=h.x,n.rotY=h.y,n.rotZ=h.z,n.rotW=h.w,l.rotX=t.rot.x,l.rotY=t.rot.y,l.rotZ=t.rot.z,l.rotW=t.rot.w}if(t.sca){var d=e.transform.getWorldLossyScale().clone();n.scaX=d.x,n.scaY=d.y,n.scaZ=d.z,l.scaX=t.sca.x,l.scaY=t.sca.y,l.scaZ=t.sca.z}this.tween.to(n,{posX:l.posX,posY:l.posY,posZ:l.posZ,rotX:l.rotX,rotY:l.rotY,rotZ:l.rotZ,rotW:l.rotW,scaX:l.scaX,scaY:l.scaY,scaZ:l.scaZ},s,i,Laya.Handler.create(this,()=>{a&&a();var t=this.tweens.shift();e&&!e.destroyed&&(t?this.toTween(this.target,t.value,t.time,t.completeFun,i):this.updateTweenCallback&&(this.updateTweenCallback=null))}));var c=0;return this.tween.update=new Laya.Handler(this,()=>{if(!e||e.destroyed)return;let a=(c+=Laya.timer.delta)/s;a>1&&(a=1),t.pos&&(o?e.transform.localPosition=new Laya.Vector3(n.posX,n.posY,n.posZ):e.transform.position=new Laya.Vector3(n.posX,n.posY,n.posZ)),t.rot&&(o?e.transform.localRotation=new Laya.Quaternion(n.rotX,n.rotY,n.rotZ,n.rotW):e.transform.rotation=new Laya.Quaternion(n.rotX,n.rotY,n.rotZ,n.rotW)),t.sca&&e.transform.setWorldLossyScale(new Laya.Vector3(n.scaX,n.scaY,n.scaZ)),this.updateTweenCallback&&this.updateTweenCallback(a)}),this}}clearTween(e){this.tweens=[],this.tween.clear(),this.target&&e&&(e.pos&&(this.isLocal?this.target.transform.localPosition=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z):this.target.transform.position=new Laya.Vector3(e.pos.x,e.pos.y,e.pos.z)),e.rot&&(this.target.transform.rotation=new Laya.Quaternion(e.rot.x,e.rot.y,e.rot.z,e.rot.w)),e.sca&&this.target.transform.setWorldLossyScale(new Laya.Vector3(e.sca.x,e.sca.y,e.sca.z)))}then(e,t,s){return this.tweens.push({value:e,time:t,completeFun:s}),this}toScaleTween(e,t,s,a,i,o=Laya.Ease.elasticOut){e&&!e.destroyed&&(e.transform.localScale=t,this.toTween(e,{sca:s},a,i,o))}}class B extends Laya.Script3D{onAwake(){this.self=this.owner,this.selfTween=new k,this.init()}init(){}onDestroy(){Laya.timer.clearAll(this),this.selfTween.clearTween(),u.offAllCaller(this)}tweenBornDo(){let e=this.selfTween;e.clearTween(),this.self.transform.localScale=new Laya.Vector3(0,0,0),e.toTween(this.self,{sca:new Laya.Vector3(1,1,1)},500,null,Laya.Ease.elasticOut)}tweenBornDoSlow(){let e=this.selfTween;e.clearTween(),this.self.transform.localScale=new Laya.Vector3(0,0,0),e.toTween(this.self,{sca:new Laya.Vector3(1,1,1)},2e3,null,Laya.Ease.elasticOut)}tweenBornDo_Smooth(){let e=this.selfTween;e.clearTween(),this.self.transform.localScale=new Laya.Vector3(0,0,0),e.toTween(this.self,{sca:new Laya.Vector3(1,1,1)},500,null)}tweenDieDo_Smooth(){let e=this.selfTween;e.clearTween(),this.self.transform.localScale=new Laya.Vector3(1,1,1),e.toTween(this.self,{sca:new Laya.Vector3(0,0,0)},500,null)}}class A extends B{numberShow(e,t,s){let a=s%4*.25,i=.25*Math.floor(s/4),o=e.getChildAt(t),n=o.meshRenderer.material.clone(),l=new Laya.Vector4(1,1,a,-i);n.tilingOffset=l,o.meshRenderer.material=n}numberDeal(e){e=Math.ceil(e);let t,s=this.self,a=Math.floor(e/1e3),i=Math.floor(e%1e3/100),o=Math.floor(e%100/10),n=Math.floor(e%10),l=(e,t)=>{this.numberShow(s,e,t)},r=1;switch(0!=a?(r=4,l(0,a),l(1,i),l(2,o)):0!=i?(r=3,l(1,i),l(2,o)):0!=o&&(r=2,l(2,o)),l(3,n),b.d3_unactiveAllChildren(s),r){case 1:(t=s.getChildAt(3)).transform.localPosition=new Laya.Vector3(-.0375,0,0),t.active=!0;break;case 2:for(let e=0;e<2;e++)(t=s.getChildAt(2+e)).transform.localPosition=new Laya.Vector3(0-.075*e,0,0),t.active=!0;break;case 3:for(let e=0;e<3;e++)(t=s.getChildAt(1+e)).transform.localPosition=new Laya.Vector3(.0375-.075*e,0,0),t.active=!0;break;case 4:for(let e=0;e<4;e++)(t=s.getChildAt(e)).transform.localPosition=new Laya.Vector3(.075-.075*e,0,0),t.active=!0}}numberDeal_5(e,t){e.transform.localScale=new Laya.Vector3(1.5,1.5,1.5);let s,a=Math.floor(t/1e4),i=Math.floor(t%1e4/1e3),o=Math.floor(t%1e3/100),n=Math.floor(t%100/10),l=Math.floor(t%10),r=(t,s)=>{this.numberShow(e,t,s)},h=1;switch(0!=a?(h=5,r(0,a),r(1,i),r(2,o),r(3,n)):0!=i?(h=4,r(1,i),r(2,o),r(3,n)):0!=o?(h=3,r(2,o),r(3,n)):0!=n&&(h=2,r(3,n)),r(4,l),b.d3_unactiveAllChildren(e),h){case 1:(s=e.getChildAt(4)).transform.localPosition=new Laya.Vector3(-.0375,0,0),s.active=!0;break;case 2:for(let t=0;t<2;t++)(s=e.getChildAt(3+t)).transform.localPosition=new Laya.Vector3(0-.075*t,0,0),s.active=!0;break;case 3:for(let t=0;t<3;t++)(s=e.getChildAt(2+t)).transform.localPosition=new Laya.Vector3(.0375-.075*t,0,0),s.active=!0;break;case 4:for(let t=0;t<4;t++)(s=e.getChildAt(1+t)).transform.localPosition=new Laya.Vector3(.075-.075*t,0,0),s.active=!0;break;case 5:for(let t=0;t<5;t++)(s=e.getChildAt(t)).transform.localPosition=new Laya.Vector3(.1125-.075*t,0,0),s.active=!0}}}class D extends B{constructor(){super(...arguments),this.setId=-1,this.nowHp=50}init(){D.instance=this,this.anim=this.self.getComponent(Laya.Animator),this.collider=b.d3_FindNodeHasName(this.self,"collider"),this.raidus=parseFloat(this.collider.name.split("_")[2]);let e=b.d3_FindNodeByName(this.self,"Number");this.number=e.addComponent(A)}reset(){this.nowHp=p.endChestHp,this.idle(),this.number.numberDeal(this.nowHp)}idle(){this.anim.crossFade("Idle",.1,0,0)}colliderDo(e,t){this.nowHp<=0||(this.nowHp-=e,this.nowHp>0?(this.number.numberDeal(this.nowHp),p.BornDiamond(this.self.transform.position.clone(),this.setId,1),this.anim.crossFade("Hit",.1,0,0),Laya.timer.once(150,this,this.idle)):this.open())}open(){this.number.self.active=!1,Laya.timer.clear(this,this.idle),this.anim.crossFade("Open",.1,0,0),u.event(a.Game_EnemyDie_Event)}}class R extends B{constructor(){super(...arguments),this.state=n.Lock}getColunm(){return Math.abs(Math.round(-(this.self.transform.localPosition.x-25)/10))}getRow(){return Math.abs(Math.round(-(this.self.transform.localPosition.y-30)/10))}}!function(e){e[e.Lock=0]="Lock",e[e.Empty=1]="Empty",e[e.GunPos=2]="GunPos",e[e.Add_0=3]="Add_0",e[e.Add_1=4]="Add_1",e[e.Add_2=5]="Add_2",e[e.Mul_2_0=6]="Mul_2_0",e[e.Mul_2_1=7]="Mul_2_1",e[e.Mul_3_0=8]="Mul_3_0",e[e.Mul_3_1=9]="Mul_3_1",e[e.Mul_3_2=10]="Mul_3_2",e[e.Cannon=11]="Cannon"}(n||(n={}));class I extends B{constructor(){super(...arguments),this.cubePos=null}}!function(e){e.Add_1="mod_+1",e.Add_2="mod_+2",e.Mul_2="mod_x2",e.Mul_3="mod_x3",e.Cannon="cannon"}(l||(l={}));class H{constructor(){this.cubeList=[],this.setGunPos=[[new Laya.Vector2(0,3)],[new Laya.Vector2(0,4)],[new Laya.Vector2(0,3),new Laya.Vector2(0,4)],[new Laya.Vector2(0,2),new Laya.Vector2(0,3)],[new Laya.Vector2(0,2),new Laya.Vector2(0,3),new Laya.Vector2(0,4)]],this.gunPos=[new Laya.Vector2(0,3)],H.instance=this}initCube(e){this.cube=e;let t=e.getChildByName("Scan"),s=[];for(let e=0;e<6;e++)s.push(new Array(7));for(let e=0;e<t.numChildren;e++){let a=t.getChildAt(e),i=a.getComponent(R);i||(i=a.addComponent(R));let o=a.transform.localPosition.clone();parseInt(a.name)<=g.ReadLockCube()?i.state=n.Empty:i.state=n.Lock;let l=Math.abs(Math.round(-(o.x-25)/10)),r=Math.abs(Math.round(-(o.y-30)/10));s[l][r]=i}let i=Math.floor(g.ReadSpeedLevel()/10);i>4&&(i=4);let o=this.setGunPos[i];this.gunPos=o;for(let e=0;e<o.length;e++)s[o[e].x][o[e].y].state=n.GunPos;this.cubeList=s,this.updateLock(),this.allModBack(),this.culFinalBullet(),u.off(a.Game_CubeLevel_Update,this,this.updateLock),u.off(a.Game_SpeedLevel_Update,this,this.culFinalBullet),u.on(a.Game_CubeLevel_Update,this,this.updateLock),u.on(a.Game_SpeedLevel_Update,this,this.culFinalBullet)}ifModCanPut(e,t,s=!0){if(null==e)return!1;let a=Math.abs(Math.round(-(e.x-25)/10)),i=Math.abs(Math.round(-(e.y-30)/10)),o=[];switch(o.push(this.cubeList[a][i]),t){case l.Add_1:break;case l.Add_2:case l.Cannon:if(++a>=this.cubeList.length)return!1;o.push(this.cubeList[a][i]);break;case l.Mul_2:if(++i>=this.cubeList[a].length)return!1;o.push(this.cubeList[a][i]);break;case l.Mul_3:if(++i>=this.cubeList[a].length)return!1;if(o.push(this.cubeList[a][i]),(i-=2)<0)return!1;o.push(this.cubeList[a][i])}for(let e=0;e<o.length;e++){if(o[e].state==n.Lock)return!1;if(s&&o[e].state!=n.Empty&&o[e].state!=n.GunPos)return!1}for(let e=0;e<o.length;e++)if(o[e].state==n.GunPos)return!0;if(a=o[0].getColunm(),(a-=1)<0)return!s;let r=[];switch(r.push(o[0].getRow()),t){case l.Mul_2:r.push(o[0].getRow()+1);break;case l.Mul_3:r.push(o[0].getRow()+1),r.push(o[0].getRow()-1)}for(let e=0;e<r.length;e++){let t=r[e];switch(this.cubeList[a][t].state){case n.Add_0:case n.Add_1:case n.Mul_2_0:case n.Mul_2_1:case n.Mul_3_0:case n.Mul_3_1:case n.Mul_3_2:return!0}}return!1}modPutInCube(e,t,s=!0,a=!0){if(null==e)return t.cubePos=null,void(a&&(t.self.transform.position=t.originalPos));let i=Math.abs(Math.round(-(e.x-25)/10)),o=Math.abs(Math.round(-(e.y-30)/10));switch(t.self.name){case l.Add_1:this.cubeList[i][o].state=s?n.Add_1:this.checkCubeEmptyState(this.cubeList[i][o]);break;case l.Add_2:this.cubeList[i][o].state=s?n.Add_2:this.checkCubeEmptyState(this.cubeList[i][o]),i++,this.cubeList[i][o].state=s?n.Add_0:this.checkCubeEmptyState(this.cubeList[i][o]);break;case l.Cannon:this.cubeList[i][o].state=s?n.Cannon:this.checkCubeEmptyState(this.cubeList[i][o]),i++,this.cubeList[i][o].state=s?n.Add_0:this.checkCubeEmptyState(this.cubeList[i][o]);break;case l.Mul_2:this.cubeList[i][o].state=s?n.Mul_2_0:this.checkCubeEmptyState(this.cubeList[i][o]),o++,this.cubeList[i][o].state=s?n.Mul_2_1:this.checkCubeEmptyState(this.cubeList[i][o]);break;case l.Mul_3:this.cubeList[i][o].state=s?n.Mul_3_0:this.checkCubeEmptyState(this.cubeList[i][o]),o++,this.cubeList[i][o].state=s?n.Mul_3_1:this.checkCubeEmptyState(this.cubeList[i][o]),o-=2,this.cubeList[i][o].state=s?n.Mul_3_2:this.checkCubeEmptyState(this.cubeList[i][o])}s?t.cubePos=e:(t.cubePos=null,a&&(t.self.transform.position=t.originalPos)),this.checkAllModStiilCanPut()}culFinalBullet(){let e=0,t=[],s=[0,0,0,0,0,0,0];for(let e=0;e<this.gunPos.length;e++)s[this.gunPos[e].y]=1;let i=!1;for(let a=0;a<this.cubeList.length;a++){let o=[0,0,0,0,0,0,0];for(let l=0;l<this.cubeList[a].length;l++){let r=this.cubeList[a][l].state,h=s[l];switch(r){case n.Add_0:s[l]=s[l];break;case n.Cannon:i=!0,s[l]=s[l];break;case n.Add_1:s[l]=s[l]+s[l];break;case n.Add_2:s[l]=s[l]+s[l]+s[l];break;case n.Mul_2_0:o[l]+=s[l],o[l+1]+=s[l],s[l]=0;break;case n.Mul_2_1:o[l]+=s[l],o[l-1]+=s[l],s[l]=0;break;case n.Mul_3_0:o[l]+=s[l],o[l+1]+=s[l],o[l-1]+=s[l],s[l]=0;break;case n.Mul_3_1:o[l]+=s[l],o[l-1]+=s[l],o[l-2]+=s[l],s[l]=0;break;case n.Mul_3_2:o[l]+=s[l],o[l+1]+=s[l],o[l+2]+=s[l],s[l]=0;break;default:e+=h,h>0&&t.push({bullet:h,column:a,row:l}),s[l]=0}}for(let e=0;e<s.length;e++)s[e]+=o[e]}for(let a=0;a<s.length;a++)s[a]>0&&t.push({bullet:s[a],column:6,row:a}),e+=s[a];let o=!1,l=g.ReadSpeedLevel();l>=p.gunLevelUpData.length&&(l=p.gunLevelUpData.length-1);let r=p.gunLevelUpData[l].gunLevelAtk;(e*=r/=this.gunPos.length)>p.doubleCondition&&(e*=p.doubleAxis,o=!0),u.event(a.Game_DesignStat_Update,e),O.instance.bulletCount=e,p.gunBullet=e,p.endChestHp=2*e,D.instance.reset();let h=Math.floor(g.ReadSpeedLevel()/10)+1;h>5&&(h=5),O.instance.changeGun(h,o),p.isCannon=i,O.instance.clearGunPos();for(let e=0;e<t.length;e++){let s=t[e].bullet,a=t[e].column,i=t[e].row;this.bulletShotFxUpdate(s,a,i)}}bulletShotFxUpdate(e,t,s){let a=new Laya.Vector3;a.x=30-10*t,a.y=30-10*s,a.z=-5;let i=1+.1*e;O.instance.bornGunPos(a,i)}checkCubeEmptyState(e){let t;if(parseInt(e.self.name)<=g.ReadLockCube()){t=n.Empty;for(let s=0;s<this.gunPos.length;s++)if(e.getColunm()==this.gunPos[s].x&&e.getRow()==this.gunPos[s].y){t=n.GunPos;break}}else t=n.Lock;return t}updateLock(){for(let e=0;e<this.cubeList.length;e++)for(let t=0;t<this.cubeList[e].length;t++)this.cubeList[e][t].state==n.Lock&&parseInt(this.cubeList[e][t].self.name)<=g.ReadLockCube()&&(this.cubeList[e][t].state=n.Empty);let e=this.cube.getChildByName("Black");for(let t=0;t<e.numChildren;t++){let s=e.getChildAt(t);s.active=parseInt(s.name)>g.ReadLockCube()}}checkAllModStiilCanPut(){let e=O.instance.mod;for(let t=0;t<e.numChildren;t++){let s=e.getChildAt(t),a=s.getComponent(I);this.ifModCanPut(a.cubePos,s.name,!1)||this.modPutInCube(a.cubePos,a,!1)}}allModBack(){let e=O.instance.mod;for(let t=0;t<e.numChildren;t++){let s=e.getChildAt(t).getComponent(I);this.modPutInCube(s.cubePos,s,!1)}}}class N extends B{constructor(){super(...arguments),this.speed=1}init(){Laya.timer.once(1e3,this,()=>{this.self.destroy()})}onUpdate(){let e=Laya.timer.delta/1e3,t=this.self.transform.position.clone();t.x+=150*e*this.speed,this.self.transform.position=t}}class T extends B{constructor(){super(...arguments),this.speed=1}realInit(){this.fire();let e=1e3/(1+.05*O.instance.bulletCount);e<100&&(e=100),Laya.timer.loop(e,this,this.fire)}fire(){let t=e.bornStageObj("Bullet",this.self);t.transform.rotation=O.instance.gun.transform.rotation.clone(),t.transform.rotate(new Laya.Vector3(0,180,0),!0,!1),e.bornFxFromPool("GunFireFX",e.mainScene,1e3,1,this.self.transform.position.clone()),t.addComponent(N).speed=this.speed}}class V{static BoxToBox(e,t){return e.minX<=t.maxX&&e.maxX>=t.minX&&e.minY<=t.maxY&&e.maxY>=t.minY&&e.minZ<=t.maxZ&&e.maxZ>=t.minZ}static SphereToSphere(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2)<Math.pow(e.radius,2)+Math.pow(t.radius,2)}static SphereToBox(e,t){var s=Math.max(t.minX,Math.min(e.x,t.maxX)),a=Math.max(t.minY,Math.min(e.y,t.maxY)),i=Math.max(t.minZ,Math.min(e.z,t.maxZ));return Math.sqrt((s-e.x)*(s-e.x)+(a-e.y)*(a-e.y)+(i-e.z)*(i-e.z))<e.radius}static calcBounds(e){let t=[];e.meshFilter.sharedMesh.getPositions(t);let s=new Laya.Sprite3D;e.addChild(s);for(let e=0;e<t.length;e++)s.transform.localPosition=new Laya.Vector3(t[e].x,t[e].y,t[e].z),t[e]=s.transform.position.clone();let a=t[0].x,i=t[0].y,o=t[0].z,n=a,l=i,r=o;for(var h=0;h<t.length;h++)a=Math.max(a,t[h].x),i=Math.max(i,t[h].y),o=Math.max(o,t[h].z),n=Math.min(n,t[h].x),l=Math.min(l,t[h].y),r=Math.min(r,t[h].z);return{maxX:a,maxY:i,maxZ:o,minX:n,minY:l,minZ:r}}static calculateDistance(e,t,s){let a=v.subtract(t,e),i=v.subtract(s,e),o=v.normalized(a.clone()),n=v.normalized(i.clone()),l=Math.abs(v.dot(o,n)),r=v.subtract(s,t),h=v.subtract(e,t),d=v.normalized(r.clone()),c=v.normalized(h.clone());if(Math.abs(v.dot(d,c))>0&&l>0){let i=Math.sqrt(1-l*l),o=v.distance(e,s),n=o*i,r=o*l,h=v.mull(v.normalized(a.clone()),r);v.add(e.clone(),h);return{pt1:e,pt2:t,pt:s,distance:n,goDistance:r}}return null}}class U extends S{constructor(){super(...arguments),this.speedVideo=!1,this.cubeVideo=!1}init(){U.instance=this,this.stat=this.self.getChildByName("stat"),this.startBtn=this.self.getChildByName("startBtn"),this.speedBtn=this.self.getChildByName("speedBtn"),this.cubeBtn=this.self.getChildByName("cubeBtn");let e=b.d3_getSpritePosBySprite3DPoint(O.instance.cam,O.instance.gun,new Laya.Vector3(-20,0,15)),t=U.instance.self.getChildByName("teach");if(this.teach=t,1==g.ReadGrade()){let e=b.d3_getSpritePosBySprite3DPoint(O.instance.cam,O.instance.mod.getChildAt(2));t.x=e.x,t.y=e.y}else t.set_visible(!1);this.stat.x=e.x,this.stat.y=e.y,this.btnUpdate(),this.statUpdate(.1*g.ReadSpeedLevel()+1),u.on(a.Game_DesignStat_Update,this,this.statUpdate),b.d2_AddClickEvent(this.startBtn,this,this.onStartBtnClick),b.d2_AddClickEvent(this.speedBtn,this,this.onSpeedBtnClick),b.d2_AddClickEvent(this.cubeBtn,this,this.onCubeBtnClick)}statUpdate(e){let t=this.stat.getChildAt(0),s=t.getChildByName("valueBullet"),a=t.getChildByName("valueDouble_1"),i=t.getChildByName("valueDouble_2"),o=e>=p.doubleCondition;t.skin=o?"ui/game/ksjm_jlq.png":"ui/game/ksjm_bq.png",a.set_visible(!o),i.set_visible(!o),s.value=e.toFixed(1),a.value=p.doubleCondition.toString(),i.value="*"+p.doubleAxis.toString()}btnUpdate(){let e=g.ReadSpeedLevel(),t=g.ReadLockCube();e>=p.gunLevelUpData.length&&(e=p.gunLevelUpData.length-1);let s=p.gunLevelUpData[e].gunLevelUpNeed,a=5+4*t,i=g.ReadCoin(),o=i>=s,n=i>=a,l=!1,r=!1;o||n?o?n||(n=!0,r=!0):(o=!0,l=!0):b.halfPercent()?(o=!0,l=!0):(n=!0,r=!0),this.btnDeal(this.speedBtn,e,s,o,l),this.btnDeal(this.cubeBtn,t,a,n,r),this.speedVideo=l,this.cubeVideo=r}btnDeal(e,t,s,a,i){let o=e.getChildByName("black"),n=e.getChildByName("levelValue"),l=e.getChildByName("coinValue"),r=e.getChildByName("coinIcon"),h=e.getChildByName("videoIcon"),d=e.getChildByName("videoWord");o.set_visible(!a),n.value=(t+1).toString(),l.value=s.toString(),r.set_visible(!i),l.set_visible(!i),h.set_visible(i),d.set_visible(i)}onStartBtnClick(){u.event(a.Game_DesginFinish_Event),this.startBtn.set_visible(!1),this.speedBtn.set_visible(!1),this.cubeBtn.set_visible(!1),Laya.timer.once(2e3,this,()=>{u.event(a.Scene_GoGame),this.self.set_visible(!1)})}onSpeedBtnClick(){let e=g.ReadSpeedLevel();g.ReadLockCube();e>=p.gunLevelUpData.length&&(e=p.gunLevelUpData.length-1);let t=p.gunLevelUpData[e].gunLevelUpNeed;g.ReadCoin()>=t?(g.AddCoin(-t),g.AddSpeedLevel(),this.btnUpdate(),u.event(a.Game_SpeedLevel_Update)):this.speedVideo&&y.instance.showVideo(()=>{g.AddSpeedLevel(),this.btnUpdate(),u.event(a.Game_SpeedLevel_Update)},null)}onCubeBtnClick(){let e=g.ReadSpeedLevel(),t=g.ReadLockCube();e>=p.gunLevelUpData.length&&(e=p.gunLevelUpData.length-1);p.gunLevelUpData[e].gunLevelUpNeed;let s=5+4*t;g.ReadCoin()>=s?(g.AddCoin(-s),g.AddLockCube(),this.btnUpdate(),u.event(a.Game_CubeLevel_Update)):this.cubeVideo&&y.instance.showVideo(()=>{g.AddLockCube(),this.btnUpdate(),u.event(a.Game_CubeLevel_Update)},null)}}class F{constructor(){}On(e,t,s){this.cam=e,this.mod=t,this.cube=s,this.controlOn()}Off(){this.rayCheckRelease(),this.controlOff()}controlOn(){u.on(o.singleTouchStart,this,this.rayCheckGet),u.on(o.getAxis,this,this.rayCheckMove),u.on(o.singleTouchEnd,this,this.rayCheckRelease)}controlOff(){u.off(o.singleTouchStart,this,this.rayCheckGet),u.off(o.getAxis,this,this.rayCheckMove),u.off(o.singleTouchEnd,this,this.rayCheckRelease)}rayCheckGet(e){let t=e.stageX,s=e.stageY;this.orignalX=t,this.orignalY=s;let a=10,o=null;U.instance&&U.instance.teach.set_visible(!1);for(let e=0;e<this.mod.numChildren;e++){let i=this.mod.getChildAt(e),n=new Laya.Ray(new Laya.Vector3,new Laya.Vector3);this.cam.viewportPointToRay(new Laya.Vector2(t,s),n);let l=V.calculateDistance(n.origin,v.add(n.origin,v.mull(n.direction,1e4)),i.transform.position.clone());l.distance<a&&(a=l.distance,o=i)}if(this.getObj=o,this.getObj){this.getPos=this.getObj.transform.position.clone(),this.movePos=this.getPos.clone();let e=this.getObj.getComponent(I);H.instance.modPutInCube(e.cubePos,e,!1,!1),m.play(i.Choose)}}rayCheckMove(e){if(this.getObj){let t=Laya.stage.width/Laya.stage.height/(750/1750);this.movePos.x+=e.x/750*93*t,this.movePos.z+=e.y/750*93*t;let s=this.cube.getChildByName("Scan"),a=!1;for(let e=0;e<s.numChildren;e++){let t=s.getChildAt(e),i=t.transform.position.clone(),o=t.transform.localPosition.clone();if(Math.pow(i.x-this.movePos.x,2)+Math.pow(i.z-this.movePos.z,2)<25&&H.instance.ifModCanPut(o,this.getObj.name)){this.getObj.transform.position=new Laya.Vector3(i.x,this.movePos.y,i.z),a=!0,this.cubePos=o;break}}a||(this.getObj.transform.position=this.movePos,this.cubePos=null)}}rayCheckRelease(){if(this.getObj){let e=this.getObj.getComponent(I);null!=this.cubePos?(H.instance.modPutInCube(this.cubePos,e,!0),m.play(i.Put)):H.instance.modPutInCube(e.cubePos,e,!1),H.instance.culFinalBullet()}this.getObj=null}}class O extends B{constructor(){super(...arguments),this.gunPoses=[],this.bulletCount=1,this.nowWeaponIndex=1,this.nowIsDouble=!1}init(){O.instance=this,this.moveObjComp=new F,this.cubeManager=new H,this.cam=this.self.getChildByName("Cam"),this.mod=this.self.getChildByName("Mod"),this.gun=this.self.getChildByName("Guns"),this.cube=this.self.getChildByName("Cube"),this.fx=this.self.getChildByName("Fx").getChildAt(0)}onDesginFinish(){this.fx.active=!0,this.fx.particleSystem.play();let e=this.gun.getComponent(B);e||(e=this.gun.addComponent(B)),e.tweenBornDoSlow(),Laya.timer.once(2e3,this,this.Off)}On(){this.self.active=!0,this.fx.active=!1,u.on(a.Game_DesginFinish_Event,this,this.onDesginFinish);let t=!1,s=p.designMods;for(let a=0;a<s.length;a++){let i=e.bornStageObj(s[a],this.mod),o=a%4,n=Math.floor(a/4);i.transform.localPosition=new Laya.Vector3(60-25*o-25*n,50+30*n,5),s[a]==l.Cannon&&(t=!0)}for(let e=0;e<this.mod.numChildren;e++){let t=this.mod.getChildAt(e),s=t.getComponent(I);s||(s=t.addComponent(I)),s.cubePos=null,s.originalPos=t.transform.position.clone()}this.nowWeaponIndex=0;let i=Math.floor(g.ReadSpeedLevel()/10);i>4&&(i=4),this.changeGun(i+1,!1),this.moveObjComp.On(this.cam,this.mod,this.cube)}Off(){this.self.active=!1,this.clearGunPos(),this.moveObjComp.Off();for(let e=this.mod.numChildren-1;e>=0;e--){null==this.mod.getChildAt(e).getComponent(I).cubePos&&this.mod.getChildAt(e).destroy()}p.gunMod=this.mod.clone()}bornGunPos(e,t){let s=new Laya.Sprite3D("gunPos");this.self.addChild(s),s.transform.localPosition=e;let a=s.addComponent(T);a.speed=t,a.realInit(),this.gunPoses.push(s)}clearGunPos(){for(let e=0;e<this.gunPoses.length;e++)this.gunPoses[e].destroy()}changeGun(e,t){if(this.nowWeaponIndex==e&&this.nowIsDouble==t)return;b.d3_unactiveAllChildren(this.gun);let s=this.gun.getComponent(B);s||(s=this.gun.addComponent(B));let a="Gun_"+e.toString()+"_"+(t?2:1).toString();p.gunType=a,this.gun.getChildByName(a).active=!0,s.tweenBornDo(),this.nowWeaponIndex!=e&&(this.nowWeaponIndex=e,this.cubeManager.initCube(this.cube)),this.nowIsDouble=t}}class G extends B{constructor(){super(...arguments),this.smallColliders=[],this.bigRange=0,this.bigWidth=0,this.smallRaidus=[],this.setId=-1,this.isColliderActive=!1,this.enemyId=-1,this.paths=[],this.nowPathId=0,this.moveSpeed=3,this.nowHp=1,this.isHurt=!1}enemySetHp(){}deadSpecail(){}init(){G.enemys.push(this),this.enemyId=G.enemys.length-1,this.model=this.self.getChildByName("Model"),this.anim=this.model.getComponent(Laya.Animator);let e=b.d3_FindNodeByName(this.model,"Number");this.numebr=[],this.numebr.push(e.addComponent(A)),this.idle(),this.bigCollider=b.d3_FindNodeHasName(this.self,"collider_box");let t=this.bigCollider.name.split("_");this.bigRange=parseFloat(t[2]),this.bigWidth=parseFloat(t[3]),this.enemySetHp(),this.numebr[0].numberDeal(this.nowHp),this.smallColliders=b.d3_FindAllNodeHasName(this.self,"collider_circle");for(let e=0;e<this.smallColliders.length;e++){let t=this.smallColliders[e].name.split("_");this.smallRaidus.push(parseFloat(t[2]))}Laya.timer.frameOnce(1,this,()=>{this.isColliderActive=!0,this.getPath(),this.checkWay(),this.moveDir=null}),Laya.timer.loop(32,this,this.pushOtherEnemy),u.on(a.Game_SetOn_Event,this,this.startMove)}getPath(){let e=q.instance.setPaths[this.setId];this.paths=[];for(let t=e.length-1;t>=1;t--){let s=e[t].transform.localPosition.clone(),a=e[t].parent.transform.localPosition.clone(),i=e[t].parent.parent.transform.localPosition.clone();s=v.add(s,a),s=v.add(s,i),this.self.transform.localPosition.z>s.z&&this.paths.push(s)}this.nowPathId=0}checkWay(e=!1){if(this.nowPathId<this.paths.length){let t,s=this.self.transform.localPosition.clone(),a=this.paths[this.nowPathId],i=v.subtract(a,s);if(e||(i.x=0),this.moveDir=v.normalized(i),0==(i=this.moveDir).x&&i.z,-1==i.z&&0==i.x)t=0;else if(1==i.z&&0==i.x)t=180;else{t=180*Math.atan2(i.x,-i.z)/Math.PI}let o=this.self.transform.localRotationEuler.clone();o.y=180-t,this.self.transform.localRotationEuler=o}else this.moveDir=null,this.setId==W.instance.nowSetId&&u.event(a.Game_EnemyReach_Event)}startMove(e,t=!1){e==this.setId&&(this.moveSpeed=p.enemyMoveSpeed,this.getPath(),this.checkWay(t),this.run())}onUpdate(){if(this.moveDir&&!this.isHurt){if(this.paths[this.nowPathId].z-this.self.transform.localPosition.z>=0)return this.nowPathId++,void this.checkWay();let e=this.self.transform.localPosition.clone(),t=this.moveSpeed*Laya.timer.delta/1e3,s=v.mull(this.moveDir,t);e=v.add(e,s),this.self.transform.localPosition=e}}colliderDo(e,t){this.hurt(e)}idle(){this.anim.crossFade("Idle",.1,0,0)}run(){this.isColliderActive&&(this.anim.crossFade("Run",.1,0,0),this.isHurt=!1)}hurt(e){if(this.isColliderActive)if(this.isHurt=!0,this.nowHp-=e,this.nowHp>0){this.anim.play("Hurt",0,0);let e=this.anim.getControllerLayer(0).getAnimatorState("Hurt").clip.duration();Laya.timer.once(1e3*e,this,this.run),this.numebr[0].numberDeal(this.nowHp)}else this.numebr[0].numberDeal(0),Laya.timer.clear(this,this.run),this.dead()}dead(){this.isColliderActive=!1,this.moveDir=null,u.event(a.Game_EnemyDie_Event),Laya.timer.clear(this,this.pushOtherEnemy),this.deadSpecail()}pushOtherEnemy(){let e=this.bigCollider.transform.position.clone(),t=!1;for(let s=0;s<G.enemys.length;s++){let a=G.enemys[s];if(a.setId!=this.setId||s==this.enemyId||!a.moveDir||!a.isColliderActive)continue;let i=a.bigCollider.transform.position.clone(),o=b.BoxCheck_2D_Normal(e.z,e.x,this.bigRange,this.bigWidth,i.z,i.x,a.bigRange,a.bigWidth);if(o.isHit){let e=-.01,s=new Laya.Vector3(-o.pushHorizontalWay*e,0,o.pushAxisWay*e);this.addPushWay(s),a.addPushWay(v.mull(s,-1)),t=!0;break}}}addPushWay(e){let t=this.self.transform.position.clone();t=v.add(t,e),this.self.transform.position=t}}G.enemys=[];class E extends B{constructor(){super(...arguments),this.speed=1,this.direction=new Laya.Vector3,this.dis=0,this.endDis=p.bulletDis,this.damage=1,this.isCannon=!1}init(){this.self.transform.localScale=new Laya.Vector3(.06,.06,.06),E.bullets.push(this)}beBullet(){this.isCannon=!1;this.speed=1,this.self.transform.localScale=new Laya.Vector3(.06,.06,.06)}beCannon(){this.isCannon=!0;this.speed=.4,this.self.transform.localScale=new Laya.Vector3(.18,.18,.18),this.damage*=p.cannonDamage,this.cannonSound=m.play(i.Boom_01)}onUpdate(){if(!this.self.active)return;let e=Laya.timer.delta/1e3,t=this.self.transform.position.clone(),s=100*this.speed*e;t=v.add(t,v.mull(this.direction,s)),this.dis+=s,this.self.transform.position=t,this.dis>=this.endDis&&this.colliderDo(),this.self.transform.position.y<p.setGroundY[W.instance.nowSetId]&&this.hitGround()}colliderDo(){this.self.active=!1,this.colliderTarget&&(this.isCannon?this.cannonExposion():(p.BornEnemyHitFx(this.self.transform.position.clone()),this.colliderTarget.colliderDo(this.damage,this.colliderHitSprite)))}hitGround(){this.self.active=!1,p.BornEnemyHitGroundFx(this.self.transform.position.clone()),this.isCannon&&this.cannonExposion()}cannonExposion(){e.bornFxDestroy("BoomFX",e.mainScene,3e3,1,this.self.transform.position.clone()),this.cannonSound.stop(),m.play(i.Boom_02);let t=G.enemys,s=this.self.transform.position.clone(),a={x:s.x,y:s.y,z:s.z,radius:p.cannonRaidus};for(let e=0;e<t.length;e++){if(t[e].setId!=W.instance.nowSetId||!t[e].isColliderActive)continue;let s=t[e].bigCollider.transform.position.clone(),i=(t[e].bigRange+t[e].bigWidth)/2;s.y+=i;let o=V.SphereToSphere(a,{x:s.x,y:s.y,z:s.z,radius:i});if(o){let i=t[e].smallColliders;for(let n=0;n<i.length;n++)i[n].active&&(o=V.SphereToSphere(a,{x:s.x,y:s.y,z:s.z,radius:t[e].smallRaidus[n]}))&&t[e].colliderDo(this.damage,i[n])}}}}E.bullets=[];class W extends B{constructor(){super(...arguments),this.bulletCount=1,this.bulletTime=1e3,this.damageAxis=1,this.isRotate=!1,this.bulletOffset=[new Laya.Vector3(0,0,0),new Laya.Vector3(0,.3,0),new Laya.Vector3(.3,0,0),new Laya.Vector3(0,-.3,0),new Laya.Vector3(-.3,0,0),new Laya.Vector3(0,0,.3),new Laya.Vector3(0,0,-.3)],this.nowSetId=0,this.isFire=!1,this.cannonNowCd=0,this.rotateSpeed=0,this.nowPoint=new Laya.Vector2,this.xAxis=0,this.yAxis=0}init(){W.instance=this,this.model=this.self.getChildByName("Model"),this.camPoint=this.model.getChildByName("CamPoint"),this.cam=b.d3_FindNodeByName(this.camPoint,"Main Camera"),this.weaponGrip=this.camPoint.getChildByName("WeaponGrip"),this.gunGrip=this.weaponGrip.getChildByName("Guns"),this.gunPos=this.gunGrip.getChildByName("Guns"),this.gunModStart=this.gunGrip.getChildByName("Mod"),this.gunModFinal=this.gunGrip.getChildByName("ModFinal")}fireOn(){this.isFire=!0;for(let e=0;e<this.bulletCount;e++)this.fire(this.bulletOffset[e]),Laya.timer.loop(this.bulletTime,this,this.fire,[this.bulletOffset[e]],!1)}fireOff(){this.isFire=!1,Laya.timer.clearAll(this)}onUpdate(){let e=Laya.timer.delta/1e3;this.isRotate&&(this.isFire?(this.rotateSpeed+=20*e,this.rotateSpeed>20&&(this.rotateSpeed=20)):(this.rotateSpeed-=10*e,this.rotateSpeed<0&&(this.rotateSpeed=0)),this.gunModFinal.transform.rotate(new Laya.Vector3(0,0,this.rotateSpeed),!0,!1)),this.cannonNowCd-=e,this.cannonNowCd<=0&&(this.cannonNowCd=0),w.instance&&w.instance.setCannonRange(this.cannonNowCd/p.cannonCD)}On(){u.on(o.getAxis,this,this.pointUpdate),u.on(o.singleTouchStart,this,this.fireOn),u.on(o.singleTouchEnd,this,this.fireOff),this.isFire=!1,E.bullets=[],this.gunModFinal.transform.localRotation=new Laya.Quaternion,this.weaponGrip.transform.localRotation=new Laya.Quaternion,this.model.transform.localRotation=new Laya.Quaternion,this.camPoint.transform.localRotation=new Laya.Quaternion;for(let e=0;e<this.gunPos.numChildren;e++){let t=this.gunPos.getChildAt(e).name;this.gunPos.getChildAt(e).active=t==p.gunType}this.nowPoint=new Laya.Vector2(Laya.stage.width/2,Laya.stage.height/2),w.instance.aim.x=this.nowPoint.x,w.instance.aim.y=this.nowPoint.y;this.bulletOffset;let e=1,t=1e3;if(this.isRotate=p.gunBullet>p.doubleCondition,this.damageAxis=1,p.gunBullet<=10)t=1e3/p.gunBullet;else{t=100;let s=p.gunBullet-10;(e=1+Math.floor(s/10))<5?this.damageAxis=1+(s-10*(e-1))%10*.1:(e=5,this.damageAxis=1+(s-40)/50)}this.bulletTime=t,this.bulletCount=e,this.gunModStart.addChild(p.gunMod),p.gunMod.transform.localPosition=new Laya.Vector3,p.gunMod.transform.localRotation=new Laya.Quaternion,p.gunMod.transform.localScale=new Laya.Vector3(1,1,1),b.d3_addChildNotMove(p.gunMod,this.gunModFinal)}Off(){u.off(o.getAxis,this,this.pointUpdate),u.off(o.singleTouchStart,this,this.fireOn),u.off(o.singleTouchEnd,this,this.fireOff);let e=new k,t=new k,s=new k,a=new k;e.toTween(this.model,{rot:new Laya.Quaternion},1e3),t.toTween(this.camPoint,{rot:new Laya.Quaternion},1e3),s.toTween(this.weaponGrip,{rot:new Laya.Quaternion},1e3),a.toTween(this.gunGrip,{rot:new Laya.Quaternion},1e3),Laya.Tween.to(w.instance.aim,{x:Laya.stage.width/2,y:Laya.stage.height/2},1e3),this.fireOff()}pointUpdate(e){let t=this.nowPoint.clone();t.x+=e.x,t.y+=e.y,t.x>.95*Laya.stage.width?t.x=.95*Laya.stage.width:t.x<.05*Laya.stage.width&&(t.x=.05*Laya.stage.width),t.y>.95*Laya.stage.height?t.y=.95*Laya.stage.height:t.y<.05*Laya.stage.height&&(t.y=.05*Laya.stage.height);let s=t.x-this.nowPoint.x,a=t.y-this.nowPoint.y;this.nowPoint=t;let i=.001*a,o=-.001*s*Laya.stage.height/Laya.stage.height;this.model.transform.rotate(new Laya.Vector3(0,.3*o,0),!0),this.camPoint.transform.rotate(new Laya.Vector3(.3*i,0,0),!0),this.weaponGrip.transform.rotate(new Laya.Vector3(0,.7*o,0),!0),this.gunGrip.transform.rotate(new Laya.Vector3(.7*i,0,0),!0),w.instance.aim.x=this.nowPoint.x,w.instance.aim.y=this.nowPoint.y}fire(t){let s=new Laya.Ray(new Laya.Vector3,new Laya.Vector3);this.cam.viewportPointToRay(this.nowPoint,s);let a=this.gunPos.transform.position.clone(),i=G.enemys,o=v.add(s.origin,v.mull(s.direction,30)),n=[];for(let e=0;e<i.length;e++){if(i[e].setId!=this.nowSetId||!i[e].isColliderActive)continue;let t=i[e].bigCollider.transform.position.clone(),a=(i[e].bigRange+i[e].bigWidth)/2;if(t.y+=a,V.calculateDistance(s.origin,o,t).distance<a+p.bulletRaidus){let t=i[e].smallColliders;for(let a=0;a<t.length;a++){if(!t[a].active)continue;let l=V.calculateDistance(s.origin,o,t[a].transform.position.clone());l.distance<i[e].smallRaidus[a]+p.bulletRaidus&&n.push({enemy:i[e],dis:l.goDistance,collider:i[e].smallColliders[a]})}}}let l=1e4,r=null,h=null;for(let e=0;e<n.length;e++){let t=n[e].dis;t<l&&(l=t,r=n[e].enemy,h=n[e].collider)}null!=r&&(o=v.add(s.origin,v.mull(s.direction,l)));let d=new Laya.Vector3(b.randomNumber(-.1,.1),b.randomNumber(-.1,.1),b.randomNumber(-.1,.1));t=v.add(t,d);let c=v.subtract(o,a);a=v.add(a,t);let u,m,g=v.normalized(c);for(let e=0;e<E.bullets.length;e++)if(!E.bullets[e].self.active){u=E.bullets[e].self,(m=E.bullets[e]).dis=0,m.colliderTarget=null,m.endDis=p.bulletDis,u.active=!0;break}u||(m=(u=e.bornStageObj("Bullet")).addComponent(E)),u.transform.position=a,u.transform.lookAt(o,new Laya.Vector3(0,1,0)),m.direction=g,m.damage=this.damageAxis,r?(p.isCannon&&this.cannonNowCd<=0?(m.beCannon(),this.cannonNowCd=p.cannonCD):m.beBullet(),m.colliderTarget=r,m.colliderHitSprite=h,m.endDis=Laya.Vector3.scalarLength(v.subtract(o,a))):m.beBullet();let f=D.instance;if(f.setId==this.nowSetId&&f.nowHp>0){let e=V.calculateDistance(s.origin,o,f.self.transform.position.clone());e.distance<f.raidus+p.bulletRaidus&&(m.colliderTarget=f,m.endDis=e.goDistance)}y.instance.vibrateShort()}}class z extends G{constructor(){super(...arguments),this.maxHp=0}enemySetHp(){this.nowHp=b.randomInt(1,2)*p.enemyHpScale,this.maxHp=this.nowHp;let e=b.d3_FindNodeByName(this.self,"skin");b.d3_swtichMatColor(e,b.d3_getRgbByHex("FFEE00"))}deadSpecail(){this.anim.crossFade("Die",.1,0,0);let e=b.d3_FindNodeByName(this.self,"skin");b.d3_swtichMatColor(e,b.d3_getRgbByHex("000000")),this.numebr[0].self.active=!1,Laya.timer.once(2e3,this,()=>{let e=this.self.transform.position.clone();e.y-=2,this.selfTween.toTween(this.self,{pos:e},1e3,()=>{this.self.active=!1},null,!1)}),p.BornDiamond(this.self.transform.position,this.setId,this.maxHp)}}class X extends G{enemySetHp(){this.nowHp=b.randomInt(3,6)*p.enemyHpScale;let e=b.d3_FindNodeByName(this.self,"skin");b.d3_swtichMatColor(e,b.d3_getRgbByHex("FFA700"))}deadSpecail(){let t=this.self.transform.localPosition.clone();t.x-=.5;let s=this.self.transform.rotation.clone();this.numebr=null;let a=b.d3_FindNodeByName(this.self,"skin");b.d3_swtichMatColor(a,b.d3_getRgbByHex("000000")),this.tweenDieDo_Smooth();for(let a=0;a<2;a++){let a,i="Enemy1",o=e.bornStageObj(i,this.self.parent);a=o.addComponent(z),o.transform.localPosition=t,t.x+=1,o.transform.rotation=s,a.setId=this.setId,a.tweenBornDo_Smooth(),Laya.timer.once(250,this,()=>{a.startMove(this.setId)})}p.BornDiamond(this.self.transform.position,this.setId,1)}}class Y extends G{enemySetHp(){this.nowHp=b.randomInt(7,10)*p.enemyHpScale;let e=b.d3_FindNodeByName(this.self,"skin");b.d3_swtichMatColor(e,b.d3_getRgbByHex("FF0000"))}deadSpecail(){let t=this.self.transform.localPosition.clone();this.numebr=null;let s=this.self.transform.rotation.clone(),a=b.d3_FindNodeByName(this.self,"skin");b.d3_swtichMatColor(a,b.d3_getRgbByHex("000000")),this.tweenDieDo_Smooth();let i,o=e.bornStageObj("Enemy2",this.self.parent);i=o.addComponent(X),o.transform.localPosition=t,o.transform.rotation=s,i.setId=this.setId,Laya.timer.once(250,this,()=>{i.startMove(this.setId)});for(let a=0;a<2;a++){let a,i="Enemy1",o=e.bornStageObj(i,this.self.parent);a=o.addComponent(z),o.transform.localPosition=t,o.transform.rotation=s,a.setId=this.setId,a.tweenBornDo_Smooth(),Laya.timer.once(250,this,()=>{a.startMove(this.setId)})}p.BornDiamond(this.self.transform.position,this.setId,1)}}class j extends G{constructor(){super(...arguments),this.boss1=!0,this.bodyParts=[],this.moveSpeed=1,this.animState=h.Idle}init(){G.enemys.push(this),this.enemyId=G.enemys.length-1,this.model=this.self.getChildByName("Model"),this.anim=this.model.getComponent(Laya.Animator);let e=b.d3_FindAllNodeHasName(this.model,"NumberSwitch(Clone)");this.numebr=[];for(let t=0;t<e.length;t++)this.numebr.push(e[t].addComponent(A)),this.bodyParts.push(new J(t,e[t].parent.parent.parent));J.bodyParts=this.bodyParts,this.anim.speed=1,this.idle(),this.animState=h.Idle,this.bigCollider=b.d3_FindNodeHasName(this.self,"collider_box");let t=this.bigCollider.name.split("_");this.bigRange=parseFloat(t[2]),this.bigWidth=parseFloat(t[3]);for(let e=0;e<this.numebr.length;e++)this.numebr[e].numberDeal(this.bodyParts[e].hp);this.smallColliders=b.d3_FindAllNodeHasName(this.self,"collider_circle");for(let e=0;e<this.smallColliders.length;e++){let t=this.smallColliders[e].name.split("_");this.smallRaidus.push(parseFloat(t[2]))}this.isColliderActive=!0,Laya.timer.frameLoop(1,this,this.pushOtherEnemy),u.on(a.Game_SetOn_Event,this,this.startMove),this.checkNowState()}startMove(e){e==this.setId&&(this.anim.play(h.Taunt,0,0),Laya.timer.once(2600,this,()=>{this.getPath(),this.checkWay(),this.animState==h.Walk&&this.anim.play(h.Walk,0,0)}))}colliderDo(e,t){let s=t.parent.name;for(let t=0;t<this.bodyParts.length;t++)if(this.bodyParts[t].partName==s){this.bodyParts[t].partHurt(e);break}for(let e=0;e<this.numebr.length;e++)this.numebr[e].numberDeal(this.bodyParts[e].hp);this.checkNowState(),p.BornEnemyHitFx(t.transform.position.clone())}checkNowState(){this.nowHp=0,this.nowWalkState=h.Walk;for(let e=0;e<this.bodyParts.length;e++)this.smallColliders[e].active=this.bodyParts[e].part.active;if(this.bodyParts[11].part.active){if(this.nowHp+=this.bodyParts[11].hp,this.nowWalkState=h.Head_only,this.bodyParts[7].part.active){this.nowHp+=this.bodyParts[7].hp,this.nowWalkState=h.Crawling;let e=this.bodyParts[8].partChildIds;for(let t=0;t<e.length;t++){this.bodyParts[e[t]].part.active&&(this.nowHp+=this.bodyParts[e[t]].hp)}let t=this.bodyParts[12].partChildIds;for(let e=0;e<t.length;e++){this.bodyParts[t[e]].part.active&&(this.nowHp+=this.bodyParts[t[e]].hp)}if(this.bodyParts[0].part.active){let e=this.bodyParts[1].partChildIds;for(let t=0;t<e.length;t++){this.bodyParts[e[t]].part.active&&(this.nowHp+=this.bodyParts[e[t]].hp)}let t=this.bodyParts[4].partChildIds;for(let e=0;e<t.length;e++){this.bodyParts[t[e]].part.active&&(this.nowHp+=this.bodyParts[t[e]].hp)}let s=this.bodyParts[3].part.active,a=this.bodyParts[6].part.active;s&&a?this.nowWalkState=h.Walk:s?this.nowWalkState=h.Walk_Injured_R:a&&(this.nowWalkState=h.Walk_Injured_L)}}}else this.dead(),b.d3_FindNodeByName(this.self,"crown").active=!1,this.anim.speed=0;this.playStateAnim()}playStateAnim(){if(this.nowWalkState!=this.animState){if(this.nowWalkState==h.Crawling)this.anim.crossFade(h.Falling_NoLegs,.1,0,0),this.moveSpeed=0,Laya.timer.once(2600,this,()=>{this.animState==h.Crawling&&(this.anim.crossFade(h.Crawling,.1,0,0),this.moveSpeed=p.boss1CrawlSpeed)});else switch(this.anim.crossFade(this.nowWalkState,.1,0,0),this.nowWalkState){case h.Walk:this.moveSpeed=p.boss1MoveSpeed;break;case h.Walk_Injured_L:case h.Walk_Injured_R:this.moveSpeed=p.boss1MoveSpeed2;break;case h.Head_only:this.moveSpeed=p.boss1MoveSpeed3}this.animState=this.nowWalkState}}}class J{constructor(e,t){switch(this.partChildIds=[],this.hp=1,this.hpScale=1,this.id=e,this.part=t,this.partName=t.name,this.hpScale=p.enemyHpScale,this.hp=p.boss1Hp[t.name]*this.hpScale,t.name){case r.Boss_Body_Bottom:for(let e=0;e<=6;e++)this.partChildIds.push(e);break;case r.Boss_UpLeg_L:for(let e=1;e<=3;e++)this.partChildIds.push(e);break;case r.Boss_Leg_L:for(let e=2;e<=3;e++)this.partChildIds.push(e);break;case r.Boss_Foot_L:for(let e=3;e<=3;e++)this.partChildIds.push(e);break;case r.Boss_UpLeg_R:for(let e=4;e<=6;e++)this.partChildIds.push(e);break;case r.Boss_Leg_R:for(let e=5;e<=6;e++)this.partChildIds.push(e);break;case r.Boss_Foot_R:for(let e=6;e<=6;e++)this.partChildIds.push(e);break;case r.Boss_Body_Top:for(let e=0;e<=14;e++)11!=e&&this.partChildIds.push(e);break;case r.Boss_Arm_L:for(let e=8;e<=10;e++)this.partChildIds.push(e);break;case r.Boss_ForeArm_L:for(let e=9;e<=10;e++)this.partChildIds.push(e);break;case r.Boss_Hand_L:for(let e=10;e<=10;e++)this.partChildIds.push(e);break;case r.Boss_Head:for(let e=0;e<=14;e++)this.partChildIds.push(e);break;case r.Boss_Arm_R:for(let e=12;e<=14;e++)this.partChildIds.push(e);break;case r.Boss_ForeArm_R:for(let e=13;e<=14;e++)this.partChildIds.push(e);break;case r.Boss_Hand_R:for(let e=14;e<=14;e++)this.partChildIds.push(e)}}partHurt(e){if(this.hp-=e,this.hp<=0){for(let e=0;e<this.partChildIds.length;e++)J.bodyParts[this.partChildIds[e]].part.active&&(J.bodyParts[this.partChildIds[e]].part.active=!1,p.BornDiamond(J.bodyParts[this.partChildIds[e]].part.transform.position.clone(),1,3));return!0}return!1}switchType(){switch(this.partName){case r.Boss_Body_Bottom:case r.Boss_UpLeg_L:case r.Boss_Leg_L:case r.Boss_Foot_L:case r.Boss_UpLeg_R:case r.Boss_Leg_R:case r.Boss_Foot_R:case r.Boss_Body_Top:case r.Boss_Arm_L:case r.Boss_ForeArm_L:case r.Boss_Hand_L:case r.Boss_Head:case r.Boss_Arm_R:case r.Boss_ForeArm_R:case r.Boss_Hand_R:}}}!function(e){e.Boss_Body_Bottom="Boss_Body_Bottom",e.Boss_UpLeg_L="Boss_UpLeg_L",e.Boss_Leg_L="Boss_Leg_L",e.Boss_Foot_L="Boss_Foot_L",e.Boss_UpLeg_R="Boss_UpLeg_R",e.Boss_Leg_R="Boss_Leg_R",e.Boss_Foot_R="Boss_Foot_R",e.Boss_Body_Top="Boss_Body_Top",e.Boss_Arm_L="Boss_Arm_L",e.Boss_ForeArm_L="Boss_ForeArm_L",e.Boss_Hand_L="Boss_Hand_L",e.Boss_Head="Boss_Head",e.Boss_Arm_R="Boss_Arm_R",e.Boss_ForeArm_R="Boss_ForeArm_R",e.Boss_Hand_R="Boss_Hand_R"}(r||(r={})),function(e){e.Idle="Idle",e.Crawling="Crawling",e.Falling_NoLegs="Falling_NoLegs",e.Head_only="Head_only",e.Hit="Hit",e.Taunt="Taunt",e.Walk_Injured_R="Walk_Injured_R",e.Walk_Injured_L="Walk_Injured_L",e.Walk="Walk"}(h||(h={}));class Z extends G{constructor(){super(...arguments),this.nowHp=1,this.maxHp=1}init(){G.enemys.push(this),this.target=W.instance.self,this.moveDir=null,this.isColliderActive=!0,this.smallColliders=b.d3_FindAllNodeHasName(this.self,"collider_circle");for(let e=0;e<this.smallColliders.length;e++){let t=this.smallColliders[e].name.split("_");this.smallRaidus.push(parseFloat(t[2]))}this.bigCollider=this.smallColliders[0].clone(),this.smallColliders[0].parent.addChild(this.bigCollider);let e=this.smallColliders[0].transform.localPosition.clone();e.y-=this.smallRaidus[0],this.bigCollider.transform.localPosition=e,this.bigRange=this.smallRaidus[0],this.bigWidth=this.smallRaidus[0];let t=b.d3_FindNodeByName(this.self,"Number");this.number=t.addComponent(A)}setHp(e){this.nowHp=e*p.enemyHpScale,this.maxHp=e*p.enemyHpScale,this.isColliderActive=!0,this.number.numberDeal(this.nowHp),this.startMove(this.setId)}run(){}startMove(e){e==this.setId&&(this.moveSpeed=p.boss2BulletSpeed,this.getPath(),this.checkWay(),this.run())}getPath(){let e=q.instance.setPaths[this.setId];this.paths=[];let t=e[1].transform.localPosition.clone(),s=e[1].parent.transform.localPosition.clone(),a=e[1].parent.parent.transform.localPosition.clone();t=v.add(t,s),(t=v.add(t,a)).y+=5,this.self.transform.localPosition.z>t.z&&this.paths.push(t),this.nowPathId=0}onUpdate(){if(this.moveDir&&!this.isHurt){if(this.paths[this.nowPathId].z-this.self.transform.localPosition.z>=0)return this.nowPathId++,void this.checkWay();let e=this.self.transform.localPosition.clone(),t=this.moveSpeed*Laya.timer.delta/1e3,s=v.mull(this.moveDir,t);e=v.add(e,s),this.self.transform.localPosition=e;let a,i=this.moveDir;if(0==i.x&&i.z,-1==i.z&&0==i.x)a=0;else if(1==i.z&&0==i.x)a=180;else{a=180*Math.atan2(i.x,-i.z)/Math.PI}let o=this.self.transform.localRotationEuler.clone();o.y=180,this.self.transform.localRotationEuler=o}}checkWay(){if(this.nowPathId<this.paths.length){let e=this.self.transform.localPosition.clone(),t=this.paths[this.nowPathId],s=v.subtract(t,e);this.moveDir=v.normalized(s)}else this.moveDir=null,this.setId==W.instance.nowSetId&&u.event(a.Game_EnemyReach_Event)}colliderDo(e,t){this.nowHp<=0||(this.nowHp-=e,this.nowHp<=0?(this.number.numberDeal(0),this.dead()):this.number.numberDeal(this.nowHp))}dead(){if(!this.isColliderActive)return;console.log("Bullet"),this.tweenDieDo_Smooth(),this.isColliderActive=!1;let t,s=1,a="Enemy"+(s=this.maxHp<=2?1:this.maxHp<=6?2:3).toString(),i=e.bornStageObj(a,this.self.parent),o=new Laya.Vector3(this.self.transform.position.x,this.target.transform.position.y,this.self.transform.position.z);i.transform.position=v.subtract(o,v.mull(this.moveDir,1.5)),i.transform.rotation=this.self.transform.rotation.clone();let n=0;switch(a){case"Enemy1":n+=1,t=i.addComponent(z);break;case"Enemy2":n+=3,t=i.addComponent(X);break;case"Enemy3":n+=6,t=i.addComponent(Y)}q.instance.setCount[this.setId]+=n,t.setId=this.setId,t.tweenBornDo_Smooth(),Laya.timer.once(250,this,()=>{t.enemySetHp(),t.startMove(this.setId,!0)}),this.moveDir=null}}class Q extends G{constructor(){super(...arguments),this.boss2=!0,this.moveSpeed=2,this.isMove=!1,this.way=1}init(){G.enemys.push(this),this.enemyId=G.enemys.length-1,this.model=this.self.getChildByName("Model"),this.anim=this.model.getComponent(Laya.Animator),this.anim.speed=1,Laya.timer.clear(this,this.attack),this.idle(),this.enemySetHp();let e=b.d3_FindNodeByName(this.model,"Number");this.numebr=[],this.numebr.push(e.addComponent(A)),this.numebr[0].numberDeal(this.nowHp),this.bigCollider=b.d3_FindNodeHasName(this.self,"collider_box");let t=this.bigCollider.name.split("_");this.bigRange=parseFloat(t[2]),this.bigWidth=parseFloat(t[3]),this.smallColliders=b.d3_FindAllNodeHasName(this.self,"collider_circle");for(let e=0;e<this.smallColliders.length;e++){let t=this.smallColliders[e].name.split("_");this.smallRaidus.push(parseFloat(t[2]))}this.isColliderActive=!0,u.on(a.Game_SetOn_Event,this,this.startMove),this.gunPos=this.model.getChildByName("GunPos")}enemySetHp(){this.nowHp=p.boss2Hp*p.enemyHpScale}startMove(e){e==this.setId&&(this.isMove=!0,this.way=1,this.model.transform.localPosition=new Laya.Vector3,this.moveSpeed=p.boss2MoveSpeed,Laya.timer.once(1e3*p.boss2AttackCD,this,this.attack))}attack(){this.isMove=!1,this.anim.crossFade("Clap",.1,0,0),Laya.timer.once(1e3,this,()=>{let t=e.bornStageObj("Bullet_Boss2",this.self.parent);t.transform.position=this.gunPos.transform.position.clone(),t.transform.rotation=this.gunPos.transform.rotation.clone();let s=t.addComponent(Z);s.setId=this.setId,s.setHp(b.randomInt(p.boss2BulletMin,p.boss2BulletMax)),s.tweenBornDo_Smooth()}),Laya.timer.once(2e3,this,()=>{this.isMove=!0,this.idle(),Laya.timer.once(1e3*p.boss2AttackCD,this,this.attack)})}idle(){this.anim.crossFade("Idle",.1,0,0)}onUpdate(){if(this.isMove){let e=Laya.timer.delta/1e3,t=this.model.transform.localPosition.clone();t.x<-4?this.way=1:t.x>4&&(this.way=-1),t.x+=this.way*e*this.moveSpeed,this.model.transform.localPosition=t}}hurt(e){this.nowHp<=0||(this.nowHp-=e,this.nowHp<=0?(this.numebr[0].numberDeal(0),this.dead()):this.numebr[0].numberDeal(this.nowHp))}dead(){this.isColliderActive=!1,this.moveDir=null,this.deadSpecail(),p.BornDiamond(this.model.transform.position,this.setId,10)}deadSpecail(){this.self.active&&(Laya.timer.clearAll(this),this.self.active=!1,q.instance.roundEnd())}}class q{constructor(){this.dropObjs=[],this.moneyCount=0,this.nowRound=0,this.playCount=0,this.setCount=[],this.setCountMax=[],this.setGroundY=[],this.sets=[],this.enemys=[],this.setPaths=[],this.isWin=!1,this.isReadJsonOrScene=!0,this.isBornStage=!0,this.isStart=!1,this.lastValue=0,this.isItemColliderOn=!1,q.instance=this,this.init()}init(){this.initEvent(),this.readJson()}createShadow(e){e.shadowMode=Laya.ShadowMode.SoftLow,e.shadowDistance=100,e.shadowResolution=2048,e.shadowCascadesMode=Laya.ShadowCascadesMode.NoCascades,e.shadowNormalBias=.6,e.shadowStrength=.4}hideShadow(e){e.shadowMode=Laya.ShadowMode.None}useRetinalCanvas(){Laya.stage.useRetinalCanvas=!0}disabelRetinalCanvas(){Laya.stage.useRetinalCanvas=!1}setFog(e,t,s){t.enableFog=e,e&&(t.fogColor=s,t.fogStart=10,t.fogRange=30)}readJson(){x.addLoadRes("Json1"),x.addLoadRes("Json2");let e=["res/json/stageJson.json","res/json/dataJson.json"],t=()=>{Laya.loader.load(e,Laya.Handler.create(this,s=>{if(s)for(let t=0;t<e.length;t++)Laya.loader.load(e[t],Laya.Handler.create(this,e=>{switch(t){case 0:this.stageJson=e,x.removeLoadRes("Json1");break;case 1:x.removeLoadRes("Json2"),this.dataJson=e,p.gunLevelUpData=this.dataJson.GunLevelUp;break;default:console.log(e)}}),null,Laya.Loader.JSON);else console.log("load json fail,reload after 1s"),Laya.timer.once(1e3,this,t)}),null,Laya.Loader.JSON)};e.length>0&&t()}JsonV3(e,t){if(t){let s=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),a=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector3(s,a,i)}return new Laya.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z))}V3ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString()}}JsonV4(e,t){if(t){let s=Math.round(parseFloat(e.x)*Math.pow(10,t))/Math.pow(10,t),a=Math.round(parseFloat(e.y)*Math.pow(10,t))/Math.pow(10,t),i=Math.round(parseFloat(e.z)*Math.pow(10,t))/Math.pow(10,t),o=Math.round(parseFloat(e.w)*Math.pow(10,t))/Math.pow(10,t);return new Laya.Vector4(s,a,i,o)}return new Laya.Vector4(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z),parseFloat(e.w))}V4ToJson(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString(),w:e.w.toString()}}firstIn(){console.log("首次进入处理"),e.mainScene=this.mainScene;for(let t=0;t<this.mainScene.numChildren;t++){let s=this.mainScene.getChildAt(t);switch(s.name){case"Prefabs":e.prefabs=s,e.prefabs.active=!1;break;case"Light":this.light=s;break;case"Fxs":e.fxs=s,Laya.timer.once(1e3,this,()=>{e.fxs.active=!1});break;case"Stage":this.stage=s,this.start=s.getChildByName("Start"),this.end=s.getChildByName("End"),this.player=this.stage.getChildByName("Player"),this.playerFpsComp=this.player.addComponent(W),this.camPoint=b.d3_FindNodeByName(this.player,"CamPoint"),this.mainCam=this.camPoint.getChildByName("MainCam"),this.mainCamera=this.mainCam.getChildByName("Main Camera");break;case"DesignScene":this.designScene=s.addComponent(O)}}this.useRetinalCanvas(),this.createShadow(this.light)}initEvent(){}levelInit(){this.isStart=!1,Laya.timer.clear(this,this.gameUpdate),e.stageObjClear(),this.dropObjs=[],this.nowRound=0,this.moneyCount=0,this.setCount=[],this.setGroundY=[],this.sets=[],this.setPaths=[],G.enemys=[];let t=this.dataJson.Base.length,s=g.ReadGrade()-1;s=s>=t?t-1:s;let a=this.dataJson.Base[s];if(p.doubleCondition=a.doubleCondition,p.doubleAxis=a.doubleAxis,p.designMods=a.designMods,g.ReadGrade()-1>=t){p.designMods=[];let e=[l.Add_1,l.Add_2,l.Mul_2,l.Mul_3];for(let t=0;t<6;t++)p.designMods.push(b.getRandomInArray(e));p.designMods.push(l.Cannon)}p.enemyMoveSpeed=a.enemyMoveSpeed,p.enemyHpScale=a.enemyHpScale,p.passStageGet=a.passStageGet,p.boss1Hp=this.dataJson.Boss1[0],p.boss1MoveSpeed=this.dataJson.Boss1[0].boss1MoveSpeed,p.boss1MoveSpeed2=this.dataJson.Boss1[0].boss1MoveSpeed2,p.boss1CrawlSpeed=this.dataJson.Boss1[0].boss1CrawlSpeed,p.boss1MoveSpeed3=this.dataJson.Boss1[0].boss1MoveSpeed3;let i=this.dataJson.Boss2[0];p.boss2MoveSpeed=i.boss2MoveSpeed,p.boss2Hp=i.boss2Hp,p.boss2AttackCD=i.boss2AttackCD,p.boss2BulletMin=parseInt(i.boss2BulletMin),p.boss2BulletMax=parseInt(i.boss2BulletMax),p.boss2BulletSpeed=parseInt(i.boss2BulletSpeed);let o=this.dataJson.Other[0];p.cannonCD=o.cannonCD,p.cannonDamage=o.cannonDamage;let n=this.isBornStage,r=this.start.transform.position.clone(),h=this.start.transform.rotation.clone();if(n){let t=this.stage.getChildByName("Level");if(this.isReadJsonOrScene)t&&(t.active=!1),t=this.stageJson;else{t.active=!1;let e=[];for(let s=0;s<t.numChildren;s++){let a=t.getChildAt(s),i=[];for(let e=0;e<a.numChildren;e++){let t=a.getChildAt(e),s=[];for(let e=0;e<t.numChildren;e++){let a=t.getChildAt(e),i=new Laya.Vector4(a.transform.localRotation.x,a.transform.localRotation.y,a.transform.localRotation.z,a.transform.localRotation.w),o={name:a.name.split(" ")[0],pos:this.V3ToJson(a.transform.localPosition.clone()),rot:this.V4ToJson(i),sca:this.V3ToJson(a.transform.localScale.clone())};s.push(o)}i.push(s)}e.push(i)}console.log(JSON.stringify(e)),t=e}let s=(g.ReadGrade()-1)%5,a=t[s=g.ReadGrade()-1<5?g.ReadGrade()-1:g.ReadGrade()%5==0?b.randomInt(4,5):b.randomInt(0,3)];for(let t=0;t<a.length;t++){let s=0,i=a[t],o=new Laya.Sprite3D("Set"+t.toString());e.stageObj.push(o),this.stage.addChild(o),this.sets.push(o);let n=[];o.transform.position=r,o.transform.rotation=h,this.setGroundY.push(-1e3);for(let a=0;a<i.length;a++){let l=i[a],r=l.name,h=e.bornStageObj(r,o),d=this.JsonV3(l.pos),c=this.JsonV4(l.rot),u=new Laya.Quaternion(c.x,c.y,c.z,c.w),m=this.JsonV3(l.sca);if(h.transform.localPosition=d,h.transform.localRotation=u,h.transform.localScale=m,-1!=l.name.indexOf("Enemy")){let e;switch(this.setGroundY[t]=h.transform.position.y,r){case"Enemy1":s+=1,e=h.addComponent(z);break;case"Enemy2":s+=3,e=h.addComponent(X);break;case"Enemy3":s+=6,e=h.addComponent(Y)}e.setId=t}else if(-1!=l.name.indexOf("Boss1")){this.setGroundY[t]=h.transform.position.y,s+=1,h.addComponent(j).setId=t}else if(-1!=l.name.indexOf("Boss2")){this.setGroundY[t]=h.transform.position.y,s+=1,h.addComponent(Q).setId=t}else if(-1!=l.name.indexOf("Road")||-1!=l.name.indexOf("Stair")){let e=h.getChildByName("Path");for(let t=0;t<e.numChildren;t++)n.push(e.getChildAt(t))}}this.setCount.push(s),r=n[n.length-1].transform.position.clone(),h=n[n.length-1].transform.rotation.clone(),this.setPaths.push(n)}}p.setGroundY=this.setGroundY,this.end.transform.position=r,this.end.transform.rotation=h,this.setCount.push(1),this.sets.push(this.end),this.setGroundY.push(r.y);let d=this.end.getChildByName("Path"),c=[];for(let e=0;e<d.numChildren;e++)c.push(d.getChildAt(e));this.setPaths.push(c);let u=b.d3_FindNodeByName(this.end,"Chest"),m=u.getComponent(D);m||(m=u.addComponent(D)),m.setId=this.sets.length-1,m.reset(),this.designScene.On(),this.setCountMax=b.cloneArray(this.setCount),this.player.active=!1,this.player.transform.position=this.start.transform.position.clone(),this.player.transform.rotation=this.start.transform.rotation.clone(),Laya.timer.frameLoop(1,this,this.gameUpdate)}gameStart(){this.isStart=!0,this.roundInit(),this.playCount++,Laya.timer.loop(16,this,this.fixUpdate),u.on(a.Game_EnemyReach_Event,this,this.Lose)}levelEnd(t){this.playerFpsComp.Off(),u.off(a.Game_EnemyDie_Event,this,this.checkNowSetDone),u.off(a.Game_EnemyReach_Event,this,this.Lose),this.isWin=t,this.nowRound=9999,Laya.timer.clear(this,this.fixUpdate),t?(e.bornFxDestroy("PlayerConffettiFX",this.player,2e3,1,new Laya.Vector3(0,1,0)),m.play(i.Win),Laya.timer.once(2e3,this,()=>{u.event(a.Scene_GoOver)}),q.instance.moneyCount=p.passStageGet):(m.play(i.FALSE),u.event(a.Scene_GoOver))}roundInit(){let e=e=>{let t=0,s=()=>{if(t>1)0!=this.setCount[e]?u.event(a.Game_SetOn_Event,e):this.roundEnd();else{let a=this.setPaths[e][t];t++;let i=50*v.distance(this.playerFpsComp.self.transform.position.clone(),a.transform.position.clone());this.playerFpsComp.selfTween.toTween(this.playerFpsComp.self,{pos:a.transform.position.clone(),rot:a.transform.rotation.clone()},i,()=>{s()},null,!1)}};s()},t=t=>{let s=1,a=()=>{if(s>this.setPaths[t-1].length-1)e(t);else{let e=this.setPaths[t-1][s];s++;let i=50*v.distance(this.playerFpsComp.self.transform.position.clone(),e.transform.position.clone());this.playerFpsComp.selfTween.toTween(this.playerFpsComp.self,{pos:e.transform.position.clone(),rot:e.transform.rotation.clone()},i,()=>{a()},null,!1)}};a()};if(this.playerFpsComp.nowSetId=this.nowRound,0==this.nowRound&&(this.player.active=!0,Laya.timer.frameOnce(1,this,()=>{this.playerFpsComp.On()}),u.on(a.Game_EnemyDie_Event,this,this.checkNowSetDone)),this.nowRound<this.sets.length){let s=this.nowRound;this.nowRound-1>=0?t(s):e(s);let a=1;for(let e=0;e<this.setCountMax.length-2;e++)0!=this.setCountMax[e]&&a++;let i=a;for(let e=0;e<this.setCount.length-2;e++)0!=this.setCount[e]&&i--;w.instance.roundBar.getChildByName("round").value=i.toString()+"/"+a.toString(),0!=this.setCountMax[this.nowRound]&&this.nowRound<this.sets.length-1&&(w.instance.roundBar.value=0)}else this.nowRound==this.sets.length&&this.levelEnd(!0)}checkNowSetDone(){this.setCount[this.nowRound]--,this.setCount[this.nowRound]<=0?(Laya.timer.once(1e3,this,this.roundEnd),w.instance.roundBar.value=1):w.instance.roundBar.value=1-this.setCount[this.nowRound]/this.setCountMax[this.nowRound]}roundEnd(){this.nowRound++,this.roundInit()}Lose(){this.levelEnd(!1),y.instance.vibrateLong()}gameUpdate(){Laya.timer.delta;this.nowRound}fixUpdate(){this.nowRound}addMoenyCount(e){this.moneyCount+=e}}class K extends L{init(){q.instance.playCount}initEvent(){b.d2_AddClickEvent(this.btnStart,this,this.onBtnStartClick)}onBtnStartClick(){}}class $ extends S{init(...e){this.value=this.self.getChildByName("value"),this.value.value=g.ReadGrade().toString()}}class ee extends L{init(){Laya.timer.frameOnce(1,this,this.loadProgressUpdate)}initEvent(){u.on(a.Progress_Load_Update,this,this.loadProgressUpdate)}loadProgressUpdate(){let e=x.loadingList;0==e.length?(console.log("加载完毕"),u.event(a.Scene_GoHome)):console.log("正在加载",e[0]),this.loadBar.value=(x.loadingCount-e.length)/x.loadingCount}}class te extends L{constructor(){super(...arguments),this.coinUrl=p.coinUrl}init(){f.toScale(this.icon,0,1,500,Laya.Ease.elasticOut),this.icon.skin=q.instance.isWin?"ui/game/sljm_bt.png":"ui/game/sljm_bt_lose.png",this.videoCheckBox.set_visible(q.instance.isWin),this.btnContinue.skin=q.instance.isWin?"ui/game/sljm_zd.png":"ui/game/sbjm_zd.png";let e=this.btnContinue.getChildByName("coinValue");e.set_visible(q.instance.isWin),e.value=(this.videoCheckBox.selected?5*q.instance.moneyCount:q.instance.moneyCount).toString()}initEvent(){this.videoCheckBox.on("change",this,()=>{this.btnContinue.getChildByName("coinValue").value=(this.videoCheckBox.selected?5*q.instance.moneyCount:q.instance.moneyCount).toString()}),b.d2_AddClickEvent(this.btnContinue,this,this.onBtnContinueClick)}onBtnContinueClick(){let e=this,t=t=>{this.btnContinue.offAllCaller(this),q.instance.isWin&&(t?g.AddCoin(5*q.instance.moneyCount):g.AddCoin(q.instance.moneyCount)),q.instance.isWin?(m.play(i.GetMoney),b.d2_coinCollectAnim(this.coinUrl,new Laya.Vector2(e.btnContinue.x,e.btnContinue.y),new Laya.Vector2(e.coin.x,e.coin.y),e.scene,10,1,()=>{g.AddGrade(),u.event(a.Scene_GoHome)})):u.event(a.Scene_GoHome)};this.videoCheckBox.selected&&q.instance.isWin?y.instance.showVideo(()=>{t(!0)},()=>{y.instance.showToast("未看完视频，没有奖励")}):t(!1)}}class se extends Laya.Script{constructor(){super(...arguments),this.delayTime=0}onEnable(){let e=this.owner,t=e.y;Laya.timer.once(this.delayTime,this,()=>{f.toPosition(e,{y:t+15},1e3,Laya.Ease.sineInOut,()=>{},!0)})}onDisable(){let e=this.owner;f.clearTween(e),Laya.timer.clearAll(this)}}!function(e){e[e.has=0]="has",e[e.choose=1]="choose",e[e.coin=2]="coin",e[e.video=3]="video"}(d||(d={})),function(e){e[e.cup=0]="cup",e[e.hand=1]="hand",e[e.levelUp=2]="levelUp"}(c||(c={}));class ae extends S{constructor(){super(...arguments),this.bgUrl=["ui/game/Shop/sd_bz_bj.png","ui/game/Shop/sd_sb_bj.png","ui/game/Shop/sd_ys_bj.png"],this.showUrl=["ui/game/Shop/sd_bz_zst.png","ui/game/Shop/sd_sb_zst.png","ui/game/Shop/sd_ys_zst.png"],this.itemUrl=["ui/game/Shop/skin.png","ui/game/Shop/skin_selected.png","ui/game/Shop/skin_buy.png","ui/game/Shop/skin_buy.png"],this.nowType=c.cup}init(){this.self.width=Laya.stage.width,this.self.height=Laya.stage.height,this.self.x=0,this.self.y=0,this.mainPanel=this.self.getChildByName("mainPanel"),this.closeBtn=this.self.getChildByName("closeBtn"),this.bg=this.self.getChildByName("bg"),this.showImage=this.self.getChildByName("showImage"),this.cupType=this.mainPanel.getChildByName("cupType"),this.handType=this.mainPanel.getChildByName("handType"),this.levelUpType=this.mainPanel.getChildByName("levelUpType"),this.nowType=c.cup,this.switchType(this.nowType),this.initEvent()}initEvent(){b.d2_AddClickEvent(this.closeBtn,this,this.onCloseClick),b.d2_AddClickEvent(this.cupType,this,this.switchType,[c.cup],!1,!0,!1),b.d2_AddClickEvent(this.handType,this,this.switchType,[c.hand],!1,!0,!1),b.d2_AddClickEvent(this.levelUpType,this,this.switchType,[c.levelUp],!1,!0,!1)}onCloseClick(){this.self.set_visible(!1),this.closeCB&&this.closeCB()}switchType(e){this.nowType=e;let t=this.cupType.getChildAt(0),s=this.handType.getChildAt(0),a=this.levelUpType.getChildAt(0);switch(t.set_visible(!0),s.set_visible(!0),a.set_visible(!0),this.bg.skin=this.bgUrl[e],this.showImage.skin=this.showUrl[e],this.nowType){case c.cup:t.set_visible(!1);break;case c.hand:s.set_visible(!1);break;case c.levelUp:a.set_visible(!1);break;default:console.error("选择错误的类型",e)}this.initList(),this.updateShow()}initList(){this.list=this.mainPanel.getChildByName("list"),this.list.selectEnable=!1,this.list.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.list.hScrollBarSkin="",this.list.repeatX=3,this.list.repeatY=2}onListRender(e,t){let s,a=e.getChildByName("Item"),i=a.getChildByName("icon"),o=a.getChildByName("coin"),n=a.getChildByName("video"),l=d.has;switch(o.set_visible(!1),n.set_visible(!1),this.nowType){case c.cup:i.skin="ui/game/Shop/Cup/buck"+(t+1)+".png";break;case c.hand:i.skin="ui/game/Shop/Hand/hand0"+t+".png";break;case c.levelUp:i.skin="ui/game/Shop/LevelUp/frap0"+(t+1)+".png"}switch(l){case d.coin:o.set_visible(!0),s=o.getChildAt(0);break;case d.video:n.set_visible(!0),s=n.getChildAt(0)}a.skin=this.itemUrl[l],a.scale(1,1)}clickEvent(e){let t=e.id,s=e.type,a=e.unlockType,i=e=>{this.nowChooseIndex=e};switch(a){case d.has:i(t);break;case d.choose:break;case d.coin:g.CostCoin(e.unlockCount)&&((t,s)=>{e[t][s]=-1,i(s)})(s,t);break;case d.video:y.instance.showVideo(()=>{},()=>{y.instance.showToast("视频解锁失败")})}this.updateShow(),this.list.refresh()}updateShow(){let e,t=this.nowChooseIndex;switch(this.nowType){case c.cup:e="ui/game/Shop/Cup/buck"+(t+1)+".png";break;case c.hand:e="ui/game/Shop/Hand/hand0"+t+".png";break;case c.levelUp:e="ui/game/Shop/LevelUp/frap0"+(t+1)+".png";break;default:e=""}this.showImage.getChildByName("icon").skin=e}}class ie{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("Scenes/Game.ts",w),e("Tools/ctrl/TouchCtrl.ts",_),e("Tools/ctrl/TouchScan.ts",C),e("UIComps/CoinComp.ts",P),e("Tools/uiTween/RotUITween.ts",M),e("Scenes/Home.ts",K),e("UIComps/StageComp.ts",$),e("UIComps/DesignPanel.ts",U),e("Scenes/Load.ts",ee),e("Scenes/Over.ts",te),e("Tools/uiTween/PosUITween.ts",se),e("UIComps/ShopComp.ts",ae)}}ie.width=750,ie.height=1334,ie.scaleMode="fixedwidth",ie.screenMode="vertical",ie.alignV="middle",ie.alignH="center",ie.startScene="scenes/Game.scene",ie.sceneRoot="",ie.debug=!1,ie.stat=!1,ie.physicsDebug=!1,ie.exportSceneToJson=!0,ie.init();class oe extends y{init(){super.init(),this.platformApi=Laya.Browser.window.wx,this.showShareMenuWithTicket(!0),this.regisiterWXShareCallback()}showToast(e,t=1500){Laya.Browser.window.wx.showToast({title:e,icon:"none",duration:t})}showShareMenuWithTicket(e){wx.showShareMenu({withShareTicket:e,success:function(){},fail:function(){},complete:function(){}})}regisiterWXShareCallback(){if(Laya.Browser.onWeiXin){var e={title:"分享",image:""};Laya.Browser.window.wx.onShareAppMessage(function(){return console.log("用户点击了转发按钮"),{title:e.title,imageUrl:e.image,query:"share_id=1"}})}}}class ne{static init(){this.isStatShow&&(Laya.Stat.show(),m.muiscSwitch(!1)),this.game=new q,this.goLoad(),x.addLoadRes(s.SubPackage),x.addLoadRes(s.Scene3D),m.init(),g.CheckPlayerData(),Laya.Browser.onWeiXin?this.platform=new oe:this.platform=new y,this.platform.init();this.platform.loadSubPackage(this.subPackageName,e=>{e&&(x.removeLoadRes(s.SubPackage),this.load3DRes(this.scene3DUrl))})}static sceneEventOn(){u.on(a.Scene_GoHome,this,this.goHome),u.on(a.Scene_GoGame,this,this.goGame),u.on(a.Scene_GoOver,this,this.goOver)}static goLoad(){this.sceneEventOn(),this.openScene(t.Load)}static goHome(){this.closeScene(t.Load),this.closeScene(t.Over),this.openScene(t.Home),this.game.levelInit()}static goGame(){0==this.game.playCount&&m.randomPlayMusic(),this.closeScene(t.Home),this.openScene(t.Game,()=>{this.game.gameStart()})}static goOver(){this.closeScene(t.Game),this.openScene(t.Over)}static load3DRes(e){var t=[{url:e,clas:Laya.Scene3D,priority:1}];Laya.loader.create(t,Laya.Handler.create(this,this.onLoadFinished,[{target:"3dRes"}],!1),Laya.Handler.create(this,this.onLoading,null,!1)),Laya.loader.on(Laya.Event.ERROR,this,t=>{console.error("资源加载失败",t),this.load3DRes(e)})}static onLoadFinished(e){console.log("资源加载完成",e),this.loadSceneRes(),x.removeLoadRes(s.Scene3D)}static onLoading(e){}static loadSceneRes(){let e=Laya.loader.getRes(this.scene3DUrl);Laya.stage.addChild(e),Laya.stage.setChildIndex(e,0),this.game.mainScene=e,this.game.firstIn()}static openScene(e,t){Laya.Scene.open(e,!1,null,Laya.Handler.create(this,e=>{Laya.stage.addChild(e),t&&t()}))}static closeScene(e,t){Laya.Scene.close(e)&&t&&t()}static checkPerformance(e,t,s){let a=0,i=100,o=i;Laya.timer.loop(100,this,function addValue(){a+=1e3/Laya.timer.delta;o--;if(o<=0){Laya.timer.clear(this,addValue);let o=a/i;o>50?e&&e():o>40?t&&t():s&&s()}})}}ne.subPackageName="scene",ne.scene3DUrl="res/scene/Conventional/ResScene.ls",ne.isStatShow=!1;new class{constructor(){window.Laya3D?Laya3D.init(ie.width,ie.height):Laya.init(ie.width,ie.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=ie.scaleMode,Laya.stage.screenMode=ie.screenMode,Laya.stage.alignV=ie.alignV,Laya.stage.alignH=ie.alignH,Laya.URL.exportSceneToJson=ie.exportSceneToJson,(ie.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),ie.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),ie.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){ne.init()}}}();