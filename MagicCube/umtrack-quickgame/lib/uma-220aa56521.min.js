var e="[UMENG] -- ",t=function(){var t=null,n=!1;function i(){this.setDebug=function(e){n=e},this.d=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=e+arguments[0]),console.log.apply(console,arguments)}catch(e){}},this.i=function(){try{if(n)try{"string"==typeof arguments[0]&&(arguments[0]=e+arguments[0]),console.log.apply(console,arguments)}catch(e){}}catch(e){}},this.e=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=e+arguments[0]),console.log.apply(console,arguments)}catch(e){}},this.w=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=e+arguments[0]),console.log.apply(console,arguments)}catch(e){}},this.v=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=e+arguments[0]),console.log.apply(console,arguments)}catch(e){}},this.t=function(){if(n)try{console.log.apply(console,arguments)}catch(e){}},this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=e+arguments[0]),console.log.apply(console,arguments)}catch(e){}},this.tip_w=function(e){try{console.log("%c [UMENG] -- "+e,"background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;")}catch(e){}},this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=e+arguments[0]),console.log.apply(console,arguments)}catch(e){}},this.repeat=function(e){for(var t=e;t.length<86;)t+=e;return t}}return function(){return null===t&&(t=new i),t}}(),n=function(){var e=null;function t(){var e={};this.useOpenid=function(){return!!e.useOpenid},this.useSwanid=function(){return!!e.useSwanid},this.autoGetOpenid=function(){return!!e.autoGetOpenid},this.appKey=function(){return e.appKey},this.uploadUserInfo=function(){return e.uploadUserInfo},this.enableVerify=function(){return e.enableVerify},this.set=function(t){e=t},this.get=function(){return e},this.setItem=function(t,n){e[t]=n},this.getItem=function(t){return e[t]}}return function(){return e||(e=new t),e}}();function i(){}i.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var i=this;function r(){i.off(e,r),t.apply(n,arguments)}return r._=t,this.on(e,r,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var o=0,a=r.length;o<a;o++)r[o].fn!==t&&r[o].fn._!==t&&i.push(r[o]);return i.length?n[e]=i:delete n[e],this}};var r=new i;function o(){return qg}r.messageType={CONFIG_LOADED:0,UMA_LIB_INITED:1};var s=o(),a=new(function(){function e(){}return e.prototype.setStorage=function(e,t,n){s.setStorage?s.setStorage({key:e,value:t,success:function(){"function"==typeof n&&n(!0)},fail:function(){"function"==typeof n&&n(!1)}}):(localStorage.setItem(e,t),"function"==typeof n&&n(!0))},e.prototype.getStorage=function(e,n){if(s.getStorage)s.getStorage({key:e,success:function(e){"function"==typeof n&&n(e)},fail:function(r,i){t().w(e+"code = : "+i),"function"==typeof n&&n()}});else if(localStorage){var r=localStorage.getItem(e);"function"==typeof n&&n(r)}},e.prototype.removeStorage=function(e,t){s.deleteStorage?s.deleteStorage({key:e,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof t&&t(!1)}}):localStorage&&(localStorage.removeItem(e),"function"==typeof t&&t(!0))},e.prototype.getSystemInfo=function(e){s.getSystemInfo({success:function(t){var n={model:t.model,brand:t.brand,screenWidth:t.screenWidth,screenHeight:t.screenHeight,platform:t.osType,pixelRatio:t.pixelRatio,platformVersion:t.platformVersionCode,language:t.language,deviceName:t.model,OSVersion:t.osVersionName,resolution:"",statusBarHeight:t.statusBarHeight};if(t.system){var r=t.system.split(" ");Array.isArray(r)&&(!n.platform&&(n.platform=r[0]),!n.OSVersion&&(n.OSVersion=r[1]))}var i=Math.round(t.screenWidth*t.pixelRatio),o=Math.round(t.screenHeight*t.pixelRatio);n.resolution=i>o?i+"*"+o:o+"*"+i,"function"==typeof e&&e(n)},fail:function(){"function"==typeof e&&e()}})},e.prototype.getDeviceInfo=function(e){"function"==typeof e&&e("")},e.prototype.getNetworkInfo=function(e){s.getNetworkType({success:function(t){"function"==typeof e&&e({networkAvailable:"none"!==t.networkType,networkType:t.networkType})},fail:function(){"function"==typeof e&&e()}})},e.prototype.request=function(e){var t=e.success,n=e.fail,r=!1,i=null;e.success=function(e){r||(i&&clearTimeout(i),"function"==typeof t&&t(e))},e.fail=function(){r||(i&&clearTimeout(i),"function"==typeof n&&n(!1))},s.request?s.request(e):XMLHttpRequest&&function(e,t){void 0===t&&(t=!0),(e=e||{}).method=e.method||"GET",e.url=e.url||"",e.success=e.success||function(){},e.fail=e.fail||function(){};var n,r,i=new XMLHttpRequest,o=[];if("object"==typeof e.data){for(var a in e.data)o.push(a+"="+encodeURIComponent(e.data[a]));n=JSON.stringify(e.data||{}),r=o.join("&")}else"string"==typeof e.data&&(n=e.data,r=e.data);if("POST"===e.method?i.open(e.method,e.url,t):i.open(e.method,e.url+"?"+r||"",t),e.header&&"object"==typeof e.header){for(var s in e.header)i.setRequestHeader(s,e.header[s]);e.header["content-type"]||e.header["Content-Type"]||i.setRequestHeader("content-type","text/plain")}t&&(i.timeout=e.timeout||3e4),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var t={};try{t=JSON.parse(i.responseText)}catch(e){}e.success({data:t,status:i.status})}else 4==i.readyState&&e.fail({data:null,status:i.status})},"POST"===e.method?i.send(n||""):i.send()}(e,!0),i=setTimeout(function(){i&&clearTimeout(i),r=!0,"function"==typeof n&&n(r)},e.timeout||3e4)},e.prototype.getSdkType=function(){return this.getPlatform()+"mp"},e.prototype.getPlatform=function(){return"quickgame"},e.prototype.getUserInfo=function(e){e&&e()},e.prototype.getAppInfoSync=function(){return{}},e.prototype.onShareAppMessage=function(e){},e.prototype.shareAppMessage=function(e){},e.prototype.getContext=function(){return o()},e.prototype.getLaunchOptionsSync=function(){var e=null;if(e)return e;if(!s.getLaunchOptionsSync)return{};try{e=s.getLaunchOptionsSync()}catch(t){e=null}return e||{}},e}()),u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function c(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var p,f={SESSION_INTERVAL:3e4,LOG_URL:"/quickgamem_logs",GET_OPENID_URL:"",USERINFO_URL:"/uminiprogram_logs/comm/uif",ENDPOINT:"https://umini.shujupie.com",ENDPOINTB:"https://ulogs.umeng.com",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_DEFAULT_INTERVAL:15e3,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.7.1",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",PROVIDER:"um_provider",SWANID:"um_swanid",ANONYMOUSID:"um_anonymousid",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",USER_INFO:"user_info",IS_ALIYUN:!1},l={isNumber:function(e){return!Number.isNaN(parseInt(e,10))},compareVersion:function(e,t){for(var n=String(e).split("."),r=String(t).split("."),i=0;i<Math.max(n.length,r.length);i++){var o=parseInt(n[i]||0,10),a=parseInt(r[i]||0,10);if(o>a)return 1;if(o<a)return-1}return 0},getRandomStr:function(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],r=0;r<Number(e);r++)t+=n[Math.round(Math.random()*(n.length-1))];return t},clone:function(e){return JSON.parse(JSON.stringify(e))},startsWith:function(e,t){return!(!e||!t||0===t.length||t.length>e.length)&&e.substr(0,t.length)===t},endsWith:function(e,t){return!(!t||0===e.length||t.length>e.length)&&e.substring(e.length-t.length)===t},assign:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},deepEqual:function e(t,n){if(t===n)return!0;if(t&&"object"==typeof t&&n&&"object"==typeof n){if(Object.keys(t).length!==Object.keys(n).length)return!1;for(var r in t){if(Object.prototype.hasOwnProperty.call(n,r))return!1;if(!e(t[r],n[r]))return!1}return!0}return!1},trimStart:function(e,t){if(!e)return"";if("string"==typeof t&&t.length){var n=new RegExp("^"+t+"*");e=e.replace(n,"")}else e=e.replace(/^s*/,"");return e},trimEnd:function(e,t){if(!e)return"";var n,r;if("string"==typeof t&&t.length){for(n=new RegExp(t),r=e.length;n.test(e.charAt(r));)r-=1;return e.slice(0,r+1)}for(n=/s/,r=e.length-1;n.test(e.charAt(r));)r-=1;return e.slice(0,r+1)},isFunction:function(e){return"function"==typeof e}},d=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._openid="",t._unionid="",t._useOpenid=!1,t}return c(n,e),n.prototype.initID=function(e){var n=this;n._idType=n._useOpenid?"openid":"uuid",t().v("id type: ",n._idType),a.getStorage(f.UNIONID,function(e){n._unionid=e}),this._useOpenid?a.getStorage(f.OPENID,function(t){n._openid=t,e&&e()}):e&&e()},n.prototype.setUseOpenid=function(e){this._useOpenid=e},n.prototype.setOpenid=function(e){!this._openid&&e&&(this._openid=e,a.setStorage(f.OPENID,e))},n.prototype.setUnionid=function(e){!this._unionid&&e&&(this._unionid=e,a.setStorage(f.UNIONID,e))},n.prototype.getIdTracking=function(){var t=e.prototype.getIdTracking.call(this);return this._openid&&(t.openid=this._openid),this._unionid&&(t.unionid=this._unionid),this._userid&&(t.userid=this._userid),t},n.prototype.getId=function(){return this._useOpenid?this._openid:this._uuid},n}(function(){function e(){this._uuid="",this._userid="",this._provider="",this._idType=""}return e.prototype.createUUID=function(){return l.getRandomStr(10)+Date.now()+l.getRandomStr(7)+f.UUID_SUFFIX},e.prototype.initUUID=function(e){var t=this;a.getStorage(f.UUID,function(n){n?t._uuid=n:(t._uuid=t.createUUID(),a.setStorage(f.UUID,t._uuid)),e&&e(n)})},e.prototype.initUserid=function(){var e=this;a.getStorage(f.USERID,function(n){!e._userid&&n&&(e._userid=n,t().v("userId is ",n))}),a.getStorage(f.PROVIDER,function(n){!e._provider&&n&&(e._provider=n,t().v("provider is ",n))})},e.prototype.init=function(e){var t=this;t.initUUID(function(){t.initUserid(),t.initID(e)})},e.prototype.setUserid=function(e,t){!this._userid&&e&&(this._userid=e,this._provider=t,a.setStorage(f.USERID,e),a.setStorage(f.PROVIDER,t))},e.prototype.getUserId=function(){return this._userid},e.prototype.getProvider=function(){return this._provider},e.prototype.getIdType=function(){return this._idType},e.prototype.getIdTracking=function(){var e={};return this._uuid&&(e.uuid=this._uuid),this._userid&&(e.userid=this._userid),e},e}()),h=o(),g=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return c(n,e),n.prototype.getOpenIdAsync=function(e,n){var r=this;h.login({success:function(i){i.code?a.request({url:f.ENDPOINT+f.GET_OPENID_URL,method:"GET",data:{key:e,code:i.code},success:function(e){if(e&&200===e.statusCode&&e.data&&e.data.data){var t=e.data.data;return r.setOpenid(t.oid),r.setUnionid(t.uid),n&&n(!0)}n&&n()},fail:function(e){t().v("wx request failed...",e),n&&n()}}):n&&n()},fail:function(){n&&n()}})},n}(d),v=(p=null,function(){return p||(p=new g),p}),_=function(){var e=null;function t(){var e=!1,t=null,n=[];this.addPageStart=function(n){n&&!e&&(t={ts:Date.now(),path:n,page_name:n},e=!0)},this.addPageEnd=function(r){if(e&&r&&t&&r===t.page_name){var i=Date.now()-t.ts;t.duration=Math.abs(i),n.push(t),t=null,e=!1}},this.get=function(){return n},this.getCurrentPage=function(){return t},this.clear=function(){n.length=0}}return function(){return e||(e=new t),e}}(),y={},m=function(){var e=null,n=[],i="";function r(){return{add:function(e,r){t().v("share origin: %o",e);var o={title:e&&e.title,path:e&&e.path&&e.path.split("?")[0],_um_sts:Date.now()};o.path&&o.path.length>1&&l.startsWith(o.path,"/")&&(o.path=l.trimStart(o.path,"/"));var a=e.path||"",s=v().getId();if(s){var u=i.split(","),c=(u=u.filter(function(e){return e.length>0})).indexOf(s);c>=0&&(u=u.slice(0,c)),u.length<3&&u.push(s);var f=u.join(",");-1!==a.indexOf("?")?a+="&_um_ssrc="+f:a+="?_um_ssrc="+f;var p=Date.now();if(a+="&_um_sts="+p,r){var d=function(e){var t=[];for(var n in e)"_um_ssrc"!==n&&"_um_sts"!==n&&t.push(n+"="+e[n]);return t.join("&")}(y),h=d?d+"&_um_ssrc="+f+"&_um_sts="+p:"_um_ssrc="+f+"&_um_sts="+p;e.query=e.query?e.query+"&_um_ssrc="+f+"&_um_sts="+p:h}else e.path=a;o._um_ssrc=f,o._um_sts=p}return n.push(o),t().v("share: %o",e),e},setShareSource:function(e){i=e},clear:function(){n.length=0},get:function(){return n}}}return function(){return e||(e=new r),e}}(),S=function(e){if(e)try{return JSON.stringify(e)}catch(e){}return""},I=function(e){if(e)try{return JSON.parse(e)}catch(e){}return null},O=function(){var e=null,t="",r=null,i=!1;function o(){this.load=function(e){r?(a.removeStorage(t),e()):(t="um_cache_"+n().appKey(),a.getStorage(t,function(n){r=I(n)||{},i=!0,a.removeStorage(t),e()}))},this.save=function(){r&&a.setStorage(t,S(r))},this.set=function(e,t){r&&(r[e]=t)},this.get=function(e){return(r||{})[e]},this.remove=function(e){r&&r[e]&&delete r[e]},this.getAll=function(){return r},this.clear=function(){r=null},this.has=function(e){return!!this.get(e)},this.isLoaded=function(){return i}}return function(){return e||(e=new o),e}}(),E=function(){var e,n,r=[],i=[];function s(e,t){var r=(e=e||{})[n];return Array.isArray(r)&&r.length?e[n]=r.concat(t):e[n]=[].concat(t),e}return function(){return e||(e={addEvent:function(e){n?(r.unshift(e),r.length>1&&(!function(){if(r.length){var e=O().get("ekvs");(function(e){var t=0;for(var n in e)Array.isArray(e[n])&&(t+=e[n].length);return t})(e)+r.length<=1e4&&(e=s(e,r),O().set("ekvs",e))}}(),r.length=0)):(t().w("session id is null: ",n),i.unshift(e))},setSessionId:function(e){if(n=e,t().v("setSessionId: ",n),Array.isArray(i)&&i.length&&n){for(var r=0;r<i.length;r++)this.addEvent(i[r]);i.length=0}},getEkvs:function(){var e=O().get("ekvs");return r&&r.length&&(e=s(e,r)),e},clear:function(){O().remove("ekvs"),r.length=0}}),e}}(),T="2g",N="3g",A="4g",k="half_session",b="close_session",D="ekv",w=["access","access_subtype"],R=function(){var e=null;function t(){var e=!1,t={};return{init:function(){!function(e){var r=O().get(f.IMPRINT);r&&(t.imprint=r),t.device_type="Phone",t.sdk_version=f.IMPL_VERSION,t.appkey=n().appKey(),a.getDeviceInfo(function(e){t.device_info=e||""});var i=a.getAppInfoSync();t.appid=i.appId,t.app_env=i.appEnv,t.app_version=i.appVersion,a.getSystemInfo(function(n){a.getNetworkInfo(function(r){var i=function(e,t){var n={};(e=e||{}).safeArea=e.safeArea||{};var r=(t=t||{}).networkType;"none"===r&&(r="unknown");var i=e.model||"",o=e.platform||"",s=e.brand||"",u=s.toLowerCase();switch(n.sdk_type=a.getSdkType(),n.platform=a.getPlatform(),n.platform_sdk_version=e.platformSDKVersion,n.platform_version=e.platformVersion,n.resolution=e.resolution,n.pixel_ratio=e.pixelRatio,n.os=o,n.font_size_setting=e.fontSizeSetting,n.device_model=i,n.device_brand=s,n.device_manufacturer=u,n.device_manuid=i,n.device_name=i,n.os_version=e.OSVersion,n.language=e.language,n.theme=e.theme,n.benchmark_level=e.benchmarkLevel,n.status_bar_height=e.statusBarHeight,n.safe_area_top=e.safeArea.top,n.safe_area_left=e.safeArea.left,n.safe_area_right=e.safeArea.right,n.safe_area_bottom=e.safeArea.bottom,n.safe_area_height=e.safeArea.height,n.safe_area_width=e.safeArea.width,n.storage=e.storage,n.screen_width=e.screenWidth,n.screen_height=e.screenHeight,n.host=e.host,r=r?r.toLowerCase():""){case A:n.access_subtype="LTE",n.access="4G";break;case N:n.access_subtype="CDMA",n.access="3G";break;case T:n.access_subtype="GRPS",n.access="2G";break;default:n.access=r,delete n.access_subtype}return n}(n,r);l.assign(t,i),e&&e()})})}(function(){e=!0})},isLoaded:function(){return e},get:function(){return t},getRealtimeFields:function(){var e={};return w.forEach(function(n){e[n]=t[n]}),e},setIdTracking:function(e){this.setItem("id_tracking",e)},setIdType:function(e){this.setItem("id_type",e)},setAppVersion:function(e){this.setItem("app_version",e)},setSuperProperty:function(e){t.sp||(t.sp={}),t.sp.isv=e},getSuperProperty:function(){return t&&t.sp?t.sp.isv:""},setItem:function(e,n){t[e]=n},getItem:function(e){return t[e]}}}return{instance:function(){return e||(e=t()),e}}}(),U=function(){var e=null,n=null,r=null;return function(){return e||(e={resume:function(e){var i=!1;r||(r=O().get(f.CURRENT_SESSION));var o=new Date;return n=o.getTime(),!r||!r.end_time||n-r.end_time>f.SESSION_INTERVAL?(i=!0,function(e){try{var n=(r||{}).options||{},i=l.assign({},function(e){var n={};for(var r in e)0===r.indexOf("_um_")&&(n[r]=e[r]);return t().v("query: ",e),t().v("_um_params: ",n),n}(e.query));i.path=e.path||n.path,i.scene=e.scene?a.getPlatform()+"_"+e.scene:n.scene;var o=e.referrerInfo;o&&(i.referrerAppId=o.appId),t().v("session options: ",i);var s=i[f.UM_SSRC];s&&m().setShareSource(s);var u=Date.now();r={id:l.getRandomStr(10)+u,start_time:u,options:i}}catch(e){t().e("生成新session失败: ",e)}}(e),t().v("开始新的session(%s): ",r.id,r)):t().v("延续上一次session(%s): %s ",r.id,o.toLocaleTimeString(),r),i},pause:function(){!function(){if(r){var e=new Date;r.end_time=e.getTime(),"number"!=typeof r.duration&&(r.duration=0),r.duration=r.end_time-n,O().set(f.CURRENT_SESSION,r),t().v("退出会话(%s): %s ",r.id,e.toLocaleTimeString(),r)}}()},getCurrentSessionId:function(){return(r||{}).id},getCurrentSession:function(){return r},cloneCurrentSession:function(){return l.clone(r)}}),e}}();function P(e){var t=null;switch(e){case k:t=function(){var e=null,t=U().cloneCurrentSession();return t&&(e={header:{st:"1"},analytics:{sessions:[t]}}),e}();break;case b:t=function(){var e=null,t={},n=U().cloneCurrentSession();if(n){var r=_().get(),i=m().get();Array.isArray(r)&&r.length&&(n.pages=l.clone(r)),Array.isArray(i)&&i.length&&(n.shares=l.clone(i)),_().clear(),m().clear(),t.sessions=[n]}var o=E().getEkvs();return o&&(t.ekvs=l.clone(o),E().clear()),(t.sessions||t.ekvs)&&(e={analytics:t}),e}();break;case D:t=function(){var e=null,t=E().getEkvs();return t&&(e={analytics:{ekvs:l.clone(t)}},E().clear()),e}()}return t}var C={sessions:"sn",ekvs:"e",active_user:"active_user"},L={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl",testToken:"ttn",theme:"t5",benchmark_level:"bml",screen_width:"sw",screen_height:"sh",status_bar_height:"sbh",safe_area_top:"sat",safe_area_left:"sal",safe_area_right:"sar",safe_area_bottom:"sab",safe_area_height:"sah",safe_area_width:"saw",pixel_ratio:"pr",storage:"s7",host:"hs"},M={uuid:"ud",unionid:"und",openid:"od",anonymousid:"nd",alipay_id:"ad",device_id:"dd",userid:"puid"};function j(e,t){var n=V(e,t);return e&&e.id_tracking&&(n[t.id_tracking||"id_tracking"]=V(e.id_tracking,M)),n}function V(e,t){var n={};for(var r in e)t[r]?n[t[r]]=e[r]:n[r]=e[r];return n}function x(e,t){var n={};if(e)for(var r in e)e[r]&&(n[t[r]]=e[r]);return n}var q="";function G(){return q}var F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",H=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(F),K=String.fromCharCode,Y=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?K(192|t>>>6)+K(128|63&t):K(224|t>>>12&15)+K(128|t>>>6&63)+K(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return K(240|t>>>18&7)+K(128|t>>>12&63)+K(128|t>>>6&63)+K(128|63&t)},J=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,X=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[F.charAt(n>>>18),F.charAt(n>>>12&63),t>=2?"=":F.charAt(n>>>6&63),t>=1?"=":F.charAt(63&n)].join("")},B=function(e){return function(e){return e.replace(J,Y)}(e).replace(/[\s\S]{1,3}/g,X)},W=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),z=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return K(55296+(t>>>10))+K(56320+(1023&t));case 3:return K((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return K((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},Q=function(e){var t=e.length,n=t%4,r=(t>0?H[e.charAt(0)]<<18:0)|(t>1?H[e.charAt(1)]<<12:0)|(t>2?H[e.charAt(2)]<<6:0)|(t>3?H[e.charAt(3)]:0),i=[K(r>>>16),K(r>>>8&255),K(255&r)];return i.length-=[0,0,2,1][n],i.join("")},Z=function(e){return function(e){return e.replace(/[\s\S]{1,4}/g,Q)}(e).replace(W,z)},$=function(e,t){return t?B(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):B(String(e))},ee=function(e){return Z(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},te=new function(){var e="",t=this;this.set=function(t){e=t},this.get=function(){return e},this.getImpObj=function(){return I(ee(e))},this.getItem=function(e){var n=t.getImpObj();return n&&n[e]||""},this.load=function(){e=O().get(f.IMPRINT)},this.save=function(){e&&O().set(f.IMPRINT,e)}};function ne(e,n,r,i){R.instance().setIdType(v().getIdType()),R.instance().setIdTracking(v().getIdTracking());var o=v().getUserId();o&&e.analytics&&(e.analytics.active_user={puid:o,provider:v().getProvider()});var s=l.clone(R.instance().get());e.header=l.assign(s,e.header,{ts:Date.now(),testToken:G(),traceId:l.getRandomStr(10)+Date.now()+l.getRandomStr(9)});var u=function(e){return{h:j(e.header,L),a:x(e.analytics,C)}}(e),c=S(u),p={url:f.ENDPOINT+f.LOG_URL,method:"POST",data:$(c),success:function(i){var o=i.code||i.status||i.statusCode;200===o||413===o?(t().i("数据发送成功: ",e,c),function(e){e&&(R.instance().setItem(f.IMPRINT,e),te.set(e),te.save(),t().v("imprint: ",te.getImpObj()),te.getItem("ttn_invalid")&&(q=""))}((i.data||{}).imprint),"function"==typeof n&&n(i)):(t().w("数据发送失败: ",c),"function"==typeof r&&r())},fail:function(e){t().w("超时: ",c),"function"==typeof r&&r()},complete:function(){"function"==typeof i&&i()}};a.request(l.assign(p,{header:{"content-type":"text/plain","Msg-Type":a.getSdkType()+"/json"}}))}function ie(e){var t=e,n=[];this.enqueue=function(e){"number"==typeof t&&this.size()>=t&&this.dequeue(),n.push(e)},this.dequeue=function(){return n.shift()},this.front=function(){return n[0]},this.isEmpty=function(){return 0===n.length},this.clear=function(){n.length=0},this.size=function(){return n.length},this.items=function(){return n},this.print=function(){console.log(n.toString())}}var re=function(){var e=null,n=!1,r=[],i=new ie(50);function a(e){v().getId()?n?t().i("队列正在发送中"):(n=!0,function s(e){var t=i.front();t?ne(t,function(){i.dequeue(),s(e)},function(){var t=i.dequeue();t&&!t.noCache&&r.push(t),s(e)}):(r.forEach(function(e){i.enqueue(e)}),r.length=0,e())}(function(){n=!1,"function"==typeof e&&e()})):(t().i("获取id标识失败，暂缓发送"),"function"==typeof e&&e())}function u(){this.send=function(e,t,n){e?this.add(e,t,function(){a(n)}):a(n)},this.add=function(e,t,n){!function o(e,t,n){if(R.instance().isLoaded()){t=t||{};var r=P(e);if(r){var a=R.instance().getRealtimeFields();r.header=l.assign({},r.header,a),r.noCache=t.noCache,i.enqueue(r)}"function"==typeof n&&n()}else setTimeout(function(){o(e,t,n)},100)}(e,t,n)},this.load=function(){var e=O().get(f.REQUESTS);e&&e.length&&e.forEach(function(e){i.enqueue(e)}),O().remove(f.REQUESTS)},this.save=function(){O().set(f.REQUESTS,l.clone(i.items())),i.clear()}}return function(){return e||(e=new u),e}}(),oe=function(){var i=null,o=null;function r(){function e(e){if(e&&"object"==typeof e){var r=O().get(f.USER_INFO);return r&&l.deepEqual(e,r)||function(e,r){var i=n().appKey(),o=a.getSdkType(),s=v().getId(),u=v().getIdType();if(i&&o&&s&&u){var c={ak:n().appKey(),sdt:a.getSdkType(),uin:e.nickName,uia:e.avatar||e.avatarUrl,uig:e.gender,uit:e.country,uip:e.province,uic:e.city,uil:e.language,id:v().getId(),it:v().getIdType(),age:e.age,cln:e.constellation},p=JSON.stringify(c);p=$(p),a.request({url:f.ENDPOINT+f.USERINFO_URL,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:"ui="+p,success:function(n){t().v("用户信息上传成功: ",e),r&&r(n&&n.data&&200===n.data.code)},fail:function(){t().e("用户信息上传失败: ",e),r&&r(!1)}})}}(e,function(t){t&&O().set(f.USER_INFO,e)}),!0}return!1}this.setUserInfo=function(e){o=e},this.update=function(){e(o)||a.getUserInfo(function(t){e(t)})}}return function(){return i||(i=new r),i}}();function se(e,t){this.id=e,this.ts=Date.now();var n=typeof t;if("string"===n&&t)this[e]=t;else if("object"===n)for(var r in t)({}).hasOwnProperty.call(t,r)&&(this[r]=t[r])}function ae(){var e=!1,r=!1,i=0;this.init=function(r){t().v("sdk version: "+f.IMPL_VERSION),e?t().v("Lib重复实例化"):O().load(function(){t().v("cache初始化成功: ",O().getAll()),v().setUseOpenid&&v().setUseOpenid(n().useOpenid()),v().init(function(){R.instance().init(),t().v("Header初始化成功")}),e=!0,"function"==typeof r&&r(),t().tip("SDK集成成功")})},this.resume=function(i){var o;e&&!r&&(t().v("showOptions: ",i),r=!0,n().enableVerify()&&i&&i.query&&(o=i.query._ttn,q=o||q),this._resume(i))},this._resume=function(e){re().load();var r=U().resume(e),i=U().getCurrentSessionId();E().setSessionId(i),r&&re().add(k,{},function(){v().setUseOpenid&&v().setUseOpenid(n().useOpenid()),n().useOpenid()&&n().autoGetOpenid()&&!v().getId()?(t().v("get id async"),function o(e,r){v().getId()||e<=0||v().getOpenIdAsync(n().appKey(),function(n){n?(t().v("获取id成功"),re().send()):(t().v("获取openid失败,启动重试,剩余可用次数",e-1),setTimeout(function(){o(e-1,r)},r))})}(10,3e3)):(t().v("session auto send"),re().send())})},this.pause=function(o){e&&(r=!1,i=0,U().pause(),n().uploadUserInfo()&&oe().update(),re().send(b,{},function(){re().save(),O().save(),t().v("cache save success"),"function"==typeof o&&o()}))},this.setOpenid=function(e){t().v("setOpenId: %s",e),v().setOpenid(e),re().send()},this.setUnionid=function(e){t().v("setUnionid: %s",e),v().setUnionid(e)},this.setUserid=function(e,n){t().v("setUserid: %s",e,n),v().setUserid(e,n)},this.setUserInfo=function(e){t().v("setUserInfo: %s",e),oe().setUserInfo(e)},this.setAnonymousid=function(e){t().v("setAnonymousId: %s",e),v().setAnonymousid(e),re().send()},this.setAppVersion=function(e){e&&"string"!=typeof e?t().w("setAppVersion方法只接受字符串类型参数"):R.instance().setAppVersion(e)},this.setAlipayUserid=function(e){e&&"string"!=typeof e?t().w("setAlipayUserid方法只接受字符串类型参数"):(t().v("setAlipayUserid: %s",e),v().setAlipayUserid(e))},this.setDeviceId=function(e){if("string"==typeof e)return v().setDeviceId(e),e},this.setSuperProperty=function(e){if(e&&"string"!=typeof e)t().w("超级属性只支持字符串类型");else{var n=this;R.instance().getSuperProperty()!==e&&(R.instance().setSuperProperty(e),n.pause(function(){n.resume()}))}},this.trackEvent=function(n,r){if(e&&(t().v("event: ",n,r),function(e,n){if(!e||"string"!=typeof e)return t().e('please check trackEvent id. id should be "string" and not null'),!1;var r=["id","ts","du"],i={};if(r.forEach(function(e){i[e]=1}),i[e])return t().e("eventId不能与以下保留字冲突: "+r.join(",")),!1;if(e.length>f.MAX_EVENTID_LENGTH)return t().e("The maximum length of event id shall not exceed "+f.MAX_EVENTID_LENGTH),!1;if(n&&("object"!=typeof n||Array.isArray(n))&&"string"!=typeof n)return t().e("please check trackEvent properties. properties should be string or object(not include Array)"),!1;if("object"==typeof n){var o=0;for(var a in n)if({}.hasOwnProperty.call(n,a)){if(a.length>f.MAX_PROPERTY_KEY_LENGTH)return t().e("The maximum length of property key shall not exceed "+f.MAX_PROPERTY_KEY_LENGTH),!1;if(o>=f.MAX_PROPERTY_KEYS_COUNT)return t().e("The maximum count of properties shall not exceed "+f.MAX_PROPERTY_KEYS_COUNT),!1;if(i[a])return t().e("属性中的key不能与以下保留字冲突: "+r.join(",")),!1;o+=1}}return!0}(n,r))){var o=new se(n,r);E().addEvent(o);var a=!!G(),s=a?0:f.EVENT_SEND_DEFAULT_INTERVAL,u=Date.now();("number"!=typeof i||"number"!=typeof s||i<=0||u-i>s)&&(i=u,re().send(D,{noCache:a},function(){}))}},this.trackShare=function(n){if(e)try{a.getSdkType().indexOf("game")>-1?(n=m().add(n,!0),t().v("shareQuery: ",n)):(n=m().add(n,!1),t().v("sharePath: ",n.path))}catch(e){t().v("shareAppMessage: ",e)}return n},this.trackPageStart=function(t){e&&_().addPageStart(t)},this.trackPageEnd=function(t){e&&_().addPageEnd(t)},this.onShareAppMessage=function(e){var t=this;a.onShareAppMessage(function(){return t.trackShare(e())})},this.shareAppMessage=function(e){this.trackShare(e),a.shareAppMessage(e)}}var ue=[];function ce(){}ce.prototype={createMethod:function(e,n,r){try{e[n]=r&&r[n]?function(){return r[n].apply(r,arguments)}:function(){ue.push([n,[].slice.call(arguments)])}}catch(e){t().v("create method errror: ",e)}},installApi:function(e,n){try{var r,i,o="resume,pause,trackEvent,trackPageStart,trackPageEnd,trackShare,setUserid,setOpenid,setUnionid,onShareAppMessage,shareAppMessage,setUserInfo".split(",");for(r=0,i=o.length;r<i;r++)this.createMethod(e,o[r],n);if(n)for(r=0,i=ue.length;r<i;r++){var a=ue[r];try{n[a[0]].apply(n,a[1])}catch(e){t().v("impl[v[0]].apply error: ",a[0],e)}}}catch(e){t().v("install api errror: ",e)}}};var fe=[f.ENDPOINT,f.ENDPOINTB];function pe(e,n){var r,i;if(0===e||1===e&&n?r=f.ENDPOINT:2===e&&n?r=f.ENDPOINTB:n&&(r=fe[e]),e>=fe.length||n)return n&&(i=r,f.ENDPOINT=i),n&&t().v("命中可用服务",r),!n&&t().tip_w("未命中可用服务"),!1;a.request({url:f.ENDPOINT+"/uminiprogram_logs/ckdh",success:function(t){200===(t.code||t.status||t.statusCode)&&t.data&&200===t.data.code?pe(e+1,!0):pe(e+1,!1)},fail:function(){pe(e+1,!1)}})}!function(e){f.ENDPOINTB&&setTimeout(function(){pe(0,!1)},e)}(3e3);var le=new ce,de={_inited:!1,_log:t(),preinit:function(e){if(e&&"object"==typeof e)for(var t in e)f[t]=e[t];return f},use:function(e,t){return e&&l.isFunction(e.install)?e.install(de,t):l.isFunction(e)&&e(de,t),de},messager:r,init:function(e){if(this._inited)t().v("已经实例过，请避免重复初始化");else if(e)if(e.appKey){"boolean"!=typeof e.useOpenid&&(e.useOpenid=!0),n().set(e),t().setDebug(e.debug),this._inited=!0;var i=this;r.emit(r.messageType.CONFIG_LOADED,e);try{var o=new ae;t().v("成功创建Lib对象"),o.init(function(){t().v("Lib对象初始化成功"),le.installApi(i,o),t().v("安装Lib接口成功"),r.emit(r.messageType.UMA_LIB_INITED,e)})}catch(e){t().w("创建Lib对象异常: "+e)}}else t().err("请确保传入正确的appkey");else t().err("请正确设置相关信息！")}};try{le.installApi(de,null)}catch(e){t().w("uma赋值异常: ",e)}var he="https://ucc.umeng.com/v1/mini/fetch",ge="https://pslog.umeng.com/mini_ablog",ve="2.7.1",_e="none",ye={},me=Array.isArray;ye.isArray=me||function(e){return"[object Array]"===toString.call(e)},ye.isObject=function(e){return e===Object(e)&&!ye.isArray(e)},ye.isEmptyObject=function(e){if(ye.isObject(e)){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0}return!1},ye.isUndefined=function(e){return void 0===e},ye.isString=function(e){return"[object String]"===toString.call(e)},ye.isDate=function(e){return"[object Date]"===toString.call(e)},ye.isNumber=function(e){return"[object Number]"===toString.call(e)},ye.each=function(e,t,n){if(null!=e){var r={},i=Array.prototype.forEach;if(i&&e.forEach===i)e.forEach(t,n);else if(e.length===+e.length){for(var o=0,a=e.length;o<a;o++)if(o in e&&t.call(n,e[o],o,e)===r)return}else for(var s in e)if(hasOwnProperty.call(e,s)&&t.call(n,e[s],s,e)===r)return}},ye.buildQuery=function(e,t){var n,r,i=[];return void 0===t&&(t="&"),ye.each(e,function(e,t){n=encodeURIComponent(e.toString()),r=encodeURIComponent(t),i[i.length]=r+"="+n}),i.join(t)},ye.JSONDecode=function(e){if(e){try{return JSON.parse(e)}catch(e){console.error("JSONDecode error",e)}return null}},ye.JSONEncode=function(e){try{return JSON.stringify(e)}catch(e){console.error("JSONEncode error",e)}};var Se=Object.create(null);function Ie(e){t().v("开始构建 fetch body"),a.getSystemInfo(function(t){a.getNetworkInfo(function(r){var i=(r=r||{}).networkType;i=i===_e?"unknown":i.toUpperCase(),Se.access=i,function(e,t){var r=e.brand||"";if(Se.deviceType="Phone",Se.sdkVersion=ve,Se.appkey=n().appKey(),Se.sdkType=a.getSdkType(),Se.umid=v().getId(),e){Se.language=e.language||"",Se.os=e.OS,Se.osVersion=e.OSVersion,Se.deviceName=e.deviceName,Se.platformVersion=e.platformVersion,Se.platformSdkVersion=e.platformSDKVersion,Se.deviceBrand=r;var i=e.resolution.split("*");ye.isArray(i)&&(Se.resolutionHeight=Number(i[0]),Se.resolutionWidth=Number(i[1]))}!function(e){e&&(Se.installTime=e.install_datetime&&Date.parse(e.install_datetime),Se.scene=e.install_scene,Se.channel=e.install_channel,Se.campaign=e.install_campaign)}(te.getImpObj()),t&&t(Se)}(t,e)})})}var Oe=Object.create(null),Ee=null,Te=!1,Ne={minFetchIntervalSeconds:43200};function Ae(e){e&&ye.each(e,function(e){Oe[e.k]=e})}function ke(){var e=this;this.STORAGE_NAME=null,r.once(r.messageType.CONFIG_LOADED,function(n){t().v("云配初始化开始..."),e.init(n)})}ke.prototype={setDefaultValues:function(e){Te&&ye.isObject(e)&&ye.each(e,function(e,t){Oe[t]&&Oe[t].v||(Oe[t]={v:e})})},getValue:function(e){t().v("从配置项中读取 value, 当前配置为: ",Oe),t().v("待读取的 key : ",e);try{if(!Te)return;var r=Oe[e]||{};return t().v("读取相应配置ing..., 结果为: ",r),ye.isNumber(r.e)&&ye.isNumber(r.g)&&(t().v("读取到相应配置, 开始数据上报..."),function(e){var r={appkey:n().appKey(),sdkType:a.getSdkType(),expId:e&&e.e,groupId:e&&e.g,clientTs:Date.now(),key:e&&e.k,value:e&&e.v,umid:v().getId()};try{a.request({url:ge,method:"POST",data:[r],success:function(e){e&&200===e.statusCode?t().v("上传数据成功",r):t().w("ablog 请求成功, 返回结果异常 ",e)},fail:function(e){t().w("ablog 请求数据错误 ",r,e)}})}catch(e){t().w("urequest 调用错误",e)}}(r)),r.v}catch(n){t().w("getValue error, key: ",e)}},active:function(e){try{if(!Te)return;var n,r;e&&e.params&&(n=e.params),e&&e.callback&&(r=e.callback),t().v("激活配置项: ",n),n?(t().v("本地已缓存的配置项: ",Oe),Ae(n),t().v("合并后的配置项: ",Oe),r&&r(Oe),t().v("active 结束")):(t().v("配置项为空!! 读取本地配置..."),a.getStorage(this.STORAGE_NAME,function(e){e?(Ae((e=ye.JSONDecode(e)||{}).params),t().v("当前本地配置项为: ",Oe),r&&r(Oe),t().v("active 结束")):t().v("当前本地配置项为空, 退出激活")}))}catch(e){t().w("SDK active 错误",e)}},init:function(e){e.appKey&&(Ee=e.appKey,this.STORAGE_NAME="um_remote_config_{{"+Ee+"}}"),Ee?Te?t().w("SDK 已经初始化, 请避免重复初始化"):(Te=!0,this.setOptions(e),this.active()):t().err("请检查您的小程序 appKey, appKey 不能为空")},setOptions:function(e){if(ye.isObject(e)){var t=e.minFetchIntervalSeconds;ye.isNumber(t)&&(Ne.minFetchIntervalSeconds=Math.max(t,5))}},fetch:function(e){if(Te&&this.STORAGE_NAME){var n,r;e&&e.active&&(n=e.active),e&&e.callback&&(r=e.callback);var i=this;a.getStorage(this.STORAGE_NAME,function(e){t().v("开始读缓存 data is ",e),(e=ye.JSONDecode(e)||{}).params&&e.ts&&Date.now()-e.ts<1e3*Ne.minFetchIntervalSeconds?(t().v("缓存数据存在, 并且本次触发时间距离上次fetch触发时间未超过 fetch 时间间隔, 无需 fetch"),r&&r(e.params)):Ie(function(e){t().v("缓存数据不存在, 构建 fetch body :",e);try{a.request({url:he,method:"POST",data:e,success:function(e){if(e&&200===e.statusCode&&e.data&&e.data.cc){t().v("fetch 请求成功, 响应数据: ",e.data);var o=Object.create(null);ye.each(e.data.cc,function(e){o[e.k]=e});var s={ts:Date.now(),params:o};t().v("开始缓存 fetch 请求的云配置结果..."),a.setStorage(i.STORAGE_NAME,ye.JSONEncode(s),function(e){t().v("缓存云配置成功, 缓存数据为: ",s),t().v("缓存云配置成功, 成功消息为: ",e),t().v("云配拉取数据是否自动激活: ",n),e&&n&&(t().v("激活云配置..."),i.active({params:o,callback:r}))})}else t().w("fetch 请求成功,返回结果异常 ",e.data),r&&r()},fail:function(n){t().w("fetch请求数据错误 ",e,n),r&&r()}})}catch(e){t().w("urequest调用错误",e)}})})}}};var be={install:function(e,t){return e.rc||(e.rc=new ke),e.messager.once(e.messager.messageType.CONFIG_LOADED,function(){e._log.v("plugin rc installed")}),e.rc}},De="_um",we="revenue",Re="stage",Ue="level",Pe="running",Ce="end",Le="init",Me="set",je=[De,Re,"start"].join(".");function Ve(e){var t={};for(var n in e){var r=e[n];if("object"==typeof r)for(var i in r)t[n+"."+i]=r[i];else t[n]=r}return t}var xe={install:function(e,t){e.revenue=function(t){e.trackEvent([De,we,t.group].join("."),Ve(t))};var n=0;return e.stage={onStart:function(t){n=Date.now(),e.trackEvent(je,Ve(t))},onEnd:function(t){"number"!=typeof t._um_sdu&&(t._um_sdu=0!==n?Date.now()-n:0),e.trackEvent([De,Re,Ce,t.event].join("."),Ve(t))},onRunning:function(t){e.trackEvent([De,Re,Pe,t.event].join("."),Ve(t))}},e.level={onInitLevel:function(t){e.trackEvent([De,Ue,Le].join("."),Ve(t))},onSetLevel:function(t){e.trackEvent([De,Ue,Me].join("."),Ve(t))}},e.messager.once(e.messager.messageType.CONFIG_LOADED,function(){e._log.v("plugin game-ext installed")}),e}},qe=a.getContext();qe.onShow(function(e){var n;t().v("game onShow: ",e),n=e.query,y=n,de.resume(e,!0)}),qe.onHide(function(){t().v("game onHide"),de.pause()});var Ge=de.init;de.init=function(e){e&&e.useOpenid&&(t().tip_w(t().repeat("!")),t().tip_w("您选择了使用openid进行统计，请确保使用setOpenid回传openid或通过设置autoGetOpenid为true，并在友盟后台设置secret由友盟帮您获取"),t().tip_w(t().repeat("!"))),de.resume({}),Ge.call(de,e)},de.use(be),de.use(xe),qe.uma=de;export default de;